

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>NAT &mdash; Patrick&#39;s Docuhub a documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'a',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/js/custom.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Device Discovery Management &amp; Maintenance" href="lldpAndLicensing.html" />
    <link rel="prev" title="DHCP" href="dhcp.html" />
    <link href="../../../_static/mylayout.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Patrick's Docuhub
          

          
          </a>

          
            
            
              <div class="version">
                2019-07-14
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../cheatsheets.html">cheatsheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../commands.html">commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripting.html">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../diagrams.html">Diagrams in Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python.html">python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cumulocity.html">cumulocity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../server.html">debian server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workstation.html">workstation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../vim.html">VIM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../git.html">GIT</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../inhoud.html">Routing/Switching</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="inhoud.html">basics</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="connect2console.html">Connect to console</a></li>
<li class="toctree-l3"><a class="reference internal" href="routingConcepts.html">Routing Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="staticRouting.html">Static Routes</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamicRouting.html">Dynamic Routing</a></li>
<li class="toctree-l3"><a class="reference internal" href="switchedNetworks.html">switched networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="switchConfiguration.html">Switch Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="vlans.html">VLANS</a></li>
<li class="toctree-l3"><a class="reference internal" href="acl.html">ACLs</a></li>
<li class="toctree-l3"><a class="reference internal" href="dhcp.html">DHCP</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">NAT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#nat-border">NAT Border</a></li>
<li class="toctree-l4"><a class="reference internal" href="#types-of-nat-addresses">Types of NAT Addresses</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nat-address-terminology">NAT Address Terminology</a></li>
<li class="toctree-l4"><a class="reference internal" href="#static-nat">Static NAT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-nat">Dynamic NAT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pat-aka-nat-overload">PAT aka NAT Overload</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nat-vs-pat">NAT vs PAT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nat-advantages">NAT Advantages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nat-disadvantages">NAT Disadvantages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-static-nat">Configuring Static NAT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#static-nat-process">Static NAT Process</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-static-nat-exercise">Configure Static NAT exercise</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-nat-operation">Dynamic NAT operation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-dynamic-nat">Configuring Dynamic NAT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-nat-example">Dynamic NAT example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-nat-process">Dynamic NAT process</a></li>
<li class="toctree-l4"><a class="reference internal" href="#clearing-nat-translations">Clearing NAT Translations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-dynamic-nat-exercise">Configure Dynamic NAT exercise</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-dynamic-static-nat-lab">Configure Dynamic &amp; Static NAT Lab</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-pat-nat-overload">Configuring PAT (NAT overload)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pat-analysis">PAT analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pt-implementing-static-dynamic-nat">PT Implementing Static &amp; Dynamic NAT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-pat-nat-lab">Configure PAT NAT Lab</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-forwarding">Port Forwarding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nat-for-ipv6">NAT for IPv6?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ipv6-unique-local-address-ula">IPv6 Unique Local Address ULA</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">NAT for IPv6</a></li>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting-nat">Troubleshooting NAT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pt-troubleshooting-nat-ex1">PT Troubleshooting NAT ex1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lab-troubleshooting-nat">LAB Troubleshooting NAT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ch9-skills-integration-test-assignment">Ch9 Skills Integration Test - assignment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ch9-skills-integration-test-when-opened-with-pt-7-0-on-windos">Ch9 Skills Integration Test - when opened with PT 7.0 on windos</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ch9-practice-exam">Ch9 practice exam</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lldpAndLicensing.html">Device Discovery Management &amp; Maintenance</a></li>
<li class="toctree-l3"><a class="reference internal" href="finals.html">routing n switching basics finals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sn/inhoud.html">scaling networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sdn/inhoud.html">Open Daylight</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sdn/gns3server.html">Setting up a GNS3 server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../storage/storage.html">Storage</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Patrick's Docuhub</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../inhoud.html">Routing/Switching</a> &raquo;</li>
        
          <li><a href="inhoud.html">basics</a> &raquo;</li>
        
      <li>NAT</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/nw/rns/basics/nat.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="nat">
<h1>NAT<a class="headerlink" href="#nat" title="Permalink to this headline">¶</a></h1>
<div class="section" id="nat-border">
<h2>NAT Border<a class="headerlink" href="#nat-border" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_NAT_border.png" src="../../../_images/Ch9_NAT_border.png" />
<p>NAT has many uses, but its primary use is to conserve public IPv4 addresses. It does this by allowing networks to use private IPv4 addresses internally and providing translation to a public address only when needed. NAT has an added benefit of adding a degree of privacy and security to a network, because it hides internal IPv4 addresses from outside networks.</p>
<p>NAT-enabled routers can be configured with <strong>one or more valid public IPv4 addresses</strong>. These public addresses are known as the <strong>NAT pool</strong>. When an internal device sends traffic out of the network, the <strong>NAT-enabled router translates the internal IPv4 address of the device to a public address from the NAT pool</strong>. To outside devices, all traffic entering and exiting the network appears to have a public IPv4 address from the provided pool of addresses.</p>
<p>A NAT router typically operates at the border of a stub network. A stub network is a network that has a single connection to its neighboring network, one way in and one way out of the network. In the example in the figure, R2 is a border router. As seen from the ISP, R2 forms a stub network.</p>
<p>When a device inside the stub network wants to communicate with a device outside of its network, the packet is forwarded to the border router. The border router performs the NAT process, translating the internal private address of the device to a public, outside, routable address.</p>
</div>
<div class="section" id="types-of-nat-addresses">
<h2>Types of NAT Addresses<a class="headerlink" href="#types-of-nat-addresses" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_Types_of_NAT_addresses.png" src="../../../_images/Ch9_Types_of_NAT_addresses.png" />
<p>It is important to remember that NAT terminology is always applied from the perspective of the device with the translated address:</p>
<dl class="docutils">
<dt>Inside address</dt>
<dd>The address of the device which is being translated by NAT.</dd>
<dt>Outside address</dt>
<dd>The address of the destination device.</dd>
</dl>
<p>NAT also uses the concept of local or global with respect to addresses:</p>
<dl class="docutils">
<dt>Local address</dt>
<dd>A local address is any address that appears on the inside portion of the network.</dd>
<dt>Global address</dt>
<dd>A global address is any address that appears on the outside portion of the network.</dd>
</dl>
<p>PC1 has an inside local address of 192.168.10.10. From the perspective of PC1, the web server has an outside address of 209.165.201.1. When packets are sent from PC1 to the global address of the web server, the inside local address of PC1 is translated to 209.165.200.226 (inside global address). The address of the outside device is not typically translated, because that address is usually a public IPv4 address.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">PC1 has different local and global addresses, whereas the web server has the same public IPv4 address for both. From the perspective of the web server, traffic originating from PC1 appears to have come from 209.165.200.226, the inside global address.</p>
</div>
<p>The NAT router, R2, is the <strong>demarcation point</strong> between the inside and outside networks and as between local and global addresses.</p>
</div>
<div class="section" id="nat-address-terminology">
<h2>NAT Address Terminology<a class="headerlink" href="#nat-address-terminology" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_NAT_address_examples.png" src="../../../_images/Ch9_NAT_address_examples.png" />
<p>The terms, inside and outside, are combined with the terms local and global to refer to specific addresses. In the figure, router R2 has been configured to provide NAT. It has a pool of public addresses to assign to inside hosts.</p>
<dl class="docutils">
<dt>Inside local address</dt>
<dd>The address of the source as seen from inside the network. In the figure, the IPv4 address 192.168.10.10 is assigned to PC1. This is the inside local address of PC1.</dd>
<dt>Inside global address</dt>
<dd><strong>The address of source as seen from the outside network</strong>. In the figure, when traffic from PC1 is sent to the web server at 209.165.201.1,**R2 translates the inside local address to an inside global address**. In this case, R2 changes the IPv4 source address <strong>from 192.168.10.10 to 209.165.200.226</strong>. In NAT terminology, the <strong>inside local address of 192.168.10.10 is translated to the inside global address of 209.165.200.226</strong>.</dd>
<dt>Outside global address</dt>
<dd><strong>The address of the destination as seen from the outside network</strong>. It is a <strong>globally routable IPv4 address assigned to a host on the Internet</strong>. For example, the web server is reachable at IPv4 address 209.165.201.1. Most often the outside local and outside global addresses are the same.</dd>
<dt>Outside local address</dt>
<dd><strong>The address of the destination as seen from the inside network</strong>. In this example, PC1 sends traffic to the web server at the IPv4 address 209.165.201.1. While uncommon, this address could be different than the globally routable address of the destination.</dd>
</dl>
<p>The figure shows how traffic is addressed that is sent from an internal PC to an external web server, across the NAT-enabled router. It also shows how return traffic is initially addressed and translated.</p>
<p>Note: The use of the outside local address is outside the scope of this course.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">inside = Source  outside = Destination</p>
</div>
<img alt="../../../_images/Ch9_NAT_identify1.png" src="../../../_images/Ch9_NAT_identify1.png" />
</div>
<div class="section" id="static-nat">
<h2>Static NAT<a class="headerlink" href="#static-nat" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_Static_NAT.png" src="../../../_images/Ch9_Static_NAT.png" />
<p>There are three types of NAT translation:</p>
<dl class="docutils">
<dt>Static address translation (static NAT)</dt>
<dd>One-to-one address mapping between local and global addresses.</dd>
<dt>Dynamic address translation (dynamic NAT)</dt>
<dd>Many-to-many address mapping between local and global addresses. Translations are made on an as-available basis; for example, if there are 100 inside local addresses and 10 inside global addresses, then at any given time only 10 of the 100 inside local addresses can be translated. This limitation of dynamic NAT makes it much less useful for production networks than port address translation.</dd>
<dt>Port Address Translation (PAT)</dt>
<dd>Many-to-one address mapping between local and global addresses. This method is also known as overloading (NAT overloading). For example, if there are 100 inside local addresses and 10 inside global addresses, PAT uses ports as an additional parameter to provide a multiplier effect, making it possible to reuse any one of the 10 inside global addresses up to 65,536 times (depending on whether the flow is based on UDP, TCP, or ICMP).</dd>
</dl>
<p><strong>Static NAT uses a one-to-one mapping of local and global addresses</strong>. These mappings are configured by the network administrator and remain constant.</p>
<p>R2 is configured with static mappings for the inside local addresses of Svr1, PC2, and PC3. When these devices send traffic to the Internet, <strong>their inside local addresses are translated to the configured inside global addresses</strong>. <strong>To outside networks, these devices have public IPv4 addresses.</strong></p>
<p>Static NAT is particularly <strong>useful for web servers or devices that must have a consistent address that is accessible from the Internet</strong>, such as a company web server. It is <em>also useful for devices that must be accessible by authorized personnel when offsite</em>, but not by the general public on the Internet. For example, a network administrator from PC4 can SSH to Svr1’s inside global address (209.165.200.226). R2 translates this inside global address to the inside local address and connects the administrator’s session to Svr1.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Static NAT requires that enough public addresses are available to satisfy the total number of simultaneous user sessions.</p>
</div>
</div>
<div class="section" id="dynamic-nat">
<h2>Dynamic NAT<a class="headerlink" href="#dynamic-nat" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_Dynamic_NAT.png" src="../../../_images/Ch9_Dynamic_NAT.png" />
<dl class="docutils">
<dt>Dynamic NAT</dt>
<dd>uses a pool of public addresses and assigns them on a <strong>first-come, first-served basis</strong>. When an inside device requests access to an outside network, dynamic NAT assigns an available public IPv4 address from the pool.</dd>
</dl>
<p>PC3 has accessed the Internet using the first available address in the dynamic NAT pool. The other addresses are still available for use.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Similar to static NAT, dynamic NAT requires that enough public addresses are available to satisfy the total number of simultaneous user sessions.</p>
</div>
</div>
<div class="section" id="pat-aka-nat-overload">
<h2>PAT aka NAT Overload<a class="headerlink" href="#pat-aka-nat-overload" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_PAT_process.png" src="../../../_images/Ch9_PAT_process.png" />
<p>Port Address Translation (PAT), also known as NAT overload, maps multiple private IPv4 addresses to a single public IPv4 address or a few addresses. This is what most home routers do. The ISP assigns one address to the router, yet several members of the household can simultaneously access the Internet. This is the most common form of NAT.</p>
<p>With PAT, multiple addresses can be mapped to one or to a few addresses, because each private address is also tracked by a port number. When a device initiates a TCP/IP session, it generates a TCP or UDP source port value or a specially assigned query ID for ICMP, to uniquely identify the session. When the NAT router receives a packet from the client, it uses its source port number to uniquely identify the specific NAT translation.</p>
<p><strong>PAT ensures that devices use a different TCP port number for each session with a server on the Internet. When a response comes back from the server, the source port number, which becomes the destination port number on the return trip, determines to which device the router forwards the packets. The PAT process also validates that the incoming packets were requested, thus adding a degree of security to the session.</strong></p>
<p>The source address (SA) is the inside local address with the TCP/IP assigned port number added. The destination address (DA) is the outside local address with the service port number added. In this example, the service port is 80, which is HTTP.</p>
<p>For the source address, R2 translates the inside local address to an inside global address with the port number added. The destination address is not changed, but is now referred to as the outside global IPv4 address. When the web server replies, the path is reversed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">PAT attempts to preserve the original source port. However, if the original source port is already used, PAT assigns the first available port number starting from the beginning of the appropriate port group 0–511, 512–1,023, or 1,024–65,535. When there are no more ports available and there is more than one external address in the address pool, PAT moves to the next address to try to allocate the original source port. This process continues until there are no more available ports or external IPv4 addresses</p>
</div>
</div>
<div class="section" id="nat-vs-pat">
<h2>NAT vs PAT<a class="headerlink" href="#nat-vs-pat" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_NAT_vs_PAT.png" src="../../../_images/Ch9_NAT_vs_PAT.png" />
<p>NAT translates IPv4 addresses on a 1:1 basis between private IPv4 addresses and public IPv4 addresses. However, PAT modifies both the address and the port number.</p>
<p>NAT forwards incoming packets to their inside destination by referring to the incoming source IPv4 address given by the host on the public network. With PAT, there is generally only one or a very few publicly exposed IPv4 addresses. Incoming packets from the public network are routed to their destinations on the private network by referring to a table in the NAT router. This table tracks public and private port pairs. <strong>This is called connection tracking</strong></p>
<div class="section" id="packets-without-a-layer-4-segment">
<h3>Packets without a Layer 4 Segment<a class="headerlink" href="#packets-without-a-layer-4-segment" title="Permalink to this headline">¶</a></h3>
<p>What about IPv4 packets carrying data other than a TCP or UDP segment? These packets do not contain a Layer 4 port number. PAT translates most common protocols carried by IPv4 that do not use TCP or UDP as a transport layer protocol. The most common of these is ICMPv4. Each of these types of protocols is handled differently by PAT. For example, ICMPv4 query messages, echo requests, and echo replies include a Query ID. <strong>ICMPv4 uses the Query ID to identify an echo request with its corresponding echo reply. The Query ID is incremented with each echo request sent. PAT uses the Query ID instead of a Layer 4 port number</strong>.</p>
<p>Note: Other ICMPv4 messages do not use the Query ID. These messages and other protocols that do not use TCP or UDP port numbers vary and are beyond the scope of this curriculum.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1">#show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.2</span><span class="p">:</span><span class="mi">25</span>    <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">25</span>      <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.2</span><span class="p">:</span><span class="mi">443</span>   <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">443</span>     <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.2</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">80</span>      <span class="o">---</span>                <span class="o">---</span>

<span class="n">R2</span><span class="c1">#show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">udp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.2</span><span class="p">:</span><span class="mi">1025</span>  <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">1025</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">8.8</span><span class="p">:</span><span class="mi">53</span>      <span class="mf">64.100</span><span class="o">.</span><span class="mf">8.8</span><span class="p">:</span><span class="mi">53</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.2</span><span class="p">:</span><span class="mi">25</span>    <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">25</span>      <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.2</span><span class="p">:</span><span class="mi">443</span>   <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">443</span>     <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.2</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">80</span>      <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1025</span>  <span class="mf">10.2</span><span class="o">.</span><span class="mf">0.5</span><span class="p">:</span><span class="mi">1025</span>      <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1026</span>  <span class="mf">10.2</span><span class="o">.</span><span class="mf">0.5</span><span class="p">:</span><span class="mi">1026</span>      <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1027</span>  <span class="mf">10.2</span><span class="o">.</span><span class="mf">0.5</span><span class="p">:</span><span class="mi">1027</span>      <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">7</span> <span class="p">(</span><span class="mi">3</span> <span class="n">static</span><span class="p">,</span> <span class="mi">4</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">7</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span> <span class="p">,</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span> <span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">2</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">19</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">R2Pool</span> <span class="n">refCount</span> <span class="mi">4</span>
 <span class="n">pool</span> <span class="n">R2Pool</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.224</span>
       <span class="n">start</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span> <span class="n">end</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.31</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">29</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">6</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>
<span class="n">R2</span><span class="c1">#</span>

<span class="n">R4</span><span class="c1">#show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">150.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">80</span>      <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">25</span>    <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">25</span>      <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">443</span>   <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">443</span>     <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">80</span>      <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">80</span>      <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1025</span>  <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1025</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">80</span>      <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1026</span>  <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1026</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">80</span>      <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1027</span>  <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1027</span>

<span class="n">R4</span><span class="c1">#show ip nat sta</span>
<span class="n">R4</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">7</span> <span class="p">(</span><span class="mi">4</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">6</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span> <span class="p">,</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span> <span class="p">,</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">17</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">5</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="n">R4</span><span class="c1">#</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="nat-advantages">
<h2>NAT Advantages<a class="headerlink" href="#nat-advantages" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Conserves the legally registered addressing scheme<ul>
<li>by allowing privatization of intranets</li>
<li>NAT conserves addresses through app port-level multiplexing</li>
<li>with NAT overload very few external addresses are required to support many internal hosts</li>
</ul>
</li>
<li>NAT increases flexibility of connections to public network<ul>
<li>Multiple pools, backup pools, and load-balancing pools can be implemented to ensure reliable public network connections</li>
</ul>
</li>
<li>Provides consistency for internal network addressing schemes<ul>
<li>NAT allows the existing private IPv4 address scheme to remain while allowing for easy change to a new public addressing scheme. This means an organization could change ISPs and not need to change any of its inside clients.</li>
</ul>
</li>
<li>Provides network security<ul>
<li>NAT provides the side effect of hiding users and other devices’ IPv4 addresses. Some people consider this a security feature, however most experts agree that NAT does not provide security. A stateful firewall is what provides security on the edge of the network</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="nat-disadvantages">
<h2>NAT Disadvantages<a class="headerlink" href="#nat-disadvantages" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Performance is degraded<ul>
<li>One disadvantage of using NAT is related to network performance, particularly for real time protocols such as VoIP. NAT increases forwarding delays because the translation of each IPv4 address within the packet headers takes time. The first packet is always process-switched going through the slower path. The router must look at every packet to decide whether it needs translation. The router must alter the IPv4 header, and possibly alter the TCP or UDP header. The IPv4 header checksum, along with the TCP or UDP checksum must be recalculated each time a translation is made. Remaining packets go through the fast-switched path if a cache entry exists; otherwise, they too are delayed.</li>
</ul>
</li>
<li>End-to-end functionality is degraded<ul>
<li>Many Internet protocols and applications depend on end-to-end addressing from the source to the destination. Some applications do not work with NAT. For example, some security applications, such as digital signatures, fail because the source IPv4 address changes before reaching the destination. Applications that use physical addresses, instead of a qualified domain name, do not reach destinations that are translated across the NAT router. <strong>Sometimes, this problem can be avoided by implementing static NAT mappings.</strong></li>
</ul>
</li>
<li>End-to-end IP traceability is lost<ul>
<li>it becomes much more difficult to trace packets that undergo numerous packet address changes over multiple NAT hops, making troubleshooting challenging.</li>
</ul>
</li>
<li>Tunneling becomes more complicated<ul>
<li>Using NAT also complicates the use of tunneling protocols, such as IPsec, because NAT modifies values in the headers, causing integrity checks to fail.</li>
</ul>
</li>
<li>Initiating TCP connections can be disrupted<ul>
<li>Services that require the initiation of TCP connections from the outside network, or stateless protocols, such as those using UDP, can be disrupted. Unless the NAT router has been configured to support such protocols, incoming packets cannot reach their destination. Some protocols can accommodate one instance of NAT between participating hosts (passive mode FTP, for example), but fail when both systems are separated from the Internet by NAT.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="configuring-static-nat">
<h2>Configuring Static NAT<a class="headerlink" href="#configuring-static-nat" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">create a MAPPING between inside local address and the inside global addresses</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source static local-ip global-ip</span>
</pre></div>
</div>
</li>
<li><dl class="first docutils">
<dt>Specify the INSIDE interface</dt>
<dd><p class="first last">In the example, the Serial 0/0/0 interface of R2 is an inside interface and Serial 0/1/0 is an outside interface.</p>
</dd>
</dl>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface type number</span>
</pre></div>
</div>
</li>
<li><p class="first">Mark the interface as connected to the inside</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
</pre></div>
</div>
</li>
<li><dl class="first docutils">
<dt>Specify the OUTSIDE interface</dt>
<dd><p class="first last">E.g. Serial 0/1/0</p>
</dd>
</dl>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface type number</span>
</pre></div>
</div>
</li>
<li><p class="first">Mark the interface as connected to the outside</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
</li>
</ol>
<p>Image shows the commands needed on R2 to create a static NAT mapping to the web server in the example topology. With the configuration shown, R2 translates packets from the web server with address 192.168.10.254 to public IPv4 address 209.165.201.5. The Internet client directs web requests to the public IPv4 address 209.165.201.5. R2 forwards that traffic to the web server at 192.168.10.254.</p>
<img alt="../../../_images/Ch9_Static_NAT_example.png" src="../../../_images/Ch9_Static_NAT_example.png" />
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">establishes</span> <span class="n">static</span> <span class="n">translation</span> <span class="n">between</span> <span class="n">an</span> <span class="n">inside</span> <span class="n">local</span> <span class="n">address</span> <span class="o">&amp;</span> <span class="n">an</span> <span class="n">inside</span> <span class="k">global</span> <span class="n">address</span>
<span class="o">---</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source static 192.168.10.254 209.165.201.5</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Serial0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 10.1.1.2 255.255.255.252</span>

<span class="n">identifies</span> <span class="n">interface</span> <span class="n">Serial</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span> <span class="k">as</span> <span class="n">an</span> <span class="n">inside</span> <span class="n">NAT</span> <span class="n">interface</span>
<span class="o">---</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># exit</span>

<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Serial 0/1/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 209.165.200.1 255.255.255.252</span>
<span class="n">Identifies</span> <span class="n">interface</span> <span class="n">serial</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span> <span class="k">as</span> <span class="n">the</span> <span class="n">outside</span> <span class="n">NAT</span> <span class="n">interface</span>
<span class="o">---</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
</div>
<div class="section" id="static-nat-process">
<h2>Static NAT Process<a class="headerlink" href="#static-nat-process" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_Static_NAT_process.png" src="../../../_images/Ch9_Static_NAT_process.png" />
<ol class="arabic simple">
<li>The client sends a packet to the web server using the public IPv4 destination address of 209.165.201.5. This is the <strong>inside global address of the web server</strong></li>
<li>The first packet that R2 receives from the client on its NAT outside interface causes R2 to check its NAT table. The destination IPv4 address is located in the NAT table and is translated</li>
<li>R2 <strong>replaces the inside global address of 209.165.201.5 with the inside local address of 192.168.10.254</strong>. R2 then forwards the packet towards the web server.</li>
<li>The web server receives the packet and responds to the client using the <strong>inside local address</strong>, 192.168.10.254</li>
<li>Router 2<ol class="loweralpha">
<li>receives the packet from the webserver on its <strong>NAT inside interface with source address of the inside local address of the webserver</strong>,192.168.10.254</li>
<li>checks the <strong>NAT table for a translation for the inside local address</strong>. The address is found in the NAT table. R2 <strong>translates the source address to the inside global address of 209.165.201.5</strong> and forwards the packet toward the client</li>
</ol>
</li>
<li>The client receives the packet and continues the conversation. The NAT router performs Steps 2 to 5b for each packet.</li>
</ol>
<dl class="docutils">
<dt>verify with</dt>
<dd><code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">translations</span></code></dd>
<dt>clear nat statistics</dt>
<dd><code class="docutils literal"><span class="pre">clear</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code></dd>
<dt>check if nat is working</dt>
<dd><code class="docutils literal"><span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code></dd>
</dl>
<p>In this example it would show <strong>1 static</strong> in <strong>Total active translations</strong></p>
</div>
<div class="section" id="configure-static-nat-exercise">
<h2>Configure Static NAT exercise<a class="headerlink" href="#configure-static-nat-exercise" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_9.2.1.4_Configuring_Static_NAT.png" src="../../../_images/Ch9_9.2.1.4_Configuring_Static_NAT.png" />
<p>configure static NAT so that outside devices can access and inside server at its public address</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="o">&gt;</span><span class="n">enable</span>
<span class="n">R1</span><span class="c1">#show ip nat translations</span>
<span class="n">R1</span><span class="c1">#map the server1 inside address to its outside address</span>
<span class="n">R1</span><span class="c1">#conf t</span>
<span class="n">Enter</span> <span class="n">configuration</span> <span class="n">commands</span><span class="p">,</span> <span class="n">one</span> <span class="n">per</span> <span class="n">line</span><span class="o">.</span>  <span class="n">End</span> <span class="k">with</span> <span class="n">CNTL</span><span class="o">/</span><span class="n">Z</span><span class="o">.</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip nat inside source static 172.16.16.1 64.100.50.1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface Gig0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat inside</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#exit</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface Serial0/0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat outside</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#exit</span>
</pre></div>
</div>
<p>Use the following commands to verify the static NAT configuration:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>show running-config
show ip nat translations
show ip nat statistics

R1#show running-config
!
!
interface GigabitEthernet0/0
 ip address 172.16.16.14 255.255.255.240
 ip nat inside
 duplex auto
 speed auto
!
interface GigabitEthernet0/1
 no ip address
 duplex auto
 speed auto
 shutdown
!
interface GigabitEthernet0/2
 no ip address
 duplex auto
 speed auto
 shutdown
!
interface Serial0/0/0
 ip address 209.165.128.130 255.255.255.248
 ip nat outside
!
interface Serial0/0/1
 no ip address
 clock rate 2000000
 shutdown
!
interface Vlan1
 no ip address
 shutdown
!
ip nat inside source static 172.16.16.1 64.100.50.1
ip classless
!
ip flow-export version 9
!

R1#show ip nat translations
Pro  Inside global     Inside local       Outside local      Outside global
---  64.100.50.1       172.16.16.1        ---                ---

R1#show ip nat statistics
Total translations: 1 (1 static, 0 dynamic, 0 extended)
Outside Interfaces: Serial0/0/0
Inside Interfaces: GigabitEthernet0/0
Hits: 0  Misses: 0
Expired translations: 0
Dynamic mappings:
</pre></div>
</div>
</div>
<div class="section" id="dynamic-nat-operation">
<h2>Dynamic NAT operation<a class="headerlink" href="#dynamic-nat-operation" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_Dynamic_NAT_1to1_translation.png" src="../../../_images/Ch9_Dynamic_NAT_1to1_translation.png" />
<p>While static NAT provides a permanent mapping between an inside local address and an inside global address, <strong>dynamic NAT allows the automatic mapping of inside local addresses to inside global addresses</strong>. <strong>These inside global addresses are typically public IPv4 addresses</strong>. Dynamic NAT uses a group, or pool of public IPv4 addresses for translation.</p>
<p>Dynamic NAT, like static NAT, requires the configuration of the inside and outside interfaces participating in NAT. However, where static NAT creates a permanent mapping to a single address, dynamic NAT uses a pool of addresses.</p>
<p>Attached to router R1 are two LANs, 192.168.10.0/24 and 192.168.11.0/24. Router R2, the border router, is configured for dynamic NAT using a pool of public IPv4 addresses 209.165.200.226 through 209.165.200.240</p>
<p>The pool of public IPv4 addresses <strong>(inside global address pool)</strong> is available to any device on the inside network on a first-come first-served basis.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">With dynamic NAT, a single inside address is translated to a single outside address. With this type of translation there must be enough addresses in the pool to accommodate all the inside devices needing access to the outside network at the same time. If all of the addresses in the pool have been used, a device must wait for an available address before it can access the outside network.</p>
</div>
</div>
<div class="section" id="configuring-dynamic-nat">
<h2>Configuring Dynamic NAT<a class="headerlink" href="#configuring-dynamic-nat" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Define a <strong>pool of global addresses</strong> to be used for translation</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat pool name start-ip end-ip {netmask netmask | prefix-length prefix-length}</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure a standard <strong>access list permitting the addresses that should be translated</strong></p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list access-list-number permit source [source-wildcard]</span>
</pre></div>
</div>
</li>
<li><p class="first">Establish dynamic <strong>source</strong> translation, specifying the <strong>access list and pool</strong> defined in prior steps</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside source list access-list-number pool name</span>
</pre></div>
</div>
</li>
<li><p class="first">identify the INSIDE interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface type number</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
</pre></div>
</div>
</li>
<li><p class="first">identify the OUTSIDE interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface type number</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="dynamic-nat-example">
<h2>Dynamic NAT example<a class="headerlink" href="#dynamic-nat-example" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_dynamic_NAT_example_config.png" src="../../../_images/Ch9_dynamic_NAT_example_config.png" />
<p>Defines a pool of public IPv4 addresses under the pool name NAT POOL1</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat pool NAT-POOL1 209.165.200.226 209.165.200.240 netmask 255.255.255.224</span>
</pre></div>
</div>
<p>Defines what addresses are eligible to be translated</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit 192.168.0.0 0.0.255.255</span>
</pre></div>
</div>
<p>Binds NAT-POOL1 with ACL 1</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source list 1 pool NAT-POOL1</span>
</pre></div>
</div>
<p>Identifies interface serial 0/0/0 as an inside NAT interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Serial 0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
</pre></div>
</div>
</div>
<div class="section" id="dynamic-nat-process">
<h2>Dynamic NAT process<a class="headerlink" href="#dynamic-nat-process" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_Dynamic_NAT_process_1.png" src="../../../_images/Ch9_Dynamic_NAT_process_1.png" />
<p>Using the previous configuration, the figures illustrate the dynamic NAT translation process between two clients and the web server:</p>
<p>In image 1, the traffic flow from inside to outside is shown:</p>
<ol class="arabic">
<li><p class="first">The hosts with the source IPv4 addresses (192.168.10.10 (PC1) and 192.168.11.10 (PC2)) send packets requesting a connection to the server at the public IPv4 address (209.165.200.254).</p>
</li>
<li><p class="first">R2 receives the first packet from host 192.168.10.10. Because this packet was received on an interface configured as an inside NAT interface, R2 checks the NAT configuration to determine if this packet should be translated. The ACL permits this packet, so R2 will translate the packet. R2 checks its NAT table. <strong>Because there is no translation entry for this IPv4 address, R2 determines that the source address 192.168.10.10 must be translated dynamically</strong>. R2 selects an available global address from the dynamic address pool and creates a translation entry, 209.165.200.226. The original source IPv4 address (192.168.10.10) is the inside local address and the translated address is the inside global address (209.165.200.226) in the NAT table.</p>
<p>For the second host, 192.168.11.10, R2 repeats the procedure, selects the next available global address from the dynamic address pool, and creates a second translation entry, 209.165.200.227.</p>
</li>
<li><p class="first">R2 replaces the inside local source address of PC1, 192.168.10.10, with the translated inside global address of 209.165.200.226 and forwards the packet. The same process occurs for the packet from PC2 using the translated address for PC2 (209.165.200.227).</p>
<img alt="../../../_images/Ch9_Dynamic_NAT_process_2.png" src="../../../_images/Ch9_Dynamic_NAT_process_2.png" />
<p>In image 2, the traffic flow from outside to inside is shown:</p>
</li>
<li><p class="first">The server receives the packet from PC1 and responds using the IPv4 destination address of 209.165.200.226. When the server receives the second packet, it responds to PC2 using the IPv4 destination address of 209.165.200.227.</p>
</li>
<li><p class="first">When R2 receives the packet with the destination IPv4 address of 209.165.200.226;</p>
<ol class="loweralpha simple">
<li><strong>it performs a NAT table lookup</strong>. Using the mapping from the table, R2 translates the address back to the inside local address (192.168.10.10) and forwards the packet toward PC1.</li>
<li>When R2 receives the packet with the destination IPv4 address of 209.165.200.227; it performs a NAT table lookup. Using the mapping from the table, R2 translates the address back to the inside local address (192.168.11.10) and forwards the packet toward PC2.</li>
</ol>
</li>
<li><p class="first">PC1 at 192.168.10.10 and PC2 at 192.168.11.10 receive the packets and continue the conversation. The router performs Steps 2 to 5 for each packet.</p>
</li>
</ol>
<p>Verify with <code class="docutils literal"><span class="pre">R2#</span> <span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">translations</span> <span class="pre">verbose</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, translation entries time out after 24 hours, unless the timers have been reconfigured with the <code class="docutils literal"><span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">translation</span> <span class="pre">timeout</span> <span class="pre">timeout-seconds</span></code> command in global configuration mode.</p>
</div>
</div>
<div class="section" id="clearing-nat-translations">
<h2>Clearing NAT Translations<a class="headerlink" href="#clearing-nat-translations" title="Permalink to this headline">¶</a></h2>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">clears</span> <span class="nb">all</span> <span class="n">dynamic</span> <span class="n">address</span> <span class="n">translation</span> <span class="n">entries</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">NAT</span> <span class="n">translation</span> <span class="n">table</span>
<span class="o">-----------------------------------------------------------------------------</span>
<span class="n">R2</span><span class="c1"># clear ip nat translation *</span>

<span class="n">Clear</span> <span class="n">a</span> <span class="n">simple</span> <span class="n">dynamic</span> <span class="n">translation</span> <span class="n">entry</span> <span class="n">containing</span> <span class="n">an</span> <span class="n">inside</span> <span class="n">translation</span>
<span class="ow">or</span> <span class="n">both</span> <span class="n">inside</span> <span class="o">&amp;</span> <span class="n">outside</span> <span class="n">translation</span>
<span class="o">------------------------------------</span>
<span class="n">R2</span><span class="c1"># clear ip nat translation inside global-ip local-ip [outside local-ip global-ip]</span>

<span class="n">Clears</span> <span class="n">an</span> <span class="n">extended</span> <span class="n">dynamic</span> <span class="n">translation</span> <span class="n">entry</span>
<span class="o">--------------------------------------------</span>
<span class="n">R2</span><span class="c1"># clear ip nat translation protocol inside global-ip global-port local-ip local-port</span>
 <span class="p">[</span><span class="n">outside</span> <span class="n">local</span><span class="o">-</span><span class="n">ip</span> <span class="n">local</span><span class="o">-</span><span class="n">port</span> <span class="k">global</span><span class="o">-</span><span class="n">ip</span> <span class="k">global</span><span class="o">-</span><span class="n">port</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only the dynamic translations are cleared from the table. Static translations cannot be cleared from the translation table</p>
</div>
<p><code class="docutils literal"><span class="pre">R2#</span> <span class="pre">clear</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code></p>
</div>
<div class="section" id="configure-dynamic-nat-exercise">
<h2>Configure Dynamic NAT exercise<a class="headerlink" href="#configure-dynamic-nat-exercise" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_9.2.2.5_Configuring_Dynamic_NAT.png" src="../../../_images/Ch9_9.2.2.5_Configuring_Dynamic_NAT.png" />
<div class="section" id="configure-dynamic-nat">
<h3>configure dynamic NAT<a class="headerlink" href="#configure-dynamic-nat" title="Permalink to this headline">¶</a></h3>
<p>On R2:</p>
<ul>
<li><p class="first">configure one statement for ACL 1 to permit any address belonging to 172.16.0.0/16</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#access-list 1 permit 172.16.0.0 0.0.255.255</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure a NAT pool that uses all four addresses in the 209.165.76.196/30 address space</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip nat pool NAT-POOL1 209.165.76.196 209.165.76.199 netmask 255.255.255.252</span>
</pre></div>
</div>
</li>
</ul>
<p>Notice in the topology there are 3 network ranges that would be translated based on the ACL created. What will happen if more than 2 devices attempt to access the Internet?</p>
<ul>
<li><p class="first">Associate ACL1 with the NAT pool</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source list 1 nat NAT-POOL1</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure the NAT interfaces</p>
<p>Configure R2 interfaces with the appropriate inside and outside NAT commands</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface Serial 0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat outside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#interface Serial 0/0/1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat inside</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">if you try to remove an active pool you will get an error msg that it is in use <code class="docutils literal"><span class="pre">R2(config)#no</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">pool</span> <span class="pre">1</span> <span class="pre">209.165.76.192</span> <span class="pre">209.165.76.195</span> <span class="pre">netmask</span> <span class="pre">255.255.255.252</span></code>
%Pool 1 in use, cannot destroy
You need to remove the pool reference first from the inside nat
<code class="docutils literal"><span class="pre">R2(config)#no</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">inside</span> <span class="pre">source</span> <span class="pre">list</span> <span class="pre">1</span></code></p>
</div>
</div>
<div class="section" id="verify-nat-implementation">
<h3>Verify NAT implementation<a class="headerlink" href="#verify-nat-implementation" title="Permalink to this headline">¶</a></h3>
<div class="code highlight-default"><div class="highlight"><pre><span></span>R2 running-config
-----------------
!
interface Serial0/0/0
 ip address 209.165.76.193 255.255.255.224
 ip nat outside
 clock rate 2000000
!
interface Serial0/0/1
 ip address 172.16.1.1 255.255.255.252
 ip nat inside
 clock rate 2000000
!
interface Vlan1
 no ip address
 shutdown
!
ip nat pool NAT-POOL1 209.165.76.196 209.165.76.199 netmask 255.255.255.252
ip nat inside source list 1 pool NAT-POOL1
ip classless
ip route 0.0.0.0 0.0.0.0 Serial0/0/0
ip route 172.16.0.0 255.255.0.0 Serial0/0/1
!
ip flow-export version 9
!
!
access-list 1 permit 172.16.0.0 0.0.255.255
!
</pre></div>
</div>
<ul>
<li><p class="first">From the web browser of L1, PC1, or PC2, access the web page for Server1</p>
<p>The first 2 devices have access and any additional devices are denied access until the other 2 are timed out.</p>
</li>
<li><p class="first">View the NAT translations on R2</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">0</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">0</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">0</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">0</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">2</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">2</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">15</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">2</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">25</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">3</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">22</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">3</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">50</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>

<span class="n">R2</span><span class="c1">#show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.197</span><span class="p">:</span><span class="mf">1025172.16</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">1025</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.197</span><span class="p">:</span><span class="mf">1026172.16</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">1026</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.198</span><span class="p">:</span><span class="mf">1025172.16</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">1025</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>

<span class="n">R2</span><span class="c1">#show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.197</span><span class="p">:</span><span class="mf">1025172.16</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">1025</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.197</span><span class="p">:</span><span class="mf">1026172.16</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">1026</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.198</span><span class="p">:</span><span class="mf">1025172.16</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">1025</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">3</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">22</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">27</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">3</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">50</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">24</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">3</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">22</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">39</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">3</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">50</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">36</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">3</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">22</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">51</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">3</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">50</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">48</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">3</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">22</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">63</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">3</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">50</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">60</span>

<span class="n">R2</span><span class="c1">#clear ip nat translation</span>
<span class="o">%</span> <span class="n">Incomplete</span> <span class="n">command</span><span class="o">.</span>
<span class="n">R2</span><span class="c1">#clear ip nat translation ?</span>
  <span class="o">*</span>  <span class="n">Deletes</span> <span class="nb">all</span> <span class="n">dynamic</span> <span class="n">translations</span>
<span class="n">R2</span><span class="c1">#clear ip nat translation *</span>
<span class="n">R2</span><span class="c1">#show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.197</span><span class="p">:</span><span class="mf">1027172.16</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">1027</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.198</span><span class="p">:</span><span class="mf">1030172.16</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">1030</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">2</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">2</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">36</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">65</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">2</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">50</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">60</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="configure-dynamic-static-nat-lab">
<h2>Configure Dynamic &amp; Static NAT Lab<a class="headerlink" href="#configure-dynamic-static-nat-lab" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_9.2.2.6_Configuring_Dynamic_And_Static_NAT.png" src="../../../_images/Ch9_9.2.2.6_Configuring_Dynamic_And_Static_NAT.png" />
<div class="section" id="addressing-table-9-2-2-6">
<h3>Addressing Table 9.2.2.6<a class="headerlink" href="#addressing-table-9-2-2-6" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="16%" />
<col width="18%" />
<col width="19%" />
<col width="19%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Gateway</td>
<td>G0/1</td>
<td>192.168.1.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>209.165.201.18</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>ISP</td>
<td>S0/0/0 (DCE)</td>
<td>209.165.201.17</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Lo0</td>
<td>192.31.7.1</td>
<td>255.255.255.255</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>PC-A (Simulated Server)</td>
<td>NIC</td>
<td>192.168.1.20</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
<tr class="row-odd"><td>PC-B</td>
<td>NIC</td>
<td>192.168.1.21</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="objectives-9-2-2-6">
<h3>Objectives 9.2.2.6<a class="headerlink" href="#objectives-9-2-2-6" title="Permalink to this headline">¶</a></h3>
<p>Part 1: Build the Network and Verify Connectivity
Part 2: Configure and Verify Static NAT
Part 3: Configure and Verify Dynamic NAT</p>
<p>An ISP has allocated the public IP address space of 209.165.200.224/27 to a company. This provides the company with 30 public IP addresses. The addresses , 209.165.200.225 to 209.165.200.241, are for static allocation and 209.165.200.242 to 209.165.200.254 are for dynamic allocation.</p>
<p>A static route is used from the ISP to the gateway router, and a default route is used from the gateway to the ISP router. The ISP connection to the Internet is simulated by a loopback address on the ISP router.</p>
</div>
<div class="section" id="required-resources">
<h3>Required Resources<a class="headerlink" href="#required-resources" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>2 Routers (Cisco 1941 with Cisco IOS Release 15.2(4)M3 universal image or comparable)</li>
<li>1 Switch (Cisco 2960 with Cisco IOS Release 15.0(2) lanbasek9 image or comparable)</li>
<li>2 PCs (Windows 7, Vista, or XP with terminal emulation program, such as Tera Term)</li>
<li>Console cables to configure the Cisco IOS devices via the console ports</li>
<li>Ethernet and serial cables as shown in the topology</li>
</ul>
</div>
<div class="section" id="build-network-verify-connectivity">
<h3>Build network &amp; verify connectivity<a class="headerlink" href="#build-network-verify-connectivity" title="Permalink to this headline">¶</a></h3>
<p>Basic settings for each router:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">no</span> <span class="n">ip</span> <span class="n">domain</span><span class="o">-</span><span class="n">lookup</span>
<span class="n">service</span> <span class="n">password</span><span class="o">-</span><span class="n">encryption</span>
<span class="n">enable</span> <span class="n">secret</span> <span class="k">class</span>
<span class="nc">banner</span> <span class="n">motd</span> <span class="c1">#</span>
<span class="n">Unauthorized</span> <span class="n">access</span> <span class="ow">is</span> <span class="n">strictly</span> <span class="n">prohibited</span><span class="o">.</span> <span class="c1">#</span>
<span class="n">line</span> <span class="n">con</span> <span class="mi">0</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
<span class="n">logging</span> <span class="n">synchronous</span>
<span class="n">line</span> <span class="n">vty</span> <span class="mi">0</span> <span class="mi">4</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
</pre></div>
</div>
<p>Configure the host name as shown in the topology.
Copy the running configuration to the startup configuration.</p>
<ul>
<li><p class="first">Create a simulated web server on ISP</p>
<ul>
<li><p class="first">Create a local user named webuser with an encrypted password of webpass</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ISP</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># username webuser privilege 15 secret webpass</span>
</pre></div>
</div>
</li>
<li><p class="first">Create a default route from the Gateway router to the ISP router</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 0.0.0.0 0.0.0.0 209.165.201.17</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Save the running configuration to the startup configuration</p>
</li>
<li><p class="first">Verify network connectivity</p>
<ul class="simple">
<li>From the PC hosts, ping the G0/1 interface on the Gateway router. Troubleshoot if the pings are unsuccessful</li>
<li>Display the routing tables on both routers to verify that the static routes are in the routing table and configured correctly on both routers</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="configure-and-verify-static-nat">
<h3>Configure and Verify Static NAT<a class="headerlink" href="#configure-and-verify-static-nat" title="Permalink to this headline">¶</a></h3>
<p>Static NAT uses a one-to-one mapping of local and global addresses, and these mappings remain constant.
Static NAT is particularly useful for web servers or devices that must have static addresses that are accessible from the Internet</p>
<ul>
<li><p class="first">configure a static mapping</p>
<p>A static map is configured to tell the router to translate between the private inside server address 192.168.1.20 and the public address 209.165.200.225. This allows a user from the Internet to access PC-A.
PC-A is simulating a server or device with a constant address that can be accessed from the Internet.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source static 192.168.1.20 209.165.200.225</span>
</pre></div>
</div>
</li>
<li><p class="first">specify the interfaces</p>
<ul>
<li><p class="first">Issue the <code class="docutils literal"><span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">inside</span></code> and <code class="docutils literal"><span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">outside</span></code> commands to the interfaces</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/1</span>
<span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
<span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># interface s0/0/1</span>
<span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
</li>
<li><p class="first">Display the static NAT table by issuing the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">translations</span></code> command</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>      <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>       <span class="o">---</span>                <span class="o">---</span>
</pre></div>
</div>
<p>What is the translation of the Inside local host address?
192.168.1.20 =
The Inside global address is assigned by?</p>
<p>The Inside local address is assigned by?</p>
</li>
<li><p class="first">From PC-A, ping the Lo0 interface ( 192.31.7.1) on ISP. If the ping was un successful, troubleshoot and correct the issues.  On the Gateway router, d isplay the NAT table.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>      <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">1</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>       <span class="o">---</span>                <span class="o">---</span>
</pre></div>
</div>
<p>A NAT entry was added to the table with ICMP listed as the protocol when PC-A sent an ICMP request (ping) to 192.31.7.1 on ISP.
What port number was used in this ICMP exchange?
Note: It may be necessary to disable the PC-A firewall for the ping to be successful.</p>
</li>
<li><p class="first">From PC-A, telnet to the ISP Lo0 interface and display the NAT table</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>        <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">1</span>   <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">1034</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span><span class="p">:</span><span class="mi">1034</span>  <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">23</span>      <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">23</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span>      <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>       <span class="o">---</span>                <span class="o">---</span>
</pre></div>
</div>
<p>Note: The NAT for the ICMP request may have timed out and been removed from the NAT table.
What was the protocol used in this translation?
What are the port numbers used?</p>
<p>Inside global / local:
Outside global / local:</p>
</li>
<li><p class="first">Because static NAT was configured for PC-A, verify that pinging from ISP to PC-A at the static NAT public address (209.165.200.225) is successful.</p>
</li>
<li><p class="first">On the Gateway router, display the NAT table to verify the translation.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>       <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">12</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span><span class="p">:</span><span class="mi">12</span>    <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.17</span><span class="p">:</span><span class="mi">12</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.17</span><span class="p">:</span><span class="mi">12</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span>     <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>       <span class="o">---</span>                <span class="o">---</span>
</pre></div>
</div>
<p>Notice that the Outside local and Outside global addresses are the same. This address is the ISP remote network source address. For the ping from the ISP to succeed, the Inside global static NAT address 209.165.200.225 was translated to the Inside local address of PC-A (192.168.1.20).</p>
</li>
<li><p class="first">Verify NAT statistics by using the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code> command on the Gateway router</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat statistics</span>
<span class="n">Total</span> <span class="n">active</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">1</span> <span class="n">static</span><span class="p">,</span> <span class="mi">1</span> <span class="n">dynamic</span><span class="p">;</span> <span class="mi">1</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Peak</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">occurred</span> <span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">12</span> <span class="n">ago</span>
<span class="n">Outside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Inside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">39</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">CEF</span> <span class="n">Translated</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">39</span><span class="p">,</span> <span class="n">CEF</span> <span class="n">Punted</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="n">Total</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Appl</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Normal</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Queued</span> <span class="n">Packets</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="configure-and-verify-dynamic-nat">
<h3>Configure and Verify Dynamic NAT<a class="headerlink" href="#configure-and-verify-dynamic-nat" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Dynamic NAT</dt>
<dd>uses a pool of public addresses and assigns them on a first-come, first-served basis. When an inside device requests access to an outside network, dynamic NAT assigns an available public IPv4 address from the pool. Dynamic NAT results in a many-to-many address mapping between local and global addresses.</dd>
</dl>
<ul>
<li><p class="first">Clear NATs
Before proceeding to add dynamic NATs, clear the NATs and statistics from Part 2.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># clear ip nat translation *</span>
<span class="n">Gateway</span><span class="c1"># clear ip nat statistics</span>
</pre></div>
</div>
</li>
<li><p class="first">Define an access control list (ACL) that matches the LAN private IP address range.</p>
<p>ACL 1 is used to allow 192.168.1.0/24 network to be translated.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit 192.168.1.0 0.0.0.255</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify that the NAT interface configurations are still valid</p>
<p>Issue the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code> command on the Gateway router to verify the NAT configurations.</p>
</li>
<li><p class="first">Define the pool of usable public IP addresses.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat pool public_access 209.165.200.242 209.165.200.254 netmask 255.255.255.224</span>
</pre></div>
</div>
</li>
<li><p class="first">Define the NAT from the inside source list to the outside pool</p>
<p>Note: Remember that NAT pool names are case-sensitive and the pool name entered here must match that used in the previous step.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source list 1 pool public_access</span>
</pre></div>
</div>
</li>
<li><p class="first">Test the configuration</p>
<ol class="loweralpha">
<li><p class="first">From PC-B, ping the Lo0 interface (192.31.7.1) on ISP. If the ping was unsuccessful, troubleshoot and correct the issues. On the Gateway router, display the NAT table.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>      <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>       <span class="o">---</span>                <span class="o">---</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span>       <span class="o">---</span>                <span class="o">---</span>
</pre></div>
</div>
<p>What is the translation of the Inside local host address for PC-B?</p>
<p>192.168.1.21 =</p>
<p>A dynamic NAT entry was added to the table with ICMP as the protocol when PC-B sent an ICMP message to 192.31.7.1 on ISP.</p>
<p>What port number was used in this ICMP exchange?</p>
</li>
<li><p class="first">From PC-B, open a browser and enter the IP address of the ISP-simulated web server (Lo0 interface)
When prompted, log in as webuser with a password of webpass</p>
</li>
<li><p class="first">Display the NAT table.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>        <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span>      <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>       <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1038</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1038</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1039</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1039</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1040</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1040</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1041</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1041</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1042</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1042</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1043</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1043</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1044</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1044</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1045</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1045</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1046</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1046</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1047</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1047</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1048</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1048</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1049</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1049</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1050</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1050</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1051</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1051</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1052</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1052</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.22</span>       <span class="o">---</span>                <span class="o">---</span>
</pre></div>
</div>
<p>What protocol was used in this translation? What port numbers were used?
Inside:
Outside:
What well-known port number and service was used?</p>
</li>
<li><p class="first">Verify NAT statistics by using the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code> command on the Gateway router</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat statistics</span>
<span class="n">Total</span> <span class="n">active</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">1</span> <span class="n">static</span><span class="p">,</span> <span class="mi">2</span> <span class="n">dynamic</span><span class="p">;</span> <span class="mi">1</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Peak</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="n">occurred</span> <span class="mi">00</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">40</span> <span class="n">ago</span>
<span class="n">Outside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Inside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">345</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">CEF</span> <span class="n">Translated</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">345</span><span class="p">,</span> <span class="n">CEF</span> <span class="n">Punted</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">20</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="p">[</span><span class="n">Id</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">public_access</span> <span class="n">refcount</span> <span class="mi">2</span>
 <span class="n">pool</span> <span class="n">public_access</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.224</span>
        <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.254</span>
        <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">13</span><span class="p">,</span> <span class="n">allocated</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">7</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>
<span class="n">Total</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Appl</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Normal</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Queued</span> <span class="n">Packets</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p class="first">Remove the static NAT entry</p>
<ol class="loweralpha">
<li><p class="first">Remove the static NAT from Part 2. Enter yes when prompted to delete child entries.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>Gateway(config)# no ip nat inside source static 192.168.1.20 209.165.200.225
Static entry in use, do you want to delete child entries? [no]: yes
</pre></div>
</div>
</li>
<li><p class="first">Clear the NATs and statistics.</p>
</li>
<li><p class="first">Ping the ISP (192.31.7.1) from both hosts.</p>
</li>
<li><p class="first">Display the NAT table and statistics.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat statistics</span>
<span class="n">Total</span> <span class="n">active</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">4</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">4</span> <span class="n">dynamic</span><span class="p">;</span> <span class="mi">2</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Peak</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="n">occurred</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">43</span> <span class="n">ago</span>
<span class="n">Outside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Inside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">16</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">CEF</span> <span class="n">Translated</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">285</span><span class="p">,</span> <span class="n">CEF</span> <span class="n">Punted</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">11</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="p">[</span><span class="n">Id</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">public_access</span> <span class="n">refcount</span> <span class="mi">4</span>
 <span class="n">pool</span> <span class="n">public_access</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.224</span>
        <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.254</span>
        <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">13</span><span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">15</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>
<span class="n">Total</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Appl</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Normal</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Queued</span> <span class="n">Packets</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Gateway</span><span class="c1"># show ip nat translation</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>      <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.243</span><span class="p">:</span><span class="mi">512</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span><span class="p">:</span><span class="mi">512</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">512</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">512</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.243</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>       <span class="o">---</span>                <span class="o">---</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">512</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">512</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">512</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">512</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span>       <span class="o">---</span>                <span class="o">---</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ul>
<dl class="docutils">
<dt>Reflection</dt>
<dd><ol class="first last arabic simple">
<li>Why would NAT be used in a network?</li>
<li>What are the limitations of NAT?</li>
</ol>
</dd>
</dl>
</div>
</div>
<div class="section" id="configuring-pat-nat-overload">
<h2>Configuring PAT (NAT overload)<a class="headerlink" href="#configuring-pat-nat-overload" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Define a pool of global addresses to be used for overload translation</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat pool NAT-POOL-OVERLOAD start-ip end-ip {netmask netmask prefix-length prefix-length}</span>
</pre></div>
</div>
</li>
<li><p class="first">Define a standard access list permitting the addresses that should be translated</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit source source-wildcard</span>
</pre></div>
</div>
</li>
<li><p class="first">Establish overload translation, specifying the acl and pool defined in prior steps</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source list 1 pool NAT-POOL-OVERLOAD overload</span>
</pre></div>
</div>
</li>
<li><p class="first">Identify the inside interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Serial 0/0/0</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
</pre></div>
</div>
</li>
<li><p class="first">Identify the outside interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># interface Serial 0/1/0</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
</li>
</ol>
<p>When multiple inside local addresses map to one inside global address, the TCP or UDP port numbers of each inside host distinguish between the local addresses.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The total number of internal addresses that can be translated to one external address could theoretically be as high as 65,536 per IPv4 address. However, the number of internal addresses that can be assigned a single IPv4 address is around 4,000.</p>
</div>
<p>There are two ways to configure PAT, depending on how the ISP allocates public IPv4 addresses:</p>
<blockquote>
<div><ol class="arabic simple">
<li>ISP allocates more than one public IPv4 address to the organization</li>
<li>It allocates a single public IPv4 address that is required for the organization to connect to the ISP</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The primary difference between this configuration and the configuration for dynamic, one-to-one NAT is that the overload keyword is used. The <strong>overload</strong> keyword enables PAT.</p>
</div>
<img alt="../../../_images/Ch9_PAT_with_single_address.png" src="../../../_images/Ch9_PAT_with_single_address.png" />
<p><code class="docutils literal"><span class="pre">R2(config)#</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">inside</span> <span class="pre">source</span> <span class="pre">list</span> <span class="pre">2</span> <span class="pre">interface</span> <span class="pre">Serial</span> <span class="pre">0/1/0</span> <span class="pre">overload</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">PAT with single public ip = <strong>interface</strong> type number overload</p>
</div>
</div>
<div class="section" id="pat-analysis">
<h2>PAT analysis<a class="headerlink" href="#pat-analysis" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_PAT_Analysis1.png" src="../../../_images/Ch9_PAT_Analysis1.png" />
<img alt="../../../_images/Ch9_PAT_Analysis2.png" src="../../../_images/Ch9_PAT_Analysis2.png" />
<p>However, PC2 has the same source port number as a current PAT entry, the translation for PC1. <strong>PAT increments the source port number until it is a unique value in its table</strong>. In this instance, the source port entry in the NAT table and the packet for PC2 receives 1445.</p>
<p>Although PC1 and PC2 are using the same translated address, the inside global address of 209.165.200.225, and the same source port number of 1444; the modified port number for PC2 (1445) makes each entry in the NAT table unique. This will become evident with the packets sent from the servers back to the clients.</p>
<p>When the packet from Svr2 arrives R2 performs a similar translation. The destination IPv4 address of 209.165.200.225 is located, again with multiple entries. However, using the destination port of 1445, R2 is able to uniquely identify the translation entry. The destination IPv4 address is changed to 192.168.10.11. <strong>In this case, the destination port must also be modified back to its original value of 1444, which is stored in the NAT table.</strong> The packet is then forwarded toward PC2.</p>
</div>
<div class="section" id="pt-implementing-static-dynamic-nat">
<h2>PT Implementing Static &amp; Dynamic NAT<a class="headerlink" href="#pt-implementing-static-dynamic-nat" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pt-9-2-3-6">
<h3>PT 9.2.3.6<a class="headerlink" href="#pt-9-2-3-6" title="Permalink to this headline">¶</a></h3>
<img alt="../../../_images/Ch9_pt_9.2.3.6_statdyn_NAT.png" src="../../../_images/Ch9_pt_9.2.3.6_statdyn_NAT.png" />
</div>
<div class="section" id="configure-dynamic-nat-with-pat">
<h3>Configure dynamic NAT with PAT<a class="headerlink" href="#configure-dynamic-nat-with-pat" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Configure traffic that will be permitted for NAT translations</p>
<ul>
<li><p class="first">On R2, configure a standard ACL named R2NAT that uses three statements to permit, in order, the following private address spaces:192.168.10.0/24, 192.168.20.0/24, and 192.168.30.0/24</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip access-list standard R2NAT</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#permit 192.168.10.0 0.0.0.255</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#permit 192.168.20.0 0.0.0.255</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#permit 192.168.30.0 0.0.0.255</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#exit</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Configure a pool of addresses for NAT</p>
<ul>
<li><p class="first">Configure R2 with a NAT pool named R2POOL that uses the first address in the 209.165.202.128/30 address space. The second address is used for static NAT later in Part 2.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip nat pool R2POOL 209.165.202.129 209.165.202.129 netmask 255.255.255.255</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Associate the named ACL with the NAT pool and enable PAT</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip nat inside source list R2NAT pool R2POOL overload</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure the NAT interfaces</p>
<ul>
<li><p class="first">Configure R2 interfaces with the appropriate inside and outside NAT commands</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#interface FastEthernet 0/1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#interface Serial 0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#interface Serial 0/0/1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#interface FastEthernet 0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface Serial 0/1/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat outside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># exit</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="configure-static-nat">
<h3>Configure Static NAT<a class="headerlink" href="#configure-static-nat" title="Permalink to this headline">¶</a></h3>
<p>Create a static NAT translation to map the local.pka inside address to its outside address</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source static 192.168.20.254 209.165.202.130</span>
</pre></div>
</div>
</div>
<div class="section" id="verify-nat-implementation-9-2-3-6">
<h3>Verify NAT implementation 9.2.3.6<a class="headerlink" href="#verify-nat-implementation-9-2-3-6" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Access services across the Internet</p>
<ol class="loweralpha simple">
<li>From the web browser of PC1, or PC3, access the web page for cisco.pka</li>
<li>From the web browser for PC4, access the web page for local.pka</li>
</ol>
</li>
<li><p class="first">View NAT translations</p>
<p>View the NAT translations on R2</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#do show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="o">---</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.130</span>   <span class="mf">192.168</span><span class="o">.</span><span class="mf">20.254</span>     <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.129</span><span class="p">:</span><span class="mf">1025192.168</span><span class="o">.</span><span class="mf">10.10</span><span class="p">:</span><span class="mi">1025</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.30</span><span class="p">:</span><span class="mi">80</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.30</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.129</span><span class="p">:</span><span class="mf">1026192.168</span><span class="o">.</span><span class="mf">10.10</span><span class="p">:</span><span class="mi">1026</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.30</span><span class="p">:</span><span class="mi">80</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.30</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.129</span><span class="p">:</span><span class="mf">1027192.168</span><span class="o">.</span><span class="mf">10.10</span><span class="p">:</span><span class="mi">1027</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.30</span><span class="p">:</span><span class="mi">80</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.30</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.130</span><span class="p">:</span><span class="mi">80</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">20.254</span><span class="p">:</span><span class="mi">80</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.14</span><span class="p">:</span><span class="mf">1029209.165</span><span class="o">.</span><span class="mf">201.14</span><span class="p">:</span><span class="mi">1029</span>

<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#do show ip access-list</span>
<span class="n">Standard</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="n">R2NAT</span>
    <span class="mi">10</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span> <span class="p">(</span><span class="mi">6</span> <span class="n">match</span><span class="p">(</span><span class="n">es</span><span class="p">))</span>
    <span class="mi">20</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">20.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="mi">30</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">30.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>

<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#do show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">5</span> <span class="p">(</span><span class="mi">1</span> <span class="n">static</span><span class="p">,</span> <span class="mi">4</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">4</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span> <span class="p">,</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="p">,</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span> <span class="p">,</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">68</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">8</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="n">R2NAT</span> <span class="n">pool</span> <span class="n">R2POOL</span> <span class="n">refCount</span> <span class="mi">3</span>
 <span class="n">pool</span> <span class="n">R2POOL</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.129</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.129</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">100</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
</ol>
<p>Router 2 running config</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>spanning-tree mode pvst
!
!
!
!
!
!
interface FastEthernet0/0
 ip address 192.168.20.1 255.255.255.0
 ip nat inside
 duplex auto
 speed auto
!
interface FastEthernet0/1
 no ip address
 ip nat inside
 duplex auto
 speed auto
 shutdown
!
interface Serial0/0/0
 ip address 10.1.1.2 255.255.255.252
 ip nat inside
!
interface Serial0/0/1
 ip address 10.2.2.1 255.255.255.252
 ip nat inside
 clock rate 64000
!
interface Serial0/1/0
 ip address 209.165.200.225 255.255.255.224
 ip nat outside
!
interface Serial0/1/1
 no ip address
 clock rate 2000000
 shutdown
!
interface Vlan1
 no ip address
 shutdown
!
router rip
 version 2
 passive-interface Serial0/1/0
 network 10.0.0.0
 default-information originate
 no auto-summary
!
ip nat pool R2POOL 209.165.202.129 209.165.202.129 netmask 255.255.255.255
ip nat inside source list R2NAT pool R2POOL overload
ip nat inside source static 192.168.20.254 209.165.202.130
ip classless
ip route 0.0.0.0 0.0.0.0 Serial0/1/0
!
ip flow-export version 9
!
!
ip access-list standard R2NAT
 permit 192.168.10.0 0.0.0.255
 permit 192.168.20.0 0.0.0.255
 permit 192.168.30.0 0.0.0.255
!
banner motd ^CAUTHORIZED ACCESS ONLY!^C
</pre></div>
</div>
</div>
</div>
<div class="section" id="configure-pat-nat-lab">
<h2>Configure PAT NAT Lab<a class="headerlink" href="#configure-pat-nat-lab" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_9.2.3.7_Configuring_PAT_NAT_lab.png" src="../../../_images/Ch9_9.2.3.7_Configuring_PAT_NAT_lab.png" />
<div class="section" id="addressing-table-9-2-3-7">
<h3>Addressing Table 9.2.3.7<a class="headerlink" href="#addressing-table-9-2-3-7" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="16%" />
<col width="18%" />
<col width="19%" />
<col width="19%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Gateway</td>
<td>G0/1</td>
<td>192.168.1.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>209.165.201.18</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>ISP</td>
<td>S0/0/0 (DCE)</td>
<td>209.165.201.17</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Lo0</td>
<td>192.31.7.1</td>
<td>255.255.255.255</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>PC-A (Simulated Server)</td>
<td>NIC</td>
<td>192.168.1.20</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
<tr class="row-odd"><td>PC-B</td>
<td>NIC</td>
<td>192.168.1.21</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
<tr class="row-even"><td>PC-C</td>
<td>NIC</td>
<td>192.168.1.22</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="objectives-9-2-3-7">
<h3>Objectives 9.2.3.7<a class="headerlink" href="#objectives-9-2-3-7" title="Permalink to this headline">¶</a></h3>
<p>Part 1: Build the Network and Verify Connectivity
Part 2: Configure and Verify NAT Pool Overload
Part 3: Configure and Verify PAT</p>
<p>your company is allocated the public IP address range of 209.165.200.224/29 by the ISP . This provides the company with six public IP addresses</p>
<p>Dynamic NAT pool overload uses a pool of IP addresses in a many-to-many relationship. The router uses the first IP address in the pool and assigns connections using the IP address plus a unique port number. After the maximum number of translations for a single IP address have been reached on the router (platform and hardware specific), it uses the next IP address in the pool.</p>
<p>NAT pool overload is a form port address translation (PAT) that overloads a group of public IPv4 addresses.</p>
<p>In Part 2, the ISP has allocated a single IP address, 209.165.201.18, to your company for use on the Internet connection from the company G ateway router to the ISP.  You will use the PAT to convert multiple internal addresses into the one usable public address. You will test, view, and verify that the translations are taking place, and you will interpret the NAT/PAT statistics to monitor the process.</p>
</div>
<div class="section" id="required-resources-9-2-3-7">
<h3>Required Resources 9.2.3.7<a class="headerlink" href="#required-resources-9-2-3-7" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>2 Routers (Cisco 1941 with Cisco IOS Release 15.2(4)M3 universal image or comparable)</li>
<li>1 Switch (Cisco 2960 with Cisco IOS Release 15.0(2) lanbasek9 image or comparable)</li>
<li>3 PCs (Windows 7, Vista, or XP with terminal emulation program, such as Tera Term)</li>
<li>Console cables to configure the Cisco IOS devices via the console ports</li>
<li>Ethernet and serial cables as shown in the topology</li>
</ul>
</div>
<div class="section" id="build-network-verify-connectivity-9-2-3-7">
<h3>Build network &amp; verify connectivity 9.2.3.7<a class="headerlink" href="#build-network-verify-connectivity-9-2-3-7" title="Permalink to this headline">¶</a></h3>
<p>Basic settings for each router:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">no</span> <span class="n">ip</span> <span class="n">domain</span><span class="o">-</span><span class="n">lookup</span>
<span class="n">service</span> <span class="n">password</span><span class="o">-</span><span class="n">encryption</span>
<span class="n">enable</span> <span class="n">secret</span> <span class="k">class</span>
<span class="nc">banner</span> <span class="n">motd</span> <span class="c1">#</span>
<span class="n">Unauthorized</span> <span class="n">access</span> <span class="ow">is</span> <span class="n">strictly</span> <span class="n">prohibited</span><span class="o">.</span> <span class="c1">#</span>
<span class="n">line</span> <span class="n">con</span> <span class="mi">0</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
<span class="n">logging</span> <span class="n">synchronous</span>
<span class="n">line</span> <span class="n">vty</span> <span class="mi">0</span> <span class="mi">4</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
</pre></div>
</div>
<p>Configure Static Routing</p>
<ul>
<li><p class="first">Create a static route from the ISP router to the Gateway router</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ISP</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 209.165.200.224 255.255.255.248 209.165.201.18</span>
</pre></div>
</div>
</li>
<li><p class="first">Create a default route from the Gateway router to the ISP router</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 0.0.0.0 0.0.0.0 209.165.201.17</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify network connectivity</p>
</li>
</ul>
<ol class="loweralpha simple">
<li>From the PC hosts, ping the G0/1 interface on the Gateway router. Troubleshoot if the pings are unsuccessful.</li>
<li>Verify that the static routes are configured correctly on both routers.</li>
</ol>
</div>
<div class="section" id="configure-and-verify-nat-pool-overload-9-2-3-7">
<h3>Configure and Verify NAT Pool Overload 9.2.3.7<a class="headerlink" href="#configure-and-verify-nat-pool-overload-9-2-3-7" title="Permalink to this headline">¶</a></h3>
<p>You will configure the Gateway router to translate the IP addresses from the 192.168.1.0/24 network to one of the six usable addresses in the 209.165.200.224/29 range.</p>
<ol class="arabic">
<li><p class="first">Define an access control list that matches the LAN private IP addresses.
ACL 1 is used to allow the 192.168.1.0/24 network to be translated.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit 192.168.1.0 0.0.0.255</span>
</pre></div>
</div>
</li>
<li><p class="first">Define the pool of usable public IP addresses.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat pool public_access 209.165.200.225 209.165.200.230 netmask 255.255.255.248</span>
</pre></div>
</div>
</li>
<li><p class="first">Define the NAT from the inside source list to the outside pool.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source list 1 pool public_access overload</span>
</pre></div>
</div>
</li>
<li><p class="first">Specify the interfaces</p>
<p>Issue the ip nat inside and ip nat outside commands to the interfaces.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/1</span>
<span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
<span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="o">-</span> <span class="k">if</span><span class="p">)</span><span class="c1"># interface s0/0/1</span>
<span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify the NAT pool overload configuration.</p>
<ol class="loweralpha">
<li><p class="first">From each PC host, ping the 192.31.7.1 address on the ISP router.</p>
</li>
<li><p class="first">Display NAT statistics on the Gateway router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat statistics</span>
<span class="n">Total</span> <span class="n">active</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">;</span> <span class="mi">3</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Peak</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">occurred</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">25</span> <span class="n">ago</span>
<span class="n">Outside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Inside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">24</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">CEF</span> <span class="n">Translated</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="n">CEF</span> <span class="n">Punted</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="p">[</span><span class="n">Id</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">public_access</span> <span class="n">refcount</span> <span class="mi">3</span>
 <span class="n">pool</span> <span class="n">public_access</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.248</span>
        <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.230</span>
        <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">6</span><span class="p">,</span> <span class="n">allocated</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">16</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>
<span class="n">Total</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Appl</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Normal</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Queued</span> <span class="n">Packets</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p class="first">Display NATs on the Gateway router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>      <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">0</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">0</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">1</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">2</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.22</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">2</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div class="section" id="configure-and-verify-pat-9-2-3-7">
<h3>Configure and Verify PAT 9.2.3.7<a class="headerlink" href="#configure-and-verify-pat-9-2-3-7" title="Permalink to this headline">¶</a></h3>
<p>In Part 3, you will configure PAT by using an interface instead of a pool of addresses to define the outside address.  Not all of the commands in Part 2 will be reused in Part 3.</p>
<ol class="arabic">
<li><p class="first">Clear NATs and statistics on the gateway router</p>
</li>
<li><p class="first">Verify the configuration for NAT</p>
<ol class="loweralpha simple">
<li>Verify that statistics have been cleared.</li>
<li>Verify that the outside and inside interfaces are configured for NATs.</li>
<li>Verify that the ACL is still configured for NATs.</li>
</ol>
</li>
<li><p class="first">Remove the pool of useable public IP addresses</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no ip nat pool public_access 209.165.200.225 209.165.200.230 netmask 255.255.255.248</span>
</pre></div>
</div>
</li>
<li><p class="first">Remove the NAT translation from inside source list to outside pool.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no ip nat inside source list 1 pool public_access overload</span>
</pre></div>
</div>
</li>
<li><p class="first">Associate the source list with the outside interface.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source list 1 interface serial 0/0/1 overload</span>
</pre></div>
</div>
</li>
<li><p class="first">Test the PAT configuration.</p>
<ol class="loweralpha">
<li><p class="first">From each PC, ping the 192.31.7.1 address on the ISP router.</p>
</li>
<li><p class="first">Display NAT statistics on the Gateway router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat statistics</span>
<span class="n">Total</span> <span class="n">active</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">;</span> <span class="mi">3</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Peak</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">occurred</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">19</span> <span class="n">ago</span>
<span class="n">Outside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Inside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">24</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">CEF</span> <span class="n">Translated</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="n">CEF</span> <span class="n">Punted</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="p">[</span><span class="n">Id</span><span class="p">:</span> <span class="mi">2</span><span class="p">]</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">interface</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span> <span class="n">refcount</span> <span class="mi">3</span>
<span class="n">Total</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Appl</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Normal</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Queued</span> <span class="n">Packets</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p class="first">Display NAT translations on Gateway.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>      <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.18</span><span class="p">:</span><span class="mi">3</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">3</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.18</span><span class="p">:</span><span class="mi">1</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.18</span><span class="p">:</span><span class="mi">4</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.22</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">4</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ol>
<p>Reflection</p>
<blockquote>
<div>What advantages does PAT provide?</div></blockquote>
</div>
</div>
<div class="section" id="port-forwarding">
<h2>Port Forwarding<a class="headerlink" href="#port-forwarding" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">inside</span> <span class="pre">source</span> <span class="pre">{static</span> <span class="pre">{tcp</span> <span class="pre">|</span> <span class="pre">udp</span> <span class="pre">local-ip</span> <span class="pre">local-port</span> <span class="pre">global-ip</span> <span class="pre">global-port}</span> <span class="pre">[extendable]}</span></code></p>
<ul class="simple">
<li>TCP or UDP port number</li>
<li>local-ip = 192.168.10.254</li>
<li>local-port = 80</li>
<li>global-ip = 209.165.200.225</li>
<li>global-port = 8080</li>
<li><dl class="first docutils">
<dt>extendable</dt>
<dd>The extendable option is applied automatically. The <strong>extendable</strong> keyword allows the user to configure several ambiguous static translations, <strong>where ambiguous translations are translations with the same local or global address.</strong> It allows the router to extend the translation to more than one port if necessary.</dd>
</dl>
</li>
</ul>
<img alt="../../../_images/Ch9_port_forwarding_example.png" src="../../../_images/Ch9_port_forwarding_example.png" />
<p>Establishes static translation between an inside local address and local port and an inside global address and global port</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source static tcp 192.168.10.254 80 209.165.200.225 8080</span>
</pre></div>
</div>
<p>Identifies interface Serial 0/0/0 as an inside NAT interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Serial0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
</pre></div>
</div>
<p>Identifies interface Serial 0/1/0 as an outside NAT interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Serial0/1/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>         <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>          <span class="n">Outside</span> <span class="k">global</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.225</span><span class="p">:</span><span class="mi">8080</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.254</span><span class="p">:</span><span class="mi">80</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.254</span><span class="p">:</span><span class="mi">46088</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.254</span><span class="p">:</span><span class="mi">46088</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.225</span><span class="p">:</span><span class="mi">8080</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.254</span><span class="p">:</span><span class="mi">80</span>  <span class="o">---</span>                    <span class="o">---</span>
</pre></div>
</div>
<p>In the example, when the router receives the packet with the inside global IPv4 address of 209.165.200.225 and a TCP destination port 8080, the router performs a NAT table lookup using the destination IPv4 address and destination port as the key. The router then translates the address to the inside local address of host 192.168.10.254 and destination port 80. R2 then forwards the packet to the web server. For return packets from the web server back to the client, this process is reversed.</p>
</div>
<div class="section" id="nat-for-ipv6">
<h2>NAT for IPv6?<a class="headerlink" href="#nat-for-ipv6" title="Permalink to this headline">¶</a></h2>
<p>IPv6, with a 128-bit address, provides 340 undecillion addresses. Therefore, address space is not an issue. IPv6 was developed with the intention of making NAT for IPv4 with its translation between public and private IPv4 addresses unnecessary. However, IPv6 does implement a form of NAT. IPv6 includes both its own IPv6 private address space and NAT, which are implemented differently than they are for IPv4.</p>
</div>
<div class="section" id="ipv6-unique-local-address-ula">
<h2>IPv6 Unique Local Address ULA<a class="headerlink" href="#ipv6-unique-local-address-ula" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_ipv6_unique_local_address.png" src="../../../_images/Ch9_ipv6_unique_local_address.png" />
<p>The intent of ULA is to provide IPv6 address space for communications within a local site; it is not meant to provide additional IPv6 address space, nor is it meant to provide a level of security.</p>
<p>As shown in the image, ULA have the <strong>prefix FC00::/7</strong>, which results in a first hextet <strong>range of FC00 to FDFF</strong>. The <strong>next 1 bit is set to 1 if the prefix is locally assigned</strong>. Set to 0 may be defined in the future. The next 40 bits is a global ID followed by a 16-bit Subnet ID. These first 64 bits combine to make the ULA prefix. This leaves the remaining 64 bits for the interface ID, or in IPv4 terms, the host portion of the address.</p>
<p>Unique local addresses are defined in RFC 4193. ULAs are also known as <strong>local IPv6 addresses</strong> (not to be confused with IPv6 link-local addresses) and have several characteristics including:</p>
<ul class="simple">
<li>Allows sites to be combined or privately interconnected, without creating any address conflicts or requiring renumbering of interfaces that use these prefixes.</li>
<li>Independent of any ISP and can be used for communications within a site without having any Internet connectivity.</li>
<li>Not routable across the Internet, however, if accidentally leaked by routing or DNS, there is not conflict with other addresses.</li>
</ul>
<p>ULA is not quite as straight-forward as RFC 1918 addresses. Unlike private IPv4 addresses, it has not been the intention of the IETF to use a form of NAT to translate between unique local addresses and IPv6 global unicast addresses.</p>
<p>The implementation and potential uses for IPv6 unique local addresses are still being examined by the Internet community. For example, the IETF is considering allowing the option of having the 40-bit global ID centrally assigned when using the FC00::/8 ULA prefix, and the 40-bit global ID randomly generated, or perhaps manually assigned, when using the ULA prefix FD00::/8. The rest of the address remains the same. We still use 16 bits for the subnet ID and 64 bits for the interface ID.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The original IPv6 specification allocated address space for site-local addresses, defined in RFC 3513. Site-local addresses have been deprecated by the IETF in RFC 3879 because the term “site” was somewhat ambiguous. Site-local addresses had the prefix range of FEC0::/10 and may still be found in some older IPv6 documentation.T for IPv6</p>
</div>
</div>
<div class="section" id="id1">
<h2>NAT for IPv6<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_NAT64.png" src="../../../_images/Ch9_NAT64.png" />
<p>NAT for IPv6 is used in a much different context than NAT for IPv4. The varieties of NAT for IPv6 are used to transparently provide access between IPv6-only and IPv4-only networks. It is not used as a form of private IPv6 to global IPv6 translation.</p>
<p>Ideally, IPv6 should be run natively wherever possible. This means IPv6 devices communicating with each other over IPv6 networks. However, to aid in the move from IPv4 to IPv6, the IETF has developed several transition techniques to accommodate a variety of IPv4-to-IPv6 scenarios, including dual-stack, tunneling, and translation.</p>
<p>Dual-stack is when the devices are running protocols associated with both the IPv4 and IPv6. Tunneling for IPV6 is the process of encapsulating an IPv6 packet inside an IPv4 packet. This allows the IPv6 packet to be transmitted over an IPv4-only network.</p>
<p>NAT for IPv6 should not be used as a long term strategy, but as a temporary mechanism to assist in the migration from IPv4 to IPv6. Over the years, there have been several types of NAT for IPv6 including Network Address Translation-Protocol Translation (NAT-PT). NAT-PT has been deprecated by IETF in favor of its replacement, NAT64. NAT64 is beyond the scope of this curriculum.</p>
<p>The image shows three clouds. Two are labeled ipv6 and one is labeled ipv4. The packets traveling between the two ipv6 networks are native ipv6 packets. The packets traveling between the ipv4 and ipv6 are translated.</p>
</div>
<div class="section" id="troubleshooting-nat">
<h2>Troubleshooting NAT<a class="headerlink" href="#troubleshooting-nat" title="Permalink to this headline">¶</a></h2>
<p>The show ip nat Commands</p>
<p>Figure 1 shows R2 enabled for PAT, using the range of addresses 209.165.200.226 to 209.165.200.240.</p>
<p>When there are IPv4 connectivity problems in a NAT environment, it is often difficult to determine the cause of the problem. The first step in solving the problem is to rule out NAT as the cause. Follow these steps to verify that NAT is operating as expected:</p>
<p>Step 1. Based on the configuration, clearly define what NAT is supposed to achieve. This may reveal a problem with the configuration.</p>
<p>Step 2. Verify that correct translations exist in the translation table using the show ip nat translations command.</p>
<p>Step 3. Use the clear and debug commands to verify that NAT is operating as expected. Check to see if dynamic entries are recreated after they are cleared.</p>
<p>Step 4. Review in detail what is happening to the packet, and verify that routers have the correct routing information to move the packet.</p>
<p><code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code> and <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">translations</span></code> commands. Prior to using the show commands, the NAT statistics and entries in the NAT table are cleared with the <code class="docutils literal"><span class="pre">clear</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code> and <code class="docutils literal"><span class="pre">clear</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">translation</span> <span class="pre">*</span></code> commands. After the host at 192.168.10.10 telnets to the server at 209.165.201.1, the NAT statistics and NAT table are displayed to verify NAT is working as expected.</p>
<p>In a simple network environment, it is useful to monitor NAT statistics with the show ip nat statistics command. The show ip nat statistics command displays information about the total number of active translations, NAT configuration parameters, the number of addresses in the pool, and the number that have been allocated. However, in a more complex NAT environment, with several translations taking place, this command may not clearly identify the issue. It may be necessary to run <code class="docutils literal"><span class="pre">debug</span></code> commands on the router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1"># debug ip nat</span>
<span class="n">R2</span><span class="c1"># debug ip nat detailed</span>
</pre></div>
</div>
<p>When decoding the debug output, note what the following symbols and values indicate:</p>
<blockquote>
<div><ul class="simple">
<li>(asterisk) - The asterisk next to NAT indicates that the translation is occurring in the fast-switched path. The first packet in a conversation is always process-switched, which is slower. The remaining packets go through the fast-switched path if a cache entry exists.</li>
</ul>
<p>s= - This symbol refers to the source IPv4 address.</p>
<p>a.b.c.d—&gt;w.x.y.z - This value indicates that source address a.b.c.d is translated to w.x.y.z.</p>
<p>d= - This symbol refers to the destination IPv4 address.</p>
<p>[xxxx] - The value in brackets is the IPv4 identification number. This information may be useful for debugging in that it enables correlation with other packet traces from protocol analyzers.</p>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Verify that the ACL referenced in the NAT command is permitting all of the necessary networks. E.g., only 192.168.0.0/16 addresses are eligible to be translated. Packets from the inside network destined for the Internet with source addresses that are not explicitly permitted by ACL 1 are not translated by R2.</p>
</div>
<img alt="../../../_images/Ch9_NAT_troubleshooting_scenario1.png" src="../../../_images/Ch9_NAT_troubleshooting_scenario1.png" />
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1"># show ip nat translations</span>
<span class="n">R2</span><span class="c1">#</span>
<span class="n">R2</span><span class="c1"># show ip nat statistics</span>
<span class="n">Total</span> <span class="n">active</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">0</span> <span class="n">dynamic</span><span class="p">;</span> <span class="mi">0</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Peak</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Outside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">0</span> <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>

<span class="n">R2</span><span class="c1">#conf t</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface serial 0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no ip nat outside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface serial 0/0/1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1"># show access-lists</span>
<span class="n">Standard</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="mi">1</span>
    <span class="mi">10</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">wildcard</span> <span class="n">bits</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
<span class="n">R2</span><span class="c1">#</span>

<span class="n">R2</span><span class="c1">#conf t</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no access-list 1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit 192.168.0.0 0.0.255.255</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1"># show ip nat statistics</span>
<span class="n">Total</span> <span class="n">active</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">1</span> <span class="n">dynamic</span><span class="p">;</span> <span class="mi">1</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Peak</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">occurred</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">19</span> <span class="n">ago</span>
<span class="n">Outside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Inside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">20</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">CEF</span> <span class="n">Translated</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="n">CEF</span> <span class="n">Punted</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="p">[</span><span class="n">Id</span><span class="p">:</span> <span class="mi">5</span><span class="p">]</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL2</span> <span class="n">refcount</span> <span class="n">r1</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL2</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.224</span>
<span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.226</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.240</span>
<span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">15</span><span class="p">,</span> <span class="n">allocated</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">6</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>

<span class="n">R2</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>         <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.226</span><span class="p">:</span><span class="mi">38</span>   <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.10</span><span class="p">:</span><span class="mi">38</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.1</span><span class="p">:</span><span class="mi">38</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.1</span><span class="p">:</span><span class="mi">38</span>
<span class="n">R2</span><span class="c1">#</span>
</pre></div>
</div>
</div>
<div class="section" id="pt-troubleshooting-nat-ex1">
<h2>PT Troubleshooting NAT ex1<a class="headerlink" href="#pt-troubleshooting-nat-ex1" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_pt_troubleshooting_NAT_ex1.png" src="../../../_images/Ch9_pt_troubleshooting_NAT_ex1.png" />
<div class="section" id="addressing-table-ex1">
<h3>Addressing Table ex1<a class="headerlink" href="#addressing-table-ex1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="16%" />
<col width="23%" />
<col width="24%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R1</td>
<td>G0/0</td>
<td>10.4.10.254</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/1</td>
<td>10.4.11.254</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/1</td>
<td>10.4.1.2</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>R2</td>
<td>S0/0/0</td>
<td>209.165.76.194</td>
<td>255.255.255.224</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/1</td>
<td>10.4.1.1</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>Server1</td>
<td>NIC</td>
<td>64.100.201.5</td>
<td>255.255.255.0</td>
<td>64.100.201.1</td>
</tr>
<tr class="row-even"><td>PC1</td>
<td>NIC</td>
<td>10.4.10.1</td>
<td>255.255.255.0</td>
<td>10.4.10.254</td>
</tr>
<tr class="row-odd"><td>PC2</td>
<td>NIC</td>
<td>10.4.10.2</td>
<td>255.255.255.0</td>
<td>10.4.10.254</td>
</tr>
<tr class="row-even"><td>L1</td>
<td>NIC</td>
<td>10.4.11.1</td>
<td>255.255.255.0</td>
<td>10.4.11.254</td>
</tr>
<tr class="row-odd"><td>L2</td>
<td>NIC</td>
<td>10.4.11.2</td>
<td>255.255.255.0</td>
<td>10.4.11.254</td>
</tr>
</tbody>
</table>
<p>Objectives</p>
<p>Part 1: Isolate Problems</p>
<p>Part 2: Troubleshoot NAT Configuration</p>
<p>Part 3: Verify Connectivity</p>
<p>Scenario</p>
<p>A contractor restored an old configuration to a new router running NAT. But, the network has changed and a new subnet was added after the old configuration was backed up. It is your job to get the network working again.</p>
<p>Ping Server1 from PC1, PC2, L1, L2, and R2.
Record the success of each ping. Ping any other machines as needed.</p>
<dl class="docutils">
<dt>Pinging 64.100.201.5 with 32 bytes of data:</dt>
<dd><dl class="first last docutils">
<dt>from pc1</dt>
<dd>Packets: Sent = 4, Received = 0, Lost = 4 (100% loss)</dd>
<dt>from pc2</dt>
<dd>Packets: Sent = 4, Received = 0, Lost = 4 (100% loss)</dd>
<dt>from L1</dt>
<dd>Packets: Sent = 4, Received = 0, Lost = 4 (100% loss)</dd>
<dt>from L2</dt>
<dd>Packets: Sent = 4, Received = 0, Lost = 4 (100% loss)</dd>
<dt>from R2</dt>
<dd><div class="code first last highlight-default"><div class="highlight"><pre><span></span>R2#ping 64.100.201.5
Sending 5, 100-byte ICMP Echos to 64.100.201.5, timeout is 2 seconds
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 1/2/5 ms
</pre></div>
</div>
</dd>
</dl>
</dd>
</dl>
</div>
<div class="section" id="pt-troubleshoot-nat-configuration">
<h3>PT Troubleshoot NAT Configuration<a class="headerlink" href="#pt-troubleshoot-nat-configuration" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">View the NAT translations on R2. If NAT is working, there should be table entries.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1">#show ip nat translation</span>
<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">0</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">0</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">16</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">101</span> <span class="n">pool</span> <span class="n">R2POOL</span> <span class="n">refCount</span> <span class="mi">0</span>
 <span class="n">pool</span> <span class="n">R2POOL</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.224</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.223</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">29</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">0</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>

<span class="n">so</span> <span class="n">the</span> <span class="n">statistics</span> <span class="n">tell</span> <span class="n">us</span> <span class="n">that</span> <span class="n">there</span> <span class="n">were</span> <span class="mi">16</span> <span class="n">misses</span> <span class="n">on</span> <span class="n">the</span> <span class="n">inside</span> <span class="n">interface</span> <span class="n">Serial</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Indeed</span> <span class="n">we</span> <span class="n">deed</span> <span class="n">pings</span> <span class="kn">from</span> <span class="mi">4</span> <span class="n">locations</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">network</span> <span class="n">to</span> <span class="n">this</span> <span class="n">interface</span> <span class="n">towards</span> <span class="n">server1</span> <span class="n">this</span> <span class="n">makes</span> <span class="n">sense</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p class="first">Show the running configuration of R2. The NAT inside port should align with the private address, while the NAT outside port should align with the public address.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>!
interface Serial0/0/0
 ip address 209.165.76.194 255.255.255.224
 ip nat inside
 clock rate 2000000
!
interface Serial0/0/1
 ip address 10.4.1.1 255.255.255.252
 ip nat outside
 clock rate 2000000
!
ip nat pool R2POOL 209.165.76.195 209.165.76.223 netmask 255.255.255.224
ip nat inside source list 101 pool R2POOL
!
ip route 10.0.0.0 255.0.0.0 10.4.1.2
ip route 0.0.0.0 0.0.0.0 209.165.76.193
!
access-list 101 permit ip 10.4.10.0 0.0.0.255 any
!
</pre></div>
</div>
<p>Inside and outside are incorrectly configured, got it backwards here</p>
</li>
<li><p class="first">Correct the Interfaces. Assign the ip nat inside and ip nat outside commands to the correct ports.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">nat</span> <span class="n">debugging</span> <span class="ow">is</span> <span class="n">on</span>

<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface Serial 0/0/1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#no ip nat outside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="n">ip_ifnat_modified</span><span class="p">:</span> <span class="n">old_if</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_if</span> <span class="mi">2</span>

<span class="n">ip</span> <span class="n">nat</span> <span class="n">inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="n">ip_ifnat_modified</span><span class="p">:</span> <span class="n">old_if</span> <span class="mi">2</span><span class="p">,</span> <span class="n">new_if</span> <span class="mi">0</span>

<span class="n">now</span> <span class="n">configure</span> <span class="n">serial</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span> <span class="k">as</span> <span class="n">outside</span> <span class="n">nat</span> <span class="k">if</span>
<span class="o">--------------------------------------------</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#interface Serial 0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#no ip nat insid</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#no ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="n">ip_ifnat_modified</span><span class="p">:</span> <span class="n">old_if</span> <span class="mi">0</span><span class="p">,</span> <span class="n">new_if</span> <span class="mi">2</span>

<span class="n">ip</span> <span class="n">nat</span> <span class="n">outside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="n">ip_ifnat_modified</span><span class="p">:</span> <span class="n">old_if</span> <span class="mi">2</span><span class="p">,</span> <span class="n">new_if</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p class="first">Ping Server1 from PC1, PC2, L1, L2, and R2. Record the success of each ping. Ping any other machines as needed.</p>
<dl class="docutils">
<dt>from L1 and L2</dt>
<dd><p class="first last">same as before, ping unsuccessful and increasing the miss counter in ip nat statistics</p>
</dd>
<dt>from PC1 is successful</dt>
<dd><p class="first">see NAT translations working and later expiring via debug ip nat after the ping from PC1 (ip 10.4.10.1)</p>
<div class="code last highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">33</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">34</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">7</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">35</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">36</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">5</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">6</span> <span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">7</span> <span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">8</span> <span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>View the NAT translations on R2. If NAT is working, there should be table entries.</dt>
<dd><p class="first">Well NAT is not working properly yet as only nodes on the 10.4.10.0/24 network are being translated
the 10.4.11.0/24 ain’t getting any..</p>
<div class="code last highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1">#show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">10</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">10</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">10</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">10</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">11</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">11</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">11</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">11</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">12</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">12</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">12</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">12</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">9</span>  <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">9</span>        <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">9</span>     <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">9</span>
<span class="n">R2</span><span class="c1">#</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">9</span> <span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">11</span> <span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">12</span> <span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p class="first">Show Access-list 101 on R2. The wildcard mask should encompass both the 10.4.10.0 network and the 10.4.11.0 network.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1">#show ip access-list</span>
<span class="n">Extended</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="mi">101</span>
    <span class="mi">10</span> <span class="n">permit</span> <span class="n">ip</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span> <span class="nb">any</span> <span class="p">(</span><span class="mi">16</span> <span class="n">match</span><span class="p">(</span><span class="n">es</span><span class="p">))</span>
</pre></div>
</div>
<p>obviously the 11 isn’t included.. lets fix this</p>
</li>
<li><p class="first">Correct the Access-list. Delete access-list 101 and replace it with a similar list that is also one statement in length. The only difference should be the wildcard.</p>
<p>to include the 11 we will need to change the third octet of the wildcard..
so to include 11 would be like changing the subnet from 24 to 23 which means 2^23 network bits and 2^9 host bits = 510 nodes
so  255.255.255.255
| - 255.255.254.0 (/23 instead of /24)
| =   0.  0.  1.255</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no access-list 101 permit ip 10.4.10.0 0.0.0.255 any</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#access-list 101 permit ip 10.4.10.0 0.0.1.255 any</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="pt-verify-connectivity">
<h3>PT Verify Connectivity<a class="headerlink" href="#pt-verify-connectivity" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Verify connectivity to Server1. Record the success of each ping. All hosts should be able to ping Server1, R1, and R2. Troubleshoot if the pings are not successful.
sure enough pings are working now</p>
</li>
<li><p class="first">View the NAT translations on R2. NAT should display many table entries.
launch a ping from a node in each network and check nat translations with debugging on for bonus kudos</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="o">&gt;</span><span class="n">en</span>
<span class="n">R2</span><span class="c1">#show ip nat translation</span>
<span class="n">R2</span><span class="c1">#</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span> <span class="p">[</span><span class="mi">49</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">30</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span> <span class="p">[</span><span class="mi">50</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">31</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span> <span class="p">[</span><span class="mi">51</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">32</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span> <span class="p">[</span><span class="mi">52</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">13</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">53</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">14</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">54</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">15</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">55</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">16</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">56</span><span class="p">]</span>
<span class="n">show</span> <span class="n">ip</span> <span class="n">nat</span> <span class="n">translation</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">29</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">29</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">29</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">29</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">30</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">30</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">30</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">30</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">31</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">31</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">31</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">31</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">32</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">32</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">32</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">32</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">:</span><span class="mi">13</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">13</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">13</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">13</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">:</span><span class="mi">14</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">14</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">14</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">14</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">:</span><span class="mi">15</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">15</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">15</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">15</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">:</span><span class="mi">16</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">16</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">16</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">16</span>

<span class="n">R2</span><span class="c1">#</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">29</span> <span class="p">(</span><span class="mi">29</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">30</span> <span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">31</span> <span class="p">(</span><span class="mi">31</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">32</span> <span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">13</span> <span class="p">(</span><span class="mi">13</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">14</span> <span class="p">(</span><span class="mi">14</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">15</span> <span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">16</span> <span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="lab-troubleshooting-nat">
<h2>LAB Troubleshooting NAT<a class="headerlink" href="#lab-troubleshooting-nat" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/Ch9_lab_troubleshooting_NAT.png" src="../../../_images/Ch9_lab_troubleshooting_NAT.png" />
<div class="section" id="pt-addressing-table">
<h3>PT Addressing Table<a class="headerlink" href="#pt-addressing-table" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="19%" />
<col width="23%" />
<col width="23%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Gateway</td>
<td>G0/1</td>
<td>192.168.1.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>209.165.200.225</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>ISP</td>
<td>S0/0/0 (DCE)</td>
<td>209.165.200.226</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Lo0</td>
<td>198.133.219.1</td>
<td>255.255.255.255</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>PC-A</td>
<td>NIC</td>
<td>192.168.1.3</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
<tr class="row-odd"><td>PC-B</td>
<td>NIC</td>
<td>192.168.1.4</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
</tbody>
</table>
<p>Objectives
Part 1: Build the Network and Configure Basic Device Settings
Part 2: Troubleshoot Static NAT
Part 3: Troubleshoot Dynamic NAT</p>
<p>Background / Scenario
In this lab, the Gateway router was configured by an inexperienced network administrator at your company.  Several errors in the configuration have resulted in NAT issues. Your boss has asked you to troubleshoot and correct the NAT errors and document your work. Ensure that the network supports the following:</p>
<blockquote>
<div><ul class="simple">
<li>PC-A acts as a web server with a static NAT and will be reachable from the outside using the 209.165.200.254 address.</li>
<li>PC-B acts as a host computer and dynamically receives an IP address from the created pool of addresses called NAT_POOL, which uses the 209.165.200.240/29 range.</li>
</ul>
</div></blockquote>
<p>Copy the following basic configuration and paste it to the running-configuration on the router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">no</span> <span class="n">ip</span> <span class="n">domain</span><span class="o">-</span><span class="n">lookup</span>
<span class="n">service</span> <span class="n">password</span><span class="o">-</span><span class="n">encryption</span>
<span class="n">enable</span> <span class="n">secret</span> <span class="k">class</span>
<span class="nc">banner</span> <span class="n">motd</span> <span class="c1">#</span>
<span class="n">Unauthorized</span> <span class="n">access</span> <span class="ow">is</span> <span class="n">strictly</span> <span class="n">prohibited</span><span class="o">.</span> <span class="c1">#</span>
<span class="n">line</span> <span class="n">con</span> <span class="mi">0</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
<span class="n">logging</span> <span class="n">synchronous</span>
<span class="n">line</span> <span class="n">vty</span> <span class="mi">0</span> <span class="mi">4</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-static-routing">
<h3>Configure Static Routing<a class="headerlink" href="#configure-static-routing" title="Permalink to this headline">¶</a></h3>
<ol class="loweralpha">
<li><p class="first">Create a static route from the ISP router to the Gateway router which was assigned public network address range 209.165.200.224/27.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ISP</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 209.165.200.224 255.255.255.224 s0/0/0</span>
</pre></div>
</div>
</li>
<li><p class="first">Create a default route from the Gateway router to the ISP router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 0.0.0.0 0.0.0.0 s0/0/1</span>
</pre></div>
</div>
</li>
</ol>
<p>provided faulty configurations:</p>
<p>Gateway Router Configuration</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>interface
g0/1
 ip nat outside
no shutdown
interface
s0/0/0
 ip nat outside
interface
s0/0/1
no shutdown
ip nat inside source static 192.168.2.3
209.165.200.254
ip nat pool NAT_POOL
209.165.200.241 209.165.200.246
netmask 255.255.255.248
ip nat inside source list NAT_ACL pool NATPOOL
ip access-
list standard NAT_ACL
 permit 192.168
.10.0 0.0.0.255
banner motd $AUTHORIZED ACCESS ONLY$
end
</pre></div>
</div>
</div>
<div class="section" id="troubleshoot-static-nat">
<h3>Troubleshoot Static NAT<a class="headerlink" href="#troubleshoot-static-nat" title="Permalink to this headline">¶</a></h3>
<p>examine the static NAT for PC-A to determine if it is configured correctly. You will troubleshoot the scenario until the correct static NAT is verified.</p>
<ol class="loweralpha">
<li><p class="first">To troubleshoot issues with NAT, use the <code class="docutils literal"><span class="pre">debug</span> <span class="pre">ip</span> <span class="pre">nat</span></code> command. Turn on NAT debugging to see translations in real-time across the Gateway router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># debug ip nat</span>
</pre></div>
</div>
</li>
<li><p class="first">From PC-A, ping Lo0 on the ISP router. Do any NAT debug translations appear on the Gateway router?</p>
</li>
<li><p class="first">On the Gateway router, enter the command that allows you to see all current NAT translations on the Gateway router. Write the command in the space below.
Why are you seeing a NAT translation in the table, but none occurred when PC-A pinged the ISP loopback interface? What is needed to correct the issue?</p>
</li>
<li><p class="first">Record any commands that are necessary to correct the static NAT configuration error</p>
</li>
<li><p class="first">From PC-A, ping Lo0 on the ISP router. Do any NAT debug translations appear on the Gateway router?</p>
</li>
<li><p class="first">On the Gateway router, enter the command that allows you to observe the total number of current NATs.</p>
<p>Write the command in the space below. Is the static NAT occurring successfully? Why?</p>
</li>
<li><p class="first">On the Gateway router, enter the command that allows you to view the current configuration of the router. Write the command in the space below.</p>
</li>
<li><p class="first">Are there any problems with the current configuration that prevent the static NAT from occurring?</p>
</li>
<li><p class="first">Record any commands that are necessary to correct the static NAT configuration errors.</p>
</li>
<li><p class="first">From PC-A, ping Lo0 on the ISP router. Do any NAT debug translations appear on the Gateway router?</p>
</li>
<li><p class="first">Use the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">translations</span> <span class="pre">verbose</span></code> command to verify static NAT functionality.</p>
</li>
</ol>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The timeout value for ICMP is very short. If you do not see all the translations in the output, redo the ping.</p>
</div>
<p>Is the static NAT translation occurring successfully?
If static NAT is not occurring, repeat the steps above to troubleshoot the configuration.</p>
</div></blockquote>
</div>
<div class="section" id="troubleshoot-dynamic-nat">
<h3>Troubleshoot Dynamic NAT<a class="headerlink" href="#troubleshoot-dynamic-nat" title="Permalink to this headline">¶</a></h3>
<ol class="loweralpha">
<li><p class="first">From PC-B, ping Lo0 on the ISP router. Do any NAT debug translations appear on the Gateway router?</p>
</li>
<li><p class="first">On the Gateway router, enter the command that allows you to view the current configuration of the router. Are there any problems with the current configuration that prevent dynamic NAT from occurring?</p>
</li>
<li><p class="first">Record any commands that are necessary to correct the dynamic NAT configuration errors.</p>
</li>
<li><p class="first">From PC-B, ping Lo0 on the ISP router. Do any NAT debug translations appear on the Gateway router?</p>
</li>
<li><p class="first">Use the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code> to view NAT usage.</p>
<p>Is the NAT occurring successfully?
What percentage of dynamic addresses has been allocated?</p>
</li>
<li><p class="first">Turn off all debugging using the <code class="docutils literal"><span class="pre">undebug</span> <span class="pre">all</span></code> command.</p>
</li>
</ol>
<p>Reflection</p>
<ol class="arabic simple">
<li>What is the benefit of a static NAT?</li>
<li>What issues would arise if 10 host computers in this network were attempting simultaneous Internet communication?</li>
</ol>
</div>
</div>
<div class="section" id="ch9-skills-integration-test-assignment">
<h2>Ch9 Skills Integration Test - assignment<a class="headerlink" href="#ch9-skills-integration-test-assignment" title="Permalink to this headline">¶</a></h2>
<p>Topology Assigned</p>
<img alt="../../../_images/Ch9_skills_integration_test_assignment.png" src="../../../_images/Ch9_skills_integration_test_assignment.png" />
<p>Addressing Table Assigned</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="16%" />
<col width="22%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#160;</td>
<td>G0/0.15</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0.30</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/0.45</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0.60</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/1/0</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/0</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/0</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/1</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>VLAN 60</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>NIC</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
</tr>
</tbody>
</table>
<p>VLANs and Port Assignments Table Given</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="37%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">VLAN Number - Name</th>
<th class="head">Port assignment</th>
<th class="head">Network</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>15- Servers</td>
<td>F0/11 - F0/20</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>30- PCs</td>
<td>F0/1 - F0/10</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>45- Native</td>
<td>G0/1</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>60 - Management</td>
<td>VLAN 60</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>complete the documentation for the network</li>
<li>configure VLANS, Trunking, port security and SSH remote access on a switch</li>
<li>implement inter-VLAN routing and NAT on a router</li>
<li>Use your documentation to verify implementation &amp; test end2end connectivity</li>
</ul>
<ol class="arabic simple">
<li>Label All the device names, network addresses and other important information</li>
<li>Complete the <strong>Addressing Table</strong> and <strong>VLANS &amp; Port assignment Table</strong></li>
<li>Fill in any blanks in the implementation and verification steps. The information is supplied when
you launch the Packet Tracer activity.</li>
</ol>
<div class="section" id="implementation-given">
<h3>Implementation Given<a class="headerlink" href="#implementation-given" title="Permalink to this headline">¶</a></h3>
<p>Note: All devices in the topology except , , and    are fully configured. You do not have access to the other routers. You can access all the servers and PCs for testing purposes.</p>
<p>Implement to following requirements using your documentation:
• Configure remote management access including IP addressing and SSH:</p>
<blockquote>
<div><ul class="simple">
<li>Domain is cisco.com</li>
<li>User     with password</li>
<li>Crypto key length of 1024</li>
<li>SSH version 2, limited to 2 authentication attempts and a 60 second timeout</li>
<li>Clear text passwords should be encrypted.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Configure, name and assign VLANs. Ports should be manually configured as access ports.</li>
<li>Configure trunking.</li>
<li>Implement port security:<ul>
<li>On Fa0/1, allow 2 MAC addresses that are automatically added to the configuration file when detected. The port should not be disabled, but a syslog message should be captured if a violation occurs.</li>
<li>Disable all other unused ports.</li>
</ul>
</li>
<li>Configure inter-VLAN routing.</li>
<li>Configure DHCP services for VLAN 30. Use <strong>LAN</strong> as the case-sensitive name for the pool.</li>
<li>Implement routing:</li>
</ul>
<ul class="simple">
<li>Use RIPv2 as the routing protocol.</li>
<li>Configure one network statement for the entire address space.</li>
<li>Disable interfaces that should not send RIPv2 messages.</li>
<li>Configure a default route to the Internet.</li>
</ul>
<ul class="simple">
<li>Implement NAT:<ul>
<li>Configure a standard, one statement ACL number 1. All IP addresses belonging to the addr ess space are allowed.</li>
<li>Refer to your documentation and configure static NAT for the File Server.</li>
<li>Configure dynamic NAT with PAT using a pool name of your choice, a /30 mask, and these two public addresses:</li>
</ul>
</li>
</ul>
<p>Verify       has received full addressing information from       .</p>
</div>
<div class="section" id="verification-given">
<h3>Verification Given<a class="headerlink" href="#verification-given" title="Permalink to this headline">¶</a></h3>
<p>All devices should now be able to ping all other devices. If not, troubleshoot your configurations to isolate and solve problems. A few tests include:
• Verify remote access to       by using SSH from a PC.
• Verify VLANs are assigned to appropriate ports and port security is in force.
• Verify OSPF neighbors and a complete routing table.
• Verify NAT translations and statics.</p>
<blockquote>
<div><ul class="simple">
<li><strong>Outside Host</strong> should be able to access <strong>File Server</strong> at the public address.</li>
<li>Inside PCs should be able to access <strong>Web Server</strong>.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Document any problems you encountered and the solutions in the <strong>Troubleshooting Documentation</strong> table below.</li>
</ul>
<p>Troubleshooting Documentation</p>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">________Problem________</th>
<th class="head">________Solution________</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>Packet Tracer scores 70 points.  Documentation is worth 30 points.</p>
</div>
</div>
<div class="section" id="ch9-skills-integration-test-when-opened-with-pt-7-0-on-windos">
<h2>Ch9 Skills Integration Test - when opened with PT 7.0 on windos<a class="headerlink" href="#ch9-skills-integration-test-when-opened-with-pt-7-0-on-windos" title="Permalink to this headline">¶</a></h2>
<p>Topology Solved</p>
<img alt="../../../_images/Ch9_Skills_integration_test.png" src="../../../_images/Ch9_Skills_integration_test.png" />
<p>???????why are ips present here and not in PDF ????????</p>
<p>Addressing Table Solved</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="16%" />
<col width="23%" />
<col width="24%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Central</td>
<td>G0/0.15</td>
<td>172.16.15.17</td>
<td>255.255.255.240</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0.30</td>
<td>172.16.15.33</td>
<td>255.255.255.224</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/0.45</td>
<td>172.16.15.1</td>
<td>255.255.255.248</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0.60</td>
<td>172.16.15.9</td>
<td>255.255.255.248</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0</td>
<td>172.16.15.245</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>172.16.15.254</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/1/0</td>
<td>192.135.250.18</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>East</td>
<td>G0/0</td>
<td>172.16.15.65</td>
<td>255.255.255.192</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0</td>
<td>172.16.15.249</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>172.16.15.246</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>West</td>
<td>G0/0</td>
<td>172.16.15.129</td>
<td>255.255.255.192</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/0</td>
<td>172.16.15.253</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/1</td>
<td>172.16.15.250</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>Cnt-Sw</td>
<td>VLAN 60</td>
<td>172.16.15.10</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>NIC</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
</tr>
</tbody>
</table>
<p>VLANs and Port Assignments Table Solved</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="31%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">VLAN Number - Name</th>
<th class="head">Port assignment</th>
<th class="head">Network</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>15 - Servers</td>
<td>F0/11 - F0/20</td>
<td>172.16.15.16 /28</td>
</tr>
<tr class="row-odd"><td>30 - PCs</td>
<td>F0/1 - F0/10</td>
<td>172.16.15.32 /27</td>
</tr>
<tr class="row-even"><td>45 - Native</td>
<td>G0/1</td>
<td>172.16.15.0  /29</td>
</tr>
<tr class="row-odd"><td>60 - Management</td>
<td>VLAN 60</td>
<td>172.16.15.8  /29</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>complete the documentation for the network</li>
<li>configure VLANS, Trunking, port security and SSH remote access on a switch</li>
<li>implement inter-VLAN routing and NAT on a router</li>
<li>Use your documentation to verify implementation &amp; test end2end connectivity</li>
</ul>
<ol class="arabic simple">
<li>Label All the device names, network addresses and other important information</li>
<li>Complete the <strong>Addressing Table</strong> and <strong>VLANS &amp; Port assignment Table</strong></li>
<li>Fill in any blanks in the implementation and verification steps. The information is supplied when
you launch the Packet Tracer activity.</li>
</ol>
<div class="section" id="implementation-completed">
<h3>Implementation completed<a class="headerlink" href="#implementation-completed" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All devices in the topology except Central, Cnt-Sw, and NetAdmin are fully configured. You do not have access to the other routers. You can access all the servers and PCs for testing purposes.</p>
</div>
<p>Implement to following requirements using your documentation:</p>
<p>Cnt-Sw</p>
<ul class="simple">
<li>Configure remote management access including IP addressing and SSH:<ul>
<li>Domain is cisco.com</li>
<li>User HQadmin with password ciscoclass</li>
<li>Crypto key length of 1024</li>
<li>SSH version 2, limited to 2 authentication attempts and a 60 second timeout</li>
<li>Clear text passwords should be encrypted.</li>
</ul>
</li>
<li>Configure, name and assign VLANs. Ports should be manually configured as access ports.</li>
<li>Configure trunking.</li>
<li>Implement port security:<ul>
<li>On Fa0/1, allow 2 MAC addresses that are automatically added to the configuration file when detected. The port should not be disabled, but a syslog message should be captured if a violation occurs.</li>
<li>Disable all other unused ports.</li>
</ul>
</li>
</ul>
<p>Central</p>
<ul>
<li><p class="first">Configure inter-VLAN routing.</p>
</li>
<li><p class="first">Configure DHCP services for VLAN 30. Use <strong>LAN</strong> as the case-sensitive name for the pool.</p>
</li>
<li><p class="first">Implement routing:</p>
<ul class="simple">
<li>Use OSPF Process ID 1 and router ID 1.1.1.1 ?????? why was RIPv2 asked in PDF??????</li>
<li>Configure one network statement for the entire 172.16.15.0/24 address space.</li>
<li>Disable interfaces that should not send RIPv2 messages.</li>
<li>Configure a default route to the Internet.</li>
</ul>
<ul class="simple">
<li>Implement NAT:<ul>
<li>Configure a standard, one statement ACL number 1. All IP addresses belonging to thei 172.16.15.0/24 address space are allowed.</li>
<li>Refer to your documentation and configure static NAT for the File Server.</li>
<li>Configure dynamic NAT with PAT using a pool name of your choice, a /30 mask, and these two public addresses:
209.165.200.225 and 209.165.200.226</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>NetAdmin</p>
<ul class="simple">
<li>Verify NetAdmin has received full addressing information from Central.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the default vlan needs to be configured on the router subinterface <code class="docutils literal"><span class="pre">Central(config-subif)#encapsulation</span> <span class="pre">dot1Q</span> <span class="pre">45</span> <span class="pre">native</span></code></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ospf uses area 0 by default <code class="docutils literal"><span class="pre">Central(config-router)#network</span> <span class="pre">172.16.15.0</span> <span class="pre">0.0.0.255</span> <span class="pre">area</span> <span class="pre">0</span></code></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">don’t forget to apply the ACL. PT does not score this atm. <code class="docutils literal"><span class="pre">Central(config)#ip</span> <span class="pre">nat</span> <span class="pre">inside</span> <span class="pre">source</span> <span class="pre">list</span> <span class="pre">1</span> <span class="pre">pool</span> <span class="pre">NAT-OVERLOAD</span></code></p>
</div>
<p>running configs:</p>
<blockquote>
<div><div class="code highlight-default"><div class="highlight"><pre><span></span>Central(config-router)#do show run
Building configuration...

Current configuration : 2110 bytes
!
version 15.1
no service timestamps log datetime msec
no service timestamps debug datetime msec
no service password-encryption
!
hostname Central
!
no logging console
!
!
!
ip dhcp excluded-address 172.16.15.33
!
ip dhcp pool LAN
 network 172.16.15.32 255.255.255.224
 default-router 172.16.15.33
!
!
!
ip cef
no ipv6 cef
!
!
!
!
license udi pid CISCO1941/K9 sn FTX1524OT6M
!
!
!
!
!
!
!
!
!
!
!
spanning-tree mode pvst
!
!
!
!
interface GigabitEthernet0/0
 no ip address
 ip nat inside
 duplex auto
 speed auto
!
interface GigabitEthernet0/0.15
 description ros-vlan15
 encapsulation dot1Q 15
 ip address 172.16.15.17 255.255.255.240
 ip nat inside
!
interface GigabitEthernet0/0.30
 description ros-vlan30
 encapsulation dot1Q 30
 ip address 172.16.15.33 255.255.255.224
 ip nat inside
!
interface GigabitEthernet0/0.45
 description ros-vlan45-native
 encapsulation dot1Q 45 native
 ip address 172.16.15.1 255.255.255.248
 ip nat inside
!
interface GigabitEthernet0/0.60
 encapsulation dot1Q 60
 ip address 172.16.15.9 255.255.255.248
 ip nat inside
!
interface GigabitEthernet0/1
 no ip address
 duplex auto
 speed auto
 shutdown
!
interface Serial0/0/0
 ip address 172.16.15.245 255.255.255.252
 ip nat inside
 clock rate 2000000
!
interface Serial0/0/1
 ip address 172.16.15.254 255.255.255.252
 ip nat inside
!
interface Serial0/1/0
 description link2internet
 ip address 192.135.250.18 255.255.255.252
 ip nat outside
!
interface Serial0/1/1
 no ip address
 clock rate 2000000
 shutdown
!
interface Vlan1
 no ip address
 shutdown
!
interface Vlan45
 mac-address 0005.5e43.8601
 no ip address
!
router ospf 1
 router-id 1.1.1.1
 log-adjacency-changes
 passive-interface GigabitEthernet0/0
 network 172.16.15.0 0.0.0.255 area 0
!
ip nat pool NAT-OVERLOAD 209.165.200.225 209.165.200.226 netmask 255.255.255.252
ip nat inside source list 1 pool NAT-OVERLOAD
ip nat inside source static 172.16.15.18 209.165.200.227
ip classless
ip route 0.0.0.0 0.0.0.0 Serial0/1/0
!
ip flow-export version 9
!
!
access-list 1 permit 172.16.15.0 0.0.0.255
!
!
!
!
!
line con 0
 exec-timeout 0 0
!
line aux 0
!
line vty 0 4
 login
line vty 5 15
 login
!
!
!
end

switch
------
Cnt-Sw#show run
Building configuration...

Current configuration : 3361 bytes
!
version 12.2
no service timestamps log datetime msec
no service timestamps debug datetime msec
service password-encryption
!
hostname Cnt-Sw
!
!
!
ip ssh version 2
ip ssh authentication-retries 2
ip ssh time-out 60
ip domain-name cisco.com
!
username HQadmin privilege 1 password 7 0822455D0A16061B13181F
!
!
spanning-tree mode pvst
!
interface FastEthernet0/1
 description link2NetAdminVLAN30
 switchport access vlan 30
 switchport mode access
 switchport port-security
 switchport port-security maximum 2
 switchport port-security mac-address sticky
 switchport port-security violation restrict
 switchport port-security mac-address sticky 0001.C90E.8923
!
interface FastEthernet0/2
 switchport access vlan 30
 switchport mode access
 shutdown
!
interface FastEthernet0/3
 switchport access vlan 30
 switchport mode access
 shutdown
!
interface FastEthernet0/4
 switchport access vlan 30
 switchport mode access
 shutdown
!
interface FastEthernet0/5
 switchport access vlan 30
 switchport mode access
 shutdown
!
interface FastEthernet0/6
 switchport access vlan 30
 switchport mode access
 shutdown
!
interface FastEthernet0/7
 switchport access vlan 30
 switchport mode access
 shutdown
!
interface FastEthernet0/8
 switchport access vlan 30
 switchport mode access
 shutdown
!
interface FastEthernet0/9
 switchport access vlan 30
 switchport mode access
 shutdown
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="verification-solved">
<h3>Verification Solved<a class="headerlink" href="#verification-solved" title="Permalink to this headline">¶</a></h3>
<p>to be done 2morrow</p>
<p>All devices should now be able to ping all other devices. If not, troubleshoot your configurations to isolate and solve problems. A few tests include:
• Verify remote access to Cnt-Sw by using SSH from a PC.
• Verify VLANs are assigned to appropriate ports and port security is in force.
• Verify OSPF neighbors and a complete routing table.
• Verify NAT translations and statics.</p>
<blockquote>
<div><ul class="simple">
<li><strong>Outside Host</strong> should be able to access <strong>File Server</strong> at the public address.</li>
<li>Inside PCs should be able to access <strong>Web Server</strong>.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Document any problems you encountered and the solutions in the <strong>Troubleshooting Documentation</strong> table below.</li>
</ul>
</div>
</div>
<div class="section" id="ch9-practice-exam">
<h2>Ch9 practice exam<a class="headerlink" href="#ch9-practice-exam" title="Permalink to this headline">¶</a></h2>
<p>select transparent answer below every question</p>
<ol class="arabic">
<li><p class="first">Which method is used by a PAT-enabled router to send incoming packets to the correct inside hosts?</p>
<ul class="simple">
<li>It uses the destination TCP or UDP port number on the incoming packet</li>
<li>It uses the source IP address on the incoming packet</li>
<li>It uses the source TCP or UDP port number on the incoming packet</li>
<li>It uses a combination of the source TCP or UDP port number and the destination IP address on the incoming packet</li>
<li>Answer -&gt;:transparent:<cite>It uses the destination TCP or UDP port number on the incoming packet</cite></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. Which address or addresses represent the inside global address?</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source static 192.168.0.100 209.165.20.25</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface serial0/0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 10.1.1.2 255.255.255.0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface serial 0/0/2</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 209.165.20.25 255.255.255.0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
<ul class="simple">
<li>10.1.1.2</li>
<li>any address in the 10.1.1.0 network</li>
<li>192.168.0.100</li>
<li>209.165.20.25</li>
<li>Answer -&gt; <span class="transparent">209.165.20.25</span></li>
</ul>
</li>
<li><p class="first">Fill in the blank. Don’t use abbreviations</p>
<ul class="simple">
<li>NAT overload is also known as <span class="transparent">Port Address Translation</span></li>
</ul>
</li>
<li><p class="first">A network administrator is configuring a static NAT on the border router for a web server located in the DMZ network. The web server is configured to listen on TCP port 8080. The web server is paired with the internal IP address of 192.168.5.25 and the external IP address of 209.165.200.230. For easy access by hosts on the Internet, external users do not need to specify the port when visiting the web server. Which command will configure the static NAT?</p>
<ul class="simple">
<li>R1(config)# ip nat inside source static tcp 192.168.5.25 80 209.165.200.230 8080</li>
<li>R1(config)# ip nat inside source static tcp 192.168.5.25 8080 209.165.200.230 80</li>
<li>R1(config)# ip nat inside source static tcp 209.165.200.230 80 192.168.5.25 8080</li>
<li>R1(config)# ip nat inside source static tcp 209.165.200.230 8080 192.168.5.25 80</li>
<li>Answer -&gt; <span class="transparent">R1(config)# ip nat inside source static tcp 192.168.5.25 8080 209.165.200.230 80</span></li>
</ul>
</li>
<li><p class="first">What is defined by the ip nat pool command when configuring dynamic NAT?</p>
<ul class="simple">
<li>the pool of available NAT servers</li>
<li>the range of external IP addresses that internal hosts are permitted to access</li>
<li>the range of internal IP addresses that are translated</li>
<li>the pool of global address*</li>
<li>Answer -&gt; <span class="transparent">the pool of global address</span></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. Based on the output that is shown, what type of NAT has been implemented?</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>         <span class="n">Inside</span> <span class="n">local</span>    <span class="n">Outside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="k">global</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">1405</span>  <span class="mf">10.6</span><span class="o">.</span><span class="mf">15.2</span><span class="p">:</span><span class="mi">1405</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.141</span><span class="p">:</span><span class="mi">80</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.141</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">1406</span>  <span class="mf">10.6</span><span class="o">.</span><span class="mf">15.1</span><span class="p">:</span><span class="mi">1406</span>  <span class="mf">198.51</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">198.51</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">80</span>
</pre></div>
</div>
<ul class="simple">
<li>dynamic NAT with a pool of two public IP addresses</li>
<li>PAT using an external interface</li>
<li>static NAT with one entry</li>
<li>static NAT with a NAT pool</li>
<li>Answer -&gt; <span class="transparent">PAT using an external interface</span></li>
</ul>
</li>
<li><p class="first">What is the primary purpose of NAT?</p>
<ul class="simple">
<li>conserve IPv4 addresses*</li>
<li>increase network security</li>
<li>allow peer-to-peer file sharing</li>
<li>enhance network performance</li>
<li>Answer -&gt; <span class="transparent">conserve IPv4 addresses</span></li>
</ul>
</li>
<li><p class="first">What is the major benefit of using NAT with Port Address Translation?</p>
<ul class="simple">
<li>It allows external hosts access to internal servers</li>
<li>It improves network performance for real-time protocols</li>
<li>It allows many internal hosts to share the same public IPv4 address</li>
<li>It provides a pool of public addresses that can be assigned to internal hosts.</li>
<li>Answer -&gt; <span class="transparent">It allows many internal hosts to share the same public IPv4 address</span></li>
</ul>
</li>
<li><p class="first">What is a characteristic of unique local addresses?</p>
<ul class="simple">
<li>They allow sites to be combined without creating any address conflicts</li>
<li>They are designed to improve the security of IPv6 networks</li>
<li>Their implementation depends on ISPs providing the service</li>
<li>They are defined in RFC 3927</li>
<li>Answer -&gt; <span class="transparent">They allow sites to be combined without creating any address conflicts</span></li>
</ul>
</li>
<li><p class="first">A network administrator configures the border router with the command <code class="docutils literal"><span class="pre">R1(config)#</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">inside</span> <span class="pre">source</span> <span class="pre">list</span> <span class="pre">4</span> <span class="pre">pool</span> <span class="pre">corp</span></code>. What is required to be configured in order for this particular command to be functional?</p>
<ul class="simple">
<li>a NAT pool named corp that defines the starting and ending public IP addresses</li>
<li>an access list named corp that defines the private addresses that are affected by NAT</li>
<li>an access list numbered 4 that defines the starting and ending public IP addresses</li>
<li>ip nat outside to be enabled on the interface that connects to the LAN affected by the NAT</li>
<li>a VLAN named corp to be enabled and active and routed by R1</li>
<li>Answer -&gt; <span class="transparent">a NAT pool named corp that defines the starting and ending public IP addresses</span></li>
</ul>
</li>
<li><p class="first">Which statement describes IPv6 ULAs?</p>
<ul class="simple">
<li>They conserve IPv6 address space</li>
<li>They begin with the fe80::/10 prefix</li>
<li>They are assigned by an ISP</li>
<li>They are not routable across the internet</li>
<li>Answer -&gt; <span class="transparent">They are not routable across the internet</span></li>
</ul>
</li>
<li><p class="first">What is the purpose of port forwarding?</p>
<ul class="simple">
<li>Port forwarding allows an external user to reach a service on a private IPv4 address that is located inside a LAN</li>
<li>Port forwarding allows users to reach servers on the Internet that are not using standard port numbers</li>
<li>Port forwarding allows an internal user to reach a service on a public IPv4 address that is located outside a LAN</li>
<li>Port forwarding allows for translating inside local IP addresses to outside local addresses</li>
<li>Answer -&gt; <span class="transparent">Port forwarding allows an external user to reach a service on a private IPv4 address that is located inside a LAN</span></li>
</ul>
</li>
<li><p class="first">When dynamic NAT without overloading is being used, what happens if seven users attempt to access a public server on the Internet when only six addresses are available in the NAT pool?</p>
<ul class="simple">
<li>No users can access the server</li>
<li>The request to the server for the seventh user fails</li>
<li>All users can access the server</li>
<li>The first user gets disconnected when the seventh user makes the request</li>
<li>Answer -&gt; <span class="transparent">The request to the server for the seventh user fails</span></li>
</ul>
</li>
<li><p class="first">A network engineer has configured a router with the command ip nat inside source list 4 pool corp overload. Why did the engineer use the overload option?</p>
<ul class="simple">
<li>The company has more private IP addresses than available public IP addresses</li>
<li>The company needs to have more public IP addresses available to be used on the Internet</li>
<li>The company router must throttle or buffer traffic because the processing power of the router is not enough to handle the normal load of external-bound Internet traffic</li>
<li>The company has a small number of servers that should be accessible by clients from the Internet</li>
<li>Answer -&gt; <span class="transparent">The company has more private IP addresses than available public IP addresses</span></li>
</ul>
</li>
<li><p class="first">Match the steps with the actions that are involved when an internal host with IP address 192.168.10.10 attempts to send a packet to and external server at the IP address 209.165.200.254 across a router R1 that running dynamic NAT. (Not all options are used.)</p>
<ul class="simple">
<li>not scored</li>
<li>step 1</li>
<li>step 2</li>
<li>step 3</li>
<li>step 4</li>
<li>step 5</li>
<li><span class="transparent">no score!</span> R1 translates the IP address in the packets from 209.65.200.254 to 192.168.10.10</li>
<li><span class="transparent">step 5 =&gt;</span> R1 replaces the address 192.168.10.10 with a translated inside global address</li>
<li><span class="transparent">step 2 =&gt;</span> R1 checks the NAT configuration to determine if this packet should be translated</li>
<li><span class="transparent">step 4 =&gt;</span> R1 selects an available global address from the dynamic address pool</li>
<li><span class="transparent">step 1 =&gt;</span> The host sends packets that request a connection to the server at the address 209.165.200.254</li>
<li><span class="transparent">step 3 =&gt;</span> If there is no translation entry for this IP address, R1 determines that the source address 192.168.10.10 must be translated</li>
</ul>
</li>
<li><p class="first">What is a disadvantage of NAT?</p>
<ul class="simple">
<li>There is no end-to-end addressing</li>
<li>The router does not need to alter the checksum of the IPv4 packets.</li>
<li>The internal hosts have to use a single public IPv4 address for external communication.</li>
<li>The costs of readdressing hosts can be significant for a publicly addressed network.</li>
<li>Answer -&gt; <span class="transparent">There is no end-to-end addressing</span></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. What is the purpose of the command marked with an arrow shown in the partial configuration output of a Cisco broadband router?</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>interface FastEthernet 0/0
 ip address 10.10.10.1 255.255.255.0
 ip nat inside
 no cdp enable
 hold-queue 32 in
 hold-queue 100 out
interface FastEthernet 0/1
 ip address dhcp
 ip nat outside
 no cdp enable
!
ip classless
ip http server
!
ip nat inside source list 102 interface fastethernet 0/1 overload
access-list 102 permit ip 10.10.10.0 0.0.0.255 any
no cdp run
!
</pre></div>
</div>
<ul class="simple">
<li>defines which addresses can be translated</li>
<li>defines which addresses are allowed into the router</li>
<li>defines which addresses are assigned to a NAT pool</li>
<li>defines which addresses are allowed out of the router</li>
<li>Answer -&gt; <span class="transparent">defines which addresses can be translated</span></li>
</ul>
</li>
<li><p class="first">What are two of the required steps to configure PAT? (Choose two.)</p>
<ul class="simple">
<li>Define a pool of global addresses to be used for overload translation</li>
<li>Create a standard access list to define applications that should be translated</li>
<li>Define the range of source ports to be used</li>
<li>Identify the inside interface</li>
<li>Define the hello and interval timers to match the adjacent neighbor router</li>
<li>answer -&gt; <span class="transparent">Define a pool of global addresses to be used for overload translation &amp;&amp; Identify the inside interface</span></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. A technician is configuring R2 for static NAT to allow the client to access the web server. What is a possible reason that the client PC cannot access the web server?</p>
<img alt="../../../_images/Ch9_practice_exam_q19.png" src="../../../_images/Ch9_practice_exam_q19.png" />
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source static 192.168.10.2 209.165.201.5</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Fa0/1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="c1"># ip address 192.168.10.254 255.255.255.0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Serial0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 209.165.200.225 255.255.255.224</span>
</pre></div>
</div>
<ul class="simple">
<li>Interface S0/0/0 should be identified as the outside NAT interface</li>
<li>Interface Fa0/1 should be identified as the outside NAT interface</li>
<li>The IP NAT statement is incorrect</li>
<li>The configuration is missing a valid access control list</li>
<li>Answer -&gt; <span class="transparent">Interface Fa0/1 should be identified as the outside NAT interface</span></li>
</ul>
</li>
<li><p class="first">What are two benefits of NAT? (Choose two.)</p>
<ul class="simple">
<li>It saves public IP addresses</li>
<li>It adds a degree of privacy and security to a network</li>
<li>It increases routing performance. It makes troubleshooting routing issues easier</li>
<li>It makes tunneling with IPsec less complicated</li>
<li>It makes troubleshooting routing issues easier</li>
<li>answer -&gt; <span class="transparent">It saves public IP addresses &amp;&amp; It adds a degree of privacy and security to a network</span></li>
</ul>
</li>
<li><p class="first">What is an advantage of deploying IPv4 NAT technology for internal hosts in an organization?</p>
<ul class="simple">
<li>makes internal network access easy for outside hosts using UDP</li>
<li>provides flexibility in designing the IPv4 addressing scheme</li>
<li>increases the performance of packet transmission to the Internet</li>
<li>enables the easy deployment of applications that require end-to-end traceability</li>
<li>answer -&gt; <span class="transparent">provides flexibility in designing the IPv4 addressing scheme</span></li>
</ul>
</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lldpAndLicensing.html" class="btn btn-neutral float-right" title="Device Discovery Management &amp; Maintenance" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="dhcp.html" class="btn btn-neutral float-left" title="DHCP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Patrick Brunswyck

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>