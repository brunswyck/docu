

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Networking &mdash; debian &amp; networking 20170824 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="debian &amp; networking 20170824 documentation" href="../index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> debian & networking
          

          
          </a>

          
            
            
              <div class="version">
                201708
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Networking</a><ul>
<li><a class="reference internal" href="#networking-fundamentals">Networking Fundamentals</a><ul>
<li><a class="reference internal" href="#chapter-on-fundamentals">chapter on fundamentals</a><ul>
<li><a class="reference internal" href="#connecting-to-console">Connecting to console</a><ul>
<li><a class="reference internal" href="#minicom">minicom</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#routing-and-switching-fundamentals">Routing and Switching Fundamentals</a><ul>
<li><a class="reference internal" href="#chapter-1-routing-concepts">Chapter 1 Routing Concepts</a><ul>
<li><a class="reference internal" href="#basic-concepts">basic concepts</a></li>
<li><a class="reference internal" href="#router-s-3-packet-forwarding-mechanisms">Router’s 3 packet-forwarding mechanisms</a></li>
<li><a class="reference internal" href="#loopback-interfaces">Loopback interfaces</a></li>
<li><a class="reference internal" href="#configure-loopback-interface">configure loopback interface</a></li>
<li><a class="reference internal" href="#filtering-parameters">Filtering parameters</a></li>
<li><a class="reference internal" href="#history-commands">History commands</a></li>
<li><a class="reference internal" href="#show-command-examples">Show command examples</a></li>
<li><a class="reference internal" href="#arp-neighbor-advertisement-sollicitation">ARP - Neighbor Advertisement/Sollicitation</a></li>
<li><a class="reference internal" href="#mac-addresses-on-serial-interfaces">MAC addresses on Serial Interfaces</a></li>
<li><a class="reference internal" href="#packet-forwarding-decision-process">Packet Forwarding Decision Process</a></li>
<li><a class="reference internal" href="#routing-best-path-selection">Routing BEST PATH selection</a></li>
<li><a class="reference internal" href="#administrative-distance">ADMINISTRATIVE DISTANCE</a></li>
<li><a class="reference internal" href="#changing-administrative-distance">Changing Administrative Distance</a></li>
<li><a class="reference internal" href="#example-of-changing-ad-for-rip">example of changing AD for rip</a></li>
<li><a class="reference internal" href="#other-applications-of-a-d">Other applications of A.D.</a></li>
<li><a class="reference internal" href="#directly-connected-n-remote-network-routes">Directly Connected n Remote Network Routes</a></li>
<li><a class="reference internal" href="#the-ip-routing-process">The IP routing process</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chapter-2-static-routes">Chapter 2 Static Routes</a><ul>
<li><a class="reference internal" href="#ipv4-syntax">ipv4 syntax</a></li>
<li><a class="reference internal" href="#combination-of-exit-interface-and-next-hop">combination of exit interface and next hop</a></li>
<li><a class="reference internal" href="#when-to-use-static-routes">When to Use Static Routes</a></li>
<li><a class="reference internal" href="#default-static-route">Default static route</a></li>
<li><a class="reference internal" href="#summary-static-route">Summary static route</a></li>
<li><a class="reference internal" href="#floating-static-route">Floating static route</a></li>
<li><a class="reference internal" href="#fully-specified-static-route">Fully Specified Static Route</a><ul>
<li><a class="reference internal" href="#example">example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ipv6-static-routing">ipv6 static routing</a></li>
<li><a class="reference internal" href="#ipv6-default-static-route">ipv6 default static route</a></li>
<li><a class="reference internal" href="#verify-a-default-static-route">verify a default static route</a></li>
<li><a class="reference internal" href="#troubleshooting-a-missing-route">Troubleshooting a missing route</a></li>
<li><a class="reference internal" href="#solve-a-connectivity-problem">Solve a connectivity problem</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chapter-3-dynamic-routing">Chapter 3 Dynamic Routing</a><ul>
<li><a class="reference internal" href="#dynamic-routing-protocols-components">Dynamic Routing Protocols Components</a></li>
<li><a class="reference internal" href="#static-routing-uses">Static Routing Uses</a><ul>
<li><a class="reference internal" href="#pros-static">Pros static</a></li>
<li><a class="reference internal" href="#cons-static">Cons static</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dynamic-routing-uses">Dynamic Routing Uses</a><ul>
<li><a class="reference internal" href="#pros-dynamic">Pros Dynamic</a></li>
<li><a class="reference internal" href="#cons-dynamic">Cons Dynamic</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ripv2">RIPv2</a></li>
<li><a class="reference internal" href="#enable-disable">enable/disable</a><ul>
<li><a class="reference internal" href="#verify-rip-routing">verify rip routing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#disable-auto-summarization">disable auto summarization</a></li>
<li><a class="reference internal" href="#configure-passive-interfaces">configure passive interfaces</a></li>
<li><a class="reference internal" href="#propagate-a-default-route">propagate a default route</a></li>
<li><a class="reference internal" href="#exercise-example">exercise example</a></li>
<li><a class="reference internal" href="#remote-networks-in-routing-table">Remote Networks in Routing table</a></li>
<li><a class="reference internal" href="#routing-table-terms">Routing table terms</a></li>
<li><a class="reference internal" href="#route-lookup-process">Route lookup process</a></li>
<li><a class="reference internal" href="#ipv6-routing-table-entries">IPv6 Routing Table Entries</a></li>
<li><a class="reference internal" href="#qna-chapter-3">QnA Chapter 3</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chapter-4-switched-networks">Chapter 4 switched networks</a><ul>
<li><a class="reference internal" href="#elements-of-a-converged-network">elements of a converged network</a></li>
<li><a class="reference internal" href="#hierarchy-in-the-borderless-switched-network">Hierarchy in the Borderless Switched Network</a></li>
<li><a class="reference internal" href="#access-layer">Access Layer</a></li>
<li><a class="reference internal" href="#distribution-layer">Distribution Layer</a></li>
<li><a class="reference internal" href="#core-layer">Core Layer</a></li>
<li><a class="reference internal" href="#considerations-switch">considerations switch</a></li>
<li><a class="reference internal" href="#store-n-forward-switching">store n forward switching</a></li>
<li><a class="reference internal" href="#cut-through-switching">Cut-Through Switching</a><ul>
<li><a class="reference internal" href="#rapid-frame-forwarding">Rapid Frame Forwarding</a></li>
<li><a class="reference internal" href="#fragment-free-forwarding">Fragment Free Forwarding</a></li>
</ul>
</li>
<li><a class="reference internal" href="#collision-domains">Collision domains</a></li>
<li><a class="reference internal" href="#qna-ch4">QnA Ch4</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chapter-5-switch-configuration">Chapter 5 Switch Configuration</a><ul>
<li><a class="reference internal" href="#configure-boot-environment-variable">Configure BOOT Environment variable</a></li>
<li><a class="reference internal" href="#switch-boot-sequence">Switch boot sequence</a></li>
<li><a class="reference internal" href="#recover-from-system-crash">Recover from System Crash</a><ul>
<li><a class="reference internal" href="#catalyst-2960-switch-leds">Catalyst 2960 switch LEDs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure-sw-management-ipv4">Configure Sw management ipv4</a><ul>
<li><a class="reference internal" href="#assign-all-user-ports-to-vlan">Assign all user ports to vlan</a></li>
<li><a class="reference internal" href="#configure-apply-vlan-99">configure &amp; apply vlan 99</a></li>
<li><a class="reference internal" href="#troubleshooting">troubleshooting</a></li>
<li><a class="reference internal" href="#basic-template-for-less-hassle">basic template for less hassle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setup-a-static-mac-address">Setup a static MAC address</a></li>
<li><a class="reference internal" href="#duplex-communication">Duplex communication</a></li>
<li><a class="reference internal" href="#speed-auto-mdix">Speed/auto-MDIX</a></li>
<li><a class="reference internal" href="#verify-interface-status">Verify interface status</a></li>
<li><a class="reference internal" href="#ssh-switch-setup">SSH Switch Setup</a></li>
<li><a class="reference internal" href="#disable-unused-ports">Disable unused ports</a></li>
<li><a class="reference internal" href="#port-security">Port Security</a><ul>
<li><a class="reference internal" href="#secure-mac-address-types">Secure MAC Address Types</a></li>
<li><a class="reference internal" href="#sticky-secure-mac-addresses">Sticky Secure MAC addresses</a></li>
<li><a class="reference internal" href="#security-violation-modes">Security Violation Modes</a></li>
<li><a class="reference internal" href="#configuring-port-security-on-if">Configuring port security on IF</a></li>
<li><a class="reference internal" href="#port-security-aging">Port security aging</a></li>
<li><a class="reference internal" href="#example-exercise">example exercise</a></li>
</ul>
</li>
<li><a class="reference internal" href="#qna-chapter-5">QnA Chapter 5</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chapter-6-vlans">Chapter 6 VLANS</a><ul>
<li><a class="reference internal" href="#vlan-benefits">VLAN Benefits</a></li>
<li><a class="reference internal" href="#vlan-types">VLAN Types</a></li>
<li><a class="reference internal" href="#voice-vlans">Voice VLANs</a></li>
<li><a class="reference internal" href="#vlan-trunks">VLAN Trunks</a></li>
<li><a class="reference internal" href="#q-frame">802.1Q Frame</a><ul>
<li><a class="reference internal" href="#vlan-tag-field-details">VLAN Tag Field Details</a></li>
</ul>
</li>
<li><a class="reference internal" href="#native-vlans-802-1q-tagging">Native VLANS &amp; 802.1Q Tagging</a><ul>
<li><a class="reference internal" href="#tagged-frames-on-the-native-vlan">Tagged Frames on the Native VLAN</a></li>
<li><a class="reference internal" href="#untagged-frames-on-the-native-vlan">Untagged Frames on the Native VLAN</a></li>
</ul>
</li>
<li><a class="reference internal" href="#voice-vlan-tagging">Voice VLAN Tagging</a></li>
<li><a class="reference internal" href="#q-tagging">802.1Q tagging</a></li>
<li><a class="reference internal" href="#vlan-ranges">VLAN Ranges</a><ul>
<li><a class="reference internal" href="#normal-range">normal range</a></li>
<li><a class="reference internal" href="#extended-range">extended range</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-vlans">Configuring VLANS</a><ul>
<li><a class="reference internal" href="#configure-optional-parameters">configure optional parameters</a></li>
<li><a class="reference internal" href="#adding-ports-to-a-vlan">adding ports to a VLAN</a></li>
<li><a class="reference internal" href="#verifying-vlan-configuration">Verifying VLAN configuration</a></li>
<li><a class="reference internal" href="#remove-vlan-assignment">remove VLAN Assignment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deleting-vlans">deleting VLANs</a></li>
<li><a class="reference internal" href="#verifying-vlan-info">verifying VLAN info</a></li>
<li><a class="reference internal" href="#trunk-configuration">TRUNK Configuration</a><ul>
<li><a class="reference internal" href="#resetting-trunk-to-default-state">Resetting Trunk to Default state</a></li>
<li><a class="reference internal" href="#excercise">excercise</a></li>
<li><a class="reference internal" href="#verify-commands">Verify commands</a></li>
</ul>
</li>
<li><a class="reference internal" href="#combination-exercise">combination exercise</a></li>
<li><a class="reference internal" href="#troubleshooting-vlans">Troubleshooting VLANS</a><ul>
<li><a class="reference internal" href="#ip-address-issue-vlan">IP Address issue VLAN</a></li>
<li><a class="reference internal" href="#missing-vlan">Missing VLAN</a></li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting-trunks">Troubleshooting Trunks</a><ul>
<li><a class="reference internal" href="#troubleshooting-vlans-2">Troubleshooting Vlans 2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting-vlan-trunk-bullet-points">Troubleshooting vlan/trunk bullet points</a></li>
<li><a class="reference internal" href="#vlan-command-summary-table">VLAN Command Summary Table</a></li>
<li><a class="reference internal" href="#inter-vlan-routing">Inter-VLAN Routing</a><ul>
<li><a class="reference internal" href="#legacy-intervlan-routing">legacy intervlan routing</a><ul>
<li><a class="reference internal" href="#lab-configuration">Lab configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#router-on-a-stick-intervlan-routing">router-on-a-stick intervlan routing</a></li>
<li><a class="reference internal" href="#multilayer-switch-intervlanning">multilayer switch intervlanning</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inter-vlan-routing-challenge">Inter-VLAN Routing Challenge</a></li>
<li><a class="reference internal" href="#skills-integration-challenge">Skills integration challenge</a></li>
<li><a class="reference internal" href="#qna-chapter-6">QnA Chapter 6</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chapter-7-acls">Chapter 7 ACLs</a><ul>
<li><a class="reference internal" href="#acl-operation">ACL operation</a></li>
<li><a class="reference internal" href="#acl-wildcard-masking">ACL Wildcard Masking</a></li>
<li><a class="reference internal" href="#wildcard-mask-abbreviations">Wildcard Mask Abbreviations</a></li>
<li><a class="reference internal" href="#rules-for-applying-acls">Rules for applying ACLs</a></li>
<li><a class="reference internal" href="#acl-placement">ACL Placement</a><ul>
<li><a class="reference internal" href="#standard-acl-placement">Standard ACL placement</a></li>
</ul>
</li>
<li><a class="reference internal" href="#applying-standard-ipv4-acls-to-interface">Applying standard ipv4 ACLs to interface</a></li>
<li><a class="reference internal" href="#named-standard-acls">Named Standard ACLs</a></li>
<li><a class="reference internal" href="#exercises">exercises</a><ul>
<li><a class="reference internal" href="#pt-configuring-numbered-standard-ipv4-acls">PT Configuring Numbered Standard IPv4 ACLs</a></li>
<li><a class="reference internal" href="#pt-configuring-named-standard-ipv4-acls">PT Configuring Named Standard IPv4 ACLs</a></li>
<li><a class="reference internal" href="#lab-config-mod-std-ipv4-acls">Lab Config/Mod Std IPv4 ACLs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#editing-numbered-acls">Editing Numbered ACLs</a><ul>
<li><a class="reference internal" href="#method-1-use-a-text-editor">Method 1 - Use a Text Editor</a></li>
<li><a class="reference internal" href="#method-2-use-sequence-numbers">Method 2 - Use Sequence Numbers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-a-line-to-nacl">adding a line to NACL</a></li>
<li><a class="reference internal" href="#verifying-standard-acl-interfaces">verifying standard ACL interfaces</a></li>
<li><a class="reference internal" href="#acl-vs-ip-acl">ACL VS IP ACL</a></li>
<li><a class="reference internal" href="#clearing-acl-statistics">Clearing ACL Statistics</a></li>
<li><a class="reference internal" href="#accesss-class-command">Accesss-class command</a></li>
<li><a class="reference internal" href="#the-implicit-deny-any">The implicit Deny Any</a></li>
<li><a class="reference internal" href="#the-order-of-aces-in-an-acl">The order of ACEs in an ACL</a></li>
<li><a class="reference internal" href="#sequencing-considerations-during-configuration">Sequencing considerations during configuration</a></li>
<li><a class="reference internal" href="#acl-and-routing-processes">ACL and Routing Processes</a></li>
<li><a class="reference internal" href="#troubleshooting-std-ipv4-acls">Troubleshooting StD IPv4 ACLs</a></li>
<li><a class="reference internal" href="#exercices">Exercices</a><ul>
<li><a class="reference internal" href="#pt-troubleshooting-std-ipv4-acls">PT Troubleshooting StD IPv4 ACLs</a></li>
<li><a class="reference internal" href="#pt-ch7-skills-integration-challenge">PT Ch7 Skills Integration Challenge</a></li>
<li><a class="reference internal" href="#chapter-7-exam">Chapter 7 exam</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ch7-qna">Ch7 QnA</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chapter-8-dhcp">Chapter 8 DHCP</a><ul>
<li><a class="reference internal" href="#dhcpv4-message-format">DHCPv4 Message Format</a></li>
<li><a class="reference internal" href="#dhcpv4-discover-message">DHCPv4 Discover Message</a></li>
<li><a class="reference internal" href="#dhcpv4-basic-server-configuration">DHCPv4 basic server configuration</a></li>
<li><a class="reference internal" href="#verifying-dhcpv4">Verifying DHCPv4</a></li>
<li><a class="reference internal" href="#configure-dhcpv4-relay">Configure DHCPv4 relay</a></li>
<li><a class="reference internal" href="#dhcpv4-exercises">DHCPv4 Exercises</a><ul>
<li><a class="reference internal" href="#lab-configuring-basic-dhcpv4">8.1.2.3 lab - configuring basic dhcpv4</a></li>
<li><a class="reference internal" href="#lab-basic-dhcpv4-on-a-switch">8.1.2.5 lab - basic dhcpv4 on a switch</a><ul>
<li><a class="reference internal" href="#configure-dhcp-for-vlan-1">Configure DHCP for VLAN 1</a></li>
<li><a class="reference internal" href="#configure-dhcpv4-for-multiple-vlans">Configure DHCPv4 for Multiple VLANs</a></li>
<li><a class="reference internal" href="#assign-static-routes">Assign static routes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lab-configuring-dhcp-ios-pt">8.1.3.3 lab - configuring dhcp ios pt</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-a-router-as-dhcp-client">Configuring a Router as DHCP Client</a></li>
<li><a class="reference internal" href="#troubleshooting-dhcp">Troubleshooting DHCP</a><ul>
<li><a class="reference internal" href="#dhcp-service">DHCP Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dhcpv4-troubleshooting-tasks">DHCPv4 Troubleshooting Tasks</a></li>
<li><a class="reference internal" href="#slaac">SLAAC</a><ul>
<li><a class="reference internal" href="#slaac-operation">SLAAC operation</a></li>
<li><a class="reference internal" href="#slaac-option">SLAAC Option</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dhcpv6-operations">DHCPv6 Operations</a></li>
<li><a class="reference internal" href="#dhcpv6-stateless-config">DHCPv6 Stateless Config</a></li>
<li><a class="reference internal" href="#dhcpv6-stateless-client">DHCPv6 Stateless Client</a></li>
<li><a class="reference internal" href="#verify-stateless-dhcpv6">Verify Stateless dhcpv6</a></li>
<li><a class="reference internal" href="#dhcpv6-stateful-config">DHCPv6 Stateful Config</a></li>
<li><a class="reference internal" href="#dhcpv6-stateful-client">DHCPv6 Stateful Client</a></li>
<li><a class="reference internal" href="#verify-stateful-dhcpv6">Verify Stateful dhcpv6</a></li>
<li><a class="reference internal" href="#configure-dhcpv6-relay">Configure DHCPv6 relay</a></li>
<li><a class="reference internal" href="#dhcpv6-labs">DHCPv6 labs</a></li>
<li><a class="reference internal" href="#dhcpv6-troubleshooting-tasks">DHCPv6 Troubleshooting Tasks</a></li>
<li><a class="reference internal" href="#ch8-lab-troubleshooting-dhcpv6">Ch8 Lab Troubleshooting DHCPv6</a><ul>
<li><a class="reference internal" href="#part-1-build-nw-and-configure-basic-settings">Part 1 Build NW and configure basic settings</a></li>
<li><a class="reference internal" href="#part-2-troubleshoot-ipv6-connectivity">Part 2 Troubleshoot IPv6 connectivity</a></li>
<li><a class="reference internal" href="#part-3-troubleshoot-stateless-dhcpv6">Part 3 Troubleshoot Stateless DHCPv6</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ch8-8-3-1-2-skills-integration-challenge-dhcpv4">Ch8 8.3.1.2 Skills Integration Challenge DHCPv4</a><ul>
<li><a class="reference internal" href="#addressing-table">Addressing Table</a></li>
<li><a class="reference internal" href="#vlan-port-assignments-and-dhcp-information">VLAN Port Assignments and DHCP Information</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dhcpv6-conclusion">DHCPv6 conclusion</a></li>
<li><a class="reference internal" href="#ch8-qna">Ch8 QnA</a></li>
<li><a class="reference internal" href="#ch8-practice-exam">Ch8 practice exam</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chapter-9-nat-for-ipv4">Chapter 9 NAT for IPv4</a><ul>
<li><a class="reference internal" href="#nat-border">NAT Border</a></li>
<li><a class="reference internal" href="#types-of-nat-addresses">Types of NAT Addresses</a></li>
<li><a class="reference internal" href="#nat-address-terminology">NAT Address Terminology</a></li>
<li><a class="reference internal" href="#static-nat">Static NAT</a></li>
<li><a class="reference internal" href="#dynamic-nat">Dynamic NAT</a></li>
<li><a class="reference internal" href="#pat-aka-nat-overload">PAT aka NAT Overload</a></li>
<li><a class="reference internal" href="#nat-vs-pat">NAT vs PAT</a><ul>
<li><a class="reference internal" href="#packets-without-a-layer-4-segment">Packets without a Layer 4 Segment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nat-advantages">NAT Advantages</a></li>
<li><a class="reference internal" href="#nat-disadvantages">NAT Disadvantages</a></li>
<li><a class="reference internal" href="#configuring-static-nat">Configuring Static NAT</a></li>
<li><a class="reference internal" href="#static-nat-process">Static NAT Process</a></li>
<li><a class="reference internal" href="#configure-static-nat-exercise">Configure Static NAT exercise</a></li>
<li><a class="reference internal" href="#dynamic-nat-operation">Dynamic NAT operation</a></li>
<li><a class="reference internal" href="#configuring-dynamic-nat">Configuring Dynamic NAT</a></li>
<li><a class="reference internal" href="#dynamic-nat-example">Dynamic NAT example</a></li>
<li><a class="reference internal" href="#dynamic-nat-process">Dynamic NAT process</a></li>
<li><a class="reference internal" href="#clearing-nat-translations">Clearing NAT Translations</a></li>
<li><a class="reference internal" href="#configure-dynamic-nat-exercise">Configure Dynamic NAT exercise</a><ul>
<li><a class="reference internal" href="#configure-dynamic-nat">configure dynamic NAT</a></li>
<li><a class="reference internal" href="#verify-nat-implementation">Verify NAT implementation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure-dynamic-static-nat-lab">Configure Dynamic &amp; Static NAT Lab</a><ul>
<li><a class="reference internal" href="#addressing-table-9-2-2-6">Addressing Table 9.2.2.6</a></li>
<li><a class="reference internal" href="#objectives-9-2-2-6">Objectives 9.2.2.6</a></li>
<li><a class="reference internal" href="#required-resources">Required Resources</a></li>
<li><a class="reference internal" href="#build-network-verify-connectivity">Build network &amp; verify connectivity</a></li>
<li><a class="reference internal" href="#configure-and-verify-static-nat">Configure and Verify Static NAT</a></li>
<li><a class="reference internal" href="#configure-and-verify-dynamic-nat">Configure and Verify Dynamic NAT</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-pat-nat-overload">Configuring PAT (NAT overload)</a></li>
<li><a class="reference internal" href="#pat-analysis">PAT analysis</a></li>
<li><a class="reference internal" href="#pt-implementing-static-dynamic-nat">PT Implementing Static &amp; Dynamic NAT</a><ul>
<li><a class="reference internal" href="#pt-9-2-3-6">PT 9.2.3.6</a></li>
<li><a class="reference internal" href="#configure-dynamic-nat-with-pat">Configure dynamic NAT with PAT</a></li>
<li><a class="reference internal" href="#configure-static-nat">Configure Static NAT</a></li>
<li><a class="reference internal" href="#verify-nat-implementation-9-2-3-6">Verify NAT implementation 9.2.3.6</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure-pat-nat-lab">Configure PAT NAT Lab</a><ul>
<li><a class="reference internal" href="#addressing-table-9-2-3-7">Addressing Table 9.2.3.7</a></li>
<li><a class="reference internal" href="#objectives-9-2-3-7">Objectives 9.2.3.7</a></li>
<li><a class="reference internal" href="#required-resources-9-2-3-7">Required Resources 9.2.3.7</a></li>
<li><a class="reference internal" href="#build-network-verify-connectivity-9-2-3-7">Build network &amp; verify connectivity 9.2.3.7</a></li>
<li><a class="reference internal" href="#configure-and-verify-nat-pool-overload-9-2-3-7">Configure and Verify NAT Pool Overload 9.2.3.7</a></li>
<li><a class="reference internal" href="#configure-and-verify-pat-9-2-3-7">Configure and Verify PAT 9.2.3.7</a></li>
</ul>
</li>
<li><a class="reference internal" href="#port-forwarding">Port Forwarding</a></li>
<li><a class="reference internal" href="#nat-for-ipv6">NAT for IPv6?</a></li>
<li><a class="reference internal" href="#ipv6-unique-local-address-ula">IPv6 Unique Local Address ULA</a></li>
<li><a class="reference internal" href="#id93">NAT for IPv6</a></li>
<li><a class="reference internal" href="#troubleshooting-nat">Troubleshooting NAT</a></li>
<li><a class="reference internal" href="#pt-troubleshooting-nat-ex1">PT Troubleshooting NAT ex1</a><ul>
<li><a class="reference internal" href="#addressing-table-ex1">Addressing Table ex1</a></li>
<li><a class="reference internal" href="#pt-troubleshoot-nat-configuration">PT Troubleshoot NAT Configuration</a></li>
<li><a class="reference internal" href="#pt-verify-connectivity">PT Verify Connectivity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lab-troubleshooting-nat">LAB Troubleshooting NAT</a><ul>
<li><a class="reference internal" href="#pt-addressing-table">PT Addressing Table</a></li>
<li><a class="reference internal" href="#configure-static-routing">Configure Static Routing</a></li>
<li><a class="reference internal" href="#troubleshoot-static-nat">Troubleshoot Static NAT</a></li>
<li><a class="reference internal" href="#troubleshoot-dynamic-nat">Troubleshoot Dynamic NAT</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ch9-skills-integration-test-assignment">Ch9 Skills Integration Test - assignment</a><ul>
<li><a class="reference internal" href="#implementation-given">Implementation Given</a></li>
<li><a class="reference internal" href="#verification-given">Verification Given</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ch9-skills-integration-test-when-opened-with-pt-7-0-on-windos">Ch9 Skills Integration Test - when opened with PT 7.0 on windos</a><ul>
<li><a class="reference internal" href="#implementation-completed">Implementation completed</a></li>
<li><a class="reference internal" href="#verification-solved">Verification Solved</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ch9-practice-exam">Ch9 practice exam</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chapter-10-device-discovery-management-maintenance">Chapter 10 Device Discovery Management &amp; Maintenance</a><ul>
<li><a class="reference internal" href="#cisco-discovery-protocol-operation">Cisco Discovery Protocol Operation</a></li>
<li><a class="reference internal" href="#cdp-exercise-10-1-1-4">cdp exercise 10.1.1.4</a></li>
<li><a class="reference internal" href="#link-layer-discovery-protocol">Link Layer Discovery Protocol</a><ul>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#comparison-neighbors-information">comparison neighbors information</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ntp">NTP</a></li>
<li><a class="reference internal" href="#ntp-stratum-labels">NTP Stratum Labels</a></li>
<li><a class="reference internal" href="#verify-ntp-server-config">Verify NTP Server Config</a></li>
<li><a class="reference internal" href="#syslog">Syslog</a></li>
<li><a class="reference internal" href="#syslog-intro">Syslog intro</a></li>
<li><a class="reference internal" href="#syslog-rfcs">Syslog RFCs</a></li>
<li><a class="reference internal" href="#severity-level">Severity level</a></li>
<li><a class="reference internal" href="#adding-a-timestamp-to-syslog-messages">Adding a timestamp to Syslog Messages</a></li>
<li><a class="reference internal" href="#default-logging-service-settings">Default Logging Service Settings</a></li>
<li><a class="reference internal" href="#syslog-configuration">Syslog configuration</a></li>
<li><a class="reference internal" href="#verifying-syslog">Verifying Syslog</a><ul>
<li><a class="reference internal" href="#filter-logging-with-specific-date">filter logging with specific date</a></li>
<li><a class="reference internal" href="#capturing-traffic-epc">capturing traffic &amp; EPC</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pt-configure-syslog-ntp">PT Configure Syslog &amp; NTP</a></li>
<li><a class="reference internal" href="#lab-configuring-syslog-ntp">LAB Configuring syslog &amp; NTP</a></li>
<li><a class="reference internal" href="#router-file-systems">Router File Systems</a></li>
<li><a class="reference internal" href="#backing-up-and-restoring">Backing up and restoring</a><ul>
<li><a class="reference internal" href="#backup-w-text-capture-eg-tera-term">Backup w text capture (eg Tera Term)</a></li>
<li><a class="reference internal" href="#backup-configs-w-tftp">Backup configs w TFTP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-usb-ports">Using USB ports</a><ul>
<li><a class="reference internal" href="#backing-up-to-usb">Backing up to USB</a></li>
<li><a class="reference internal" href="#restoring-from-usb">Restoring from USB</a></li>
</ul>
</li>
<li><a class="reference internal" href="#password-recovery">Password Recovery</a></li>
<li><a class="reference internal" href="#lab-managing-device-configuration-files">Lab - Managing Device Configuration Files</a></li>
<li><a class="reference internal" href="#ios-15-system-image-packaging">IOS 15 System Image Packaging</a></li>
<li><a class="reference internal" href="#ios-image-filenames">IOS Image Filenames</a></li>
<li><a class="reference internal" href="#boot-system-command">boot system command</a></li>
<li><a class="reference internal" href="#technology-packages-licenses">Technology Packages Licenses</a></li>
<li><a class="reference internal" href="#licensing-proces">Licensing Proces</a></li>
<li><a class="reference internal" href="#ch10-skills-integration-challenge">Ch10 Skills Integration Challenge</a></li>
<li><a class="reference internal" href="#ch10-practice-exam">Ch10 practice exam</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">debian & networking</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Networking</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/nw/head.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="networking">
<h1>Networking<a class="headerlink" href="#networking" title="Permalink to this headline">¶</a></h1>
<div class="section" id="networking-fundamentals">
<h2>Networking Fundamentals<a class="headerlink" href="#networking-fundamentals" title="Permalink to this headline">¶</a></h2>
<div class="section" id="chapter-on-fundamentals">
<h3>chapter on fundamentals<a class="headerlink" href="#chapter-on-fundamentals" title="Permalink to this headline">¶</a></h3>
<div class="section" id="connecting-to-console">
<h4>Connecting to console<a class="headerlink" href="#connecting-to-console" title="Permalink to this headline">¶</a></h4>
<div class="section" id="minicom">
<h5>minicom<a class="headerlink" href="#minicom" title="Permalink to this headline">¶</a></h5>
<p>make your user member of the dialout group</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">usermod</span> <span class="o">-</span><span class="n">G</span> <span class="n">dialout</span> <span class="n">guru</span>
</pre></div>
</div>
<p>check what tty you should use after connecting the cable with <code class="docutils literal"><span class="pre">dmesg</span></code></p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">dmesg</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">tty</span>
</pre></div>
</div>
<p>launch minicom with the appropriate baudrate and tty device</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">minicom</span> <span class="o">--</span><span class="n">baudrate</span><span class="o">=</span><span class="mi">9600</span> <span class="o">--</span><span class="n">device</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">ttyS0</span>
</pre></div>
</div>
<p>off you go</p>
</div>
</div>
</div>
</div>
<div class="section" id="routing-and-switching-fundamentals">
<h2>Routing and Switching Fundamentals<a class="headerlink" href="#routing-and-switching-fundamentals" title="Permalink to this headline">¶</a></h2>
<div class="section" id="chapter-1-routing-concepts">
<h3>Chapter 1 Routing Concepts<a class="headerlink" href="#chapter-1-routing-concepts" title="Permalink to this headline">¶</a></h3>
<div class="section" id="basic-concepts">
<h4>basic concepts<a class="headerlink" href="#basic-concepts" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><dl class="docutils">
<dt>RAM</dt>
<dd>Running IOS
Running config file
IP routing tables, ARP tables, CDP info
Packet buffer</dd>
<dt>ROM</dt>
<dd>Bootup instructions (System Bootstrap)
Basic diagnostic software (POST)
Limited IOS in case router cannot load full featured IOS(ROMMON)</dd>
<dt>NVRAM</dt>
<dd>Startup config file</dd>
<dt>FLASH</dt>
<dd>IOS</dd>
</dl>
<p>view their size via:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">show</span> <span class="n">version</span>
</pre></div>
</div>
<p>bootup process lookup for ios</p>
<blockquote>
<div><ul class="simple">
<li>flash memory</li>
<li>TFTP server</li>
<li>ROM</li>
</ul>
</div></blockquote>
<p>to change this order, change configuration register</p>
</div></blockquote>
</div>
<div class="section" id="router-s-3-packet-forwarding-mechanisms">
<h4>Router’s 3 packet-forwarding mechanisms<a class="headerlink" href="#router-s-3-packet-forwarding-mechanisms" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><dl class="docutils">
<dt>Process Switching</dt>
<dd>An older packet forwarding mechanism still available for Cisco routers. When a packet arrives on an interface, it is forwarded to the control plane where the CPU matches the destination address with an entry in its routing table, and then determines the exit interface and forwards the packet. It is important to understand that the router does this for every packet, even if the destination is the same for a stream of packets. This process-switching mechanism is very slow and rarely implemented in modern networks.</dd>
<dt>Fast switching</dt>
<dd>This is a common packet forwarding mechanism which uses a fast-switching cache to store next-hop information. When a packet arrives on an interface, it is forwarded to the control plane where the CPU searches for a match in the fast-switching cache. If it is not there, it is process-switched and forwarded to the exit interface. The flow information for the packet is also stored in the fast-switching cache. If another packet going to the same destination arrives on an interface, the next-hop information in the cache is re-used without CPU intervention.</dd>
<dt>Cisco Express Forwarding (CEF)</dt>
<dd>CEF is the most recent and preferred Cisco IOS packet-forwarding mechanism. Like fast switching, CEF builds a Forwarding Information Base (FIB), and an adjacency table. However, the table entries are not packet-triggered like fast switching but change-triggered such as when something changes in the network topology. Therefore, when a network has converged, the FIB and adjacency tables contain all the information a router would have to consider when forwarding a packet. The FIB contains pre-computed reverse lookups, next hop information for routes including the interface and Layer 2 information. Cisco Express Forwarding is the fastest forwarding mechanism and the preferred choice on Cisco routers.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="loopback-interfaces">
<h4>Loopback interfaces<a class="headerlink" href="#loopback-interfaces" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>Multiple loopback interfaces can be enabled on a router. The IPv4 address for each loopback interface must be unique and unused by any other interface.</div></blockquote>
</div>
<div class="section" id="configure-loopback-interface">
<h4>configure loopback interface<a class="headerlink" href="#configure-loopback-interface" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface loopback 0</span>
<span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 10.0.0.1 255.255.255.0</span>
<span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># exit</span>
</pre></div>
</div>
</div>
<div class="section" id="filtering-parameters">
<h4>Filtering parameters<a class="headerlink" href="#filtering-parameters" title="Permalink to this headline">¶</a></h4>
<p>Used after the pipe are:</p>
<dl class="docutils">
<dt>section</dt>
<dd><p class="first">Shows entire section that starts with the filtering expression</p>
<div class="last highlight-console"><div class="highlight"><pre><span></span><span class="go">R1# show running-config | section line vty</span>
</pre></div>
</div>
</dd>
<dt>include</dt>
<dd><p class="first">Includes all output lines that match the filtering expression</p>
<div class="last highlight-console"><div class="highlight"><pre><span></span><span class="go">R1# show ip interface brief | include up</span>
</pre></div>
</div>
</dd>
<dt>exclude</dt>
<dd><p class="first">Excludes all output lines that match the filtering expression</p>
<div class="last highlight-console"><div class="highlight"><pre><span></span><span class="go">R1# show ip interface brief | exclude unassigned</span>
</pre></div>
</div>
</dd>
<dt>begin</dt>
<dd><p class="first">hows all the output lines from a certain point, starting with the line that matches the filtering expression</p>
<div class="last highlight-console"><div class="highlight"><pre><span></span><span class="go">R1# show ip route | begin Gateway</span>
<span class="go">R1# show running-config | begin line</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="history-commands">
<h4>History commands<a class="headerlink" href="#history-commands" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>set/show history</dt>
<dd><div class="code first last highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># terminal history size 200</span>
<span class="n">R1</span><span class="c1"># show history</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="show-command-examples">
<h4>Show command examples<a class="headerlink" href="#show-command-examples" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>show interfaces</dt>
<dd><div class="code first last highlight-default"><div class="highlight"><pre><span></span><span class="n">TA</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#do show interfaces</span>
<span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span> <span class="p">(</span><span class="n">connected</span><span class="p">)</span>
<span class="n">OB</span> <span class="n">Hardware</span> <span class="ow">is</span> <span class="n">CN</span> <span class="n">Gigabit</span> <span class="n">Ethernet</span><span class="p">,</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">0004.9</span><span class="n">ae8</span><span class="o">.</span><span class="n">b901</span> <span class="p">(</span><span class="n">bia</span> <span class="mf">0004.9</span><span class="n">ae8</span><span class="o">.</span><span class="n">b901</span><span class="p">)</span>
<span class="n">Description</span><span class="p">:</span> <span class="n">Link</span> <span class="n">RTA</span> <span class="n">G0</span><span class="o">/</span><span class="mi">0</span> <span class="n">to</span> <span class="n">SW1</span> <span class="n">G0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Internet</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.1</span><span class="o">/</span><span class="mi">24</span>
<span class="n">MTU</span> <span class="mi">1500</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">BW</span> <span class="mi">1000000</span> <span class="n">Kbit</span><span class="p">,</span> <span class="n">DLY</span> <span class="mi">10</span> <span class="n">usec</span><span class="p">,</span>
   <span class="n">reliability</span> <span class="mi">255</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="n">txload</span> <span class="mi">1</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="n">rxload</span> <span class="mi">1</span><span class="o">/</span><span class="mi">255</span>
<span class="n">Encapsulation</span> <span class="n">ARPA</span><span class="p">,</span> <span class="n">loopback</span> <span class="ow">not</span> <span class="nb">set</span>
<span class="n">Keepalive</span> <span class="nb">set</span> <span class="p">(</span><span class="mi">10</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">Full</span><span class="o">-</span><span class="n">duplex</span><span class="p">,</span> <span class="mi">100</span><span class="n">Mb</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">media</span> <span class="nb">type</span> <span class="ow">is</span> <span class="n">RJ45</span>
<span class="n">output</span> <span class="n">flow</span><span class="o">-</span><span class="n">control</span> <span class="ow">is</span> <span class="n">unsupported</span><span class="p">,</span> <span class="nb">input</span> <span class="n">flow</span><span class="o">-</span><span class="n">control</span> <span class="ow">is</span> <span class="n">unsupported</span>
<span class="n">ARP</span> <span class="nb">type</span><span class="p">:</span> <span class="n">ARPA</span><span class="p">,</span> <span class="n">ARP</span> <span class="n">Timeout</span> <span class="mi">04</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span>
<span class="n">Last</span> <span class="nb">input</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">08</span><span class="p">,</span> <span class="n">output</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">05</span><span class="p">,</span> <span class="n">output</span> <span class="n">hang</span> <span class="n">never</span>
<span class="n">Last</span> <span class="n">clearing</span> <span class="n">of</span> <span class="s2">&quot;show interface&quot;</span> <span class="n">counters</span> <span class="n">never</span>
<span class="n">Input</span> <span class="n">queue</span><span class="p">:</span> <span class="mi">0</span><span class="o">/</span><span class="mi">75</span><span class="o">/</span><span class="mi">0</span> <span class="p">(</span><span class="n">size</span><span class="o">/</span><span class="nb">max</span><span class="o">/</span><span class="n">drops</span><span class="p">);</span> <span class="n">Total</span> <span class="n">output</span> <span class="n">drops</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Queueing</span> <span class="n">strategy</span><span class="p">:</span> <span class="n">fifo</span>
<span class="n">Output</span> <span class="n">queue</span> <span class="p">:</span><span class="mi">0</span><span class="o">/</span><span class="mi">40</span> <span class="p">(</span><span class="n">size</span><span class="o">/</span><span class="nb">max</span><span class="p">)</span>
<span class="mi">5</span> <span class="n">minute</span> <span class="nb">input</span> <span class="n">rate</span> <span class="mi">0</span> <span class="n">bits</span><span class="o">/</span><span class="n">sec</span><span class="p">,</span> <span class="mi">0</span> <span class="n">packets</span><span class="o">/</span><span class="n">sec</span>
<span class="mi">5</span> <span class="n">minute</span> <span class="n">output</span> <span class="n">rate</span> <span class="mi">0</span> <span class="n">bits</span><span class="o">/</span><span class="n">sec</span><span class="p">,</span> <span class="mi">0</span> <span class="n">packets</span><span class="o">/</span><span class="n">sec</span>
   <span class="mi">0</span> <span class="n">packets</span> <span class="nb">input</span><span class="p">,</span> <span class="mi">0</span> <span class="nb">bytes</span><span class="p">,</span> <span class="mi">0</span> <span class="n">no</span> <span class="n">buffer</span>
   <span class="n">Received</span> <span class="mi">0</span> <span class="n">broadcasts</span><span class="p">,</span> <span class="mi">0</span> <span class="n">runts</span><span class="p">,</span> <span class="mi">0</span> <span class="n">giants</span><span class="p">,</span> <span class="mi">0</span> <span class="n">throttles</span>
   <span class="mi">0</span> <span class="nb">input</span> <span class="n">errors</span><span class="p">,</span> <span class="mi">0</span> <span class="n">CRC</span><span class="p">,</span> <span class="mi">0</span> <span class="n">frame</span><span class="p">,</span> <span class="mi">0</span> <span class="n">overrun</span><span class="p">,</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">,</span> <span class="mi">0</span> <span class="n">abort</span>
   <span class="mi">0</span> <span class="n">watchdog</span><span class="p">,</span> <span class="mi">1017</span> <span class="n">multicast</span><span class="p">,</span> <span class="mi">0</span> <span class="n">pause</span> <span class="nb">input</span>
   <span class="mi">0</span> <span class="nb">input</span> <span class="n">packets</span> <span class="k">with</span> <span class="n">dribble</span> <span class="n">condition</span> <span class="n">detected</span>
   <span class="mi">0</span> <span class="n">packets</span> <span class="n">output</span><span class="p">,</span> <span class="mi">0</span> <span class="nb">bytes</span><span class="p">,</span> <span class="mi">0</span> <span class="n">underruns</span>
   <span class="mi">0</span> <span class="n">output</span> <span class="n">errors</span><span class="p">,</span> <span class="mi">0</span> <span class="n">collisions</span><span class="p">,</span> <span class="mi">2</span> <span class="n">interface</span> <span class="n">resets</span>
   <span class="mi">0</span> <span class="n">unknown</span> <span class="n">protocol</span> <span class="n">drops</span>
   <span class="mi">0</span> <span class="n">babbles</span><span class="p">,</span> <span class="mi">0</span> <span class="n">late</span> <span class="n">collision</span><span class="p">,</span> <span class="mi">0</span> <span class="n">deferred</span>
   <span class="mi">0</span> <span class="n">lost</span> <span class="n">carrier</span><span class="p">,</span> <span class="mi">0</span> <span class="n">no</span> <span class="n">carrier</span>
   <span class="mi">0</span> <span class="n">output</span> <span class="n">buffer</span> <span class="n">failures</span><span class="p">,</span> <span class="mi">0</span> <span class="n">output</span> <span class="n">buffers</span> <span class="n">swapped</span> <span class="n">out</span>
</pre></div>
</div>
</dd>
<dt>show ip interface</dt>
<dd><div class="code first last highlight-default"><div class="highlight"><pre><span></span><span class="n">SW1</span><span class="c1">#show ip interface</span>
<span class="n">Vlan1</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">Internet</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="o">/</span><span class="mi">24</span>
  <span class="n">Broadcast</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
  <span class="n">Address</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">setup</span> <span class="n">command</span>
  <span class="n">MTU</span> <span class="ow">is</span> <span class="mi">1500</span> <span class="nb">bytes</span>
  <span class="n">Helper</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="n">Directed</span> <span class="n">broadcast</span> <span class="n">forwarding</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">Outgoing</span> <span class="n">access</span> <span class="nb">list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="n">Inbound</span>  <span class="n">access</span> <span class="nb">list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="n">Proxy</span> <span class="n">ARP</span> <span class="ow">is</span> <span class="n">enabled</span>
  <span class="n">Local</span> <span class="n">Proxy</span> <span class="n">ARP</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">Security</span> <span class="n">level</span> <span class="ow">is</span> <span class="n">default</span>
  <span class="n">Split</span> <span class="n">horizon</span> <span class="ow">is</span> <span class="n">enabled</span>
  <span class="n">ICMP</span> <span class="n">redirects</span> <span class="n">are</span> <span class="n">always</span> <span class="n">sent</span>
  <span class="n">ICMP</span> <span class="n">unreachables</span> <span class="n">are</span> <span class="n">always</span> <span class="n">sent</span>
  <span class="n">ICMP</span> <span class="n">mask</span> <span class="n">replies</span> <span class="n">are</span> <span class="n">never</span> <span class="n">sent</span>
  <span class="n">IP</span> <span class="n">fast</span> <span class="n">switching</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">IP</span> <span class="n">fast</span> <span class="n">switching</span> <span class="n">on</span> <span class="n">the</span> <span class="n">same</span> <span class="n">interface</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">IP</span> <span class="n">Null</span> <span class="n">turbo</span> <span class="n">vector</span>
  <span class="n">IP</span> <span class="n">multicast</span> <span class="n">fast</span> <span class="n">switching</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">IP</span> <span class="n">multicast</span> <span class="n">distributed</span> <span class="n">fast</span> <span class="n">switching</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">IP</span> <span class="n">route</span><span class="o">-</span><span class="n">cache</span> <span class="n">flags</span> <span class="n">are</span> <span class="kc">None</span>
  <span class="n">Router</span> <span class="n">Discovery</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">IP</span> <span class="n">output</span> <span class="n">packet</span> <span class="n">accounting</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">IP</span> <span class="n">access</span> <span class="n">violation</span> <span class="n">accounting</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">TCP</span><span class="o">/</span><span class="n">IP</span> <span class="n">header</span> <span class="n">compression</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">RTP</span><span class="o">/</span><span class="n">IP</span> <span class="n">header</span> <span class="n">compression</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">Probe</span> <span class="n">proxy</span> <span class="n">name</span> <span class="n">replies</span> <span class="n">are</span> <span class="n">disabled</span>
  <span class="n">Policy</span> <span class="n">routing</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">Network</span> <span class="n">address</span> <span class="n">translation</span> <span class="ow">is</span> <span class="n">disable</span>
  <span class="n">WCCP</span> <span class="n">Redirect</span> <span class="n">outbound</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">WCCP</span> <span class="n">Redirect</span> <span class="n">inbound</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">WCCP</span> <span class="n">Redirect</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">BGP</span> <span class="n">Policy</span> <span class="n">Mapping</span> <span class="ow">is</span> <span class="n">disabled</span>
</pre></div>
</div>
</dd>
<dt>show ip int brief</dt>
<dd><div class="code first last highlight-default"><div class="highlight"><pre><span></span>RTA(config)#do show ip int brief
 Interface              IP-Address      OK? Method Status                Protocol
 GigabitEthernet0/0     10.10.10.1      YES manual up                    up
 GigabitEthernet0/1     10.10.20.1      YES manual up                    up
 Vlan1                  unassigned      YES unset  administratively down down
</pre></div>
</div>
</dd>
<dt>show ip interface</dt>
<dd><div class="code first last highlight-default"><div class="highlight"><pre><span></span><span class="n">RTA</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#do show ip interface</span>
 <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span> <span class="p">(</span><span class="n">connected</span><span class="p">)</span>
   <span class="n">Internet</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.1</span><span class="o">/</span><span class="mi">24</span>
   <span class="n">Broadcast</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
   <span class="n">Address</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">setup</span> <span class="n">command</span>
   <span class="n">MTU</span> <span class="ow">is</span> <span class="mi">1500</span> <span class="nb">bytes</span>
   <span class="n">Helper</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
   <span class="n">Directed</span> <span class="n">broadcast</span> <span class="n">forwarding</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">Outgoing</span> <span class="n">access</span> <span class="nb">list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
   <span class="n">Inbound</span>  <span class="n">access</span> <span class="nb">list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
   <span class="n">Proxy</span> <span class="n">ARP</span> <span class="ow">is</span> <span class="n">enabled</span>
   <span class="n">Security</span> <span class="n">level</span> <span class="ow">is</span> <span class="n">default</span>
   <span class="n">Split</span> <span class="n">horizon</span> <span class="ow">is</span> <span class="n">enabled</span>
   <span class="n">ICMP</span> <span class="n">redirects</span> <span class="n">are</span> <span class="n">always</span> <span class="n">sent</span>
   <span class="n">ICMP</span> <span class="n">unreachables</span> <span class="n">are</span> <span class="n">always</span> <span class="n">sent</span>
   <span class="n">ICMP</span> <span class="n">mask</span> <span class="n">replies</span> <span class="n">are</span> <span class="n">never</span> <span class="n">sent</span>
   <span class="n">IP</span> <span class="n">fast</span> <span class="n">switching</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">IP</span> <span class="n">fast</span> <span class="n">switching</span> <span class="n">on</span> <span class="n">the</span> <span class="n">same</span> <span class="n">interface</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">IP</span> <span class="n">Flow</span> <span class="n">switching</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">IP</span> <span class="n">Fast</span> <span class="n">switching</span> <span class="n">turbo</span> <span class="n">vector</span>
   <span class="n">IP</span> <span class="n">multicast</span> <span class="n">fast</span> <span class="n">switching</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">IP</span> <span class="n">multicast</span> <span class="n">distributed</span> <span class="n">fast</span> <span class="n">switching</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">Router</span> <span class="n">Discovery</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">IP</span> <span class="n">output</span> <span class="n">packet</span> <span class="n">accounting</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">IP</span> <span class="n">access</span> <span class="n">violation</span> <span class="n">accounting</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">TCP</span><span class="o">/</span><span class="n">IP</span> <span class="n">header</span> <span class="n">compression</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">RTP</span><span class="o">/</span><span class="n">IP</span> <span class="n">header</span> <span class="n">compression</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">Probe</span> <span class="n">proxy</span> <span class="n">name</span> <span class="n">replies</span> <span class="n">are</span> <span class="n">disabled</span>
   <span class="n">Policy</span> <span class="n">routing</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">Network</span> <span class="n">address</span> <span class="n">translation</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">BGP</span> <span class="n">Policy</span> <span class="n">Mapping</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">Input</span> <span class="n">features</span><span class="p">:</span> <span class="n">MCI</span> <span class="n">Check</span>
   <span class="n">WCCP</span> <span class="n">Redirect</span> <span class="n">outbound</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">WCCP</span> <span class="n">Redirect</span> <span class="n">inbound</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">WCCP</span> <span class="n">Redirect</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="n">disabled</span>
 <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span> <span class="p">(</span><span class="n">connected</span><span class="p">)</span>
   <span class="n">Internet</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">20.1</span><span class="o">/</span><span class="mi">24</span>
   <span class="n">Broadcast</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
   <span class="n">Address</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">setup</span> <span class="n">command</span>
   <span class="n">MTU</span> <span class="ow">is</span> <span class="mi">1500</span> <span class="nb">bytes</span>
   <span class="n">Helper</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
   <span class="n">Directed</span> <span class="n">broadcast</span> <span class="n">forwarding</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">Outgoing</span> <span class="n">access</span> <span class="nb">list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
   <span class="n">Inbound</span>  <span class="n">access</span> <span class="nb">list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
   <span class="n">Proxy</span> <span class="n">ARP</span> <span class="ow">is</span> <span class="n">enabled</span>
   <span class="n">Security</span> <span class="n">level</span> <span class="ow">is</span> <span class="n">default</span>
   <span class="n">Split</span> <span class="n">horizon</span> <span class="ow">is</span> <span class="n">enabled</span>
   <span class="n">ICMP</span> <span class="n">redirects</span> <span class="n">are</span> <span class="n">always</span> <span class="n">sent</span>
   <span class="n">ICMP</span> <span class="n">unreachables</span> <span class="n">are</span> <span class="n">always</span> <span class="n">sent</span>
   <span class="n">ICMP</span> <span class="n">mask</span> <span class="n">replies</span> <span class="n">are</span> <span class="n">never</span> <span class="n">sent</span>
   <span class="n">IP</span> <span class="n">fast</span> <span class="n">switching</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">IP</span> <span class="n">fast</span> <span class="n">switching</span> <span class="n">on</span> <span class="n">the</span> <span class="n">same</span> <span class="n">interface</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">IP</span> <span class="n">Flow</span> <span class="n">switching</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">IP</span> <span class="n">Fast</span> <span class="n">switching</span> <span class="n">turbo</span> <span class="n">vector</span>
   <span class="n">IP</span> <span class="n">multicast</span> <span class="n">fast</span> <span class="n">switching</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">IP</span> <span class="n">multicast</span> <span class="n">distributed</span> <span class="n">fast</span> <span class="n">switching</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">Router</span> <span class="n">Discovery</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">IP</span> <span class="n">output</span> <span class="n">packet</span> <span class="n">accounting</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">IP</span> <span class="n">access</span> <span class="n">violation</span> <span class="n">accounting</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">TCP</span><span class="o">/</span><span class="n">IP</span> <span class="n">header</span> <span class="n">compression</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">RTP</span><span class="o">/</span><span class="n">IP</span> <span class="n">header</span> <span class="n">compression</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">Probe</span> <span class="n">proxy</span> <span class="n">name</span> <span class="n">replies</span> <span class="n">are</span> <span class="n">disabled</span>
   <span class="n">Policy</span> <span class="n">routing</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">Network</span> <span class="n">address</span> <span class="n">translation</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">BGP</span> <span class="n">Policy</span> <span class="n">Mapping</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">Input</span> <span class="n">features</span><span class="p">:</span> <span class="n">MCI</span> <span class="n">Check</span>
   <span class="n">WCCP</span> <span class="n">Redirect</span> <span class="n">outbound</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">WCCP</span> <span class="n">Redirect</span> <span class="n">inbound</span> <span class="ow">is</span> <span class="n">disabled</span>
   <span class="n">WCCP</span> <span class="n">Redirect</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="n">disabled</span>
 <span class="n">Vlan1</span> <span class="ow">is</span> <span class="n">administratively</span> <span class="n">down</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">down</span>
   <span class="n">Internet</span> <span class="n">protocol</span> <span class="n">processing</span> <span class="n">disabled</span>
</pre></div>
</div>
</dd>
<dt>show ip route</dt>
<dd><div class="code first last highlight-default"><div class="highlight"><pre><span></span><span class="n">RTA</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#do show ip route</span>
<span class="n">Codes</span><span class="p">:</span> <span class="n">L</span> <span class="o">-</span> <span class="n">local</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">connected</span><span class="p">,</span> <span class="n">S</span> <span class="o">-</span> <span class="n">static</span><span class="p">,</span> <span class="n">R</span> <span class="o">-</span> <span class="n">RIP</span><span class="p">,</span> <span class="n">M</span> <span class="o">-</span> <span class="n">mobile</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">BGP</span>
       <span class="n">D</span> <span class="o">-</span> <span class="n">EIGRP</span><span class="p">,</span> <span class="n">EX</span> <span class="o">-</span> <span class="n">EIGRP</span> <span class="n">external</span><span class="p">,</span> <span class="n">O</span> <span class="o">-</span> <span class="n">OSPF</span><span class="p">,</span> <span class="n">IA</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">inter</span> <span class="n">area</span>
       <span class="n">N1</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">NSSA</span> <span class="n">external</span> <span class="nb">type</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N2</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">NSSA</span> <span class="n">external</span> <span class="nb">type</span> <span class="mi">2</span>
       <span class="n">E1</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">external</span> <span class="nb">type</span> <span class="mi">1</span><span class="p">,</span> <span class="n">E2</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">external</span> <span class="nb">type</span> <span class="mi">2</span><span class="p">,</span> <span class="n">E</span> <span class="o">-</span> <span class="n">EGP</span>
       <span class="n">i</span> <span class="o">-</span> <span class="n">IS</span><span class="o">-</span><span class="n">IS</span><span class="p">,</span> <span class="n">L1</span> <span class="o">-</span> <span class="n">IS</span><span class="o">-</span><span class="n">IS</span> <span class="n">level</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">L2</span> <span class="o">-</span> <span class="n">IS</span><span class="o">-</span><span class="n">IS</span> <span class="n">level</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">ia</span> <span class="o">-</span> <span class="n">IS</span><span class="o">-</span><span class="n">IS</span> <span class="n">inter</span> <span class="n">area</span>
       <span class="o">*</span> <span class="o">-</span> <span class="n">candidate</span> <span class="n">default</span><span class="p">,</span> <span class="n">U</span> <span class="o">-</span> <span class="n">per</span><span class="o">-</span><span class="n">user</span> <span class="n">static</span> <span class="n">route</span><span class="p">,</span> <span class="n">o</span> <span class="o">-</span> <span class="n">ODR</span>
       <span class="n">P</span> <span class="o">-</span> <span class="n">periodic</span> <span class="n">downloaded</span> <span class="n">static</span> <span class="n">route</span>
<span class="o">--</span>
<span class="n">Gateway</span> <span class="n">of</span> <span class="n">last</span> <span class="n">resort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
<span class="o">--</span>
     <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">8</span> <span class="ow">is</span> <span class="n">variably</span> <span class="n">subnetted</span><span class="p">,</span> <span class="mi">4</span> <span class="n">subnets</span><span class="p">,</span> <span class="mi">2</span> <span class="n">masks</span>
<span class="n">C</span>       <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">L</span>       <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.1</span><span class="o">/</span><span class="mi">32</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">C</span>       <span class="mf">10.10</span><span class="o">.</span><span class="mf">20.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">L</span>       <span class="mf">10.10</span><span class="o">.</span><span class="mf">20.1</span><span class="o">/</span><span class="mi">32</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
</pre></div>
</div>
</dd>
<dt>show ip route connected</dt>
<dd><div class="code first last highlight-default"><div class="highlight"><pre><span></span><span class="n">RTA</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#do show ip route connected</span>
 <span class="n">C</span>   <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.0</span><span class="o">/</span><span class="mi">24</span>  <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
 <span class="n">C</span>   <span class="mf">10.10</span><span class="o">.</span><span class="mf">20.0</span><span class="o">/</span><span class="mi">24</span>  <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="arp-neighbor-advertisement-sollicitation">
<h4>ARP - Neighbor Advertisement/Sollicitation<a class="headerlink" href="#arp-neighbor-advertisement-sollicitation" title="Permalink to this headline">¶</a></h4>
<p>A similar process is used for IPv6 packets. Instead of the ARP process, IPv6 address resolution uses ICMPv6 Neighbor Solicitation and Neighbor Advertisement messages. IPv6-to-MAC address mapping are kept in a table similar to the ARP cache, called the neighbor cache.</p>
</div>
<div class="section" id="mac-addresses-on-serial-interfaces">
<h4>MAC addresses on Serial Interfaces<a class="headerlink" href="#mac-addresses-on-serial-interfaces" title="Permalink to this headline">¶</a></h4>
<p>When the interface is a point-to-point (P2P) serial connection, the router encapsulates the IPv4 packet into the proper data link frame format used by the exit interface (HDLC, PPP, etc.). Because there are no MAC addresses on serial interfaces, R2 sets the data link destination address to an equivalent of a broadcast.
The router does not need to know any info about the destination L2 address, so the router just sends the frame out the corresponding serial interface. No source address is required on a P2P serial connection</p>
<p>HDLC frames can be transmitted over synchronous or asynchronous serial communication links. Those links have no mechanism to mark the beginning or end of a frame, so the beginning and end of each frame has to be identified. This is done by using a frame delimiter, or flag, which is a unique sequence of bits that is guaranteed not to be seen inside a frame.
This sequence is ‘01111110’, or, in hexadecimal notation, 0x7E. Each frame begins and ends with a frame delimiter. A frame delimiter at the end of a frame may also mark the start of the next frame.
A sequence of 7 or more consecutive 1-bits within a frame will cause the frame to be aborted.</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="0%" />
<col width="11%" />
<col width="13%" />
<col width="15%" />
<col width="31%" />
<col width="5%" />
<col width="13%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Flag 7E</td>
<td colspan="2">Address</td>
<td>Control</td>
<td>Protocol</td>
<td>Data</td>
<td>FCS</td>
<td>Flag 7E</td>
</tr>
<tr class="row-even"><td>8 bits</td>
<td colspan="2">8 bits</td>
<td>8 bits</td>
<td>16 bits</td>
<td>~ length 0 or x*8</td>
<td>16b</td>
<td>8 bits</td>
</tr>
</tbody>
</table>
<p>The Address field is used to specify the type of packet contained in the cHDLC frame; 0x0F for Unicast and 0x8F for Broadcast packets.
The Control field is always set to zero (0x00).
The Protocol Code field is used to specify the protocol type encapsulated within the cHDLC frame (e.g. 0x0800 for Internet Protocol).</p>
</div>
<div class="section" id="packet-forwarding-decision-process">
<h4>Packet Forwarding Decision Process<a class="headerlink" href="#packet-forwarding-decision-process" title="Permalink to this headline">¶</a></h4>
<p>Directly Connected Interface?
Yes -&gt; Check ARP cache (ARP request if necessary) and forward to host on local subnet
Remote Network? Yes -&gt; Encapsulate the frame and forward out of the exit interface to the next hop
else Gateway of last resort or drop</p>
</div>
<div class="section" id="routing-best-path-selection">
<h4>Routing BEST PATH selection<a class="headerlink" href="#routing-best-path-selection" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>RIP</dt>
<dd>Routing Information Protocol - Hop count</dd>
<dt>OSPF</dt>
<dd>Open Shortest Path First     - Cisco’s cost based on CUMULATIVE bandwidth from source to destination</dd>
<dt>EIGRP</dt>
<dd>Enhanced Interior Gateway Routing Protocol - Bandwidth, delay, load, reliability (bladder)</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">two or more paths with identical metrics = LOAD BALANCING</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Equal cost load balancing can be cfd to use both dynamic routing protocols and static routes ONLY EIGRP support UNEQUAL COST LOAD BALANCING</p>
</div>
</div>
<div class="section" id="administrative-distance">
<h4>ADMINISTRATIVE DISTANCE<a class="headerlink" href="#administrative-distance" title="Permalink to this headline">¶</a></h4>
<p>For example, if both RIP and EIGRP are configured on a router, both routing protocols may learn of the same destination network.
However, each routing protocol may decide on a different path to reach the destination based on that routing protocol’s metrics.
RIP chooses a path based on hop count, whereas EIGRP chooses a path based on its composite metric. How does the router know which route to use?</p>
<p>Cisco IOS uses what is known as the administrative distance (AD) to determine the route to install into the IP routing table.
The AD represents the “trustworthiness” of the route; the lower the AD,
the more trustworthy the route source. For example, a static route has an AD of 1,
whereas an EIGRP-discovered route has an AD of 90.
Given two separate routes to the same destination, the router chooses the route with the lowest AD.
When a router has the choice of a static route and an EIGRP route, the static route takes precedence.</p>
<blockquote>
<div><p>Default Distance Value Table</p>
<p>This table lists the administrative distance default values of the protocols that Cisco supports:</p>
<table border="1" class="docutils">
<colgroup>
<col width="63%" />
<col width="37%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Routing Protocol</th>
<th class="head">Administrative distance</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Directly connected interface</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>Static route out an interface</td>
<td>1</td>
</tr>
<tr class="row-even"><td>Static route to next-hop address</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>DMNR - Dynamic Mobile Network Routing</td>
<td>3</td>
</tr>
<tr class="row-even"><td>EIGRP summary route</td>
<td>5</td>
</tr>
<tr class="row-odd"><td>External BGP</td>
<td>20</td>
</tr>
<tr class="row-even"><td>Internal EIGRP</td>
<td>90</td>
</tr>
<tr class="row-odd"><td>IGRP</td>
<td>100</td>
</tr>
<tr class="row-even"><td>OSPF</td>
<td>110</td>
</tr>
<tr class="row-odd"><td>IS-IS</td>
<td>115</td>
</tr>
<tr class="row-even"><td>Routing Information Protocol (RIP)</td>
<td>120</td>
</tr>
<tr class="row-odd"><td>Exterior Gateway Protocol (EGP)</td>
<td>140</td>
</tr>
<tr class="row-even"><td>On Demand Routing (ODR)</td>
<td>160</td>
</tr>
<tr class="row-odd"><td>External EIGRP</td>
<td>170</td>
</tr>
<tr class="row-even"><td>Internal BGP</td>
<td>200</td>
</tr>
<tr class="row-odd"><td>Next Hop Resolution Protocol (NHRP)</td>
<td>250</td>
</tr>
<tr class="row-even"><td>Floating Static Route (ex. DHCP-learned)</td>
<td>254</td>
</tr>
<tr class="row-odd"><td>Unknown (Others)</td>
<td>255</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the administrative distance is 255, the router does not believe the source of that route and does not install the route in the routing table.
Since IOS 12.2, the administrative distance of a static route with an exit interface is 1.
Only the interface itself has an administrative distance of 0, since a route cannot have a distance of less than 1.
Directly connected routes have an administrative distance of 0.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="changing-administrative-distance">
<h4>Changing Administrative Distance<a class="headerlink" href="#changing-administrative-distance" title="Permalink to this headline">¶</a></h4>
<p>When you use <em>route redistribution</em>, occasionally you need to modify the administrative distance of a protocol so that it takes precedence.
For example, if you want the router to select RIP-learned routes (default value 120) rather than IGRP-learned routes (default value 100)
to the same destination, you must increase the administrative distance for IGRP to 120+,
or decrease the administrative distance of RIP to a value less than 100.</p>
<p>You can modify the administrative distance of a protocol through the distance command in the routing process subconfiguration mode.
This command specifies that the administrative distance is assigned to the routes learned from a particular routing protocol.
You need to use this procedure generally when you migrate the network from one routing protocol to another,
and the latter has a higher administrative distance. However, a change in the administrative distance <em>can lead to routing loops and black holes</em>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">use caution if you change the administrative distance.</p>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#router eigrp 10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#distance eigrp xx yy</span>

<span class="n">where</span> <span class="n">xx</span> <span class="n">representes</span> <span class="n">the</span> <span class="n">new</span> <span class="n">value</span> <span class="n">of</span> <span class="n">internal</span> <span class="n">administrative</span> <span class="n">distance</span> <span class="ow">and</span> <span class="n">yy</span> <span class="n">representes</span> <span class="n">the</span> <span class="n">new</span> <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">external</span> <span class="n">administrative</span> <span class="n">distance</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="example-of-changing-ad-for-rip">
<h4>example of changing AD for rip<a class="headerlink" href="#example-of-changing-ad-for-rip" title="Permalink to this headline">¶</a></h4>
<p>Here is an example that shows two routers, R1 and R2, connected through Ethernet. The loopback interfaces of the routers are also advertised with RIP and IGRP on both the routers.
You can observe that the IGRP routes are preferred over the RIP routes in the routing table because the administrative distance is 100.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1">#show ip route</span>

<span class="n">Gateway</span> <span class="n">of</span> <span class="n">last</span> <span class="n">resort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>

<span class="mf">172.16</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">subnetted</span><span class="p">,</span> <span class="mi">1</span> <span class="n">subnets</span>
<span class="n">C</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">1.0</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Ethernet0</span>
<span class="n">I</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">8</span> <span class="p">[</span><span class="mi">100</span><span class="o">/</span><span class="mi">1600</span><span class="p">]</span> <span class="n">via</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">1.200</span><span class="p">,</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">,</span> <span class="n">Ethernet0</span>
<span class="n">C</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Loopback0</span>

<span class="n">R2</span><span class="c1">#show ip route</span>

<span class="n">Gateway</span> <span class="n">of</span> <span class="n">last</span> <span class="n">resort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>

<span class="mf">172.16</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">subnetted</span><span class="p">,</span> <span class="mi">1</span> <span class="n">subnets</span>
<span class="n">C</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">1.0</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Ethernet0</span>
<span class="n">C</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">8</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Loopback0</span>
<span class="n">I</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span> <span class="p">[</span><span class="mi">100</span><span class="o">/</span><span class="mi">1600</span><span class="p">]</span> <span class="n">via</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">1.100</span><span class="p">,</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span>
</pre></div>
</div>
<p>In order to enable the router to prefer RIP routes to IGRP, configure the distance command on R1 like this:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#router rip</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#distance 90</span>
</pre></div>
</div>
<p>Now look at the routing table. The routing table shows that the router prefers the RIP routes. The router learns RIP routes with an administrative distance of 90, although the default is 120.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The new administrative distance value is relevant only to the routing process of a single router (in this case R1). R2 still has IGRP routes in the routing table.</p>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1">#show ip route</span>

<span class="n">Gateway</span> <span class="n">of</span> <span class="n">last</span> <span class="n">resort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>

<span class="mf">172.16</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">subnetted</span><span class="p">,</span> <span class="mi">1</span> <span class="n">subnets</span>
<span class="n">C</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">1.0</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Ethernet0</span>
<span class="n">R</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">8</span> <span class="p">[</span><span class="mi">90</span><span class="o">/</span><span class="mi">1</span><span class="p">]</span> <span class="n">via</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">1.200</span><span class="p">,</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span> <span class="n">Ethernet0</span>
<span class="n">C</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Loopback0</span>

<span class="n">R2</span><span class="c1">#show ip route</span>

<span class="n">Gateway</span> <span class="n">of</span> <span class="n">last</span> <span class="n">resort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>

<span class="mf">172.16</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">subnetted</span><span class="p">,</span> <span class="mi">1</span> <span class="n">subnets</span>
<span class="n">C</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">1.0</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Ethernet0</span>
<span class="n">C</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">8</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Loopback0</span>
<span class="n">I</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span> <span class="p">[</span><span class="mi">100</span><span class="o">/</span><span class="mi">1600</span><span class="p">]</span> <span class="n">via</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">1.100</span><span class="p">,</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There are no general guidelines to assign administrative distances because each network has varied requirements. You must determine a reasonable matrix of administrative distances for the network as a whole. Similarly, a directly connected route with an AD of 0 takes precedence over a static route with an AD of 1.</p>
</div>
</div>
<div class="section" id="other-applications-of-a-d">
<h4>Other applications of A.D.<a class="headerlink" href="#other-applications-of-a-d" title="Permalink to this headline">¶</a></h4>
<p>One common reason to change the administrative distance of a route is when you use <em>Static Routes to backup an existing IGP route</em>.
This is normally used to bring up a backup link when the primary fails.</p>
<p>For example, assume that you use the routing table from R1. However, in this case,
there is also an ISDN line that you can use as a backup if the primary connection fails. Here is an example of a Floating Static for this route:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>ip route 10.0.0.0 255.0.0.0 Dialer 1 250
!--- Note: The Administrative Distance is set to 250.
</pre></div>
</div>
<p>If the Ethernet interfaces fail, or if you manually bring down the Ethernet interfaces, the floating static route is installed into the routing table. All traffic destined for the 10.0.0.0/8 network is then routed out of the Dialer 1 interface and over the backup link.
The routing table appears similar to this after the failure:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1">#show ip route</span>
<span class="n">Gateway</span> <span class="n">of</span> <span class="n">last</span> <span class="n">resort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
<span class="mf">172.16</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">subnetted</span><span class="p">,</span> <span class="mi">1</span> <span class="n">subnets</span>
<span class="n">C</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">1.0</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Ethernet0</span>
<span class="n">S</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">8</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Dialer1</span>
<span class="n">C</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Loopback0</span>
</pre></div>
</div>
</div>
<div class="section" id="directly-connected-n-remote-network-routes">
<h4>Directly Connected n Remote Network Routes<a class="headerlink" href="#directly-connected-n-remote-network-routes" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><dl class="docutils">
<dt>Directly connected routes</dt>
<dd>These routes come from the active router interfaces. Routers add a directly connected route when an interface is configured with an IP address and is activated.</dd>
<dt>Remote routes</dt>
<dd>These are remote networks connected to other routers. Routes to these networks can either be statically configured or dynamically learned through dynamic routing protocols.</dd>
</dl>
</div></blockquote>
<p>The sources of the routing table entries are identified by a <em>code</em>. The code identifies how the route was learned. For instance, common codes include:</p>
<blockquote>
<div><ul class="simple">
<li>L - Identifies the address assigned to a router’s interface. This allows the router to efficiently determine when it receives a packet for the interface instead of being forwarded.</li>
<li>C - Identifies a directly connected network.</li>
<li>S - Identifies a static route created to reach a specific network.</li>
<li>D - Identifies a dynamically learned network from another router using EIGRP.</li>
<li>O - Identifies a dynamically learned network from another router using the OSPF routing protocol.</li>
</ul>
</div></blockquote>
<p>D 10.1.1.0/24 [90/2170112] via 209.165.200.226, 00:00:05, Serial0/0/0</p>
<blockquote>
<div><ul class="simple">
<li>Route source - Identifies how the route was learned.</li>
<li>Destination network - Identifies the address of the remote network.</li>
<li>Administrative distance - Identifies the trustworthiness of the route source. Lower values indicate preferred route source.</li>
<li>Metric - Identifies the value assigned to reach the remote network. Lower values indicate preferred routes.</li>
<li>Next-hop - Identifies the IPv4 address of the next router to forward the packet to.</li>
<li>Route timestamp - Identifies how much time has passed since the route was learned.</li>
<li>Outgoing interface - Identifies the exit interface to use to forward a packet toward the final destination.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="the-ip-routing-process">
<h4>The IP routing process<a class="headerlink" href="#the-ip-routing-process" title="Permalink to this headline">¶</a></h4>
<p>IP routing example using two hosts and one router</p>
<p>User on Host_A pinged Host_B’s IP address. Routing doesn’t get any simpler than this, but it still involves a lot of steps, so let’s work through them now:</p>
<ol class="arabic">
<li><p class="first">Internet Control Message Protocol (ICMP) creates an echo request payload, which is simply the alphabet in the data field.</p>
</li>
<li><p class="first">ICMP hands that payload to Internet Protocol (IP), which then creates a packet. At a minimum, this packet contains an IP source address, an IP destination address, and a Protocol field with 01h. Don’t forget that Cisco likes to use 0x in front of hex characters, so this could also look like 0x01. This tells the receiving host to whom it should hand the payload when the destination is reached—in this example, ICMP.</p>
</li>
<li><p class="first">Once the packet is created, IP determines whether the destination IP address is on the local network or a remote one.</p>
</li>
<li><p class="first">Since IP has determined that this is a remote request, the packet must be sent to the default gateway so it can be routed to the remote network. The Registry in Windows is parsed to find the configured default gateway.</p>
</li>
<li><p class="first">The default gateway of Host_A is configured to 172.16.10.1. For this packet to be sent to the default gateway, the hardware address of the router’s interface Ethernet 0, which is configured with the IP address of 172.16.10.1, must be known. Why? So the packet can be handed down to the Data Link layer, framed, and sent to the router’s interface that’s connected to the 172.16.10.0 network. Because hosts communicate only via hardware addresses on the local LAN, it’s important to recognize that for Host_A to communicate to Host_B, it has to send packets to the Media Access Control (MAC) address of the default gateway on the local network. MAC addresses are always local on the LAN and never go through and past a router.</p>
</li>
<li><p class="first">Next, the Address Resolution Protocol (ARP) cache of the host is checked to see if the IP address of the default gateway has already been resolved to a hardware address. If it has, the packet is then free to be handed to the Data Link layer for framing. Remember that the hardware destination address is also handed down with that packet.</p>
</li>
<li><p class="first">If the hardware address isn’t already in the ARP cache of the host, an ARP broadcast will be sent out onto the local network to search for the 172.16.10.1 hardware address. The router then responds to the request and provides the hardware address of Ethernet 0, and the host caches this address.</p>
</li>
<li><p class="first">Once the packet and destination hardware address are handed to the Data Link layer, the LAN driver is used to provide media access via the type of LAN being used, which is Ethernet in this case. A frame is then generated, encapsulating the packet with control information. Within that frame are the hardware destination and source addresses plus, in this case, an Ether-Type field, which identifies the specific Network layer protocol that handed the packet to the Data Link layer. In this instance, it’s IP. At the end of the frame is something called a Frame Check Sequence (FCS) field that houses the result of the cyclic redundancy check (CRC). The frame would look something like what I’ve detailed in Figure 9.3. It contains Host A’s hardware (MAC) address and the destination hardware address of the default gateway. It does not include the remote host’s MAC address—remember that!</p>
</li>
<li><p class="first">Once the frame is completed, it’s handed down to the Physical layer to be put on the physical medium (in this example, twisted-pair wire) one bit at a time.</p>
</li>
<li><p class="first">Every device in the collision domain receives these bits and builds the frame. They each run a CRC and check the answer in the FCS field. If the answers don’t match, the frame is discarded:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>* If the CRC matches, then the hardware destination address is checked to see if it matches (which, in this example, is the router’s interface Ethernet 0).
* If it’s a match, then the Ether-Type field is checked to find the protocol used at the Network layer.
</pre></div>
</div>
</li>
<li><p class="first">The packet is pulled from the frame, and what is left of the frame is discarded. The packet is handed to the protocol listed in the Ether-Type field—it’s given to IP.</p>
</li>
<li><p class="first">IP receives the packet and checks the IP destination address. Since the packet’s destination address doesn’t match any of the addresses configured on the receiving router itself, the router will look up the destination IP network address in its routing table.</p>
</li>
<li><p class="first">The routing table must have an entry for the network 172.16.20.0 or the packet will be discarded immediately and an ICMP message will be sent back to the originating device with a destination network unreachable message.</p>
</li>
<li><p class="first">If the router does find an entry for the destination network in its table, the packet is switched to the exit interface—in this example, interface Ethernet 1. The following output displays the Lab_A router’s routing table. The C means “directly connected.” No routing protocols are needed in this network since all networks (all two of them) are directly connected</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Lab_A</span><span class="o">&gt;</span><span class="n">sh</span> <span class="n">ip</span> <span class="n">route</span>
    <span class="n">C</span>       <span class="mf">172.16</span><span class="o">.</span><span class="mf">10.0</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span>    <span class="n">Ethernet0</span>
    <span class="n">L</span>       <span class="mf">172.16</span><span class="o">.</span><span class="mf">10.1</span><span class="o">/</span><span class="mi">32</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Ethernet0</span>
    <span class="n">C</span>       <span class="mf">172.16</span><span class="o">.</span><span class="mf">20.0</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span>    <span class="n">Ethernet1</span>
    <span class="n">L</span>       <span class="mf">172.16</span><span class="o">.</span><span class="mf">20.1</span><span class="o">/</span><span class="mi">32</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Ethernet1</span>
</pre></div>
</div>
</li>
<li><p class="first">The router packet-switches the packet to the Ethernet 1 buffer.</p>
</li>
<li><p class="first">The Ethernet 1 buffer needs to know the hardware address of the destination host and first checks the ARP cache. If the hardware address of Host_B has already been resolved and is in the router’s ARP cache, then the packet and the hardware address will be handed down to the Data Link layer to be framed.let’s take a look at the ARP cache on the Lab_A router by using the show ip arp command</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Lab_A</span><span class="c1">#sh ip arp</span>
<span class="n">Protocol</span>  <span class="n">Address</span>     <span class="n">Age</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="n">Hardware</span> <span class="n">Addr</span>  <span class="n">Type</span>   <span class="n">Interface</span>
<span class="n">Internet</span>  <span class="mf">172.16</span><span class="o">.</span><span class="mf">20.1</span>   <span class="o">-</span>     <span class="mi">00</span><span class="n">d0</span><span class="o">.</span><span class="mi">58</span><span class="n">ad</span><span class="o">.</span><span class="mi">05</span><span class="n">f4</span>  <span class="n">ARPA</span>   <span class="n">Ethernet1</span>
<span class="n">Internet</span>  <span class="mf">172.16</span><span class="o">.</span><span class="mf">20.2</span>   <span class="mi">3</span>     <span class="mf">0030.9492</span><span class="o">.</span><span class="n">a5dd</span>  <span class="n">ARPA</span>   <span class="n">Ethernet1</span>
<span class="n">Internet</span>  <span class="mf">172.16</span><span class="o">.</span><span class="mf">10.1</span>   <span class="o">-</span>     <span class="mi">00</span><span class="n">d0</span><span class="o">.</span><span class="mi">58</span><span class="n">ad</span><span class="o">.</span><span class="mi">06</span><span class="n">aa</span>  <span class="n">ARPA</span>   <span class="n">Ethernet0</span>
<span class="n">Internet</span>  <span class="mf">172.16</span><span class="o">.</span><span class="mf">10.2</span>  <span class="mi">12</span>     <span class="mf">0030.9492</span><span class="o">.</span><span class="n">a4ac</span>  <span class="n">ARPA</span>   <span class="n">Ethernet0</span>
</pre></div>
</div>
<ul class="simple">
<li>Now if the hardware address hasn’t already been resolved, the router will send an ARP request out E1 looking for the 172.16.20.2 hardware address. Host_B responds with its hardware address, and the packet and destination hardware addresses are then both sent to the Data Link layer for framing.</li>
</ul>
</li>
<li><p class="first">The Data Link layer creates a frame with the destination and source hardware addresses, Ether-Type field, and FCS field at the end. The frame is then handed to the Physical layer to be sent out on the physical medium one bit at a time.</p>
</li>
<li><p class="first">Host_B receives the frame and immediately runs a CRC. If the result matches the information in the FCS field, the hardware destination address will then be checked next. If the host finds a match, the Ether-Type field is then checked to determine the protocol that the packet should be handed to at the Network layer—IP in this example.</p>
</li>
<li><p class="first">At the Network layer, IP receives the packet and runs a CRC on the IP header. If that passes, IP then checks the destination address. Since a match has finally been made, the Protocol field is checked to find out to whom the payload should be given.</p>
</li>
<li><p class="first">The payload is handed to ICMP, which understands that this is an echo request. ICMP responds to this by immediately discarding the packet and generating a new payload as an echo reply.</p>
</li>
<li><p class="first">A packet is then created including the source and destination addresses, Protocol field, and payload. The destination device is now Host_A.</p>
</li>
<li><p class="first">IP then checks to see whether the destination IP address is a device on the local LAN or on a remote network. Since the destination device is on a remote network, the packet needs to be sent to the default gateway.</p>
</li>
<li><p class="first">The default gateway IP address is found in the Registry of the Windows device, and the ARP cache is checked to see if the hardware address has already been resolved from an IP address.</p>
</li>
<li><p class="first">Once the hardware address of the default gateway is found, the packet and destination hardware addresses are handed down to the Data Link layer for framing.</p>
</li>
<li><p class="first">The Data Link layer frames the packet of information and includes the following in the header</p>
<blockquote>
<div><ul class="simple">
<li>The destination and source hardware addresses</li>
<li>The Ether-Type field with 0x0800 (IP) in it</li>
<li>The FCS field with the CRC result in tow</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">The frame is now handed down to the Physical layer to be sent out over the network medium one bit at a time.</p>
</li>
<li><p class="first">The router’s Ethernet 1 interface receives the bits and builds a frame. The CRC is run, and the FCS field is checked to make sure the answers match.</p>
</li>
<li><p class="first">Once the CRC is found to be okay, the hardware destination address is checked. Since the router’s interface is a match, the packet is pulled from the frame and the Ether-Type field is checked to determine which protocol the packet should be delivered to at the Network layer.</p>
</li>
<li><p class="first">The protocol is determined to be IP, so it gets the packet. IP runs a CRC check on the IP header first and then checks the destination IP address</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">IP does not run a complete CRC as the Data Link layer does—it only checks the header for errors.</p>
</div>
</li>
<li><p class="first">Since the IP destination address doesn’t match any of the router’s interfaces, the routing table is checked to see whether it has a route to 172.16.10.0. If it doesn’t have a route over to the destination network, the packet will be discarded immediately. I want to take a minute to point out that this is exactly where the source of confusion begins for a lot of administrators because when a ping fails, most people think the packet never reached the destination host. But as we see here, that’s not always the case. All it takes for this to happen is for even just one of the remote routers to lack a route back to the originating host’s network and— poof!—the packet is dropped on the return trip, not on its way to the host!</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Just a quick note to mention that when (and if) the packet is lost on the way back to the originating host, you will typically see a request timed-out message because it is an unknown error. If the error occurs because of a known issue, such as if a route is not in the routing table on the way to the destination device, you will see a destination unreachable message. This should help you determine if the problem occurred on the way to the destination or on the way back.</p>
</div>
</li>
<li><p class="first">In this case, the router happens to know how to get to network 172.16.10.0—the exit interface is Ethernet 0—so the packet is switched to interface Ethernet 0.</p>
</li>
<li><p class="first">The router then checks the ARP cache to determine whether the hardware address for 172.16.10.2 has already been resolved.</p>
</li>
<li><p class="first">Since the hardware address to 172.16.10.2 is already cached from the originating trip to Host_B, the hardware address and packet are then handed to the Data Link layer.</p>
</li>
<li><p class="first">The Data Link layer builds a frame with the destination hardware address and source hardware address and then puts IP in the Ether-Type field. A CRC is run on the frame and the result is placed in the FCS field.</p>
</li>
<li><p class="first">The frame is then handed to the Physical layer to be sent out onto the local network one bit at a time.</p>
</li>
<li><p class="first">The destination host receives the frame, runs a CRC, checks the destination hardware address, then looks into the Ether-Type field to find out to whom to hand the packet.</p>
</li>
<li><p class="first">IP is the designated receiver, and after the packet is handed to IP at the Network layer, it checks the Protocol field for further direction. IP finds instructions to give the payload to ICMP, and ICMP determines the packet to be an ICMP echo reply.</p>
</li>
<li><p class="first">ICMP acknowledges that it has received the reply by sending an exclamation point (!) to the user interface. ICMP then attempts to send four more echo requests to the destination host.</p>
</li>
</ol>
<p>The key point here is that if you had a much larger network, the process would be the same. It’s just that the larger the internetwork, the more hops the packet goes through before it finds the destination host.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It’s super-important to remember that when Host_A sends a packet to Host_B, the destination hardware address used is the default gateway’s Ethernet interface. Why? Because frames can’t be placed on remote networks—only local networks. So packets destined for remote networks must go through the default gateway.</p>
</div>
<p>To see which packet switching method your router interface is using, use the command show ip interface.</p>
</div>
</div>
<div class="section" id="chapter-2-static-routes">
<h3>Chapter 2 Static Routes<a class="headerlink" href="#chapter-2-static-routes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="ipv4-syntax">
<h4>ipv4 syntax<a class="headerlink" href="#ipv4-syntax" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route network mask { next-hop-ip | exit-intf }</span>
</pre></div>
</div>
<p>A static route is identified in the routing table with the code ‘S’.</p>
<p>To configure an IPv4 default static route, use the following command:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 0.0.0.0 0.0.0.0 { exit-intf | next-hop-ip }</span>
</pre></div>
</div>
</div>
<div class="section" id="combination-of-exit-interface-and-next-hop">
<h4>combination of exit interface and next hop<a class="headerlink" href="#combination-of-exit-interface-and-next-hop" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 192.168.2.0 255.255.255.0 s0/0/1 192.168.1.1</span>
</pre></div>
</div>
</div>
<div class="section" id="when-to-use-static-routes">
<h4>When to Use Static Routes<a class="headerlink" href="#when-to-use-static-routes" title="Permalink to this headline">¶</a></h4>
<p>Static routing has three primary uses:</p>
<blockquote>
<div><p># Providing ease of routing table maintenance in smaller networks that are not expected to grow significantly.
# Routing to and from stub networks. A STUB NETWORK is a network accessed by a single route, and the router has ONLY ONE NEIGHBOR.
# Using a single default route to represent a path to any network that does not have a more specific match with another route in the routing table.</p>
<p>benefits:</p>
<ul class="simple">
<li>Are not advertised over the network, resulting in better security</li>
<li>Use less bandwidth than dynamic routing protocols</li>
<li>Use known paths to send data</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Default routes are used to send traffic to any destination beyond the next upstream router.</p>
</div>
<dl class="docutils">
<dt>Use static routes to…</dt>
<dd><ul class="first last simple">
<li>Connect to a specific network</li>
<li>Connect a stub router</li>
<li>Summarize routing table entries</li>
<li>Create a backup route</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="default-static-route">
<h4>Default static route<a class="headerlink" href="#default-static-route" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">route</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="n">nexthopip</span> <span class="o">|</span> <span class="n">exitif</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Default static routes are used when no other routes in the routing table match the packet destination IP address. In other words, when a more specific match does not exist. A common use is when connecting a company’s edge router to the ISP network. When a router has only one other router to which it is connected. In this situation, the router is known as a stub router.</p>
</div>
</div>
<div class="section" id="summary-static-route">
<h4>Summary static route<a class="headerlink" href="#summary-static-route" title="Permalink to this headline">¶</a></h4>
<p>Representing multiple networks</p>
<p>172.20.0.0/16
172.21.0.0/16
172.22.0.0/16
172.23.0.0/16
as 172.20.0.0/14</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">route</span> <span class="mf">172.20</span><span class="o">.</span><span class="mf">0.0</span> <span class="mf">255.252</span><span class="o">.</span><span class="mf">0.0</span> <span class="n">nexthopip</span> <span class="o">|</span> <span class="n">exitif</span>
</pre></div>
</div>
</div>
<div class="section" id="floating-static-route">
<h4>Floating static route<a class="headerlink" href="#floating-static-route" title="Permalink to this headline">¶</a></h4>
<p>Another type of static route is a floating static route.
Floating static routes are static routes that are <strong>used to provide a backup path to a primary static or dynamic route, in the event of a link failure.</strong></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The floating static route is only used when the primary route is not available.</p>
</div>
<p>To accomplish this, the floating static route is configured with a <strong>higher administrative distance than the primary route</strong>.
The administrative distance represents the trustworthiness of a route.
If multiple paths to the destination exist, the router will choose the path with the lowest administrative distance.</p>
<p>The next hop can be identified by an IP address, exit interface, or both. How the destination is specified creates one of the three following route types:</p>
<blockquote>
<div><dl class="docutils">
<dt>Next-hop route</dt>
<dd>Only the next-hop IP address is specified</dd>
<dt>Directly connected static route</dt>
<dd>Only the router exit interface is specified</dd>
<dt>Fully specified static route</dt>
<dd>The next-hop IP address and exit interface are specified</dd>
</dl>
</div></blockquote>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">route</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span> <span class="n">G0</span><span class="o">/</span><span class="mi">1</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">2.2</span>
</pre></div>
</div>
</div>
<div class="section" id="fully-specified-static-route">
<h4>Fully Specified Static Route<a class="headerlink" href="#fully-specified-static-route" title="Permalink to this headline">¶</a></h4>
<p>In a fully specified static route, <strong>both the exit interface and the next-hop IP</strong> address are specified.
This is another type of static route that is <em>used in older IOSs, prior to CEF.</em></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This form of static route is used when the exit interface is a multi-access interface and it is necessary to explicitly identify the next hop.</p>
</div>
<p>The next hop must be directly connected to the specified exit interface.</p>
<div class="section" id="example">
<h5>example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h5>
<div class="highlight-html"><div class="highlight"><pre><span></span>                             PC2
                              |
                              |_
             172.16.1.0/24   |__|
                               |
                               |
                           G0/0|.1
                              _|__
                             (_R2_)
                     S0/0/0 /.2 .2\ S0/0/1
                           /       \ DCE
             172.16.2.0/24/         \/\
                         /             \  192.168.1.0/24
                      .1/               \.1
          __           /__S0/0/0  S0/0/1_\        __
PC1------|__|---------(_R1_) DCE      (_R3_)-----|__|----PC3
                 G0/0  .1           .1 G0/0

       172.16.3.0/24                  192.168.2.0/24
</pre></div>
</div>
<p>Suppose that the network link between R1 and R2 is an Ethernet link and that the GigabitEthernet 0/1 interface of R1 is connected to that network,
as shown in Figure 1. CEF is not enabled.
To eliminate the recursive lookup,(map a next hop ip to what interface that is = if CEF not enabled)
a directly connected static route can be implemented using the following command:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 192.168.2.0 255.255.255.0 GigabitEthernet 0/1</span>
</pre></div>
</div>
<p>However, this may cause unexpected or inconsistent results. The difference between an Ethernet multi-access network and a point-to-point serial network is that a point-to-point serial network has only one other device on that network, the router at the other end of the link. With Ethernet networks, there may be many different devices sharing the same multi-access network, including hosts and even multiple routers. By only designating the Ethernet exit interface in the static route, the router will not have sufficient information to determine which device is the next-hop device.</p>
<p>R1 knows that the packet needs to be encapsulated in an Ethernet frame and sent out the GigabitEthernet 0/1 interface. However, R1 does not know the next-hop IPv4 address; therefore, it cannot determine the destination MAC address for the Ethernet frame.</p>
<p>Depending upon the topology and the configurations on other routers, this static route may or may not work. It is recommended that when the exit interface is an Ethernet network, that a fully specified static route is used, including both the exit interface and the next-hop address.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 172.16.1.0 255.255.255.0 s0/0/1 192.168.1.2</span>
</pre></div>
</div>
<p>As shown in Figure 2, when forwarding packets to R2, the exit interface is GigabitEthernet 0/1 and the next-hop IPv4 address is 172.16.2.2.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">With the use of CEF, a fully specified static route is no longer necessary. A static route using a next-hop address should be used.</p>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 0.0.0.0 0.0.0.0 172.16.2.2</span>

<span class="n">R1</span><span class="c1">#show ip route static</span>


<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#do show ip route static</span>
     <span class="mf">172.31</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">16</span> <span class="ow">is</span> <span class="n">variably</span> <span class="n">subnetted</span><span class="p">,</span> <span class="mi">7</span> <span class="n">subnets</span><span class="p">,</span> <span class="mi">5</span> <span class="n">masks</span>
<span class="n">S</span>       <span class="mf">172.31</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span> <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="p">]</span> <span class="n">via</span> <span class="mf">172.31</span><span class="o">.</span><span class="mf">1.193</span>
<span class="n">S</span>       <span class="mf">172.31</span><span class="o">.</span><span class="mf">1.128</span><span class="o">/</span><span class="mi">26</span> <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="p">]</span> <span class="n">via</span> <span class="mf">172.31</span><span class="o">.</span><span class="mf">1.193</span>
<span class="n">S</span>       <span class="mf">172.31</span><span class="o">.</span><span class="mf">1.196</span><span class="o">/</span><span class="mi">30</span> <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="p">]</span> <span class="n">via</span> <span class="mf">172.31</span><span class="o">.</span><span class="mf">1.193</span>

<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip route 172.31.1.0 255.255.255.128 S0/0/0</span>
<span class="o">%</span><span class="n">Default</span> <span class="n">route</span> <span class="n">without</span> <span class="n">gateway</span><span class="p">,</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">point</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">point</span> <span class="n">interface</span><span class="p">,</span> <span class="n">may</span> <span class="n">impact</span> <span class="n">performance</span>

<span class="n">R2</span><span class="c1">#show ip route ?</span>
  <span class="n">WORD</span>       <span class="n">Network</span> <span class="n">to</span> <span class="n">display</span> <span class="n">information</span> <span class="n">about</span> <span class="ow">or</span> <span class="n">hostname</span>
  <span class="n">bgp</span>        <span class="n">Border</span> <span class="n">Gateway</span> <span class="n">Protocol</span> <span class="p">(</span><span class="n">BGP</span><span class="p">)</span>
  <span class="n">connected</span>  <span class="n">Connected</span>
  <span class="n">eigrp</span>      <span class="n">Enhanced</span> <span class="n">Interior</span> <span class="n">Routing</span> <span class="n">Protocol</span> <span class="p">(</span><span class="n">EIGRP</span><span class="p">)</span>
  <span class="n">ospf</span>       <span class="n">Open</span> <span class="n">Shortest</span> <span class="n">Path</span> <span class="n">First</span> <span class="p">(</span><span class="n">OSPF</span><span class="p">)</span>
  <span class="n">rip</span>        <span class="n">Routing</span> <span class="n">Information</span> <span class="n">Protocol</span> <span class="p">(</span><span class="n">RIP</span><span class="p">)</span>
  <span class="n">static</span>     <span class="n">Static</span> <span class="n">routes</span>
  <span class="n">summary</span>    <span class="n">Summary</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">routes</span>
  <span class="o">|</span>          <span class="n">Output</span> <span class="n">Modifiers</span>
  <span class="o">&lt;</span><span class="n">cr</span><span class="o">&gt;</span>

<span class="n">R2</span><span class="c1">#show ip route connected</span>
 <span class="n">C</span>   <span class="mf">172.31</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">24</span>  <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
 <span class="n">C</span>   <span class="mf">172.31</span><span class="o">.</span><span class="mf">1.192</span><span class="o">/</span><span class="mi">30</span>  <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
 <span class="n">C</span>   <span class="mf">172.31</span><span class="o">.</span><span class="mf">1.196</span><span class="o">/</span><span class="mi">30</span>  <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>


<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip route 0.0.0.0 0.0.0.0 Serial 0/0/1</span>
<span class="o">%</span><span class="n">Default</span> <span class="n">route</span> <span class="n">without</span> <span class="n">gateway</span><span class="p">,</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">point</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">point</span> <span class="n">interface</span><span class="p">,</span> <span class="n">may</span> <span class="n">impact</span> <span class="n">performance</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ipv6-static-routing">
<h4>ipv6 static routing<a class="headerlink" href="#ipv6-static-routing" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ipv6 unicast-routing</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># show ipv6 route</span>

<span class="n">R1</span><span class="c1">#ping ipv6 2001.DB8:ACAD:4::2</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ipv6 route 2001.DB8:ACAD:2::/64 2001.DB8:ACAD:4::2</span>

<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># show ipv6 route</span>
</pre></div>
</div>
<p>As with IPv4, before any packet is forwarded by the router, the routing table process must resolve the route to determine the exit interface to use to forward the packet. The route resolvability process will vary depending upon the type of forwarding mechanism being used by the router. CEF (Cisco Express Forwarding) is the default behavior on most platforms running IOS 12.0 or later.</p>
<p>When a packet is destined for the 2001:DB8:ACAD:3::/64 network, R1:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Looks for a match in the routing table and finds that it has to forward the packets to the next-hop IPv6 address 2001:DB8:ACAD:4::2. Every route that references only a next-hop IPv6 address and does not reference an exit interface must have the next-hop IPv6 address resolved using another route in the routing table with an exit interface.</li>
<li>R1 must now determine how to reach 2001:DB8:ACAD:4::2; therefore, it searches a second time looking for a match. In this case, the IPv6 address matches the route for the directly connected network 2001:DB8:ACAD:4::/64 with the exit interface Serial 0/0/0. This lookup tells the routing table process that this packet is forwarded out of that interface.</li>
</ol>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Therefore, it actually takes two routing table lookup processes to forward any packet to the 2001:DB8:ACAD:3::/64 network. When the router has to perform multiple lookups in the routing table before forwarding a packet, it is performing a process known as a recursive lookup.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A recursive static IPv6 route is valid (that is, it is a candidate for insertion in the routing table) only when the specified next hop resolves, either directly or indirectly, to a valid exit interface.</p>
</div>
</div>
<div class="section" id="ipv6-default-static-route">
<h4>ipv6 default static route<a class="headerlink" href="#ipv6-default-static-route" title="Permalink to this headline">¶</a></h4>
<div class="highlight-html"><div class="highlight"><pre><span></span>                            PC2
                             |
                             |_
     2001:db8:acad:2::/64   |__|
                              |
                              |
                          G0/0|:1
                             _|__
                            (_R2_)
                    S0/0/0 /2 :2\ S0/0/1
                          /       \ DCE
                         /         \/\
   2001:db8:acad:4::/64 /             \  2001:db8:acad:5::/64
                     :1/               \:1
         __           /__S0/0/0  S0/0/1_\        __
PC1-----|__|---------(_R1_) DCE      (_R3_)-----|__|----PC3
                G0/0  :1           :1 G0/0

   2001:db8:acad:1::/64             2001:db8:acad:3::/64
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ipv6 route ::/0 s0/0/0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The ‘S’ signifies that the route source is a static route. Unlike the IPv4 static route, there is no asterisk (*) or Gateway of Last Resort explicitly identified.</p>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ipv6</span> <span class="n">route</span> <span class="n">ipv6</span><span class="o">-</span><span class="n">prefix</span><span class="o">/</span><span class="n">prefix</span><span class="o">-</span><span class="n">length</span> <span class="p">{</span><span class="n">ipv6</span><span class="o">-</span><span class="n">address</span><span class="o">|</span><span class="n">interface</span><span class="o">-</span><span class="nb">type</span> <span class="n">interface</span><span class="o">-</span><span class="n">number</span><span class="p">}</span>
<span class="o">-</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ipv6 route 2001:0DB8:ACAD:1::/64 2001:0DB8:ACAD:3::1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ipv6 route 2001:0DB8:ACAD:2::/64 s0/0/0</span>
</pre></div>
</div>
<p>Router is only connected to R2 = stub router = default static route</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ipv6 route ::/0 2001:DB8:ACAD:4::2</span>
</pre></div>
</div>
</div>
<div class="section" id="verify-a-default-static-route">
<h4>verify a default static route<a class="headerlink" href="#verify-a-default-static-route" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show ipv6 route static</span>

<span class="n">R1</span><span class="c1"># ping 2001:DB8:ACAD:4::2 source 2001:DB8:ACAD:1::2</span>
</pre></div>
</div>
</div>
<div class="section" id="troubleshooting-a-missing-route">
<h4>Troubleshooting a missing route<a class="headerlink" href="#troubleshooting-a-missing-route" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ol class="arabic simple">
<li>ping</li>
<li>traceroute</li>
<li>show ip route</li>
<li>show ip interface brief</li>
<li>show cdp neighbors detail</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="solve-a-connectivity-problem">
<h4>Solve a connectivity problem<a class="headerlink" href="#solve-a-connectivity-problem" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ol class="arabic simple">
<li>ping 192.168.2.1 source g0/0</li>
<li>traceroute 192.168.2.1</li>
<li>show ip route | begin Gateway</li>
<li>show running-config | section ip route</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In a recursive static route, only the next-hop IPv6 address is specified. As a consequence, the router must perform a recursive route table lookup to find an exit interface associated with the network of the IPv6 address.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To test a floating static route, take down the main route/link in order to see whether the backup link appears in the routing table.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When a static route is to be configured via the next-hop IP address, the IP address of the interface of the next router in the path to the destination is used.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>An example of a floating static route used in conjunction with the EIGRP routing protocol would be as follows.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 192.168.10.0 255.255.255.0 95</span>
</pre></div>
</div>
<p class="last">Notice the extra number at the end of the static route. This route only appears in the routing table if the EIGRP-learned route with an administrative distance of 90 went down. That floating static route cannot appear in the routing table when a route with a better administrative distance exists.</p>
</div>
</div>
</div>
<div class="section" id="chapter-3-dynamic-routing">
<h3>Chapter 3 Dynamic Routing<a class="headerlink" href="#chapter-3-dynamic-routing" title="Permalink to this headline">¶</a></h3>
<p>Router metrics are metrics used by a router to make routing decisions. A metric is typically one of many fields in a routing table.</p>
<p>Metrics are used to determine whether one route should be chosen over another. The routing table stores possible routes, while link-state or topological databases may store all other information as well. For example, Routing Information Protocol uses hopcount (number of hops) to determine the best possible route. The route will go in the direction of the gateway with the lowest metric. The direction with the lowest metric can be a default gateway.</p>
<p>Router metrics can contain any number of values that help the router determine the best route among multiple routes to a destination. A router metric typically based on information like <strong>path length, bandwidth, load, hop count, path cost, delay, maximum transmission unit (MTU), reliability and communications cost</strong>.</p>
<div class="section" id="dynamic-routing-protocols-components">
<h4>Dynamic Routing Protocols Components<a class="headerlink" href="#dynamic-routing-protocols-components" title="Permalink to this headline">¶</a></h4>
<p>Routing protocols are used to facilitate the exchange of routing information between routers. A routing protocol is a set of processes, algorithms, and messages that are used to exchange routing information and populate the routing table with the routing protocol’s choice of best paths. The purpose of dynamic routing protocols includes:</p>
<blockquote>
<div><ul class="simple">
<li>Discovery of remote networks</li>
<li>Maintaining up-to-date routing information</li>
<li>Choosing the best path to destination networks</li>
<li>Ability to find a new best path if the current path is no longer available</li>
</ul>
</div></blockquote>
<p>The main components of dynamic routing protocols include:</p>
<blockquote>
<div><ul class="simple">
<li>Data structures - Routing protocols typically use tables or databases for its operations. This information is kept in RAM.</li>
<li>Routing protocol messages - Routing protocols use various types of messages to discover neighboring routers, exchange routing information, and other tasks to learn and maintain accurate information about the network.</li>
<li>Algorithm - An algorithm is a finite list of steps used to accomplish a task. Routing protocols use algorithms for facilitating routing information and for best path determination.</li>
</ul>
</div></blockquote>
<p>Routing protocols allow routers to dynamically share information about remote networks and automatically offer this information to their own routing tables.</p>
<p>Routing protocols determine the best path, or route, to each network. That route is then offered to the routing table. The route will be installed in the routing table is there is not another routing source with a lower administrative distance. For example, a static route with an administrative distance of 1 will have precedence over the same network learned by a dynamic routing protocol. A primary benefit of dynamic routing protocols is that routers exchange routing information when there is a topology change. This exchange allows routers to automatically learn about new networks and also to find alternate paths when there is a link failure to a current network.</p>
</div>
<div class="section" id="static-routing-uses">
<h4>Static Routing Uses<a class="headerlink" href="#static-routing-uses" title="Permalink to this headline">¶</a></h4>
<p>Static routing has several primary uses, including:</p>
<blockquote>
<div><ul class="simple">
<li>Providing ease of routing table maintenance in smaller networks that are not expected to grow significantly.</li>
<li>Routing to and from a stub network, which is a network with only one default route out and no knowledge of any remote networks.</li>
<li>Accessing a single default route (which is used to represent a path to any network that does not have a more specific match with another route in the routing table).</li>
</ul>
</div></blockquote>
<div class="section" id="pros-static">
<h5>Pros static<a class="headerlink" href="#pros-static" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ul class="simple">
<li>Predictability: route to destination is always the same.</li>
<li>Network bandwidth overhead / no extra cpu,ram resources needed: Static routing has zero overhead, whereas all dynamic routing protocols have some degree of overhead. For example, on a network with 200 segments, the router will send updates from each interface every 30 seconds, and those updates are about 3KB of data. Over the course of a day, this traffic adds up.</li>
<li>Easy to configure: This issue is relative, depending on the size of your network. Although small networks are easy to configure, as a network grows, applying changes to all the routers can become a big task.</li>
<li>Very secure, No advertisements are sent.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="cons-static">
<h5>Cons static<a class="headerlink" href="#cons-static" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ul class="simple">
<li>Lack of scalability: For the 200 segment network mentioned previously, which possibly contains 200 routers, you could be dealing with thousands of routing table entries. Manually calculating all those routes and keeping them up-to-date would be a Herculean task and very prone to error. Even if you implement a good network-addressing design that allows for route summarization, you are still left with an overwhelming number of routes to manage.</li>
<li>Large network implementation: When working with a network of 200 routers, the task of updating one route can become a complex task, especially if you update the routes in the wrong order. In that case, you could lose access to a large section of the network until someone visits that router with a rollover cable or connects from another area of the network.</li>
<li>No redundancy: Dynamic routing protocols can update routing tables in the event of device or interface failure, so if there are multiple possible paths, these protocols will continue to allow data flow. Static routes do not allow for this automatic failover or redundant paths, so if you have a failure, you must manually adjust routes to move data through an alternative path.</li>
</ul>
</div></blockquote>
<p>Dynamic routing is the best choice for large networks like the one shown.</p>
</div>
</div>
<div class="section" id="dynamic-routing-uses">
<h4>Dynamic Routing Uses<a class="headerlink" href="#dynamic-routing-uses" title="Permalink to this headline">¶</a></h4>
<div class="section" id="pros-dynamic">
<h5>Pros Dynamic<a class="headerlink" href="#pros-dynamic" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ul class="simple">
<li>Suitable in all topologies where multiple routers are required</li>
<li>Generally independent of the network size</li>
<li>Automatically addapts topology to reroute traffic if possible</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="cons-dynamic">
<h5>Cons Dynamic<a class="headerlink" href="#cons-dynamic" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ul class="simple">
<li>Can be more complex to implement</li>
<li>Less secure. Additional config settings are required to secure.</li>
<li>Route depends on the current topology.</li>
<li>Requires additional CPU, RAM, and link bandwidth.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="ripv2">
<h4>RIPv2<a class="headerlink" href="#ripv2" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="enable-disable">
<h4>enable/disable<a class="headerlink" href="#enable-disable" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span>    <span class="n">R1</span><span class="c1"># conf t</span>
    <span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router rip</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># version 2</span>
</pre></div>
</div>
<div class="section" id="verify-rip-routing">
<h5>verify rip routing<a class="headerlink" href="#verify-rip-routing" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show ip protocols</span>
<span class="n">R1</span><span class="c1"># show ip protocols | section Default</span>
<span class="n">R1</span><span class="c1"># show ip route | begin Gateway</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="disable-auto-summarization">
<h4>disable auto summarization<a class="headerlink" href="#disable-auto-summarization" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span>    <span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router rip</span>
    <span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># no auto-summary</span>
    <span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">R1</span><span class="c1"># show ip protocols | section Automatic</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>auto-summary = classful, no auto-summary = you can see /25 routes = classless, don’t confuse with summarization. If you want a summary address you can apply the following on the <strong>outgoing interface you want de summary address advertised</strong></p>
<div class="code last highlight-default"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">summary</span><span class="o">-</span><span class="n">address</span> <span class="n">rip</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.0</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">252.0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="configure-passive-interfaces">
<h4>configure passive interfaces<a class="headerlink" href="#configure-passive-interfaces" title="Permalink to this headline">¶</a></h4>
<p>By default, RIP updates are forwarded out all RIP-enabled interfaces. However, RIP updates really only need to be sent out interfaces that are connected to other RIPenabled routers.</p>
<img alt="nw/_static/img/configure_passive_ifs_on_R1.png" src="nw/_static/img/configure_passive_ifs_on_R1.png" />
<p>For instance, refer to the topology above. RIP sends updates out of its G0/0 interface even though no RIP device exists on that LAN. R1 has no way of knowing this and, as a result, sends an update every 30 seconds. Sending out unneeded updates on a LAN impacts the network in three ways:</p>
<blockquote>
<div><ul class="simple">
<li>Wasted Bandwidth - Bandwidth is used to transport unnecessary updates. Because RIP updates are either broadcasted or multicasted, switches also forward the updates out all ports.</li>
<li>Wasted Resources - All devices on the LAN must process the update up to the transport layers, at which point the devices will discard the update.</li>
<li>Security Risk - Advertising updates on a broadcast network is a security risk. RIP updates can be intercepted with packet sniffing software. Routing updates can be modified and sent back to the router, corrupting the routing table with false metrics that misdirect traffic.</li>
</ul>
</div></blockquote>
<p>Use the <strong>passive-interface</strong> router configuration command to prevent the transmission of routing updates through a router interface, <em>but still allow that network to be advertised to other routers</em>. The command stops routing updates out the specified interface. However, the network that the specified interface belongs to is still advertised in routing updates that are sent out other interfaces.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Configure</span> <span class="n">passive</span> <span class="n">interface</span> <span class="n">on</span> <span class="n">G0</span><span class="o">/</span><span class="mi">0</span> <span class="ow">and</span> <span class="k">return</span> <span class="n">to</span> <span class="n">privileged</span> <span class="n">EXEC</span> <span class="n">mode</span><span class="o">.</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router rip</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># passive-interface g0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">R2</span><span class="c1">#</span>
<span class="o">*</span><span class="n">Mar</span> <span class="mi">10</span> <span class="mi">16</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mf">32.391</span><span class="p">:</span> <span class="o">%</span><span class="n">SYS</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">CONFIG_I</span><span class="p">:</span> <span class="n">Configured</span> <span class="kn">from</span> <span class="nn">console</span> <span class="n">by</span> <span class="n">console</span>
<span class="n">Verify</span> <span class="n">the</span> <span class="n">RIP</span> <span class="n">protocol</span> <span class="n">settings</span> <span class="n">on</span> <span class="n">R2</span><span class="o">.</span>
<span class="n">R2</span><span class="c1"># show ip protocols</span>

<span class="o">***</span> <span class="n">IP</span> <span class="n">Routing</span> <span class="ow">is</span> <span class="n">NSF</span> <span class="n">aware</span> <span class="o">***</span>

<span class="n">Routing</span> <span class="n">Protocol</span> <span class="ow">is</span> <span class="s2">&quot;rip&quot;</span>
  <span class="n">Outgoing</span> <span class="n">update</span> <span class="nb">filter</span> <span class="nb">list</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">interfaces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="n">Incoming</span> <span class="n">update</span> <span class="nb">filter</span> <span class="nb">list</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">interfaces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="n">Sending</span> <span class="n">updates</span> <span class="n">every</span> <span class="mi">30</span> <span class="n">seconds</span><span class="p">,</span> <span class="nb">next</span> <span class="n">due</span> <span class="ow">in</span> <span class="mi">17</span> <span class="n">seconds</span>
  <span class="n">Invalid</span> <span class="n">after</span> <span class="mi">180</span> <span class="n">seconds</span><span class="p">,</span> <span class="n">hold</span> <span class="n">down</span> <span class="mi">180</span><span class="p">,</span> <span class="n">flushed</span> <span class="n">after</span> <span class="mi">240</span>
  <span class="n">Redistributing</span><span class="p">:</span> <span class="n">rip</span>
  <span class="n">Default</span> <span class="n">version</span> <span class="n">control</span><span class="p">:</span> <span class="n">send</span> <span class="n">version</span> <span class="mi">2</span><span class="p">,</span> <span class="n">receive</span> <span class="n">version</span> <span class="mi">2</span>
    <span class="n">Interface</span>             <span class="n">Send</span>  <span class="n">Recv</span>  <span class="n">Triggered</span> <span class="n">RIP</span>  <span class="n">Key</span><span class="o">-</span><span class="n">chain</span>
    <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>           <span class="mi">2</span>     <span class="mi">2</span>
    <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>           <span class="mi">2</span>     <span class="mi">2</span>
  <span class="n">Automatic</span> <span class="n">network</span> <span class="n">summarization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">effect</span>
  <span class="n">Maximum</span> <span class="n">path</span><span class="p">:</span> <span class="mi">4</span>
  <span class="n">Routing</span> <span class="k">for</span> <span class="n">Networks</span><span class="p">:</span>
    <span class="mf">192.168</span><span class="o">.</span><span class="mf">2.0</span>
    <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.0</span>
    <span class="mf">192.168</span><span class="o">.</span><span class="mf">4.0</span>
  <span class="n">Passive</span> <span class="n">Interface</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
  <span class="n">Routing</span> <span class="n">Information</span> <span class="n">Sources</span><span class="p">:</span>
    <span class="n">Gateway</span>         <span class="n">Distance</span>      <span class="n">Last</span> <span class="n">Update</span>
    <span class="mf">192.168</span><span class="o">.</span><span class="mf">2.1</span>          <span class="mi">120</span>      <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">24</span>
    <span class="n">Gateway</span>         <span class="n">Distance</span>      <span class="n">Last</span> <span class="n">Update</span>
    <span class="mf">192.168</span><span class="o">.</span><span class="mf">4.1</span>          <span class="mi">120</span>      <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">23</span>
  <span class="n">Distance</span><span class="p">:</span> <span class="p">(</span><span class="n">default</span> <span class="ow">is</span> <span class="mi">120</span><span class="p">)</span>
<span class="n">R2</span><span class="c1">#</span>

<span class="n">You</span> <span class="n">are</span> <span class="n">now</span> <span class="n">logged</span> <span class="n">into</span> <span class="n">R3</span><span class="o">.</span> <span class="n">Configure</span> <span class="n">passive</span> <span class="n">interface</span> <span class="n">to</span> <span class="n">be</span> <span class="n">the</span> <span class="n">default</span> <span class="n">setting</span><span class="o">.</span> <span class="n">Remove</span> <span class="n">the</span> <span class="n">passive</span> <span class="n">interface</span> <span class="n">setting</span> <span class="kn">from</span> <span class="nn">S0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span> <span class="ow">and</span> <span class="k">return</span> <span class="n">to</span> <span class="n">privileged</span> <span class="n">EXEC</span> <span class="n">mode</span><span class="o">.</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router rip</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># passive-interface default</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># no passive-interface s0/0/1</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">R3</span><span class="c1">#</span>
<span class="o">*</span><span class="n">Mar</span> <span class="mi">10</span> <span class="mi">16</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">28.899</span><span class="p">:</span> <span class="o">%</span><span class="n">SYS</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">CONFIG_I</span><span class="p">:</span> <span class="n">Configured</span> <span class="kn">from</span> <span class="nn">console</span> <span class="n">by</span> <span class="n">console</span>
<span class="n">Verify</span> <span class="n">the</span> <span class="n">RIP</span> <span class="n">protocol</span> <span class="n">settings</span> <span class="n">on</span> <span class="n">R3</span><span class="o">.</span>
<span class="n">R3</span><span class="c1"># show ip protocols</span>
<span class="o">***</span> <span class="n">IP</span> <span class="n">Routing</span> <span class="ow">is</span> <span class="n">NSF</span> <span class="n">aware</span> <span class="o">***</span>

<span class="n">Routing</span> <span class="n">Protocol</span> <span class="ow">is</span> <span class="s2">&quot;rip&quot;</span>
  <span class="n">Outgoing</span> <span class="n">update</span> <span class="nb">filter</span> <span class="nb">list</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">interfaces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="n">Incoming</span> <span class="n">update</span> <span class="nb">filter</span> <span class="nb">list</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">interfaces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="n">Sending</span> <span class="n">updates</span> <span class="n">every</span> <span class="mi">30</span> <span class="n">seconds</span><span class="p">,</span> <span class="nb">next</span> <span class="n">due</span> <span class="ow">in</span> <span class="mi">15</span> <span class="n">seconds</span>
  <span class="n">Invalid</span> <span class="n">after</span> <span class="mi">180</span> <span class="n">seconds</span><span class="p">,</span> <span class="n">hold</span> <span class="n">down</span> <span class="mi">180</span><span class="p">,</span> <span class="n">flushed</span> <span class="n">after</span> <span class="mi">240</span>
  <span class="n">Redistributing</span><span class="p">:</span> <span class="n">rip</span>
  <span class="n">Default</span> <span class="n">version</span> <span class="n">control</span><span class="p">:</span> <span class="n">send</span> <span class="n">version</span> <span class="mi">2</span><span class="p">,</span> <span class="n">receive</span> <span class="n">version</span> <span class="mi">2</span>
    <span class="n">Interface</span>             <span class="n">Send</span>  <span class="n">Recv</span>  <span class="n">Triggered</span> <span class="n">RIP</span>  <span class="n">Key</span><span class="o">-</span><span class="n">chain</span>
    <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>           <span class="mi">2</span>     <span class="mi">2</span>
  <span class="n">Automatic</span> <span class="n">network</span> <span class="n">summarization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">effect</span>
  <span class="n">Maximum</span> <span class="n">path</span><span class="p">:</span> <span class="mi">4</span>
  <span class="n">Routing</span> <span class="k">for</span> <span class="n">Networks</span><span class="p">:</span>
    <span class="mf">192.168</span><span class="o">.</span><span class="mf">4.0</span>
    <span class="mf">192.168</span><span class="o">.</span><span class="mf">5.0</span>
  <span class="n">Passive</span> <span class="n">Interface</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">Embedded</span><span class="o">-</span><span class="n">Service</span><span class="o">-</span><span class="n">Engine0</span><span class="o">/</span><span class="mi">0</span>
    <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
    <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
    <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">3</span>
    <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
    <span class="n">RG</span><span class="o">-</span><span class="n">AR</span><span class="o">-</span><span class="n">IF</span><span class="o">-</span><span class="n">INPUT1</span>
  <span class="n">Routing</span> <span class="n">Information</span> <span class="n">Sources</span><span class="p">:</span>
    <span class="n">Gateway</span>         <span class="n">Distance</span>      <span class="n">Last</span> <span class="n">Update</span>
    <span class="mf">192.168</span><span class="o">.</span><span class="mf">4.2</span>          <span class="mi">120</span>      <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">23</span>
  <span class="n">Distance</span><span class="p">:</span> <span class="p">(</span><span class="n">default</span> <span class="ow">is</span> <span class="mi">120</span><span class="p">)</span>
<span class="n">R3</span><span class="c1">#</span>
</pre></div>
</div>
<p>There is no need for R1, R2, and R3 to forward RIP updates out of their LAN interfaces. The configuration in Figure 2 identifies the R1 G0/0 interface as passive. <em>The show ip protocols command is then used to verify that the Gigabit Ethernet interface was passive.</em>
.. note:: Notice that the G0/0 interface is no longer listed as sending or receiving version 2 updates, but instead is now listed under the Passive Interface(s) section. Also notice that the network 192.168.1.0 is still listed under Routing for Networks, which means that this network is still included as a route entry in RIP updates that are sent to R2.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All routing protocols support the passive-interface command.</p>
</div>
<p>configure the LAN interface as a passive interface on R2 and R3.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router rip</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># passive-interface g0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># end</span>

<span class="n">Verify</span> <span class="n">the</span> <span class="n">RIP</span> <span class="n">protocol</span> <span class="n">settings</span> <span class="n">on</span> <span class="n">R2</span>
<span class="n">R2</span><span class="c1"># show ip protocols</span>

<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router rip</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># passive-interface default</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># no passive-interface s0/0/1</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># end</span>

<span class="n">Verify</span> <span class="n">the</span> <span class="n">RIP</span> <span class="n">protocol</span> <span class="n">settings</span> <span class="n">on</span> <span class="n">R3</span>
<span class="n">R3</span><span class="c1"># show ip protocols</span>
</pre></div>
</div>
<p>As an alternative, all interfaces can be made passive using the passive-interface default command. Interfaces that should not be passive can be re-enabled using the no passive-interface command.</p>
</div>
<div class="section" id="propagate-a-default-route">
<h4>propagate a default route<a class="headerlink" href="#propagate-a-default-route" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/propagate_default_route.png" src="nw/_static/img/propagate_default_route.png" />
<p>To propagate a default route in RIP, the edge router must be configured with:</p>
<blockquote>
<div><ul class="simple">
<li>A default static route using the ip route 0.0.0.0 0.0.0.0 command.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>The <strong>default-information originate</strong> router configuration command. This instructs R1 to originate default information, by propagating the static default route in RIP updates.</li>
</ul>
</div></blockquote>
</div></blockquote>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 0.0.0.0 0.0.0.0 s0/0/1 209.165.200.226</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router rip</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># default-information originate</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># end</span>
</pre></div>
</div>
<p>Example above configures a fully-specified default static route to the service provider and then the route is propagated by RIP. Notice that R1 now has a Gateway of Last Resort and default route installed in its routing table.</p>
</div>
<div class="section" id="exercise-example">
<h4>exercise example<a class="headerlink" href="#exercise-example" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="code highlight-default"><div class="highlight"><pre><span></span>a router that is connected to an isp
------------------------------------
hostname R1
!
ip cef
no ipv6 cef
!
interface GigabitEthernet0/0
 ip address 192.168.1.1 255.255.255.0
 duplex auto
 speed auto
!
interface GigabitEthernet0/1
 no ip address
 duplex auto
 speed auto
 shutdown
!
interface GigabitEthernet0/2
 no ip address
 duplex auto
 speed auto
 shutdown
!
interface Serial0/0/0
 ip address 192.168.2.1 255.255.255.0
 clock rate 2000000
!
interface Serial0/0/0
 ip address 192.168.2.1 255.255.255.0
 clock rate 2000000
!
interface Serial0/0/1
 ip address 209.165.200.225 255.255.255.252
!
interface Vlan1
 no ip address
 shutdown
!
router rip
 version 2
 passive-interface GigabitEthernet0/0
 network 192.168.1.0
 network 192.168.2.0
 default-information originate
!
ip classless
ip route 0.0.0.0 0.0.0.0 Serial0/0/1
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="remote-networks-in-routing-table">
<h4>Remote Networks in Routing table<a class="headerlink" href="#remote-networks-in-routing-table" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/RemoteNetworkEntries.png" src="nw/_static/img/RemoteNetworkEntries.png" />
<ul class="simple">
<li>Route Source: ids how route was learned</li>
<li>Dest Network: ids address of the remote network</li>
<li>Administrative Distance: ids <em>trustworthiness</em> of route source</li>
<li>Metric: ids value assigned to reach remote NW. Lower is better</li>
<li>Next hop: ids ipv4 address of next router to forward packet to</li>
<li>route timestamp: ids from when the route was last heard</li>
<li>Outgoing interface: ids exit interface to use to forward packet to final destination</li>
</ul>
<img alt="nw/_static/img/RemoteNetworkEntriesExercise.png" src="nw/_static/img/RemoteNetworkEntriesExercise.png" />
</div>
<div class="section" id="routing-table-terms">
<h4>Routing table terms<a class="headerlink" href="#routing-table-terms" title="Permalink to this headline">¶</a></h4>
<ul>
<li><dl class="first docutils">
<dt>Ultimate route:</dt>
<dd><p class="first last">has next-hop ip and/or exit interface</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Level 1 route:</dt>
<dd><dl class="first last docutils">
<dt>a route with a subnet mask <em>equal or less than classful mask</em> of the network address</dt>
<dd><ul class="first last">
<li><p class="first">Network route - <em>equal</em> to that of classful mask</p>
</li>
<li><p class="first">Supernet route - <em>less</em> than classful mask, eg summary address</p>
</li>
<li><p class="first">Default route - static route with the address 0.0.0.0/0</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">source of Level 1 route = D.C. network, static, or dynamic routing protocol</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">level 1 route are also ultimate routes</p>
</div>
</li>
</ul>
</dd>
</dl>
</dd>
</dl>
</li>
<li><p class="first">Level 1 parent route: Level 1 network route (=mask) that is subnetted:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">L1 parent route = never an ultimate route e.g. 172.16.0.0/16 #of subnets, #different masks</p>
</div>
</li>
<li><p class="first">Level 2 child routes aka <strong>subnet</strong> route: subnet of a <em>classful network address</em>:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">L1 parent route contains L2 child routes</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">no L1 parent = it ain’t no L2 child</p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="58%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td rowspan="4">172.16.0.0</td>
<td>172.16.1.0/24</td>
</tr>
<tr class="row-even"><td>172.16.2.0/24</td>
</tr>
<tr class="row-odd"><td>172.16.3.0/24</td>
</tr>
<tr class="row-even"><td>172.16.4.0/28</td>
</tr>
<tr class="row-odd"><td rowspan="3">209.165.200.0</td>
<td>209.165.200.224/30</td>
</tr>
<tr class="row-even"><td>209.165.200.228/30</td>
</tr>
<tr class="row-odd"><td>209.165.200.232/30</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
<div class="section" id="route-lookup-process">
<h4>Route lookup process<a class="headerlink" href="#route-lookup-process" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>if a level 1 ultimate route (exit|nhop) = forward</li>
<li>if lvl 1 parent route (equal to snmask &amp; never and no exit|nhop) then<ul>
<li>check if match with level 2 child (subnet) route (=bigger than nwmask)</li>
</ul>
</li>
<li>continue searching lvl 1 supernet routes (=less than nwmask) for match including default route if there is one</li>
<li>sorry no match, drop it like it’s hot</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A route referencing only a next-hop IP address and not an exit interface, must be resolved to a route with an exit interface, if Cisco Express Forwarding (CEF) is not being used. Without CEF, a recursive lookup is performed on the next-hop IP address until the route is resolved to an exit interface. CEF is enabled by default.</p>
</div>
</div>
<div class="section" id="ipv6-routing-table-entries">
<h4>IPv6 Routing Table Entries<a class="headerlink" href="#ipv6-routing-table-entries" title="Permalink to this headline">¶</a></h4>
<p>reference topology</p>
<img alt="nw/_static/img/ipv6_routingtable_entries.png" src="nw/_static/img/ipv6_routingtable_entries.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Because IPv6 is classless by design, all routes are effectively <strong>L1 ultimate routes</strong>. There is no L1 parent or L2 child routes</p>
</div>
<p>R1,2,3 in full mesh topology. All routers have redundant paths to various networks.
R2 is the edge router to the ISP, however a default static route is not being advertised
EIGRP is cfgd on all of them</p>
<p>Directly connected routes on R1 = show ipv6 route –&gt; C and L</p>
<img alt="nw/_static/img/routingtable_ipv6.png" src="nw/_static/img/routingtable_ipv6.png" />
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">RIP configuration on a router should contain network statements for connected networks only. Remote networks are learned from routing updates from other routers.</p>
</div>
</div>
<div class="section" id="qna-chapter-3">
<h4>QnA Chapter 3<a class="headerlink" href="#qna-chapter-3" title="Permalink to this headline">¶</a></h4>
<p>What is a purpose of the network command when configuring RIPv2 as the routing protocol?</p>
<p>V  It identifies the interfaces that belong to a specified network.</p>
<p>X  It specifies the remote network that can now be reached.</p>
<blockquote>
<div><p>It immediately advertises the specified network to neighbor routers with a classful mask.</p>
<p>It populates the routing table with the network entry.</p>
</div></blockquote>
<p>The network command is used to advertise the directly connected networks of a router. It enables RIP on the interfaces that belong to the specified network.</p>
<p>The command being entered by the engineer will cause RIPv2 to activate on the interface for the 192.168.10.0 network. <strong>If RIPv1 is configured, the router will send only version 1 updates, but will listen for both version 1 and version 2 updates. If RIPv2 is configured, the router will send and listen to only version 2 updates.</strong></p>
</div>
</div>
<div class="section" id="chapter-4-switched-networks">
<h3>Chapter 4 switched networks<a class="headerlink" href="#chapter-4-switched-networks" title="Permalink to this headline">¶</a></h3>
<p>examination of the flow of traffic in a modern network. It examines some of the current network design models and the way LAN switches build forwarding tables and use the MAC address information to efficiently switch data between hosts.</p>
<div class="section" id="elements-of-a-converged-network">
<h4>elements of a converged network<a class="headerlink" href="#elements-of-a-converged-network" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Call control - Telephone call processing, caller ID, call transfer, hold, and conference</li>
<li>Voice messaging - Voicemail</li>
<li>Mobility - Receive important calls wherever you are</li>
<li>Automated attendant - Serve customers faster by routing calls directly to the right department or individual</li>
</ul>
</div>
<div class="section" id="hierarchy-in-the-borderless-switched-network">
<h4>Hierarchy in the Borderless Switched Network<a class="headerlink" href="#hierarchy-in-the-borderless-switched-network" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Hierarchical - Facilitates understanding the role of each device at every tier, simplifies deployment, operation, and management, and reduces fault domains at every tier</li>
<li>Modularity - Allows seamless network expansion and integrated service enablement on an on-demand basis</li>
<li>Resiliency - Satisfies user expectations for keeping the network always on</li>
<li>Flexibility - Allows intelligent traffic load sharing by using all network resources</li>
</ul>
<p>The three critical layers within these tiered designs are the <strong>access, distribution, and core layers</strong>.</p>
<img alt="nw/_static/img/accesslayer.png" src="nw/_static/img/accesslayer.png" />
<p>Access, Distribution, and Core Layers</p>
</div>
<div class="section" id="access-layer">
<h4>Access Layer<a class="headerlink" href="#access-layer" title="Permalink to this headline">¶</a></h4>
<p>The access layer represents the network edge, where traffic enters or exits the campus network. Traditionally, the primary function of an access layer switch is to provide network access to the user. Access layer switches connect to distribution layer switches, which implement network foundation technologies such as routing, quality of service, and security.</p>
<p>To meet network application and end-user demand, the next-generation switching platforms now provide more converged, integrated, and intelligent services to various types of endpoints at the network edge. Building intelligence into access layer switches allows applications to operate on the network more efficiently and securely.</p>
</div>
<div class="section" id="distribution-layer">
<h4>Distribution Layer<a class="headerlink" href="#distribution-layer" title="Permalink to this headline">¶</a></h4>
<p>The distribution layer interfaces between the access layer and the core layer to provide many important functions, including:</p>
<blockquote>
<div><ul class="simple">
<li>Aggregating large-scale wiring closet networks</li>
<li>Aggregating Layer 2 broadcast domains and Layer 3 routing boundaries</li>
<li>Providing intelligent switching, routing, and network access policy functions to access the rest of the network</li>
<li>Providing high availability through redundant distribution layer switches to the end-user and equal cost paths to the core</li>
<li>Providing differentiated services to various classes of service applications at the edge of the network</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="core-layer">
<h4>Core Layer<a class="headerlink" href="#core-layer" title="Permalink to this headline">¶</a></h4>
<p>The core layer is the network backbone. It connects several layers of the campus network. The core layer serves as the aggregator for all of the other campus blocks and ties the campus together with the rest of the network. The primary purpose of the core layer is to provide fault isolation and high-speed backbone connectivity.</p>
<p>Figure 1 shows a three-tier campus network design for organizations where the access, distribution, and core are each separate layers. To build a simplified, scalable, cost-effective, and efficient physical cable layout design, the recommendation is to build an extended-star physical network topology from a centralized building location to all other buildings on the same campus.</p>
<img alt="nw/_static/img/corelayer1.png" src="nw/_static/img/corelayer1.png" />
<p>In some cases where extensive physical or network scalability does not exist, maintaining separate distribution and core layers is not required. In smaller campus locations where there are fewer users accessing the network or in campus sites consisting of a single building, separate core and distribution layers may not be needed. In this scenario, the recommendation is the alternate two-tier campus network design, also known as the collapsed core network design.</p>
<p>Figure 2 shows a two-tier campus network design example for an enterprise campus where the distribution and core layers are collapsed into a single layer.
.. image:: _static/img/corelayercollapsed.png</p>
<p>Borderless switched networks</p>
<img alt="nw/_static/img/borderlessswitchednetworks.png" src="nw/_static/img/borderlessswitchednetworks.png" />
</div>
<div class="section" id="considerations-switch">
<h4>considerations switch<a class="headerlink" href="#considerations-switch" title="Permalink to this headline">¶</a></h4>
<p>Fixed - Modular - Stackable</p>
<ul class="simple">
<li>Cost: The cost of a switch will depend on the number and speed of the interfaces, supported features, and expansion capability.</li>
<li>Port Density: Network switches must support the appropriate number of devices on the network.</li>
<li>Power: It is now common to power access points, IP phones, and even compact switches using Power over Ethernet (PoE). In addition to PoE considerations, some chassis-based switches support redundant power supplies.</li>
<li>Reliability: The switch should provide continuous access to the network.</li>
<li>Port Speed: The speed of the network connection is of primary concern to end users.</li>
<li>Frame Buffers: The ability of the switch to store frames is important in a network where there might be congested ports to servers or other areas of the network.</li>
<li>Scalability: The number of users on a network typically grows over time; therefore, the switch should provide the opportunity for growth.</li>
</ul>
</div>
<div class="section" id="store-n-forward-switching">
<h4>store n forward switching<a class="headerlink" href="#store-n-forward-switching" title="Permalink to this headline">¶</a></h4>
<p>Store-and-forward switching has two primary characteristics that distinguish it from cut-through: error checking and automatic buffering.</p>
<p>A store-and-forward switch drops frames that do not pass the FCS check; therefore, it does not forward invalid frames. By contrast, a cut-through switch may forward invalid frames because no FCS check is performed.</p>
</div>
<div class="section" id="cut-through-switching">
<h4>Cut-Through Switching<a class="headerlink" href="#cut-through-switching" title="Permalink to this headline">¶</a></h4>
<p>start forwarding a frame earlier than store-and-forward switching. There are two primary characteristics of cut-through switching: rapid frame forwarding and fragment free.</p>
<div class="section" id="rapid-frame-forwarding">
<h5>Rapid Frame Forwarding<a class="headerlink" href="#rapid-frame-forwarding" title="Permalink to this headline">¶</a></h5>
<p>With today’s MAC controllers and ASICs, a switch using the cut-through method can quickly decide whether it needs to examine a larger portion of a frame’s headers for additional filtering purposes. For example, the switch can analyze past the first 14 bytes (the source MAC address, destination MAC, and the EtherType fields), and examine an additional 40 bytes in order to perform more sophisticated functions relative to IPv4 Layers 3 and 4.</p>
</div>
<div class="section" id="fragment-free-forwarding">
<h5>Fragment Free Forwarding<a class="headerlink" href="#fragment-free-forwarding" title="Permalink to this headline">¶</a></h5>
<p>Fragment free switching is a modified form of cut-through switching in which the switch waits for the collision window (64 bytes) to pass before forwarding the frame. This means each frame will be checked into the data field to make sure no fragmentation has occurred. Fragment free switching provides better error checking than cut-through, with practically no increase in latency.</p>
</div>
</div>
<div class="section" id="collision-domains">
<h4>Collision domains<a class="headerlink" href="#collision-domains" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/collisiondomains.png" src="nw/_static/img/collisiondomains.png" />
<img alt="nw/_static/img/collisiondomains2.png" src="nw/_static/img/collisiondomains2.png" />
</div>
<div class="section" id="qna-ch4">
<h4>QnA Ch4<a class="headerlink" href="#qna-ch4" title="Permalink to this headline">¶</a></h4>
<p>Which service is provided by an automated attendant feature on a converged network?
* Call routing</p>
<ul class="simple">
<li>The automated attendant feature increases the speed of voice services by routing calls directly to individuals or departments. Point-to-point video and video conferencing describe video services on a converged network. An IT management interface is part of a converged network solution that allows IT personnel to facilitate moves, adds, and changes through a centralized application.</li>
</ul>
<p>Stackable switches provide fault tolerance and bandwidth availability by using special cables between switches and are less costly to implement than modular switches.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">What is a basic function of the Cisco Borderless Architecture distribution layer? Aggregating Layer 3 routing boundaries</p>
</div>
<p>Match the borderless switched network guideline description to the principle.</p>
<img alt="nw/_static/img/borderlessswitchednetworks_matchup.png" src="nw/_static/img/borderlessswitchednetworks_matchup.png" />
<p>Place the options in the following order:</p>
<dl class="docutils">
<dt>flexibility:</dt>
<dd>allows intelligent traffic load sharing by using all network resources</dd>
<dt>hierarchical:</dt>
<dd>facilitates understanding the role of each device at every tier, simplifies deployment, operation, management, and reduces fault domains at every tier</dd>
<dt>modularity:</dt>
<dd>allows seamless network expansion and integrated service enablement on an on-demand basis</dd>
<dt>resiliency:</dt>
<dd>satisfies user expectations for keeping the network always on</dd>
</dl>
</div>
</div>
<div class="section" id="chapter-5-switch-configuration">
<h3>Chapter 5 Switch Configuration<a class="headerlink" href="#chapter-5-switch-configuration" title="Permalink to this headline">¶</a></h3>
<div class="section" id="configure-boot-environment-variable">
<h4>Configure BOOT Environment variable<a class="headerlink" href="#configure-boot-environment-variable" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># boot system flash:/c2960-lanbasek9-mz.150-2.SE/c2960-lanbasek9-mz.150-2.SE.bin</span>
             <span class="n">command</span>     <span class="n">storage</span>   <span class="n">path</span> <span class="n">to</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">fs</span>     <span class="n">IOS</span> <span class="n">filename</span>

<span class="n">S1</span><span class="c1"># show boot</span>
</pre></div>
</div>
</div>
<div class="section" id="switch-boot-sequence">
<h4>Switch boot sequence<a class="headerlink" href="#switch-boot-sequence" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>loads POST from ROM. Checks CPU subsystem. Tests CPU, DRAM &amp; portion of flash device</li>
<li>loads BOOT LOADER software from ROM, runs immediately after POST</li>
<li>BOOT LOADER performs low-level CPU initialization. Initializes CPU registers that control where physical memory is mapped, quantity of memory and its speed</li>
<li>BOOT LOADER initializes flash file system on the system board</li>
<li>BOOT LOADER locates &amp; loads a default IOS image into memory</li>
</ol>
<p>BOOT environment variable. If this variable is not set, the switch attempts to load and execute the first executable file it can by performing a recursive, depth-first search throughout the flash file system</p>
</div>
<div class="section" id="recover-from-system-crash">
<h4>Recover from System Crash<a class="headerlink" href="#recover-from-system-crash" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>connect by console cable, configure terminal emulation software</li>
<li>unplug power cord</li>
<li>reconnect power and hold down MODE button while system LED is flashing green</li>
<li>Continue pressing MODE button while LED turns briefly amber and then solid green. Now release the button</li>
<li>boot loader <strong>switch:</strong> prompt appears</li>
</ol>
<p>switch: dir flash:</p>
<div class="section" id="catalyst-2960-switch-leds">
<h5>Catalyst 2960 switch LEDs<a class="headerlink" href="#catalyst-2960-switch-leds" title="Permalink to this headline">¶</a></h5>
<img alt="nw/_static/img/c2960leds.png" src="nw/_static/img/c2960leds.png" />
<ol class="arabic simple">
<li>System LED: system has power and is functioning properly. If Amber = power but not working properly</li>
<li>RPS LED: blinking = connected but providing power to another device. Amber = standby mode Blinking Amber = providing power due to main PSU failed</li>
<li>Port Status LED (default mode): alternating green-amber = link fault. Amber/blinking Amber = no forwarding/port blocked to prevent loop</li>
<li>Port Duplex mode LED: green = full duplex</li>
<li>Port Speed LED: off = 10Mb/s green=100Mb/s blinking green=1000Mb/s</li>
<li>PoE Mode LED: Amber = 1or+ denied power BlinkingAmber = off due to fault| PoE fault Green= PoE on Alterating Green-Amber = no power to not exceed switch power capacity</li>
<li>Mode button</li>
<li>port LEDs</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, the switch is configured to have the management of the switch controlled through VLAN 1. All ports are assigned to VLAN 1 by default. For security purposes, it is considered a best practice to use a VLAN other than VLAN 1 for the management VLAN.</p>
</div>
</div>
</div>
<div class="section" id="configure-sw-management-ipv4">
<h4>Configure Sw management ipv4<a class="headerlink" href="#configure-sw-management-ipv4" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># configure terminal</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface vlan 99</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 172.17.99.11 255.255.255.0</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no shutdown</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">S1</span><span class="c1"># copy running-config startup-config</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Notice that the VLAN 99 interface is in the down state even though you entered the no shutdown command. The interface is currently down because no switch ports are assigned to VLAN 99.</p>
</div>
<div class="section" id="assign-all-user-ports-to-vlan">
<h5>Assign all user ports to vlan<a class="headerlink" href="#assign-all-user-ports-to-vlan" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span>S1(config)#
interface range f0/1 – 24,g0/1 - 2
S1(config-if-range)# switchport access vlan 99
S1(config-if-range)#exit
S1(config)#
%LINEPROTO-5-UPDOWN: Line protocol on Interface Vlan1, changed state to down
%LINEPROTO-5-UPDOWN: Line protocol on Interface Vlan99, changed state to up

S1# configure terminal
S1(config)# ip default-gateway 172.17.99.1
S1(config)# end
S1# copy run start
</pre></div>
</div>
</div>
<div class="section" id="configure-apply-vlan-99">
<h5>configure &amp; apply vlan 99<a class="headerlink" href="#configure-apply-vlan-99" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># vlan 99</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># name vlan_name</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface interface_id</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport access vlan 99</span>
</pre></div>
</div>
</div>
<div class="section" id="troubleshooting">
<h5>troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># show interface vlan99</span>
<span class="n">S1</span><span class="c1"># show ip interface vlan99</span>
<span class="n">S1</span><span class="c1"># show vlan brief</span>
<span class="n">S1</span><span class="c1"># show mac address-table</span>
<span class="n">S1</span><span class="c1"># show mac address-table dynamic</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-template-for-less-hassle">
<h5>basic template for less hassle<a class="headerlink" href="#basic-template-for-less-hassle" title="Permalink to this headline">¶</a></h5>
<p>from global conf mode past:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">no</span> <span class="n">ip</span> <span class="n">domain</span><span class="o">-</span><span class="n">lookup</span>
<span class="n">hostname</span> <span class="n">S1</span>
<span class="n">service</span> <span class="n">password</span><span class="o">-</span><span class="n">encryption</span>
<span class="n">enable</span> <span class="n">secret</span> <span class="k">class</span>
<span class="nc">banner</span> <span class="n">motd</span> <span class="c1">#</span>
<span class="n">Unauthorized</span> <span class="n">access</span> <span class="ow">is</span> <span class="n">strictly</span> <span class="n">prohibited</span><span class="o">.</span> <span class="c1">#</span>
<span class="n">Line</span> <span class="n">con</span> <span class="mi">0</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
<span class="n">logging</span> <span class="n">synchronous</span>
<span class="n">line</span> <span class="n">vty</span> <span class="mi">0</span> <span class="mi">15</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
<span class="n">exit</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="setup-a-static-mac-address">
<h4>Setup a static MAC address<a class="headerlink" href="#setup-a-static-mac-address" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># clear mac address-table dynamic</span>
<span class="n">S1</span><span class="c1"># show mac address-table</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># mac address-table static 0050.56BE.6C89 vlan 99 interface fastethernet 0/6</span>
<span class="n">S1</span><span class="c1"># show mac address-table</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no mac address-table static 0050.56BE.6C89 vlan 99 interface fastethernet 0/6</span>
</pre></div>
</div>
</div>
<div class="section" id="duplex-communication">
<h4>Duplex communication<a class="headerlink" href="#duplex-communication" title="Permalink to this headline">¶</a></h4>
<p>When a switch port is operating in full-duplex mode, there is no collision domain associated with the port.</p>
<p>Gigabit Ethernet and 10Gb NICs require full-duplex connections to operate. In full-duplex mode, the collision detection circuit on the NIC is disabled. Frames that are sent by the two connected devices cannot collide because the devices use two separate circuits in the network cable. Full-duplex connections require a switch that supports full-duplex configuration, or a direct connection using an Ethernet cable between two devices.</p>
<p>Standard, shared hub-based Ethernet configuration efficiency is typically rated at 50 to 60 percent of the stated bandwidth. Full-duplex offers 100 percent efficiency in both directions (transmitting and receiving). This results in a 200 percent potential use of the stated bandwidth.</p>
</div>
<div class="section" id="speed-auto-mdix">
<h4>Speed/auto-MDIX<a class="headerlink" href="#speed-auto-mdix" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># configure terminal</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface fastethernet 0/1</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># duplex auto</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># speed auto</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># mdix auto</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">S1</span><span class="c1"># copy run start</span>

<span class="n">show</span> <span class="n">controllers</span> <span class="n">ethernet</span><span class="o">-</span><span class="n">controller</span> <span class="n">fa</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span> <span class="n">phy</span> <span class="o">|</span> <span class="n">include</span> <span class="n">Auto</span><span class="o">-</span><span class="n">MDIX</span>
</pre></div>
</div>
<p>check with show interfaces interface id</p>
</div>
<div class="section" id="verify-interface-status">
<h4>Verify interface status<a class="headerlink" href="#verify-interface-status" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/interface_errors.png" src="nw/_static/img/interface_errors.png" />
<img alt="nw/_static/img/interface_error_types.png" src="nw/_static/img/interface_error_types.png" />
<p>“Input errors” is the sum of all errors in datagrams that were received on the interface being examined. This includes runts, giants, CRC, no buffer, frame, overrun, and ignored counts.</p>
<p>“Output errors” is the sum of all errors that prevented the final transmission of datagrams out the interface that is being examined.</p>
</div>
<div class="section" id="ssh-switch-setup">
<h4>SSH Switch Setup<a class="headerlink" href="#ssh-switch-setup" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># config t</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># hostname myswitch</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip domain-name thegeekstuff.com</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># crypto key generate rsa</span>

<span class="n">S1</span><span class="c1"># line vty 0 4</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">line</span><span class="p">)</span><span class="c1"># transport input ssh</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">line</span><span class="p">)</span><span class="c1"># login local</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">line</span><span class="p">)</span><span class="c1"># password 7</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">line</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">S1</span><span class="c1"># line console 0</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">line</span><span class="p">)</span><span class="c1"># logging synchronous</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">line</span><span class="p">)</span><span class="c1"># login local</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">line</span><span class="p">)</span><span class="c1"># exit</span>

<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip ssh version 2</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># username god secret h3ll0n34rth</span>
<span class="n">S1</span><span class="c1"># enable secret class</span>
<span class="n">S1</span><span class="c1"># service password-encryption</span>
<span class="n">S1</span><span class="c1"># show ip ssh</span>
</pre></div>
</div>
</div>
<div class="section" id="disable-unused-ports">
<h4>Disable unused ports<a class="headerlink" href="#disable-unused-ports" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># show run</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface range fastethernet0/1 - 4, fastethernet0/10 - 15</span>
</pre></div>
</div>
</div>
<div class="section" id="port-security">
<h4>Port Security<a class="headerlink" href="#port-security" title="Permalink to this headline">¶</a></h4>
<div class="section" id="secure-mac-address-types">
<h5>Secure MAC Address Types<a class="headerlink" href="#secure-mac-address-types" title="Permalink to this headline">¶</a></h5>
<p>There are a number of ways to configure port security. The type of secure address is based on the configuration and includes:</p>
<blockquote>
<div><ul class="simple">
<li>Static secure MAC addresses - MAC addresses that are manually configured on a port by using the switchport port-security mac-address mac-address interface configuration mode command. MAC addresses configured in this way are stored in the address table and are added to the running configuration on the switch.</li>
<li>Dynamic secure MAC addresses - MAC addresses that are dynamically learned and stored only in the address table. MAC addresses configured in this way are removed when the switch restarts.</li>
<li>Sticky secure MAC addresses - MAC addresses that can be dynamically learned or manually configured, then stored in the address table and added to the running configuration.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="sticky-secure-mac-addresses">
<h5>Sticky Secure MAC addresses<a class="headerlink" href="#sticky-secure-mac-addresses" title="Permalink to this headline">¶</a></h5>
<p>To configure an interface to convert dynamically learned MAC addresses to sticky secure MAC addresses and add them to the running configuration, you must enable sticky learning.</p>
<p>Sticky learning is enabled on an interface by using the <code class="docutils literal"><span class="pre">switchport</span> <span class="pre">port-security</span> <span class="pre">mac-address</span> <span class="pre">sticky</span> <span class="pre">interface</span> <span class="pre">configuration</span> <span class="pre">mode</span> <span class="pre">command</span></code>.
When this command is entered, the switch converts all dynamically learned MAC addresses, including those that were dynamically learned before sticky learning was enabled, into sticky secure MAC addresses. All sticky secure MAC addresses are added to the address table and to the running configuration.</p>
<p>Sticky secure MAC addresses can also be manually defined. When sticky secure MAC addresses are configured by using the <code class="docutils literal"><span class="pre">switchport</span> <span class="pre">port-security</span> <span class="pre">mac-address</span> <span class="pre">sticky</span> <span class="pre">mac-address</span></code> interface configuration mode command, all specified addresses are added to the address table and the running configuration.
If the sticky secure MAC addresses are saved to the startup configuration file, then when the switch restarts or the interface shuts down, the interface does not need to relearn the addresses. If the sticky secure addresses are not saved, they will be lost.</p>
<p>If sticky learning is disabled by using the <code class="docutils literal"><span class="pre">no</span> <span class="pre">switchport</span> <span class="pre">port-security</span> <span class="pre">mac-address</span> <span class="pre">sticky</span></code> interface configuration mode command, the sticky secure MAC addresses remain part of the address table, but are removed from the running configuration.</p>
<p>Characteristics of sticky secure MAC addresses.</p>
<img alt="nw/_static/img/sticky_secure.png" src="nw/_static/img/sticky_secure.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The port security feature will not work until port security is enabled on the interface using the switchport port-security command.</p>
</div>
</div>
<div class="section" id="security-violation-modes">
<h5>Security Violation Modes<a class="headerlink" href="#security-violation-modes" title="Permalink to this headline">¶</a></h5>
<p>Security Violation Modes include: <strong>Protect Restrict Shutdown</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="21%" />
<col width="14%" />
<col width="13%" />
<col width="16%" />
<col width="17%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Violation Mode</td>
<td>Forwards Traffic</td>
<td>Syslog msg</td>
<td>Error msg</td>
<td>up violation</td>
<td>Shutdown port</td>
</tr>
<tr class="row-even"><td>Protect</td>
<td>NO</td>
<td>NO</td>
<td>NO</td>
<td>NO</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>Restrict</td>
<td>NO</td>
<td>YES</td>
<td>NO</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-even"><td>Shutdown</td>
<td>NO</td>
<td>NO</td>
<td>NO</td>
<td>YES</td>
<td>YES</td>
</tr>
</tbody>
</table>
<p>Security violations occur in these situations:</p>
<ul class="simple">
<li>A pc with MAC address not in address table attempts to access the interface when the table is full</li>
<li>An address is being used on two secure interfaces in the same VLAN</li>
</ul>
<dl class="docutils">
<dt>Protect:</dt>
<dd>When # of secure MACs reaches limit allowed on port, packets with unknown source addresses are dropped until enough secure MACs are removed  or the # of maximum allowable addresses is increased. There is no notification</dd>
<dt>Restrict:</dt>
<dd>same as protect but there is a notification that a security violation has occurred.Syslog msg + violation count up</dd>
<dt>Shutdown (default):</dt>
<dd>a violation causes IF to become error-disabled and turns off port LED. violation count up + shutdown port</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All 3 no longer forward traffic and don’t display an error message. Restrict is only one with syslog msg, up violation = restrict &amp; shutdown</p>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">mac</span> <span class="n">address</span>
<span class="n">switchport</span> <span class="n">port</span><span class="o">-</span><span class="n">security</span> <span class="n">mac</span><span class="o">-</span><span class="n">address</span> <span class="n">mac</span><span class="o">-</span><span class="n">address</span>
<span class="n">dynamic</span> <span class="n">adds</span> <span class="n">only</span> <span class="n">to</span> <span class="n">table</span> <span class="n">n</span> <span class="n">removed</span> <span class="n">at</span> <span class="n">shutdown</span>
<span class="n">switchport</span> <span class="n">port</span><span class="o">-</span><span class="n">security</span> <span class="n">mac</span><span class="o">-</span><span class="n">address</span> <span class="n">dynamic</span>
<span class="n">switchport</span> <span class="n">port</span><span class="o">-</span><span class="n">security</span> <span class="n">mac</span><span class="o">-</span><span class="n">address</span> <span class="p">{</span><span class="n">sticky</span>
<span class="n">switchport</span> <span class="n">port</span><span class="o">-</span><span class="n">security</span> <span class="n">violation</span> <span class="p">{</span><span class="n">protect</span> <span class="o">|</span> <span class="n">restrict</span> <span class="o">|</span> <span class="n">shutdown</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-port-security-on-if">
<h5>Configuring port security on IF<a class="headerlink" href="#configuring-port-security-on-if" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface fastethernet 0/18</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport mode access</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport switchport port-security</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport switchport port-security maximum 10</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport switchport port-security mac-address sticky</span>

<span class="n">S1</span><span class="c1"># show port-security interface fastethernet 0/18</span>
<span class="n">S1</span><span class="c1"># show run | begin FastEthernet 0/18</span>
<span class="n">S1</span><span class="c1"># show port-security address</span>
</pre></div>
</div>
<p>This example shows how to enable port security on Fast Ethernet port 12 and how to set the maximum number of secure addresses to 5. The violation mode is the default, and no secure MAC addresses are configured.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Switch</span><span class="c1"># configure terminal</span>
<span class="n">Enter</span> <span class="n">configuration</span> <span class="n">commands</span><span class="p">,</span> <span class="n">one</span> <span class="n">per</span> <span class="n">line</span><span class="o">.</span>  <span class="n">End</span> <span class="k">with</span> <span class="n">CNTL</span><span class="o">/</span><span class="n">Z</span><span class="o">.</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface fastethernet 3/12</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport mode access</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport port-security</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport port-security maximum 5</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport port-security mac-address sticky</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">Switch</span><span class="c1"># show port-security interface fastethernet 3/12</span>
<span class="n">Port</span> <span class="n">Security</span>              <span class="p">:</span><span class="n">Enabled</span>
<span class="n">Port</span> <span class="n">Status</span>                <span class="p">:</span><span class="n">Secure</span><span class="o">-</span><span class="n">up</span>
<span class="n">Violation</span> <span class="n">Mode</span>             <span class="p">:</span><span class="n">Shutdown</span>
<span class="n">Aging</span> <span class="n">Time</span>                 <span class="p">:</span><span class="mi">0</span>
<span class="n">Aging</span> <span class="n">Type</span>                 <span class="p">:</span><span class="n">Absolute</span>
<span class="n">SecureStatic</span> <span class="n">Address</span> <span class="n">Aging</span> <span class="p">:</span><span class="n">Enabled</span>
<span class="n">Maximum</span> <span class="n">MAC</span> <span class="n">Addresses</span>      <span class="p">:</span><span class="mi">5</span>
<span class="n">Total</span> <span class="n">MAC</span> <span class="n">Addresses</span>        <span class="p">:</span><span class="mi">0</span>
<span class="n">Configured</span> <span class="n">MAC</span> <span class="n">Addresses</span>   <span class="p">:</span><span class="mi">0</span>
<span class="n">Sticky</span> <span class="n">MAC</span> <span class="n">Addresses</span>       <span class="p">:</span><span class="mi">11</span>
<span class="n">Last</span> <span class="n">Source</span> <span class="n">Address</span>        <span class="p">:</span><span class="mf">0000.0000</span><span class="o">.</span><span class="mi">0401</span>
<span class="n">Security</span> <span class="n">Violation</span> <span class="n">Count</span>   <span class="p">:</span><span class="mi">0</span>
</pre></div>
</div>
<ul class="simple">
<li>To return the interface <strong>to the default condition</strong> as not a secure port, use the <code class="docutils literal"><span class="pre">no</span> <span class="pre">switchport</span> <span class="pre">port-security</span></code> interface configuration command.</li>
<li>To return the interface <strong>to the default number of secure MAC addresses</strong>, use the <code class="docutils literal"><span class="pre">no</span> <span class="pre">switchport</span> <span class="pre">port-security</span> <span class="pre">maximum</span> <span class="pre">value</span></code>.</li>
<li>To <strong>delete a MAC</strong> address from the address table, use the <code class="docutils literal"><span class="pre">no</span> <span class="pre">switchport</span> <span class="pre">port-security</span> <span class="pre">mac-address</span> <span class="pre">mac_address</span></code> command.</li>
<li>To return the <strong>violation mode to the default condition (shutdown mode)</strong>, use the <code class="docutils literal"><span class="pre">no</span> <span class="pre">switchport</span> <span class="pre">port-security</span> <span class="pre">violation</span> <span class="pre">{restrict</span> <span class="pre">|</span> <span class="pre">shutdown}</span></code> command.</li>
<li>To <strong>disable sticky learning</strong> on an interface, use the <code class="docutils literal"><span class="pre">no</span> <span class="pre">switchport</span> <span class="pre">port-security</span> <span class="pre">mac-address</span> <span class="pre">sticky</span></code> command. The interface converts the sticky secure MAC addresses to dynamic secure addresses.</li>
<li>To <strong>delete a sticky secure MAC addresses</strong> from the address table, use the <code class="docutils literal"><span class="pre">no</span> <span class="pre">switchport</span> <span class="pre">port-security</span> <span class="pre">sticky</span> <span class="pre">mac-address</span> <span class="pre">mac_address</span></code> command. To <strong>delete all the sticky addresses on an interface or a VLAN</strong>, use the <code class="docutils literal"><span class="pre">no</span> <span class="pre">switchport</span> <span class="pre">port-security</span> <span class="pre">sticky</span> <span class="pre">interface</span> <span class="pre">interface-id</span></code> command.</li>
<li>To <strong>clear dynamically learned</strong> port security MAC in the CAM table, use the <code class="docutils literal"><span class="pre">clear</span> <span class="pre">port-security</span> <span class="pre">dynamic</span></code> command. The address keyword enables you to clear a secure MAC addresses. The interface keyword enables you to clear all secure addresses on an interface.</li>
</ul>
<p>This example shows how to configure a secure MAC address on Fast Ethernet port 5/1 and verify the configuration:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Switch</span><span class="c1"># configure terminal</span>
<span class="n">Enter</span> <span class="n">configuration</span> <span class="n">commands</span><span class="p">,</span> <span class="n">one</span> <span class="n">per</span> <span class="n">line</span><span class="o">.</span>  <span class="n">End</span> <span class="k">with</span> <span class="n">CNTL</span><span class="o">/</span><span class="n">Z</span><span class="o">.</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface fastethernet 5/1</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport mode access</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport port-security</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport port-security maximum 10</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport port-security mac-address 0000.0000.0003 (Static secure MAC)</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport port-security mac-address sticky</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="n">switchport</span> <span class="n">port</span><span class="o">-</span><span class="n">security</span> <span class="n">mac</span><span class="o">-</span><span class="n">address</span> <span class="n">sticky</span> <span class="mf">0000.0000</span><span class="o">.</span><span class="mi">0001</span> <span class="p">(</span><span class="n">Sticky</span> <span class="n">static</span> <span class="n">MAC</span><span class="p">)</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport port-security mac-address sticky 0000.0000.0002</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">Switch</span><span class="c1">#show port address</span>
<span class="n">Secure</span> <span class="n">Mac</span> <span class="n">Address</span> <span class="n">Table</span>
<span class="o">------------------------------------------------------------------------</span>
<span class="n">Vlan</span>  <span class="n">Mac</span> <span class="n">Address</span>       <span class="n">Type</span>                   <span class="n">Ports</span>   <span class="n">Remaining</span> <span class="n">Age</span>

                                                              <span class="p">(</span><span class="n">mins</span><span class="p">)</span>
<span class="o">----</span>  <span class="o">-----------</span>       <span class="o">----</span>                    <span class="o">-----</span>   <span class="o">-------------</span>
<span class="mi">1</span>    <span class="mf">0000.0000</span><span class="o">.</span><span class="mi">0001</span>    <span class="n">SecureSticky</span>             <span class="n">Fa5</span><span class="o">/</span><span class="mi">1</span>        <span class="o">-</span>
<span class="mi">1</span>    <span class="mf">0000.0000</span><span class="o">.</span><span class="mi">0002</span>    <span class="n">SecureSticky</span>             <span class="n">Fa5</span><span class="o">/</span><span class="mi">1</span>        <span class="o">-</span>
<span class="mi">1</span>    <span class="mf">0000.0000</span><span class="o">.</span><span class="mi">0003</span>    <span class="n">SecureConfigured</span>         <span class="n">Fa5</span><span class="o">/</span><span class="mi">1</span>        <span class="o">-</span>


<span class="o">------------------------------------------------------------------------</span>
<span class="n">Total</span> <span class="n">Addresses</span> <span class="ow">in</span> <span class="n">System</span> <span class="p">(</span><span class="n">excluding</span> <span class="n">one</span> <span class="n">mac</span> <span class="n">per</span> <span class="n">port</span><span class="p">)</span>     <span class="p">:</span> <span class="mi">2</span>
<span class="n">Max</span> <span class="n">Addresses</span> <span class="n">limit</span> <span class="ow">in</span> <span class="n">System</span> <span class="p">(</span><span class="n">excluding</span> <span class="n">one</span> <span class="n">mac</span> <span class="n">per</span> <span class="n">port</span><span class="p">)</span> <span class="p">:</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
<div class="section" id="port-security-aging">
<h5>Port security aging<a class="headerlink" href="#port-security-aging" title="Permalink to this headline">¶</a></h5>
<p>To set the aging time &amp; aging type for all secure addresses on a port</p>
<p>Use this to remove n add PCs on a secure port without deleting other secure MACs</p>
<p>To configure port security aging</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface interface_id</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport port-security [ aging {static | time aging_time | type {absolute | inactivity} ]</span>

<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface fastethernet 5/1</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport port-security aging time 120</span>
</pre></div>
</div>
<p>The <strong>static</strong> keyword enables aging for statically configured secure addresses on this port.</p>
<p>The <strong>time aging_time</strong> keyword specifies the aging time for this port. Valid range for aging_time is from 0 to 1440 minutes. If the time is equal to 0, aging is disabled for this port.</p>
<p>The <strong>type</strong> keyword sets the aging type as <strong>absolute or inactive</strong>. For absolute aging, all the secure addresses on this port ago out exactly after the time (minutes) specified and are removed from the secure address list. For inactive aging, the secure addresses on this port ago out only if there is no data traffic from the secure source address for the specified time period.</p>
<p>Verify</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Switch</span><span class="c1"># show port security [interface interface_id] [address]</span>

<span class="n">To</span> <span class="n">disable</span> <span class="n">port</span> <span class="n">security</span> <span class="n">aging</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">secure</span> <span class="n">addresses</span> <span class="n">on</span> <span class="n">a</span> <span class="n">port</span><span class="p">:</span>
<span class="n">Switch</span><span class="c1"># no switchport port-security aging time</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">This</span> <span class="n">example</span> <span class="n">displays</span> <span class="n">output</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">show</span> <span class="n">port</span><span class="o">-</span><span class="n">security</span> <span class="n">command</span> <span class="n">when</span> <span class="n">you</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">enter</span> <span class="n">an</span> <span class="n">interface</span><span class="p">:</span>

<span class="n">Switch</span><span class="c1"># show port-security</span>

<span class="n">Secure</span> <span class="n">Port</span>  <span class="n">MaxSecureAddr</span>  <span class="n">CurrentAddr</span>  <span class="n">SecurityViolation</span>  <span class="n">Security</span> <span class="n">Action</span>
                <span class="p">(</span><span class="n">Count</span><span class="p">)</span>       <span class="p">(</span><span class="n">Count</span><span class="p">)</span>          <span class="p">(</span><span class="n">Count</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
      <span class="n">Fa3</span><span class="o">/</span><span class="mi">1</span>              <span class="mi">2</span>            <span class="mi">2</span>                  <span class="mi">0</span>         <span class="n">Restrict</span>
      <span class="n">Fa3</span><span class="o">/</span><span class="mi">2</span>              <span class="mi">2</span>            <span class="mi">2</span>                  <span class="mi">0</span>         <span class="n">Restrict</span>
      <span class="n">Fa3</span><span class="o">/</span><span class="mi">3</span>              <span class="mi">2</span>            <span class="mi">2</span>                  <span class="mi">0</span>         <span class="n">Shutdown</span>
      <span class="n">Fa3</span><span class="o">/</span><span class="mi">4</span>              <span class="mi">2</span>            <span class="mi">2</span>                  <span class="mi">0</span>         <span class="n">Shutdown</span>
      <span class="n">Fa3</span><span class="o">/</span><span class="mi">5</span>              <span class="mi">2</span>            <span class="mi">2</span>                  <span class="mi">0</span>         <span class="n">Shutdown</span>
      <span class="n">Fa3</span><span class="o">/</span><span class="mi">6</span>              <span class="mi">2</span>            <span class="mi">2</span>                  <span class="mi">0</span>         <span class="n">Shutdown</span>
      <span class="n">Fa3</span><span class="o">/</span><span class="mi">7</span>              <span class="mi">2</span>            <span class="mi">2</span>                  <span class="mi">0</span>         <span class="n">Shutdown</span>
      <span class="n">Fa3</span><span class="o">/</span><span class="mi">8</span>              <span class="mi">2</span>            <span class="mi">2</span>                  <span class="mi">0</span>         <span class="n">Shutdown</span>
     <span class="n">Fa3</span><span class="o">/</span><span class="mi">10</span>              <span class="mi">1</span>            <span class="mi">0</span>                  <span class="mi">0</span>         <span class="n">Shutdown</span>
     <span class="n">Fa3</span><span class="o">/</span><span class="mi">11</span>              <span class="mi">1</span>            <span class="mi">0</span>                  <span class="mi">0</span>         <span class="n">Shutdown</span>
     <span class="n">Fa3</span><span class="o">/</span><span class="mi">12</span>              <span class="mi">1</span>            <span class="mi">0</span>                  <span class="mi">0</span>         <span class="n">Restrict</span>
     <span class="n">Fa3</span><span class="o">/</span><span class="mi">13</span>              <span class="mi">1</span>            <span class="mi">0</span>                  <span class="mi">0</span>         <span class="n">Shutdown</span>
     <span class="n">Fa3</span><span class="o">/</span><span class="mi">14</span>              <span class="mi">1</span>            <span class="mi">0</span>                  <span class="mi">0</span>         <span class="n">Shutdown</span>
     <span class="n">Fa3</span><span class="o">/</span><span class="mi">15</span>              <span class="mi">1</span>            <span class="mi">0</span>                  <span class="mi">0</span>         <span class="n">Shutdown</span>
     <span class="n">Fa3</span><span class="o">/</span><span class="mi">16</span>              <span class="mi">1</span>            <span class="mi">0</span>                  <span class="mi">0</span>         <span class="n">Shutdown</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="n">Total</span> <span class="n">Addresses</span> <span class="ow">in</span> <span class="n">System</span> <span class="p">(</span><span class="n">excluding</span> <span class="n">one</span> <span class="n">mac</span> <span class="n">per</span> <span class="n">port</span><span class="p">)</span>     <span class="p">:</span><span class="mi">8</span>
<span class="n">Max</span> <span class="n">Addresses</span> <span class="n">limit</span> <span class="ow">in</span> <span class="n">System</span> <span class="p">(</span><span class="n">excluding</span> <span class="n">one</span> <span class="n">mac</span> <span class="n">per</span> <span class="n">port</span><span class="p">)</span> <span class="p">:</span><span class="mi">1024</span>
<span class="n">Global</span> <span class="n">SNMP</span> <span class="n">trap</span> <span class="n">control</span> <span class="k">for</span> <span class="n">port</span><span class="o">-</span><span class="n">security</span>                 <span class="p">:</span><span class="mi">20</span> <span class="p">(</span><span class="n">traps</span> <span class="n">per</span> <span class="n">second</span><span class="p">)</span>
</pre></div>
</div>
<p>This example displays output from the show port-security command for a specified interface:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Switch</span><span class="c1"># show port-security interface fastethernet 5/1</span>
<span class="n">Port</span> <span class="n">Security</span>              <span class="p">:</span> <span class="n">Enabled</span>
<span class="n">Port</span> <span class="n">Status</span>                <span class="p">:</span> <span class="n">Secure</span><span class="o">-</span><span class="n">up</span>
<span class="n">Violation</span> <span class="n">Mode</span>             <span class="p">:</span> <span class="n">Shutdown</span>
<span class="n">Aging</span> <span class="n">Time</span>                 <span class="p">:</span> <span class="mi">0</span> <span class="n">mins</span>
<span class="n">Aging</span> <span class="n">Type</span>                 <span class="p">:</span> <span class="n">Absolute</span>
<span class="n">SecureStatic</span> <span class="n">Address</span> <span class="n">Aging</span> <span class="p">:</span> <span class="n">Disabled</span>
<span class="n">Maximum</span> <span class="n">MAC</span> <span class="n">Addresses</span>      <span class="p">:</span> <span class="mi">1</span>
<span class="n">Total</span> <span class="n">MAC</span> <span class="n">Addresses</span>        <span class="p">:</span> <span class="mi">1</span>
<span class="n">Configured</span> <span class="n">MAC</span> <span class="n">Addresses</span>   <span class="p">:</span> <span class="mi">0</span>
<span class="n">Sticky</span> <span class="n">MAC</span> <span class="n">Addresses</span>       <span class="p">:</span> <span class="mi">1</span>
<span class="n">Last</span> <span class="n">Source</span> <span class="n">Address</span>        <span class="p">:</span> <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">001</span><span class="n">a</span>
<span class="n">Security</span> <span class="n">Violation</span> <span class="n">Count</span>   <span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>This example displays output from the show port-security address command:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Switch</span><span class="c1">#sh port-security address</span>

          <span class="n">Secure</span> <span class="n">Mac</span> <span class="n">Address</span> <span class="n">Table</span>
<span class="o">-------------------------------------------------------------------</span>
<span class="n">Vlan</span>    <span class="n">Mac</span> <span class="n">Address</span>       <span class="n">Type</span>                <span class="n">Ports</span>   <span class="n">Remaining</span> <span class="n">Age</span>
                                                         <span class="p">(</span><span class="n">mins</span><span class="p">)</span>
<span class="o">----</span>    <span class="o">-----------</span>       <span class="o">----</span>                <span class="o">-----</span>   <span class="o">-------------</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">0000</span>    <span class="n">SecureConfigured</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">1</span>       <span class="mi">15</span> <span class="p">(</span><span class="n">I</span><span class="p">)</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">0001</span>    <span class="n">SecureConfigured</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">1</span>       <span class="mi">14</span> <span class="p">(</span><span class="n">I</span><span class="p">)</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">0100</span>    <span class="n">SecureConfigured</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">2</span>        <span class="o">-</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">0101</span>    <span class="n">SecureConfigured</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">2</span>        <span class="o">-</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">0200</span>    <span class="n">SecureConfigured</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">3</span>        <span class="o">-</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">0201</span>    <span class="n">SecureConfigured</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">3</span>        <span class="o">-</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">0300</span>    <span class="n">SecureConfigured</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">4</span>        <span class="o">-</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">0301</span>    <span class="n">SecureConfigured</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">4</span>        <span class="o">-</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">1000</span>    <span class="n">SecureDynamic</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">5</span>        <span class="o">-</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">1001</span>    <span class="n">SecureDynamic</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">5</span>        <span class="o">-</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">1100</span>    <span class="n">SecureDynamic</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">6</span>        <span class="o">-</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">1101</span>    <span class="n">SecureDynamic</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">6</span>        <span class="o">-</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">1200</span>    <span class="n">SecureSticky</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">7</span>        <span class="o">-</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">1201</span>    <span class="n">SecureSticky</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">7</span>        <span class="o">-</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">1300</span>    <span class="n">SecureSticky</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">8</span>        <span class="o">-</span>
   <span class="mi">1</span>    <span class="mf">0000.0001</span><span class="o">.</span><span class="mi">1301</span>    <span class="n">SecureSticky</span>    <span class="n">Fa3</span><span class="o">/</span><span class="mi">8</span>        <span class="o">-</span>
<span class="o">-------------------------------------------------------------------</span>
<span class="n">Total</span> <span class="n">Addresses</span> <span class="ow">in</span> <span class="n">System</span> <span class="p">(</span><span class="n">excluding</span> <span class="n">one</span> <span class="n">mac</span> <span class="n">per</span> <span class="n">port</span><span class="p">)</span>     <span class="p">:</span><span class="mi">8</span>
<span class="n">Max</span> <span class="n">Addresses</span> <span class="n">limit</span> <span class="ow">in</span> <span class="n">System</span> <span class="p">(</span><span class="n">excluding</span> <span class="n">one</span> <span class="n">mac</span> <span class="n">per</span> <span class="n">port</span><span class="p">)</span> <span class="p">:</span><span class="mi">1024</span>
</pre></div>
</div>
<p>Check if ports in Error disabled state</p>
<p><code class="docutils literal"><span class="pre">S1#</span> <span class="pre">show</span> <span class="pre">interface</span> <span class="pre">fa0/18</span> <span class="pre">status</span></code>
<code class="docutils literal"><span class="pre">S1#</span> <span class="pre">show</span> <span class="pre">port-security</span> <span class="pre">interface</span> <span class="pre">fastethernet</span> <span class="pre">0/18</span></code></p>
</div>
<div class="section" id="example-exercise">
<h5>example exercise<a class="headerlink" href="#example-exercise" title="Permalink to this headline">¶</a></h5>
<p>Requirements</p>
<dl class="docutils">
<dt>· Configure S1 with the following initial settings:</dt>
<dd><ul class="first last simple">
<li>Hostname</li>
<li>Banner that includes the word warning</li>
<li>Console port login and password cisco</li>
<li>Encrypted enable password of class</li>
<li>Encrypt plain text passwords</li>
<li>Management interface addressing</li>
</ul>
</dd>
<dt>· Configure SSH to secure remote access with the following settings:</dt>
<dd><ul class="first last simple">
<li>Domain name of cisco.com</li>
<li>RSA key-pair parameters to support SSH version 2</li>
<li>Set SSH version 2</li>
<li>User admin with secret password ccna</li>
<li>VTY lines only accept SSH connections and use local login for authentication</li>
</ul>
</dd>
<dt>· Configure the port security feature to restrict network access:</dt>
<dd><ul class="first last simple">
<li>Disable all unused ports.</li>
<li>Set the interface mode to access.</li>
<li>Enable port security to allow only two hosts per port.</li>
<li>Record the MAC address in the running configuration.</li>
<li>Ensure that port violations disable ports.</li>
</ul>
</dd>
</dl>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1">#show port-security interface ?</span>
  <span class="n">Ethernet</span>         <span class="n">IEEE</span> <span class="mf">802.3</span>
  <span class="n">FastEthernet</span>     <span class="n">FastEthernet</span> <span class="n">IEEE</span> <span class="mf">802.3</span>
  <span class="n">GigabitEthernet</span>  <span class="n">GigabitEthernet</span> <span class="n">IEEE</span> <span class="mf">802.3</span><span class="n">z</span>

<span class="n">S1</span><span class="c1">#show port-security interface FastEthernet 0/1</span>
<span class="n">Port</span> <span class="n">Security</span>              <span class="p">:</span> <span class="n">Enabled</span>
<span class="n">Port</span> <span class="n">Status</span>                <span class="p">:</span> <span class="n">Secure</span><span class="o">-</span><span class="n">up</span>
<span class="n">Violation</span> <span class="n">Mode</span>             <span class="p">:</span> <span class="n">Shutdown</span>
<span class="n">Aging</span> <span class="n">Time</span>                 <span class="p">:</span> <span class="mi">0</span> <span class="n">mins</span>
<span class="n">Aging</span> <span class="n">Type</span>                 <span class="p">:</span> <span class="n">Absolute</span>
<span class="n">SecureStatic</span> <span class="n">Address</span> <span class="n">Aging</span> <span class="p">:</span> <span class="n">Disabled</span>
<span class="n">Maximum</span> <span class="n">MAC</span> <span class="n">Addresses</span>      <span class="p">:</span> <span class="mi">2</span>
<span class="n">Total</span> <span class="n">MAC</span> <span class="n">Addresses</span>        <span class="p">:</span> <span class="mi">0</span>
<span class="n">Configured</span> <span class="n">MAC</span> <span class="n">Addresses</span>   <span class="p">:</span> <span class="mi">0</span>
<span class="n">Sticky</span> <span class="n">MAC</span> <span class="n">Addresses</span>       <span class="p">:</span> <span class="mi">0</span>
<span class="n">Last</span> <span class="n">Source</span> <span class="n">Address</span><span class="p">:</span><span class="n">Vlan</span>   <span class="p">:</span> <span class="mf">0000.0000</span><span class="o">.</span><span class="mi">0000</span><span class="p">:</span><span class="mi">0</span>
<span class="n">Security</span> <span class="n">Violation</span> <span class="n">Count</span>   <span class="p">:</span> <span class="mi">0</span>

<span class="n">S1</span><span class="c1">#show port-security ?</span>
  <span class="n">address</span>    <span class="n">Show</span> <span class="n">secure</span> <span class="n">address</span>
  <span class="n">interface</span>  <span class="n">Show</span> <span class="n">secure</span> <span class="n">interface</span>
  <span class="o">&lt;</span><span class="n">cr</span><span class="o">&gt;</span>
<span class="n">S1</span><span class="c1">#show port-security address</span>
                     <span class="n">Secure</span> <span class="n">Mac</span> <span class="n">Address</span> <span class="n">Table</span>
<span class="o">-------------------------------------------------------------------------------</span>
<span class="n">Vlan</span> <span class="n">Mac</span> <span class="n">Address</span>     <span class="n">Type</span>                    <span class="n">Ports</span>           <span class="n">Remaining</span> <span class="n">Age</span>
                                                             <span class="p">(</span><span class="n">mins</span><span class="p">)</span>
<span class="o">----</span> <span class="o">-----------</span>     <span class="o">----</span>                    <span class="o">-----</span>           <span class="o">-------------</span>
<span class="o">------------------------------------------------------------------------------</span>
<span class="n">Total</span> <span class="n">Addresses</span> <span class="ow">in</span> <span class="n">System</span> <span class="p">(</span><span class="n">excluding</span> <span class="n">one</span> <span class="n">mac</span> <span class="n">per</span> <span class="n">port</span><span class="p">)</span>     <span class="p">:</span> <span class="mi">0</span>
<span class="n">Max</span> <span class="n">Addresses</span> <span class="n">limit</span> <span class="ow">in</span> <span class="n">System</span> <span class="p">(</span><span class="n">excluding</span> <span class="n">one</span> <span class="n">mac</span> <span class="n">per</span> <span class="n">port</span><span class="p">)</span> <span class="p">:</span> <span class="mi">1024</span>
<span class="n">S1</span><span class="c1">#show ip ?</span>
  <span class="n">access</span><span class="o">-</span><span class="n">lists</span>  <span class="n">List</span> <span class="n">access</span> <span class="n">lists</span>
  <span class="n">arp</span>           <span class="n">IP</span> <span class="n">ARP</span> <span class="n">table</span>
  <span class="n">dhcp</span>          <span class="n">Show</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">DHCP</span> <span class="n">database</span>
  <span class="n">interface</span>     <span class="n">IP</span> <span class="n">interface</span> <span class="n">status</span> <span class="ow">and</span> <span class="n">configuration</span>
  <span class="n">ssh</span>           <span class="n">Information</span> <span class="n">on</span> <span class="n">SSH</span>

<span class="n">S1</span><span class="c1">#show interface FastEthernet0/1</span>
<span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span> <span class="p">(</span><span class="n">connected</span><span class="p">)</span>
  <span class="n">Hardware</span> <span class="ow">is</span> <span class="n">Lance</span><span class="p">,</span> <span class="n">address</span> <span class="ow">is</span> <span class="mi">00</span><span class="n">d0</span><span class="o">.</span><span class="n">bc57</span><span class="o">.</span><span class="mi">1001</span> <span class="p">(</span><span class="n">bia</span> <span class="mi">00</span><span class="n">d0</span><span class="o">.</span><span class="n">bc57</span><span class="o">.</span><span class="mi">1001</span><span class="p">)</span>
 <span class="n">BW</span> <span class="mi">100000</span> <span class="n">Kbit</span><span class="p">,</span> <span class="n">DLY</span> <span class="mi">1000</span> <span class="n">usec</span><span class="p">,</span>
     <span class="n">reliability</span> <span class="mi">255</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="n">txload</span> <span class="mi">1</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="n">rxload</span> <span class="mi">1</span><span class="o">/</span><span class="mi">255</span>
  <span class="n">Encapsulation</span> <span class="n">ARPA</span><span class="p">,</span> <span class="n">loopback</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="n">Keepalive</span> <span class="nb">set</span> <span class="p">(</span><span class="mi">10</span> <span class="n">sec</span><span class="p">)</span>
  <span class="n">Full</span><span class="o">-</span><span class="n">duplex</span><span class="p">,</span> <span class="mi">100</span><span class="n">Mb</span><span class="o">/</span><span class="n">s</span>
  <span class="nb">input</span> <span class="n">flow</span><span class="o">-</span><span class="n">control</span> <span class="ow">is</span> <span class="n">off</span><span class="p">,</span> <span class="n">output</span> <span class="n">flow</span><span class="o">-</span><span class="n">control</span> <span class="ow">is</span> <span class="n">off</span>
  <span class="n">ARP</span> <span class="nb">type</span><span class="p">:</span> <span class="n">ARPA</span><span class="p">,</span> <span class="n">ARP</span> <span class="n">Timeout</span> <span class="mi">04</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
  <span class="n">Last</span> <span class="nb">input</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">08</span><span class="p">,</span> <span class="n">output</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">05</span><span class="p">,</span> <span class="n">output</span> <span class="n">hang</span> <span class="n">never</span>
  <span class="n">Last</span> <span class="n">clearing</span> <span class="n">of</span> <span class="s2">&quot;show interface&quot;</span> <span class="n">counters</span> <span class="n">never</span>
  <span class="n">Input</span> <span class="n">queue</span><span class="p">:</span> <span class="mi">0</span><span class="o">/</span><span class="mi">75</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span> <span class="p">(</span><span class="n">size</span><span class="o">/</span><span class="nb">max</span><span class="o">/</span><span class="n">drops</span><span class="o">/</span><span class="n">flushes</span><span class="p">);</span> <span class="n">Total</span> <span class="n">output</span> <span class="n">drops</span><span class="p">:</span> <span class="mi">0</span>
  <span class="n">Queueing</span> <span class="n">strategy</span><span class="p">:</span> <span class="n">fifo</span>
  <span class="n">Output</span> <span class="n">queue</span> <span class="p">:</span><span class="mi">0</span><span class="o">/</span><span class="mi">40</span> <span class="p">(</span><span class="n">size</span><span class="o">/</span><span class="nb">max</span><span class="p">)</span>
  <span class="mi">5</span> <span class="n">minute</span> <span class="nb">input</span> <span class="n">rate</span> <span class="mi">0</span> <span class="n">bits</span><span class="o">/</span><span class="n">sec</span><span class="p">,</span> <span class="mi">0</span> <span class="n">packets</span><span class="o">/</span><span class="n">sec</span>
  <span class="mi">5</span> <span class="n">minute</span> <span class="n">output</span> <span class="n">rate</span> <span class="mi">0</span> <span class="n">bits</span><span class="o">/</span><span class="n">sec</span><span class="p">,</span> <span class="mi">0</span> <span class="n">packets</span><span class="o">/</span><span class="n">sec</span>
     <span class="mi">956</span> <span class="n">packets</span> <span class="nb">input</span><span class="p">,</span> <span class="mi">193351</span> <span class="nb">bytes</span><span class="p">,</span> <span class="mi">0</span> <span class="n">no</span> <span class="n">buffer</span>
     <span class="n">Received</span> <span class="mi">956</span> <span class="n">broadcasts</span><span class="p">,</span> <span class="mi">0</span> <span class="n">runts</span><span class="p">,</span> <span class="mi">0</span> <span class="n">giants</span><span class="p">,</span> <span class="mi">0</span> <span class="n">throttles</span>
     <span class="mi">0</span> <span class="nb">input</span> <span class="n">errors</span><span class="p">,</span> <span class="mi">0</span> <span class="n">CRC</span><span class="p">,</span> <span class="mi">0</span> <span class="n">frame</span><span class="p">,</span> <span class="mi">0</span> <span class="n">overrun</span><span class="p">,</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">,</span> <span class="mi">0</span> <span class="n">abort</span>
     <span class="mi">0</span> <span class="n">watchdog</span><span class="p">,</span> <span class="mi">0</span> <span class="n">multicast</span><span class="p">,</span> <span class="mi">0</span> <span class="n">pause</span> <span class="nb">input</span>
     <span class="mi">0</span> <span class="nb">input</span> <span class="n">packets</span> <span class="k">with</span> <span class="n">dribble</span> <span class="n">condition</span> <span class="n">detected</span>
     <span class="mi">2357</span> <span class="n">packets</span> <span class="n">output</span><span class="p">,</span> <span class="mi">263570</span> <span class="nb">bytes</span><span class="p">,</span> <span class="mi">0</span> <span class="n">underruns</span>
     <span class="mi">0</span> <span class="n">output</span> <span class="n">errors</span><span class="p">,</span> <span class="mi">0</span> <span class="n">collisions</span><span class="p">,</span> <span class="mi">10</span> <span class="n">interface</span> <span class="n">resets</span>
     <span class="mi">0</span> <span class="n">babbles</span><span class="p">,</span> <span class="mi">0</span> <span class="n">late</span> <span class="n">collision</span><span class="p">,</span> <span class="mi">0</span> <span class="n">deferred</span>
     <span class="mi">0</span> <span class="n">lost</span> <span class="n">carrier</span><span class="p">,</span> <span class="mi">0</span> <span class="n">no</span> <span class="n">carrier</span>
     <span class="mi">0</span> <span class="n">output</span> <span class="n">buffer</span> <span class="n">failures</span><span class="p">,</span> <span class="mi">0</span> <span class="n">output</span> <span class="n">buffers</span> <span class="n">swapped</span> <span class="n">out</span>

<span class="n">S1</span><span class="c1">#show port-security interface FastEthernet 0/1</span>
<span class="n">Port</span> <span class="n">Security</span>              <span class="p">:</span> <span class="n">Enabled</span>
<span class="n">Port</span> <span class="n">Status</span>                <span class="p">:</span> <span class="n">Secure</span><span class="o">-</span><span class="n">up</span>
<span class="n">Violation</span> <span class="n">Mode</span>             <span class="p">:</span> <span class="n">Shutdown</span>
<span class="n">Aging</span> <span class="n">Time</span>                 <span class="p">:</span> <span class="mi">0</span> <span class="n">mins</span>
<span class="n">Aging</span> <span class="n">Type</span>                 <span class="p">:</span> <span class="n">Absolute</span>
<span class="n">SecureStatic</span> <span class="n">Address</span> <span class="n">Aging</span> <span class="p">:</span> <span class="n">Disabled</span>
<span class="n">Maximum</span> <span class="n">MAC</span> <span class="n">Addresses</span>      <span class="p">:</span> <span class="mi">2</span>
<span class="n">Total</span> <span class="n">MAC</span> <span class="n">Addresses</span>        <span class="p">:</span> <span class="mi">0</span>
<span class="n">Configured</span> <span class="n">MAC</span> <span class="n">Addresses</span>   <span class="p">:</span> <span class="mi">0</span>
<span class="n">Sticky</span> <span class="n">MAC</span> <span class="n">Addresses</span>       <span class="p">:</span> <span class="mi">0</span>
<span class="n">Last</span> <span class="n">Source</span> <span class="n">Address</span><span class="p">:</span><span class="n">Vlan</span>   <span class="p">:</span> <span class="mf">0000.0000</span><span class="o">.</span><span class="mi">0000</span><span class="p">:</span><span class="mi">0</span>
<span class="n">Security</span> <span class="n">Violation</span> <span class="n">Count</span>   <span class="p">:</span> <span class="mi">0</span>

<span class="n">S1</span><span class="c1">#show port-security interface FastEthernet 0/2</span>
<span class="n">Port</span> <span class="n">Security</span>              <span class="p">:</span> <span class="n">Enabled</span>
<span class="n">Port</span> <span class="n">Status</span>                <span class="p">:</span> <span class="n">Secure</span><span class="o">-</span><span class="n">up</span>
<span class="n">Violation</span> <span class="n">Mode</span>             <span class="p">:</span> <span class="n">Shutdown</span>
<span class="n">Aging</span> <span class="n">Time</span>                 <span class="p">:</span> <span class="mi">0</span> <span class="n">mins</span>
<span class="n">Aging</span> <span class="n">Type</span>                 <span class="p">:</span> <span class="n">Absolute</span>
<span class="n">SecureStatic</span> <span class="n">Address</span> <span class="n">Aging</span> <span class="p">:</span> <span class="n">Disabled</span>
<span class="n">Maximum</span> <span class="n">MAC</span> <span class="n">Addresses</span>      <span class="p">:</span> <span class="mi">2</span>
<span class="n">Total</span> <span class="n">MAC</span> <span class="n">Addresses</span>        <span class="p">:</span> <span class="mi">0</span>
<span class="n">Configured</span> <span class="n">MAC</span> <span class="n">Addresses</span>   <span class="p">:</span> <span class="mi">0</span>
<span class="n">Sticky</span> <span class="n">MAC</span> <span class="n">Addresses</span>       <span class="p">:</span> <span class="mi">0</span>
<span class="n">Last</span> <span class="n">Source</span> <span class="n">Address</span><span class="p">:</span><span class="n">Vlan</span>   <span class="p">:</span> <span class="mf">0000.0000</span><span class="o">.</span><span class="mi">0000</span><span class="p">:</span><span class="mi">0</span>
<span class="n">Security</span> <span class="n">Violation</span> <span class="n">Count</span>   <span class="p">:</span> <span class="mi">0</span>

<span class="n">S1</span><span class="c1">#show port-security</span>
<span class="n">Secure</span> <span class="n">Port</span> <span class="n">MaxSecureAddr</span> <span class="n">CurrentAddr</span> <span class="n">SecurityViolation</span> <span class="n">Security</span> <span class="n">Action</span>
               <span class="p">(</span><span class="n">Count</span><span class="p">)</span>       <span class="p">(</span><span class="n">Count</span><span class="p">)</span>        <span class="p">(</span><span class="n">Count</span><span class="p">)</span>
<span class="o">--------------------------------------------------------------------</span>
        <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>        <span class="mi">2</span>          <span class="mi">0</span>                 <span class="mi">0</span>         <span class="n">Shutdown</span>
        <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span>        <span class="mi">2</span>          <span class="mi">0</span>                 <span class="mi">0</span>         <span class="n">Shutdown</span>
<span class="o">----------------------------------------------------------------------</span>
</pre></div>
</div>
<p>There are 10 best practices that represent the best insurance for a network:</p>
<ol class="arabic simple">
<li>Develop a written security policy for the organization.</li>
<li>Shut down unused services and ports.</li>
<li>Use strong passwords and change them often.</li>
<li>Control physical access to devices.</li>
<li>Avoid using standard insecure HTTP websites, especially for login screens. Instead use the more secure HTTPS.</li>
<li>Perform backups and test the backed up files on a regular basis.</li>
<li>Educate employees about social engineering attacks, and develop policies to validate identities over the phone, via email, and in person.</li>
<li>Encrypt sensitive data and protect it with a strong password.</li>
<li>Implement security hardware and software, such as firewalls.</li>
<li>Keep IOS software up-to-date by installing security patches weekly or daily, if possible.</li>
</ol>
</div>
</div>
<div class="section" id="qna-chapter-5">
<h4>QnA Chapter 5<a class="headerlink" href="#qna-chapter-5" title="Permalink to this headline">¶</a></h4>
<p>3 causes of interface up - line protocol down
* encapsulation mismatch
* other end = error-disabled
* hardware</p>
<dl class="docutils">
<dt>Type of Ethernet frame that is smaller than 64bytes:</dt>
<dd>runt</dd>
<dt>Indication of a media or cable error:</dt>
<dd>CRC error</dd>
</dl>
<p>A condition that occurs if a collision happens after 512bit have been transmitted: late collision</p>
<dl class="docutils">
<dt>a cisco switch feature that limits # of MAC addresses allowed through a port:</dt>
<dd>port security</dd>
<dt>a method of port security configuration whereby learned MAC addresses are deleted if the switch is restarted:</dt>
<dd>dynamic</dd>
<dt>a method of port security that can be dynamically learned &amp; once learned saved to the configuration saved in NVRAM:</dt>
<dd>sticky</dd>
<dt>default security violation for port security:</dt>
<dd>shutdown</dd>
<dt>Which command displays information about the auto-MDIX setting for a specific interface?:</dt>
<dd>show controllers</dd>
<dt>steps needed to configure a switch for SSH:</dt>
<dd><ul class="first last simple">
<li>Create a local user.</li>
<li>Generate RSA keys.</li>
<li>Configure a domain name.</li>
<li>Use the login local command.</li>
<li>Use the transport input ssh command.</li>
<li>Order does not matter within this group.</li>
</ul>
</dd>
<dt>What is a possible cause of runt Ethernet frames when a switch is being used:</dt>
<dd>malfunctioning NIC (not a late collision)</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A runt frame is a frame that is smaller than 64 bytes, the minimum allowed Ethernet frame. This type of frame is usually due to a malfunctioning NIC or excessive collisions. Duplex misconfiguration can cause connectivity issues. Excessive cable length can generate CRC errors and/or late collisions.</p>
</div>
<dl class="docutils">
<dt>switch and gateways:</dt>
<dd>If the switch was unable to find and load the IOS, the prompt would be switch:. A Layer 2 switch does not provide the default gateway for connected hosts. The default gateway is provided by a Layer 3 device. The switch cannot be managed remotely until a management VLAN and a default gateway have been configured.</dd>
<dt>what configuration must be in place for the auto-MDIX feature to function on a switch interface?:</dt>
<dd>The speed and duplex of the interface must be configured for auto detect.</dd>
<dt>What would be the most common reason that a network technician would see the following Cisco switch prompt after the switch boots?:</dt>
<dd>The switch operating system cannot be found.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The prompt of “switch:” is seen when the switch cannot find an operating system and is in the boot loader environment where only a few basic commands can be used to repair the switch to an operational state. When an administrator has used Telnet or SSH to gain access to a switch prompt, the prompt usually asks for a username and password or is in user EXEC mode (switch&gt;, for example).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Escalating CRC errors usually means that the data is being modified during transmission from the host to the switch. This is often caused by high levels of electromagnetic interference on the link.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Port security cannot be enabled globally. All active switch ports should be manually secured using the switchport port-security command, which allows the administrator to control the number of valid MAC addresses allowed to access the port. This command does not specify what action will be taken if a violation occurs, nor does it change the process of populating the MAC address table.</p>
</div>
<dl class="docutils">
<dt>Where are dynamically learned MAC addresses stored when sticky learning is enabled with the switchport port-security mac-address sticky command?:</dt>
<dd>RAM</dd>
<dt>Match the link state to the interface and protocol status:</dt>
<dd><ul class="first last simple">
<li>disable -&gt; administratively down</li>
<li>Layer 1 problem -&gt; down/down</li>
<li>Layer 2 problem -&gt; up/down</li>
<li>operational -&gt; up/up</li>
</ul>
</dd>
<dt>If one end of an Ethernet connection is configured for full duplex and the other end of the connection is configured for half duplex, where would late collisions be observed?:</dt>
<dd>on the half-duplex end of the connection</dd>
</dl>
</div>
</div>
<div class="section" id="chapter-6-vlans">
<h3>Chapter 6 VLANS<a class="headerlink" href="#chapter-6-vlans" title="Permalink to this headline">¶</a></h3>
<p>One of the technologies used to improve network performance is the separation of large broadcast domains into smaller ones.</p>
<p>The role of providing access into a LAN is normally reserved for an access layer switch. A virtual local area network (VLAN) can be created on a Layer 2 switch to reduce the size of broadcast domains, similar to a Layer 3 device. VLANs are commonly incorporated into network design making it easier for a network to support the goals of an organization. While VLANs are primarily used within switched local area networks, modern implementations of VLANs allow them to span MANs and WANs.</p>
<p>Because VLANs segment the network, a Layer 3 process is required to allow traffic to move from one network segment to another.</p>
<p>This Layer 3 routing process can either be implemented using a router or a Layer 3 switch interface. The use of a Layer 3 device provides a method for controlling the flow of traffic between network segments, including network segments created by VLANs.</p>
<p>The first part of this chapter will cover how to configure, manage, and troubleshoot VLANs and VLAN trunks. The second part of this chapter focuses on implementing inter-VLAN routing using a router. Inter-VLAN routing on a Layer 3 switch is covered in a later course.</p>
<p>Packets destined for devices that do not belong to the VLAN must be forwarded through a device that supports routing.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A VLAN creates a logical broadcast domain that can span multiple physical LAN segments. VLANs improve network performance by separating large broadcast domains into smaller ones. If a device in one VLAN sends a broadcast Ethernet frame, all devices in the VLAN receive the frame, but devices in other VLANs do not.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">VLANs enable the implementation of access and security policies according to specific groupings of users. Each switch port can be assigned to only one VLAN (with the exception of a port connected to an IP phone or to another switch).</p>
</div>
<div class="section" id="vlan-benefits">
<h4>VLAN Benefits<a class="headerlink" href="#vlan-benefits" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>Improved Security:</dt>
<dd>Groups that have sensitive data are separated from the rest of the network</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Reduced Cost:</dt>
<dd>Reduced need for expensive network upgrades and more efficient use of existing bandwidth and uplinks</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Better Performance:</dt>
<dd>Dividing L2 networks into multiple logical workgroups (broadcast domains) reduces unnecessary traffic</dd>
</dl>
</li>
<li>Smaller Broadcast Domains</li>
<li><dl class="first docutils">
<dt>IT Efficiency:</dt>
<dd>VLANs make it easier to manage the network because users with similar network requirements share the same VLAN. When a new switch is provisioned, all the policies and procedures already configured for the particular VLAN are implemented when the ports are assigned. It is also easy for the IT staff to identify the function of a VLAN by giving it an appropriate name</dd>
</dl>
</li>
<li>Management Efficiency</li>
<li>Simpler Project and Application Management: VLANs aggregate users and network devices to support business or geographic requirements. Having separate functions makes managing a project or working with a specialized application easier; an example of such an application is an e-learning development platform for faculty.</li>
</ul>
<p>Each VLAN in a switched network corresponds to an IP network. Therefore, VLAN design must take into consideration the implementation of a hierarchical network-addressing scheme. Hierarchical network addressing means that IP network numbers are applied to network segments or VLANs in an orderly fashion that takes the network as a whole into consideration.</p>
</div>
<div class="section" id="vlan-types">
<h4>VLAN Types<a class="headerlink" href="#vlan-types" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>Data VLAN:</dt>
<dd>for user generated traffic aka user VLAN. Used to seperate the network into groups of users or devices</dd>
<dt>Default VLAN:</dt>
<dd>All switch ports become part of it after initial boot. VLAN 1. View with <code class="docutils literal"><span class="pre">show</span> <span class="pre">vlan</span> <span class="pre">brief</span></code>. VLAN 2 cannot be renamed or deleted</dd>
<dt>Native VLAN:</dt>
<dd>Assigned to an 802.1Q trunk port (links between switches) that supports VLAN tagged traffic &amp; untagged traffic. Tagged means there is a <strong>4-byte</strong> tag inserted in original Ethernet frame header. The 802.1Q trunk port places untagged traffic on the native VLAN, that is <strong>VLAN 1 by default</strong>. It is a best practice to configure the native VLAN as an unused VLAN, distinct from VLAN 1 and other VLANs</dd>
<dt>Management VLAN:</dt>
<dd>VLAN configured to access the management capabilities of a switch. VLAN 1 is the management VLAN by default. To create the management VLAN, the switch virtual interface (SVI) of that VLAN is assigned an IP address and a subnet mask, allowing the switch to be managed via HTTP, Telnet, SSH, or SNMP.</dd>
</dl>
</div>
<div class="section" id="voice-vlans">
<h4>Voice VLANs<a class="headerlink" href="#voice-vlans" title="Permalink to this headline">¶</a></h4>
<p>VoIP traffic requires:</p>
<ul class="simple">
<li>Assured bandwidth to ensure voice quality</li>
<li>Transmission priority over other types of network traffic</li>
<li>Ability to be routed around congested areas on the network</li>
<li>Delay of less than 150 ms across the network</li>
</ul>
<p>To meet these requirements, the entire network has to be designed to support VoIP.</p>
<img alt="nw/_static/img/voice_vlans.png" src="nw/_static/img/voice_vlans.png" />
</div>
<div class="section" id="vlan-trunks">
<h4>VLAN Trunks<a class="headerlink" href="#vlan-trunks" title="Permalink to this headline">¶</a></h4>
<p>A trunk is a point-to-point link between 2 network devices dat carries more than one VLAN. It extends VLANS across an entire network. This way no router is needed.</p>
<p>A trunk does not belong to a specific VLAN, it is a conduit for multiple VLANS between switches and routers. A trunk can also be used between a NW device and server or other device that is equiped with an 802.1Q capable NIC</p>
<img alt="nw/_static/img/vlan_trunks.png" src="nw/_static/img/vlan_trunks.png" />
</div>
<div class="section" id="q-frame">
<h4>802.1Q Frame<a class="headerlink" href="#q-frame" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/802.1Q_frame.png" src="nw/_static/img/802.1Q_frame.png" />
<p>When the switch receives a frame on a port configured in access mode and assigned a VLAN, the switch inserts a VLAN tag in the frame header, recalculates the Frame Check Sequence (FCS), and sends the tagged frame out of a trunk port.</p>
<div class="section" id="vlan-tag-field-details">
<h5>VLAN Tag Field Details<a class="headerlink" href="#vlan-tag-field-details" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt>The VLAN tag field consists of a Type field, a Priority field, a Canonical Format Identifier field, and VLAN ID field:</dt>
<dd><ul class="first last simple">
<li><strong>Type</strong> - A 2-byte value called the tag protocol ID (TPID) value. For Ethernet, it is set to hexadecimal 0x8100.</li>
<li><strong>User priority</strong> - A 3-bit value that supports level or <strong>service implementation</strong>.</li>
<li><strong>Canonical Format Identifier</strong> (CFI) - A 1-bit identifier that <strong>enables Token Ring frames to be carried across Ethernet links</strong>.</li>
<li><strong>VLAN ID</strong> (VID) - A 12-bit VLAN identification number that supports up to 4096 VLAN IDs.</li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">After the switch inserts the Type and tag control information fields, it recalculates the FCS values and inserts the new FCS into the frame.</p>
</div>
</div>
</div>
<div class="section" id="native-vlans-802-1q-tagging">
<h4>Native VLANS &amp; 802.1Q Tagging<a class="headerlink" href="#native-vlans-802-1q-tagging" title="Permalink to this headline">¶</a></h4>
<div class="section" id="tagged-frames-on-the-native-vlan">
<h5>Tagged Frames on the Native VLAN<a class="headerlink" href="#tagged-frames-on-the-native-vlan" title="Permalink to this headline">¶</a></h5>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If an 802.1Q trunk port receives a tagged frame with the VLAN ID that is the same as the native VLAN, it drops the frame.</p>
</div>
<p>Consequently, when configuring a switch port on a Cisco switch, configure devices so that they do not send tagged frames on the native VLAN. Devices from other vendors that support tagged frames on the native VLAN include IP phones, servers, routers, and non-Cisco switches.</p>
<p>This scenario reflects poor network design for several reasons: it uses a hub, it has a host connected to a trunk link, and it implies that the switches have access ports assigned to the native VLAN. It also illustrates the motivation for the IEEE 802.1Q specification for native VLANs as a means of handling legacy scenarios.</p>
<img alt="nw/_static/img/trunkbehavior_nativevlans.png" src="nw/_static/img/trunkbehavior_nativevlans.png" />
</div>
<div class="section" id="untagged-frames-on-the-native-vlan">
<h5>Untagged Frames on the Native VLAN<a class="headerlink" href="#untagged-frames-on-the-native-vlan" title="Permalink to this headline">¶</a></h5>
<p>When a Cisco switch trunk port receives untagged frames (which are unusual in a well-designed network), it forwards those frames to the native VLAN. If there are no devices associated with the native VLAN (which is not unusual) and there are no other trunk ports (which is not unusual), then the frame is dropped. The default native VLAN is VLAN 1.
When configuring an 802.1Q trunk port, a default Port VLAN ID (PVID) is assigned the value of the native VLAN ID. All untagged traffic coming in or out of the 802.1Q port is forwarded based on the PVID value.
For example, if VLAN 99 is configured as the native VLAN, the PVID is 99 and all untagged traffic is forwarded to VLAN 99. If the native VLAN has not been reconfigured, the PVID value is set to VLAN 1.</p>
</div>
</div>
<div class="section" id="voice-vlan-tagging">
<h4>Voice VLAN Tagging<a class="headerlink" href="#voice-vlan-tagging" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/voice_vlan_tagging.png" src="nw/_static/img/voice_vlan_tagging.png" />
<ul class="simple">
<li>Port 1 connects to the switch or other VoIP device.</li>
<li>Port 2 is an internal 10/100 interface that carries the IP phone traffic.</li>
<li>Port 3 (access port) connects to a PC or other device.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An access port that is used to connect a Cisco IP phone can be configured to use two separate VLANs: one VLAN for voice traffic and another VLAN for data traffic from a device attached to the phone. The link between the switch and the IP phone acts as a trunk to carry both voice VLAN traffic and data VLAN traffic.</p>
</div>
<p>On the switch, the access is configured to send Cisco Discovery Protocol (CDP) packets that instruct an attached IP phone to send voice traffic to the switch in one of three ways, depending on the type of traffic:</p>
<ul class="simple">
<li>voice VLAN tagged with a Layer 2 class of service (CoS) priority value</li>
<li>access VLAN tagged with a Layer 2 CoS priority value</li>
<li>access VLAN, untagged (no Layer 2 CoS priority value)</li>
</ul>
</div>
<div class="section" id="q-tagging">
<h4>802.1Q tagging<a class="headerlink" href="#q-tagging" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="19%" />
<col width="16%" />
<col width="21%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="4">802.1Q tag format</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>16 bits</td>
<td>3 bits</td>
<td>1 bit</td>
<td>12 bits</td>
</tr>
<tr class="row-odd"><td rowspan="2">TPID</td>
<td colspan="3">TCI</td>
</tr>
<tr class="row-even"><td>PCP</td>
<td>DEI</td>
<td>VID</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">Tag protocol identifier (TPID): a 16-bit field set to a value of 0x8100 in order to identify the frame as an IEEE 802.1Q-tagged frame. This field is located at the same position as the EtherType/length field in untagged frames, and is thus used to distinguish the frame from untagged frames.</p>
</li>
<li><p class="first">Tag control information (TCI)
* Priority code point (PCP): a 3-bit field which refers to the <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_802.1p">IEEE 802.1p</a> <a class="reference external" href="https://en.wikipedia.org/wiki/Class_of_service">class of service</a> and maps to the frame priority level.</p>
<ul>
<li><p class="first">PCP values in order of priority are:</p>
<ul>
<li><p class="first">1 (background)</p>
</li>
<li><p class="first">0 (best effort, default)</p>
</li>
<li><p class="first">2 (excellent effort)</p>
</li>
<li><p class="first">3 (critical application)</p>
</li>
<li><p class="first">4 (video)</p>
</li>
<li><p class="first">5 (voice)</p>
</li>
<li><p class="first">6 (internetwork control)</p>
</li>
<li><p class="first">7 (network control)</p>
<p>These values can be used to prioritize different classes of traffic.</p>
</li>
</ul>
</li>
<li><p class="first">Drop eligible indicator (DEI): a 1-bit field. (formerly CFI[b]) May be used separately or in conjunction with PCP to indicate frames eligible to be dropped in the presence of congestion.</p>
</li>
<li><p class="first">VLAN identifier (VID): a 12-bit field specifying the VLAN to which the frame belongs. The hexadecimal values of 0x000 and 0xFFF are reserved. All other values may be used as VLAN identifiers, allowing up to 4,094 VLANs. The reserved value 0x000 indicates that the frame does not carry a VLAN ID; in this case, the 802.1Q tag specifies only a priority and is referred to as a priority tag. On bridges, VID 0x001 (the default VLAN ID) is often reserved for a management VLAN; this is vendor-specific. The VID value 0xFFF is reserved for implementation use; it must not be configured or transmitted. 0xFFF can be used to indicate a wildcard match in management operations or filtering database entries.</p>
</li>
</ul>
</li>
</ul>
<p>For frames using <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_802.2">IEEE 802.2</a>/<a class="reference external" href="https://en.wikipedia.org/wiki/Subnetwork_Access_Protocol">SNAP</a> encapsulation with an organizationally unique identifier (OUI) field of 00-00-00 (so that the protocol ID field in the SNAP header is an EtherType), as would be the case on LANs other than Ethernet, the EtherType value in the SNAP header is set to 0x8100 and the aforementioned extra 4 bytes are appended after the SNAP header.[citation needed]</p>
<p>Because inserting the VLAN tag changes the frame, 802.1Q encapsulation forces a recalculation of the original frame check sequence field in the Ethernet trailer.</p>
<p>The IEEE 802.3ac standard increased the maximum Ethernet frame size from 1518 bytes to 1522 bytes to accommodate the four-byte VLAN tag. Some network devices that do not support the larger frame size will process these frames successfully, but may report them as “baby giant” anomalies.</p>
<p>QinQ allows multiple VLAN tags in an Ethernet frame; together these tags constitute a tag stack. When used in the context of an Ethernet frame, a QinQ frame is a frame that has 2 VLAN 802.1Q headers (double-tagged).
<a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_802.1ad">802.1ad QinQ</a>
The idea is to provide, for example, the possibility for customers to run their own VLANs inside service provider’s provided VLAN. This way the service provider can just configure one VLAN for the customer and customer can then treat that VLAN as if it were a trunk.</p>
<p><code class="docutils literal"><span class="pre">show</span> <span class="pre">interfaces</span> <span class="pre">fa0/18</span> <span class="pre">switchport</span></code></p>
<p><code class="docutils literal"><span class="pre">show</span> <span class="pre">vlan</span> <span class="pre">brief</span></code></p>
</div>
<div class="section" id="vlan-ranges">
<h4>VLAN Ranges<a class="headerlink" href="#vlan-ranges" title="Permalink to this headline">¶</a></h4>
<div class="section" id="normal-range">
<h5>normal range<a class="headerlink" href="#normal-range" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt>1, 1002 - 1005:</dt>
<dd>Default Vlan, reserved for token ring &amp; fiber distributed data interface (FDDI) Vlans</dd>
<dt>Configuration:</dt>
<dd>Stored in VLAN database file called vlan.dat located in flash memory of switch</dd>
<dt>VTP:</dt>
<dd>can only store normal range VLANs</dd>
</dl>
</div>
<div class="section" id="extended-range">
<h5>extended range<a class="headerlink" href="#extended-range" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>big corporations need extended VLAN Ids</li>
<li>are identified as between <strong>1006 - 4094</strong></li>
<li>cfgs <strong>note written to vlan.dat</strong></li>
<li>support fewer features than normal range</li>
<li>saved by default in running config</li>
<li><strong>VTP doesn’t learn extended range VLANs</strong></li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you need to use extended range VLANs and you switch does not support VTPv3, then you would need to set the mode to transparent for VTP, which technically means that you are still using VTP, but you are not learning any VTP information from other VTP enabled devices.
With VTPv3 you can use the extended range VLANs by setting the mode to server, client, transparent or off, because VTPv3 does support the extended range VLANs.</p>
</div>
</div>
</div>
<div class="section" id="configuring-vlans">
<h4>Configuring VLANS<a class="headerlink" href="#configuring-vlans" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># configure terminal</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface F0/18</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport mode access</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport access vlan 20</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use the <strong>switchport voice vlan 150</strong> command</p>
</div>
<p>Voice traffic must be labeled as trusted as soon as it enters the network. Use the ** mls qos trust[cos | device cisco-phone | dscp | ip-precedence] ** interface configuration command</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># vlan 20</span>
<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># name student</span>
<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># vlan 150</span>
<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># name VOICE</span>
<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#</span>
<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface fa0/18</span>
<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport mode access</span>
<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport access vlan 20</span>
<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># mls qos trust cos</span>
<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport voice vlan 150</span>
<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">S3</span><span class="c1">#</span>
</pre></div>
</div>
<div class="section" id="configure-optional-parameters">
<h5>configure optional parameters<a class="headerlink" href="#configure-optional-parameters" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">switch</span><span class="c1"># configure terminal</span>
<span class="n">switch</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># vlan 5</span>
<span class="n">switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># name accounting</span>
<span class="n">switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># state active</span>
<span class="n">switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># no shutdown</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-ports-to-a-vlan">
<h5>adding ports to a VLAN<a class="headerlink" href="#adding-ports-to-a-vlan" title="Permalink to this headline">¶</a></h5>
<p>This example shows how to configure an Ethernet interface to join VLAN 5</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">switch</span><span class="c1"># configure terminal</span>
<span class="n">switch</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface ethernet 1/13</span>
<span class="n">switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport access vlan 5</span>
</pre></div>
</div>
</div>
<div class="section" id="verifying-vlan-configuration">
<h5>Verifying VLAN configuration<a class="headerlink" href="#verifying-vlan-configuration" title="Permalink to this headline">¶</a></h5>
<p>show all VLANs defined in the range of 1-21</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">switch</span><span class="c1"># show running-config vlan 1-21</span>
<span class="n">version</span> <span class="mf">4.0</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">vlan</span> <span class="mi">1</span>
<span class="n">vlan</span> <span class="mi">5</span>
</pre></div>
</div>
<p>show the VLANs created on switch and their status</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">switch</span><span class="c1"># show vlan</span>

<span class="n">VLAN</span> <span class="n">Name</span> <span class="n">Status</span> <span class="n">Ports</span>
<span class="o">----</span> <span class="o">--------------------------------</span> <span class="o">---------</span> <span class="o">-------------------------------</span>
<span class="mi">1</span> <span class="n">default</span> <span class="n">active</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">4</span>
<span class="n">Eth1</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">7</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">8</span>
<span class="n">Eth1</span><span class="o">/</span><span class="mi">9</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">11</span>
<span class="n">Eth1</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">15</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">16</span>
<span class="n">Eth1</span><span class="o">/</span><span class="mi">17</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">18</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">19</span>
<span class="n">Eth1</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">21</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">22</span>
<span class="n">Eth1</span><span class="o">/</span><span class="mi">23</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">24</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">25</span>
<span class="n">Eth1</span><span class="o">/</span><span class="mi">26</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">27</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">28</span>
<span class="n">Eth1</span><span class="o">/</span><span class="mi">29</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">30</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">31</span>
<span class="n">Eth1</span><span class="o">/</span><span class="mi">32</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">33</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">34</span>
<span class="n">Eth1</span><span class="o">/</span><span class="mi">35</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">36</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">37</span>
<span class="n">Eth1</span><span class="o">/</span><span class="mi">38</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">39</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">40</span>
<span class="n">Eth3</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">Eth3</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Eth3</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">Eth3</span><span class="o">/</span><span class="mi">4</span>
<span class="n">veth1</span><span class="o">/</span><span class="mi">1</span>
<span class="mi">13</span> <span class="n">VLAN0005</span> <span class="n">active</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">13</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">14</span>
</pre></div>
</div>
<p>shows the details of VLAN 13 including its member ports</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">switch</span><span class="c1"># show vlan id 13</span>

<span class="n">VLAN</span> <span class="n">Name</span> <span class="n">Status</span> <span class="n">Ports</span>
<span class="o">----</span> <span class="o">--------------------------------</span> <span class="o">---------</span> <span class="o">-------------------------------</span>
<span class="mi">13</span> <span class="n">VLAN0005</span> <span class="n">active</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">13</span><span class="p">,</span> <span class="n">Eth1</span><span class="o">/</span><span class="mi">14</span>


<span class="n">VLAN</span> <span class="n">Type</span> <span class="n">MTU</span>
<span class="o">----</span> <span class="o">-----</span> <span class="o">-----</span>
<span class="mi">13</span> <span class="n">enet</span> <span class="mi">576</span>

<span class="n">Remote</span> <span class="n">SPAN</span> <span class="n">VLAN</span>
<span class="o">----------------</span>
<span class="n">Disabled</span>

<span class="n">Primary</span> <span class="n">Secondary</span> <span class="n">Type</span> <span class="n">Ports</span>
<span class="o">------</span> <span class="o">---------</span> <span class="o">---------------</span> <span class="o">-------------------------------------------</span>
</pre></div>
</div>
<p>show the VLAN settings summary</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">switch</span><span class="c1"># show vlan summary</span>

<span class="n">Number</span> <span class="n">of</span> <span class="n">existing</span> <span class="n">VLANs</span> <span class="p">:</span> <span class="mi">2</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">existing</span> <span class="n">VTP</span> <span class="n">VLANs</span> <span class="p">:</span> <span class="mi">2</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">existing</span> <span class="n">extended</span> <span class="n">VLANs</span> <span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="remove-vlan-assignment">
<h5>remove VLAN Assignment<a class="headerlink" href="#remove-vlan-assignment" title="Permalink to this headline">¶</a></h5>
<p>Interface F0/18 was previously assigned to VLAN 20. The no switchport access vlan command is entered for interface F0/18</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># configure terminal</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface F0/18</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no switchport access vlan</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">VLAN 20 is still active even if no ports are assigned to it</p>
</div>
<p><code class="docutils literal"><span class="pre">S1#</span> <span class="pre">show</span> <span class="pre">interfaces</span> <span class="pre">F0/18</span> <span class="pre">switchport</span></code> -&gt; verifies that access VLAN for F0/18 has been reset to VLAN 1</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is not necessary to first remove a port from a VLAN to change its VLAN membership. When an access port has its VLAN membership reassigned to another existing VLAN, the new VLAN membership simply replaces the previous VLAN membership. In Figure 4, port F0/11 is assigned to VLAN 20.</p>
</div>
</div>
</div>
<div class="section" id="deleting-vlans">
<h4>deleting VLANs<a class="headerlink" href="#deleting-vlans" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># conf t</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no vlan 20</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">S1</span><span class="c1"># show vlan brief</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Before deleting a VLAN, reassign all member ports to a different VLAN first. Any ports that are not moved to an active VLAN are unable to communicate with other hosts after the VLAN is deleted and until they are assigned to an active VLAN</p>
</div>
<p>Alternatively, the entire vlan.dat file can be deleted using the <code class="docutils literal"><span class="pre">S1#</span> <span class="pre">delete</span> <span class="pre">flash:vlan.dat</span></code> command or <code class="docutils literal"><span class="pre">delete</span> <span class="pre">vlan.dat</span></code> if on other location.</p>
</div>
<div class="section" id="verifying-vlan-info">
<h4>verifying VLAN info<a class="headerlink" href="#verifying-vlan-info" title="Permalink to this headline">¶</a></h4>
<p><strong>show vlan summary</strong>
<strong>show vlan name student</strong>
<strong>show interfaces vlan 20</strong>
<strong>show interfaces F0/18 switchport</strong></p>
</div>
<div class="section" id="trunk-configuration">
<h4>TRUNK Configuration<a class="headerlink" href="#trunk-configuration" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">switchport</span> <span class="n">mode</span> <span class="n">trunk</span>
<span class="n">switchport</span> <span class="n">trunk</span> <span class="n">native</span> <span class="n">vlan</span> <span class="mi">99</span>
<span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">99</span>
<span class="n">end</span>
</pre></div>
</div>
<div class="section" id="resetting-trunk-to-default-state">
<h5>Resetting Trunk to Default state<a class="headerlink" href="#resetting-trunk-to-default-state" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">configure</span> <span class="n">terminal</span>
<span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">no</span> <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span>
<span class="n">no</span> <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">native</span> <span class="n">vlan</span>
<span class="n">end</span>

<span class="n">Verify</span> <span class="n">the</span> <span class="n">trunk</span> <span class="n">configuration</span> <span class="k">with</span>

<span class="n">show</span> <span class="n">interfaces</span> <span class="n">f0</span><span class="o">/</span><span class="mi">1</span> <span class="n">switchport</span> <span class="n">command</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="excercise">
<h5>excercise<a class="headerlink" href="#excercise" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span>S3#conf t
S3(config)#do show vlan brief

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                                Fa0/5, Fa0/7, Fa0/8, Fa0/9
                                                Fa0/10, Fa0/12, Fa0/13, Fa0/14
                                                Fa0/15, Fa0/16, Fa0/17, Fa0/19
                                                Fa0/20, Fa0/21, Fa0/22, Fa0/23
                                                Fa0/24, Gig0/1, Gig0/2
10   Faculty/Staff                    active    Fa0/11
20   Students                         active    Fa0/18
30   Guest(Default)                   active    Fa0/6
88   Management                       active
99   Native                           active
1002 fddi-default                     active
1003 token-ring-default               active
1004 fddinet-default                  active
1005 trnet-default                    active
S3(config)#
S3(config)#interface Gig0/2
S3(config-if)#switchport mode trunk
S3(config-if)#switchport trunk native vlan 99
S3(config-if)#s%SPANTREE-2-UNBLOCK_CONSIST_PORT: Unblocking GigabitEthernet0/2 on VLAN0099. Port consistency restored.

%SPANTREE-2-UNBLOCK_CONSIST_PORT: Unblocking GigabitEthernet0/2 on VLAN0001. Port consistency restored.
switc
S3(config-if)#switchport nat
S3(config-if)#switchport native vl
S3(config-if)#switchport native vlan 99
S3(config-if)#show inter
S3(config-if)#exit
S3(config)#exit
S3#
show interface trunk
Port        Mode         Encapsulation  Status        Native vlan
Gig0/2      on           802.1q         trunking      99

Port        Vlans allowed on trunk
Gig0/2      1-1005

Port        Vlans allowed and active in management domain
Gig0/2      1,10,20,30,88,99

Port        Vlans in spanning tree forwarding state and not pruned
Gig0/2      1,10,20,30,88,99

S3#show vlan brief

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                                Fa0/5, Fa0/7, Fa0/8, Fa0/9
                                                Fa0/10, Fa0/12, Fa0/13, Fa0/14
                                                Fa0/15, Fa0/16, Fa0/17, Fa0/19
                                                Fa0/20, Fa0/21, Fa0/22, Fa0/23
                                                Fa0/24, Gig0/1
10   Faculty/Staff                    active    Fa0/11
20   Students                         active    Fa0/18
30   Guest(Default)                   active    Fa0/6
88   Management                       active
99   Native                           active
1002 fddi-default                     active
1003 token-ring-default               active
1004 fddinet-default                  active
1005 trnet-default                    active
S3#show interfaces GigabitEthernet 0/1
GigabitEthernet0/1 is down, line protocol is down (disabled)
  Hardware is Lance, address is 00d0.9766.3301 (bia 00d0.9766.3301)
 BW 1000000 Kbit, DLY 1000 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation ARPA, loopback not set
  Keepalive set (10 sec)
  Full-duplex, 1000Mb/s
  input flow-control is off, output flow-control is off
  ARP type: ARPA, ARP Timeout 04:00:00
  Last input 00:00:08, output 00:00:05, output hang never
  Last clearing of &quot;show interface&quot; counters never
  Input queue: 0/75/0/0 (size/max/drops/flushes); Total output drops: 0
  Queueing strategy: fifo
  Output queue :0/40 (size/max)
  5 minute input rate 0 bits/sec, 0 packets/sec
  5 minute output rate 0 bits/sec, 0 packets/sec
     956 packets input, 193351 bytes, 0 no buffer
     Received 956 broadcasts, 0 runts, 0 giants, 0 throttles
     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored, 0 abort
     0 watchdog, 0 multicast, 0 pause input
     0 input packets with dribble condition detected
     2357 packets output, 263570 bytes, 0 underruns

S3#show interfaces GigabitEthernet 0/1 switchport
Name: Gig0/1
Switchport: Enabled
Administrative Mode: dynamic auto
Operational Mode: down
Administrative Trunking Encapsulation: dot1q
Operational Trunking Encapsulation: native
Negotiation of Trunking: On
Access Mode VLAN: 1 (default)
Trunking Native Mode VLAN: 1 (default)
Voice VLAN: none
Administrative private-vlan host-association: none
Administrative private-vlan mapping: none
Administrative private-vlan trunk native VLAN: none
Administrative private-vlan trunk encapsulation: dot1q
Administrative private-vlan trunk normal VLANs: none
Administrative private-vlan trunk private VLANs: none
Operational private-vlan: none
Trunking VLANs Enabled: ALL
Pruning VLANs Enabled: 2-1001
Capture Mode Disabled
Capture VLANs Allowed: ALL
Protected: false
Appliance trust: none

on switch 1 running config
--------------------------
interface GigabitEthernet0/1
 switchport trunk native vlan 99
 switchport trunk allowed vlan 10,20,30,99
 switchport mode trunk
!
interface GigabitEthernet0/2
 switchport trunk native vlan 99
 switchport trunk allowed vlan 10,20,30,99
 switchport mode trunk
</pre></div>
</div>
</div>
<div class="section" id="verify-commands">
<h5>Verify commands<a class="headerlink" href="#verify-commands" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1">#show vlan brief</span>

<span class="n">VLAN</span> <span class="n">Name</span>                             <span class="n">Status</span>    <span class="n">Ports</span>
<span class="o">----</span> <span class="o">--------------------------------</span> <span class="o">---------</span> <span class="o">-------------------------------</span>
<span class="mi">1</span>    <span class="n">default</span>                          <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">4</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">7</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">8</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">9</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">11</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">12</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">13</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">14</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">15</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">16</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">17</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">18</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">19</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">20</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">21</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">22</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">23</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">24</span>
<span class="mi">10</span>   <span class="n">Faculty</span><span class="o">/</span><span class="n">Staff</span>                    <span class="n">active</span>
<span class="mi">20</span>   <span class="n">Students</span>                         <span class="n">active</span>
<span class="mi">30</span>   <span class="n">Guest</span><span class="p">(</span><span class="n">Default</span><span class="p">)</span>                   <span class="n">active</span>
<span class="mi">88</span>   <span class="n">Management</span>                       <span class="n">active</span>
<span class="mi">99</span>   <span class="n">Native</span>                           <span class="n">active</span>
<span class="mi">1002</span> <span class="n">fddi</span><span class="o">-</span><span class="n">default</span>                     <span class="n">active</span>
<span class="mi">1003</span> <span class="n">token</span><span class="o">-</span><span class="n">ring</span><span class="o">-</span><span class="n">default</span>               <span class="n">active</span>
<span class="mi">1004</span> <span class="n">fddinet</span><span class="o">-</span><span class="n">default</span>                  <span class="n">active</span>
<span class="mi">1005</span> <span class="n">trnet</span><span class="o">-</span><span class="n">default</span>                    <span class="n">active</span>
<span class="n">S1</span><span class="c1">#show vt</span>
<span class="n">S1</span><span class="c1">#show vtp ?</span>
  <span class="n">counters</span>  <span class="n">VTP</span> <span class="n">statistics</span>
  <span class="n">password</span>  <span class="n">VTP</span> <span class="n">password</span>
  <span class="n">status</span>    <span class="n">VTP</span> <span class="n">domain</span> <span class="n">status</span>

<span class="n">S1</span><span class="c1">#show vtp status</span>

<span class="n">VTP</span> <span class="n">Version</span>                     <span class="p">:</span> <span class="mi">2</span>
<span class="n">Configuration</span> <span class="n">Revision</span>          <span class="p">:</span> <span class="mi">12</span>
<span class="n">Maximum</span> <span class="n">VLANs</span> <span class="n">supported</span> <span class="n">locally</span> <span class="p">:</span> <span class="mi">255</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">existing</span> <span class="n">VLANs</span>        <span class="p">:</span> <span class="mi">10</span>
<span class="n">VTP</span> <span class="n">Operating</span> <span class="n">Mode</span>              <span class="p">:</span> <span class="n">Server</span>
<span class="n">VTP</span> <span class="n">Domain</span> <span class="n">Name</span>                 <span class="p">:</span>
<span class="n">VTP</span> <span class="n">Pruning</span> <span class="n">Mode</span>                <span class="p">:</span> <span class="n">Disabled</span>
<span class="n">VTP</span> <span class="n">V2</span> <span class="n">Mode</span>                     <span class="p">:</span> <span class="n">Disabled</span>
<span class="n">VTP</span> <span class="n">Traps</span> <span class="n">Generation</span>            <span class="p">:</span> <span class="n">Disabled</span>
<span class="n">MD5</span> <span class="n">digest</span>                      <span class="p">:</span> <span class="mh">0xD9</span> <span class="mh">0x37</span> <span class="mh">0x14</span> <span class="mh">0xE2</span> <span class="mh">0xAF</span> <span class="mh">0x1D</span> <span class="mh">0x1E</span> <span class="mh">0x38</span>
<span class="n">Configuration</span> <span class="n">last</span> <span class="n">modified</span> <span class="n">by</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="n">at</span> <span class="mi">3</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">93</span> <span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">36</span>
<span class="n">Local</span> <span class="n">updater</span> <span class="n">ID</span> <span class="ow">is</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="p">(</span><span class="n">no</span> <span class="n">valid</span> <span class="n">interface</span> <span class="n">found</span><span class="p">)</span>

<span class="n">S1</span><span class="c1">#show interfaces trunk</span>

<span class="n">Port</span>        <span class="n">Mode</span>         <span class="n">Encapsulation</span>  <span class="n">Status</span>        <span class="n">Native</span> <span class="n">vlan</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>      <span class="n">on</span>           <span class="mf">802.1</span><span class="n">q</span>         <span class="n">trunking</span>      <span class="mi">99</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">2</span>      <span class="n">on</span>           <span class="mf">802.1</span><span class="n">q</span>         <span class="n">trunking</span>      <span class="mi">99</span>

<span class="n">Port</span>        <span class="n">Vlans</span> <span class="n">allowed</span> <span class="n">on</span> <span class="n">trunk</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>      <span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">99</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">2</span>      <span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">99</span>

<span class="n">Port</span>        <span class="n">Vlans</span> <span class="n">allowed</span> <span class="ow">and</span> <span class="n">active</span> <span class="ow">in</span> <span class="n">management</span> <span class="n">domain</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>      <span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">99</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">2</span>      <span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">99</span>

<span class="n">Port</span>        <span class="n">Vlans</span> <span class="ow">in</span> <span class="n">spanning</span> <span class="n">tree</span> <span class="n">forwarding</span> <span class="n">state</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pruned</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>      <span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">99</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">2</span>      <span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">99</span>

<span class="n">S1</span><span class="c1">#show interface Gig0/1 switchport</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Switchport</span><span class="p">:</span> <span class="n">Enabled</span>
<span class="n">Administrative</span> <span class="n">Mode</span><span class="p">:</span> <span class="n">trunk</span>
<span class="n">Operational</span> <span class="n">Mode</span><span class="p">:</span> <span class="n">trunk</span>
<span class="n">Administrative</span> <span class="n">Trunking</span> <span class="n">Encapsulation</span><span class="p">:</span> <span class="n">dot1q</span>
<span class="n">Operational</span> <span class="n">Trunking</span> <span class="n">Encapsulation</span><span class="p">:</span> <span class="n">dot1q</span>
<span class="n">Negotiation</span> <span class="n">of</span> <span class="n">Trunking</span><span class="p">:</span> <span class="n">On</span>
<span class="n">Access</span> <span class="n">Mode</span> <span class="n">VLAN</span><span class="p">:</span> <span class="mi">1</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
<span class="n">Trunking</span> <span class="n">Native</span> <span class="n">Mode</span> <span class="n">VLAN</span><span class="p">:</span> <span class="mi">99</span> <span class="p">(</span><span class="n">Native</span><span class="p">)</span>
<span class="n">Voice</span> <span class="n">VLAN</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Administrative</span> <span class="n">private</span><span class="o">-</span><span class="n">vlan</span> <span class="n">host</span><span class="o">-</span><span class="n">association</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Administrative</span> <span class="n">private</span><span class="o">-</span><span class="n">vlan</span> <span class="n">mapping</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Administrative</span> <span class="n">private</span><span class="o">-</span><span class="n">vlan</span> <span class="n">trunk</span> <span class="n">native</span> <span class="n">VLAN</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Administrative</span> <span class="n">private</span><span class="o">-</span><span class="n">vlan</span> <span class="n">trunk</span> <span class="n">encapsulation</span><span class="p">:</span> <span class="n">dot1q</span>
<span class="n">Administrative</span> <span class="n">private</span><span class="o">-</span><span class="n">vlan</span> <span class="n">trunk</span> <span class="n">normal</span> <span class="n">VLANs</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Administrative</span> <span class="n">private</span><span class="o">-</span><span class="n">vlan</span> <span class="n">trunk</span> <span class="n">private</span> <span class="n">VLANs</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Operational</span> <span class="n">private</span><span class="o">-</span><span class="n">vlan</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Trunking</span> <span class="n">VLANs</span> <span class="n">Enabled</span><span class="p">:</span> <span class="n">ALL</span>
<span class="n">Pruning</span> <span class="n">VLANs</span> <span class="n">Enabled</span><span class="p">:</span> <span class="mi">2</span><span class="o">-</span><span class="mi">1001</span>
<span class="n">Capture</span> <span class="n">Mode</span> <span class="n">Disabled</span>
<span class="n">Capture</span> <span class="n">VLANs</span> <span class="n">Allowed</span><span class="p">:</span> <span class="n">ALL</span>
<span class="n">Protected</span><span class="p">:</span> <span class="n">false</span>
<span class="n">Appliance</span> <span class="n">trust</span><span class="p">:</span> <span class="n">none</span>

<span class="n">S1</span><span class="c1">#show vlan</span>

<span class="n">VLAN</span> <span class="n">Name</span>                             <span class="n">Status</span>    <span class="n">Ports</span>
<span class="o">----</span> <span class="o">--------------------------------</span> <span class="o">---------</span> <span class="o">-------------------------------</span>
<span class="mi">1</span>    <span class="n">default</span>                          <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">4</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">7</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">8</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">9</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">11</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">12</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">13</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">14</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">15</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">16</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">17</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">18</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">19</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">20</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">21</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">22</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">23</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">24</span>
<span class="mi">10</span>   <span class="n">Faculty</span><span class="o">/</span><span class="n">Staff</span>                    <span class="n">active</span>
<span class="mi">20</span>   <span class="n">Students</span>                         <span class="n">active</span>
<span class="mi">30</span>   <span class="n">Guest</span><span class="p">(</span><span class="n">Default</span><span class="p">)</span>                   <span class="n">active</span>
<span class="mi">88</span>   <span class="n">Management</span>                       <span class="n">active</span>
<span class="mi">99</span>   <span class="n">Native</span>                           <span class="n">active</span>
<span class="mi">1002</span> <span class="n">fddi</span><span class="o">-</span><span class="n">default</span>                     <span class="n">act</span><span class="o">/</span><span class="n">unsup</span>
<span class="mi">1003</span> <span class="n">token</span><span class="o">-</span><span class="n">ring</span><span class="o">-</span><span class="n">default</span>               <span class="n">act</span><span class="o">/</span><span class="n">unsup</span>
<span class="mi">1004</span> <span class="n">fddinet</span><span class="o">-</span><span class="n">default</span>                  <span class="n">act</span><span class="o">/</span><span class="n">unsup</span>
<span class="mi">1005</span> <span class="n">trnet</span><span class="o">-</span><span class="n">default</span>                    <span class="n">act</span><span class="o">/</span><span class="n">unsup</span>

<span class="n">VLAN</span> <span class="n">Type</span>  <span class="n">SAID</span>       <span class="n">MTU</span>   <span class="n">Parent</span> <span class="n">RingNo</span> <span class="n">BridgeNo</span> <span class="n">Stp</span>  <span class="n">BrdgMode</span> <span class="n">Trans1</span> <span class="n">Trans2</span>
<span class="o">----</span> <span class="o">-----</span> <span class="o">----------</span> <span class="o">-----</span> <span class="o">------</span> <span class="o">------</span> <span class="o">--------</span> <span class="o">----</span> <span class="o">--------</span> <span class="o">------</span> <span class="o">------</span>
<span class="mi">1</span>    <span class="n">enet</span>  <span class="mi">100001</span>     <span class="mi">1500</span>  <span class="o">-</span>      <span class="o">-</span>      <span class="o">-</span>        <span class="o">-</span>    <span class="o">-</span>        <span class="mi">0</span>      <span class="mi">0</span>
<span class="mi">10</span>   <span class="n">enet</span>  <span class="mi">100010</span>     <span class="mi">1500</span>  <span class="o">-</span>      <span class="o">-</span>      <span class="o">-</span>        <span class="o">-</span>    <span class="o">-</span>        <span class="mi">0</span>      <span class="mi">0</span>
<span class="mi">20</span>   <span class="n">enet</span>  <span class="mi">100020</span>     <span class="mi">1500</span>  <span class="o">-</span>      <span class="o">-</span>      <span class="o">-</span>        <span class="o">-</span>    <span class="o">-</span>        <span class="mi">0</span>      <span class="mi">0</span>
<span class="mi">30</span>   <span class="n">enet</span>  <span class="mi">100030</span>     <span class="mi">1500</span>  <span class="o">-</span>      <span class="o">-</span>      <span class="o">-</span>        <span class="o">-</span>    <span class="o">-</span>        <span class="mi">0</span>      <span class="mi">0</span>
<span class="mi">88</span>   <span class="n">enet</span>  <span class="mi">100088</span>     <span class="mi">1500</span>  <span class="o">-</span>      <span class="o">-</span>      <span class="o">-</span>        <span class="o">-</span>    <span class="o">-</span>        <span class="mi">0</span>      <span class="mi">0</span>
<span class="mi">99</span>   <span class="n">enet</span>  <span class="mi">100099</span>     <span class="mi">1500</span>  <span class="o">-</span>      <span class="o">-</span>      <span class="o">-</span>        <span class="o">-</span>    <span class="o">-</span>        <span class="mi">0</span>      <span class="mi">0</span>
<span class="mi">1002</span> <span class="n">fddi</span>  <span class="mi">101002</span>     <span class="mi">1500</span>  <span class="o">-</span>      <span class="o">-</span>      <span class="o">-</span>        <span class="o">-</span>    <span class="o">-</span>        <span class="mi">0</span>      <span class="mi">0</span>
<span class="mi">1003</span> <span class="n">tr</span>    <span class="mi">101003</span>     <span class="mi">1500</span>  <span class="o">-</span>      <span class="o">-</span>      <span class="o">-</span>        <span class="o">-</span>    <span class="o">-</span>        <span class="mi">0</span>      <span class="mi">0</span>
<span class="mi">1004</span> <span class="n">fdnet</span> <span class="mi">101004</span>     <span class="mi">1500</span>  <span class="o">-</span>      <span class="o">-</span>      <span class="o">-</span>        <span class="n">ieee</span> <span class="o">-</span>        <span class="mi">0</span>      <span class="mi">0</span>
<span class="mi">1005</span> <span class="n">trnet</span> <span class="mi">101005</span>     <span class="mi">1500</span>  <span class="o">-</span>      <span class="o">-</span>      <span class="o">-</span>        <span class="n">ibm</span>  <span class="o">-</span>        <span class="mi">0</span>      <span class="mi">0</span>

<span class="n">VLAN</span> <span class="n">Type</span>  <span class="n">SAID</span>       <span class="n">MTU</span>   <span class="n">Parent</span> <span class="n">RingNo</span> <span class="n">BridgeNo</span> <span class="n">Stp</span>  <span class="n">BrdgMode</span> <span class="n">Trans1</span> <span class="n">Trans2</span>
<span class="o">----</span> <span class="o">-----</span> <span class="o">----------</span> <span class="o">-----</span> <span class="o">------</span> <span class="o">------</span> <span class="o">--------</span> <span class="o">----</span> <span class="o">--------</span> <span class="o">------</span> <span class="o">------</span>

<span class="n">Remote</span> <span class="n">SPAN</span> <span class="n">VLANs</span>
<span class="o">------------------------------------------------------------------------------</span>

<span class="n">Primary</span> <span class="n">Secondary</span> <span class="n">Type</span>              <span class="n">Ports</span>
<span class="o">-------</span> <span class="o">---------</span> <span class="o">-----------------</span> <span class="o">------------------------------------------</span>
<span class="n">S1</span><span class="c1">#</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="combination-exercise">
<h4>combination exercise<a class="headerlink" href="#combination-exercise" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/vlan_and_vtps_exercise.png" src="nw/_static/img/vlan_and_vtps_exercise.png" />
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="17%" />
<col width="22%" />
<col width="23%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>S1</td>
<td>VLAN 1</td>
<td>192.168.1.11</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>S2</td>
<td>VLAN 1</td>
<td>192.168.1.12</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>PC-A</td>
<td>NIC</td>
<td>192.168.10.3</td>
<td>255.255.255.0</td>
<td>192.168.10.1</td>
</tr>
<tr class="row-odd"><td>PC-B</td>
<td>NIC</td>
<td>192.168.10.4</td>
<td>255.255.255.0</td>
<td>192.168.10.1</td>
</tr>
<tr class="row-even"><td>PC-C</td>
<td>NIC</td>
<td>192.168.20.3</td>
<td>255.255.255.0</td>
<td>192.168.20.1</td>
</tr>
</tbody>
</table>
<p>basic configuration for switch</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">no</span> <span class="n">ip</span> <span class="n">domain</span><span class="o">-</span><span class="n">lookup</span>
<span class="n">service</span> <span class="n">password</span><span class="o">-</span><span class="n">encryption</span>
<span class="n">enable</span> <span class="n">secret</span> <span class="k">class</span>
<span class="nc">banner</span> <span class="n">motd</span> <span class="c1">#</span>
<span class="n">Unauthorized</span> <span class="n">access</span> <span class="ow">is</span> <span class="n">strictly</span> <span class="n">prohibited</span><span class="o">.</span> <span class="c1">#</span>
<span class="n">line</span> <span class="n">con</span> <span class="mi">0</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
<span class="n">logging</span> <span class="n">synchronous</span>
<span class="n">line</span> <span class="n">vty</span> <span class="mi">0</span> <span class="mi">15</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">logging</span> <span class="n">synchronous</span>
<span class="n">login</span>
<span class="n">exit</span>
</pre></div>
</div>
<p>create VLANs on switches</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># vlan 10</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># name Student</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># vlan 20</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># name Faculty</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># vlan 99</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># name Management</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># end</span>
</pre></div>
</div>
<p>Assign VLANs to the interfaces</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface f0/6</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport mode access</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport access vlan 10</span>

<span class="n">Move</span> <span class="n">the</span> <span class="n">switch</span> <span class="n">IP</span> <span class="n">address</span> <span class="n">VLAN</span> <span class="mf">99.</span>

<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface vlan 1</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no ip address</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># interface vlan 99</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 192.168.1.11 255.255.255.0</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
</pre></div>
</div>
<p>Assign a VLAN to multiple interfaces</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface range f0/11-24</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1"># switchport mode access</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1"># switchport access vlan 10</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1"># end</span>

<span class="n">Use</span> <span class="n">the</span> <span class="n">no</span> <span class="n">switchport</span> <span class="n">access</span> <span class="n">vlan</span> <span class="n">command</span> <span class="n">to</span> <span class="n">remove</span> <span class="n">the</span> <span class="n">VLAN</span> <span class="mi">10</span> <span class="n">assignment</span> <span class="n">to</span> <span class="n">F0</span><span class="o">/</span><span class="mi">24</span>

<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface f0/24</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no switchport access vlan</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>

<span class="n">Add</span> <span class="n">VLAN</span> <span class="mi">30</span> <span class="n">to</span> <span class="n">interface</span> <span class="n">F0</span><span class="o">/</span><span class="mi">24</span> <span class="n">without</span> <span class="n">issuing</span> <span class="n">the</span> <span class="n">VLAN</span> <span class="n">command</span><span class="o">.</span>

<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface f0/24</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport access vlan 30</span>
<span class="o">%</span> <span class="n">Access</span> <span class="n">VLAN</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">exist</span><span class="o">.</span> <span class="n">Creating</span> <span class="n">vlan</span> <span class="mi">30</span>

<span class="n">Use</span> <span class="n">the</span> <span class="n">no</span> <span class="n">vlan</span> <span class="mi">30</span> <span class="n">command</span> <span class="n">to</span> <span class="n">remove</span> <span class="n">VLAN</span> <span class="mi">30</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">VLAN</span> <span class="n">database</span><span class="o">.</span>

<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no vlan 30</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># end</span>

<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Fa0/24</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no switchport access vlan</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Current switch technology no longer requires that the vlan command be issued to add a VLAN to the database. By assigning an unknown VLAN to a port, the VLAN adds to the VLAN database.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Before removing a VLAN from the database, it is recommended that you reassign all the ports assigned to that VLAN</p>
</div>
<p>Configuring Trunks</p>
<p>use the Dynamic Trunking Protocol (DTP) to allow it to negotiate the trunk mode. After this has been accomplished and verified, you will disable DTP on interface F0/1 and manually configure it as a trunk.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Set</span> <span class="n">F0</span><span class="o">/</span><span class="mi">1</span> <span class="n">on</span> <span class="n">S1</span> <span class="n">to</span> <span class="n">negotiate</span> <span class="n">trunk</span> <span class="n">mode</span>

<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface f0/1</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport mode dynamic desirable</span>

<span class="n">Mar</span>  <span class="mi">1</span> <span class="mi">05</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mf">28.746</span><span class="p">:</span> <span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">Vlan1</span><span class="p">,</span> <span class="n">changed</span>
<span class="n">state</span> <span class="n">to</span> <span class="n">down</span>
<span class="n">Mar</span>  <span class="mi">1</span> <span class="mi">05</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mf">29.744</span><span class="p">:</span> <span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span>
<span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">down</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="n">Mar</span>  <span class="mi">1</span> <span class="mi">05</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mf">32.772</span><span class="p">:</span> <span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span>
<span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="o">**</span><span class="n">Mar</span>  <span class="mi">1</span> <span class="mi">05</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">01.789</span><span class="p">:</span> <span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">Vlan99</span><span class="p">,</span> <span class="n">changed</span>
<span class="n">state</span> <span class="n">to</span> <span class="n">up</span><span class="o">**</span>
<span class="n">Mar</span>  <span class="mi">1</span> <span class="mi">05</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">01.797</span><span class="p">:</span> <span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">Vlan1</span><span class="p">,</span> <span class="n">changed</span>
<span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="n">You</span> <span class="n">should</span> <span class="n">also</span> <span class="n">receive</span> <span class="n">link</span> <span class="n">status</span> <span class="n">messages</span> <span class="n">on</span> <span class="n">S2</span><span class="o">.</span>
<span class="n">S2</span><span class="c1">#</span>
<span class="n">Mar</span>  <span class="mi">1</span> <span class="mi">05</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mf">29.794</span><span class="p">:</span> <span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span>
<span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">down</span>
<span class="n">S2</span><span class="c1">#</span>
<span class="n">Mar</span>  <span class="mi">1</span> <span class="mi">05</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mf">32.823</span><span class="p">:</span> <span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span>
<span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="n">S2</span><span class="c1">#</span>
<span class="n">Mar</span>  <span class="mi">1</span> <span class="mi">05</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">01.839</span><span class="p">:</span> <span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">Vlan99</span><span class="p">,</span> <span class="n">changed</span>
<span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="n">Mar</span>  <span class="mi">1</span> <span class="mi">05</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">01.850</span><span class="p">:</span> <span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">Vlan1</span><span class="p">,</span> <span class="n">changed</span>
<span class="n">state</span> <span class="n">to</span> <span class="n">up</span>

<span class="n">on</span> <span class="n">S1</span> <span class="ow">and</span> <span class="n">S2</span><span class="o">.</span> <span class="n">Interface</span> <span class="n">F0</span><span class="o">/</span><span class="mi">1</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">assigned</span> <span class="n">to</span> <span class="n">VLAN</span> <span class="mf">1.</span>
<span class="n">Trunked</span> <span class="n">interfaces</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">listed</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">VLAN</span> <span class="n">table</span>

<span class="n">S1</span><span class="c1"># show vlan brief</span>
<span class="n">VLAN</span> <span class="n">Name</span>                             <span class="n">Status</span>    <span class="n">Ports</span>
<span class="o">----</span> <span class="o">--------------------------------</span> <span class="o">---------</span> <span class="o">-------------------------------</span>
<span class="mi">1</span>    <span class="n">default</span>                          <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">5</span>


<span class="n">S1</span><span class="c1"># show interfaces trunk</span>
<span class="n">Port</span>        <span class="n">Mode</span>             <span class="n">Encapsulation</span>  <span class="n">Status</span>        <span class="n">Native</span> <span class="n">vlan</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>       <span class="n">desirable</span>        <span class="mf">802.1</span><span class="n">q</span>         <span class="n">trunking</span>      <span class="mi">1</span>

<span class="n">Port</span>        <span class="n">Vlans</span> <span class="n">allowed</span> <span class="n">on</span> <span class="n">trunk</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>       <span class="mi">1</span><span class="o">-</span><span class="mi">4094</span>

<span class="n">Port</span>        <span class="n">Vlans</span> <span class="n">allowed</span> <span class="ow">and</span> <span class="n">active</span> <span class="ow">in</span> <span class="n">management</span> <span class="n">domain</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>       <span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">99</span>

<span class="n">Port</span>        <span class="n">Vlans</span> <span class="ow">in</span> <span class="n">spanning</span> <span class="n">tree</span> <span class="n">forwarding</span> <span class="n">state</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pruned</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>       <span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">99</span>

<span class="n">S2</span><span class="c1"># show interfaces trunk</span>
<span class="n">Port</span>        <span class="n">Mode</span>             <span class="n">Encapsulation</span>  <span class="n">Status</span>        <span class="n">Native</span> <span class="n">vlan</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>       <span class="n">auto</span>             <span class="mf">802.1</span><span class="n">q</span>         <span class="n">trunking</span>      <span class="mi">1</span>
<span class="n">Port</span>        <span class="n">Vlans</span> <span class="n">allowed</span> <span class="n">on</span> <span class="n">trunk</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>       <span class="mi">1</span><span class="o">-</span><span class="mi">4094</span>
<span class="n">Port</span>        <span class="n">Vlans</span> <span class="n">allowed</span> <span class="ow">and</span> <span class="n">active</span> <span class="ow">in</span> <span class="n">management</span> <span class="n">domain</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>       <span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">99</span>
<span class="n">Port</span>        <span class="n">Vlans</span> <span class="ow">in</span> <span class="n">spanning</span> <span class="n">tree</span> <span class="n">forwarding</span> <span class="n">state</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pruned</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>       <span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">99</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Change</span> <span class="n">the</span> <span class="n">switchport</span> <span class="n">mode</span> <span class="n">on</span> <span class="n">interface</span> <span class="n">F0</span><span class="o">/</span><span class="mi">1</span> <span class="n">to</span> <span class="n">force</span> <span class="n">trunking</span><span class="o">.</span><span class="n">Make</span> <span class="n">sure</span> <span class="n">to</span> <span class="n">do</span> <span class="n">this</span> <span class="n">on</span> <span class="n">both</span> <span class="n">switches</span><span class="o">.</span>

<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface f0/1</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport mode trunk</span>

<span class="n">Issue</span> <span class="n">the</span> <span class="n">show</span> <span class="n">interfaces</span> <span class="n">trunk</span> <span class="n">command</span> <span class="n">to</span> <span class="n">view</span> <span class="n">the</span> <span class="n">trunk</span> <span class="n">mode</span><span class="o">.</span> <span class="n">Notice</span> <span class="n">that</span> <span class="n">the</span> <span class="n">mode</span> <span class="n">changed</span> <span class="kn">from</span> <span class="nn">desirable</span> <span class="n">to</span> <span class="n">on</span><span class="o">.</span>

<span class="n">S2</span><span class="c1"># show interfaces trunk</span>
<span class="n">Port</span>        <span class="n">Mode</span>             <span class="n">Encapsulation</span>  <span class="n">Status</span>        <span class="n">Native</span> <span class="n">vlan</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>       <span class="n">on</span>               <span class="mf">802.1</span><span class="n">q</span>         <span class="n">trunking</span>      <span class="mi">99</span>
<span class="n">Port</span>        <span class="n">Vlans</span> <span class="n">allowed</span> <span class="n">on</span> <span class="n">trunk</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>       <span class="mi">1</span><span class="o">-</span><span class="mi">4094</span>
<span class="n">Port</span>        <span class="n">Vlans</span> <span class="n">allowed</span> <span class="ow">and</span> <span class="n">active</span> <span class="ow">in</span> <span class="n">management</span> <span class="n">domain</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>       <span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">99</span>
<span class="n">Port</span>        <span class="n">Vlans</span> <span class="ow">in</span> <span class="n">spanning</span> <span class="n">tree</span> <span class="n">forwarding</span> <span class="n">state</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pruned</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>       <span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">99</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, all VLANs are allowed on a trunk. The switchport trunk command allows you to control what VLANs have access to the trunk</p>
</div>
<p>Deleting the vlan</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># show flash</span>
<span class="n">S1</span><span class="c1"># delete vlan.dat</span>
</pre></div>
</div>
</div>
<div class="section" id="troubleshooting-vlans">
<h4>Troubleshooting VLANS<a class="headerlink" href="#troubleshooting-vlans" title="Permalink to this headline">¶</a></h4>
<div class="section" id="ip-address-issue-vlan">
<h5>IP Address issue VLAN<a class="headerlink" href="#ip-address-issue-vlan" title="Permalink to this headline">¶</a></h5>
<p>Each VLAN must correspond to a unique IP subnet. If two devices in the same VLAN have different subnet addresses, they cannot communicate.</p>
</div>
<div class="section" id="missing-vlan">
<h5>Missing VLAN<a class="headerlink" href="#missing-vlan" title="Permalink to this headline">¶</a></h5>
<img alt="nw/_static/img/missing_vlan.png" src="nw/_static/img/missing_vlan.png" />
<p>Use the show vlan command to check whether the port belongs to the expected VLAN. If the port is assigned to the wrong VLAN, use the switchport access vlan command to correct the VLAN membership. Use the show mac address-table command to check which addresses were learned on a particular port of the switch, and to which VLAN that port is assigned, as show in Figure 2.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1">#show mac address-table</span>
          <span class="n">Mac</span> <span class="n">Address</span> <span class="n">Table</span>
<span class="o">-------------------------------------------</span>

<span class="n">Vlan</span>    <span class="n">Mac</span> <span class="n">Address</span>       <span class="n">Type</span>        <span class="n">Ports</span>
<span class="o">----</span>    <span class="o">-----------</span>       <span class="o">--------</span>    <span class="o">-----</span>

   <span class="mi">1</span>    <span class="mi">000</span><span class="n">a</span><span class="o">.</span><span class="n">f333</span><span class="o">.</span><span class="n">b702</span>    <span class="n">DYNAMIC</span>     <span class="n">Gig0</span><span class="o">/</span><span class="mi">2</span>
   <span class="mi">1</span>    <span class="mi">00</span><span class="n">d0</span><span class="o">.</span><span class="mf">5828.2501</span>    <span class="n">DYNAMIC</span>     <span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>
  <span class="mi">10</span>    <span class="mi">00</span><span class="n">d0</span><span class="o">.</span><span class="mf">5828.2501</span>    <span class="n">DYNAMIC</span>     <span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>
  <span class="mi">20</span>    <span class="mi">00</span><span class="n">d0</span><span class="o">.</span><span class="mf">5828.2501</span>    <span class="n">DYNAMIC</span>     <span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>
  <span class="mi">30</span>    <span class="mi">00</span><span class="n">d0</span><span class="o">.</span><span class="mf">5828.2501</span>    <span class="n">DYNAMIC</span>     <span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>
  <span class="mi">56</span>    <span class="mi">000</span><span class="n">a</span><span class="o">.</span><span class="n">f333</span><span class="o">.</span><span class="n">b702</span>    <span class="n">DYNAMIC</span>     <span class="n">Gig0</span><span class="o">/</span><span class="mi">2</span>
  <span class="mi">56</span>    <span class="mi">00</span><span class="n">d0</span><span class="o">.</span><span class="mf">5828.2501</span>    <span class="n">DYNAMIC</span>     <span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>
</pre></div>
</div>
<img alt="nw/_static/img/missing_vlan.png" src="nw/_static/img/missing_vlan.png" />
<p>If the VLAN to which the port is assigned is deleted, the port becomes inactive. The ports of a deleted VLAN will not be listed in the output of the show vlan command. Use the show interfaces switchport command to verify the inactive VLAN is assigned to the port</p>
<ul class="simple">
<li>show vlan</li>
<li>switchport access vlan</li>
<li>show mac address-table</li>
<li>show interfaces switchport</li>
<li>switchport access vlan</li>
<li>show interface f0/1 switchport</li>
<li>no switchport access vlan vlan-id</li>
</ul>
</div>
</div>
<div class="section" id="troubleshooting-trunks">
<h4>Troubleshooting Trunks<a class="headerlink" href="#troubleshooting-trunks" title="Permalink to this headline">¶</a></h4>
<p>most important command <code class="docutils literal"><span class="pre">show</span> <span class="pre">interfaces</span> <span class="pre">trunk</span></code></p>
<img alt="nw/_static/img/troubleshooting_trunks1.png" src="nw/_static/img/troubleshooting_trunks1.png" />
<img alt="nw/_static/img/troubleshooting_trunks2.png" src="nw/_static/img/troubleshooting_trunks2.png" />
<ul class="simple">
<li>Native VLAN mismatches - Trunk ports are configured with different native VLANs. This configuration error generates console notifications, and can cause inter-VLAN routing issues, among other problems. This poses a security risk.</li>
<li>Trunk mode mismatches - One trunk port is configured in a mode that is not compatible for trunking on the corresponding peer port. This configuration error causes the trunk link to stop working. Be sure both sides of the trunk are configured with the switchport mode trunk command. Other trunk configuration commands are beyond the scope of this course.</li>
<li>Allowed VLANs on trunks - The list of allowed VLANs on a trunk has not been updated with the current VLAN trunking requirements. In this situation, unexpected traffic (or no traffic) is being sent over the trunk.</li>
</ul>
<img alt="nw/_static/img/common_problems_trunks.png" src="nw/_static/img/common_problems_trunks.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">start troubleshooting by examining the trunks for a <strong>native VLAN mismatch</strong>. If that is not the cause, check for <strong>trunk mode mismatches</strong>, and finally check for the <strong>allowed VLAN list on the trunk</strong>.</p>
</div>
<p>Mismatched Port Modes</p>
<img alt="nw/_static/img/mismatched_port_modes.png" src="nw/_static/img/mismatched_port_modes.png" />
<p>fixed:</p>
<img alt="nw/_static/img/mismatched_port_modes_fixed.png" src="nw/_static/img/mismatched_port_modes_fixed.png" />
<p>fix incorrect vlan list with</p>
<p>e.g. <code class="docutils literal"><span class="pre">switchport</span> <span class="pre">trunk</span> <span class="pre">allowed</span> <span class="pre">vlan</span> <span class="pre">10,20,99</span></code></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">make sure trunk port is in trunk mode not in access mode!</p>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#switchport mode trunk</span>

<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">down</span>
<span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
</pre></div>
</div>
<div class="section" id="troubleshooting-vlans-2">
<h5>Troubleshooting Vlans 2<a class="headerlink" href="#troubleshooting-vlans-2" title="Permalink to this headline">¶</a></h5>
<p>Packet Tracer – Troubleshooting a VLAN Implementation Scenario 2
6.2.3.8
Addressing Table</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="17%" />
<col width="23%" />
<col width="23%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IPv4 Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>S1</td>
<td>VLAN 56</td>
<td>192.168.56.11</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>S2</td>
<td>VLAN 56</td>
<td>192.168.56.12</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>S3</td>
<td>VLAN 56</td>
<td>192.168.56.13</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>PC1</td>
<td>NIC</td>
<td>192.168.10.21</td>
<td>255.255.255.0</td>
<td>192.168.10.1</td>
</tr>
<tr class="row-even"><td>PC2</td>
<td>NIC</td>
<td>192.168.20.22</td>
<td>255.255.255.0</td>
<td>192.168.20.1</td>
</tr>
<tr class="row-odd"><td>PC3</td>
<td>NIC</td>
<td>192.168.30.23</td>
<td>255.255.255.0</td>
<td>192.168.30.1</td>
</tr>
<tr class="row-even"><td>PC4</td>
<td>NIC</td>
<td>192.168.10.24</td>
<td>255.255.255.0</td>
<td>192.168.10.1</td>
</tr>
<tr class="row-odd"><td>PC5</td>
<td>NIC</td>
<td>192.168.20.25</td>
<td>255.255.255.0</td>
<td>192.168.20.1</td>
</tr>
<tr class="row-even"><td>PC6</td>
<td>NIC</td>
<td>192.168.30.26</td>
<td>255.255.255.0</td>
<td>192.168.30.1</td>
</tr>
</tbody>
</table>
<p>VLAN and Port Assignments</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="48%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ports</th>
<th class="head">VLAN Number - Name</th>
<th class="head">Network</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>F0/1 – F0/5</td>
<td>VLAN 56 – Management&amp;Native</td>
<td>192.168.56.0/24</td>
</tr>
<tr class="row-odd"><td>F0/6 – F0/10</td>
<td>VLAN 30 – Guest(Default)</td>
<td>192.168.30.0/24</td>
</tr>
<tr class="row-even"><td>F0/11 – F0/17</td>
<td>VLAN 10 – Faculty/Staff</td>
<td>192.168.10.0/24</td>
</tr>
<tr class="row-odd"><td>F0/18 – F0/24</td>
<td>VLAN 20 – Students</td>
<td>192.168.20.0/24</td>
</tr>
</tbody>
</table>
<img alt="nw/_static/img/troubleshooting_vlans2.png" src="nw/_static/img/troubleshooting_vlans2.png" />
<p>Switch 1</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>interface GigabitEthernet0/1
 switchport trunk native vlan 56
 switchport trunk allowed vlan 10,20,30,56
 switchport mode trunk
!
interface GigabitEthernet0/2
 switchport trunk native vlan 56
 switchport trunk allowed vlan 10,20,30,56
 switchport mode trunk
!
interface Vlan1
 no ip address
 shutdown
!
interface Vlan56
 mac-address 00d0.bc45.1b01
 ip address 192.168.56.11 255.255.255.0

S1#show vlan brief

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                                Fa0/5, Fa0/6, Fa0/7, Fa0/8
                                                Fa0/9, Fa0/10, Fa0/11, Fa0/12
                                                Fa0/13, Fa0/14, Fa0/15, Fa0/16
                                                Fa0/17, Fa0/18, Fa0/19, Fa0/20
                                                Fa0/21, Fa0/22, Fa0/23, Fa0/24
10   Faculty/Staff                    active
20   Students                         active
30   Guest(Default)                   active
56   Management&amp;Native                active
1002 fddi-default                     active
1003 token-ring-default               active
1004 fddinet-default                  active
1005 trnet-default                    active
S1#show interfac
S1#show interfaces trunk
Port        Mode         Encapsulation  Status        Native vlan
Gig0/1      on           802.1q         trunking      56
Gig0/2      on           802.1q         trunking      56

Port        Vlans allowed on trunk
Gig0/1      10,20,30,56
Gig0/2      10,20,30,56

Port        Vlans allowed and active in management domain
Gig0/1      10,20,30,56
Gig0/2      10,20,30,56

Port        Vlans in spanning tree forwarding state and not pruned
Gig0/1      10,20,30,56
Gig0/2      10,20,30,56
</pre></div>
</div>
<p>Switch 2 &amp; 3</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>spanning-tree mode pvst
spanning-tree extend system-id
!
interface FastEthernet0/1
 switchport access vlan 56
 switchport mode access
!
interface FastEthernet0/2
 switchport access vlan 56
 switchport mode access
!
interface FastEthernet0/3
 switchport access vlan 56
 switchport mode access
!
interface FastEthernet0/4
 switchport access vlan 56
 switchport mode access
!
interface FastEthernet0/5
 switchport access vlan 56
 switchport mode access
!
interface FastEthernet0/6
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/7
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/8
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/9
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/10
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/11
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/12
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/13
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/14
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/15
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/16
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/17
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/18
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/19
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/20
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/21
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/22
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/23
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/24
 switchport access vlan 20
 switchport mode access
!
interface GigabitEthernet0/1
 switchport trunk native vlan 56
 switchport trunk allowed vlan 10,20,30,56
 switchport mode trunk
!
interface GigabitEthernet0/2
 switchport trunk native vlan 56
 switchport trunk allowed vlan 10,20,30,56
 switchport mode trunk
!
interface Vlan1
 no ip address
 shutdown
!
interface Vlan56
 mac-address 0002.1737.2201
 ip address 192.168.56.12 255.255.255.0

S2#show vlan

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Gig0/2
10   Faculty/Staff                    active    Fa0/11, Fa0/12, Fa0/13, Fa0/14
                                                Fa0/15, Fa0/16, Fa0/17
20   Students                         active    Fa0/18, Fa0/19, Fa0/20, Fa0/21
                                                Fa0/22, Fa0/23, Fa0/24
30   Guest(Default)                   active    Fa0/6, Fa0/7, Fa0/8, Fa0/9
                                                Fa0/10
56   Management&amp;Native                active    Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                                Fa0/5
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup

VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
1    enet  100001     1500  -      -      -        -    -        0      0
10   enet  100010     1500  -      -      -        -    -        0      0
20   enet  100020     1500  -      -      -        -    -        0      0
30   enet  100030     1500  -      -      -        -    -        0      0
56   enet  100056     1500  -      -      -        -    -        0      0
1002 fddi  101002     1500  -      -      -        -    -        0      0
1003 tr    101003     1500  -      -      -        -    -        0      0
1004 fdnet 101004     1500  -      -      -        ieee -        0      0
1005 trnet 101005     1500  -      -      -        ibm  -        0      0

VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------

Remote SPAN VLANs
------------------------------------------------------------------------------

Primary Secondary Type              Ports
------- --------- ----------------- ------------------------------------------

S2#show interfaces trunk
Port        Mode         Encapsulation  Status        Native vlan
Gig0/1      on           802.1q         trunking      56

Port        Vlans allowed on trunk
Gig0/1      10,20,30,56

Port        Vlans allowed and active in management domain
Gig0/1      10,20,30,56

Port        Vlans in spannin
</pre></div>
</div>
</div>
</div>
<div class="section" id="troubleshooting-vlan-trunk-bullet-points">
<h4>Troubleshooting vlan/trunk bullet points<a class="headerlink" href="#troubleshooting-vlan-trunk-bullet-points" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">make sure management vlan has an ip address</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface vlan 56</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip address 192.168.56.12 255.255.255.0</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#no shutdown</span>
</pre></div>
</div>
</li>
<li><p class="first">check if trunks are configured correctly with</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S2</span><span class="c1">#show interfaces trunk</span>
<span class="o">------</span>      <span class="o">----</span>         <span class="o">------------</span>   <span class="o">------</span>        <span class="o">-----------</span>
<span class="n">Port</span>        <span class="n">Mode</span>         <span class="n">Encapsulation</span>  <span class="n">Status</span>        <span class="n">Native</span> <span class="n">vlan</span>
<span class="o">------</span>      <span class="o">----</span>         <span class="o">------------</span>   <span class="o">------</span>        <span class="o">-----------</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>      <span class="n">on</span>           <span class="mf">802.1</span><span class="n">q</span>         <span class="n">trunking</span>      <span class="mi">56</span>

<span class="n">Port</span>        <span class="n">Vlans</span> <span class="n">allowed</span> <span class="n">on</span> <span class="n">trunk</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>      <span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">56</span>

<span class="n">Port</span>        <span class="n">Vlans</span> <span class="n">allowed</span> <span class="ow">and</span> <span class="n">active</span> <span class="ow">in</span> <span class="n">management</span> <span class="n">domain</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>      <span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">56</span>

<span class="n">Port</span>        <span class="n">Vlans</span> <span class="ow">in</span> <span class="n">spanning</span> <span class="n">tree</span> <span class="n">forwarding</span> <span class="n">state</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pruned</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>      <span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">56</span>
</pre></div>
</div>
</li>
<li><p class="first">set native vlan on trunk ports <code class="docutils literal"><span class="pre">switchport</span> <span class="pre">trunk</span> <span class="pre">native</span> <span class="pre">vlan</span> <span class="pre">56</span></code></p>
</li>
<li><p class="first">set to access ports and set their native vlan</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#interface range fastEthernet 0/1-24</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#switchport mode access</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#switchport native vlan 56</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#no shutdown</span>
</pre></div>
</div>
</li>
<li><p class="first">set port as a trunk <code class="docutils literal"><span class="pre">switchport</span> <span class="pre">mode</span> <span class="pre">trunk</span></code></p>
</li>
<li><p class="first">set allowed vlans, including native <code class="docutils literal"><span class="pre">switchport</span> <span class="pre">trunk</span> <span class="pre">allowed</span> <span class="pre">vlan</span> <span class="pre">10,20,30,56</span></code></p>
</li>
<li><p class="first">configure access layer switch access ports with correct vlan</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface range fa0/6 - 10</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#switchport access vlan 30</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#interface range fa0/11 - 17</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#switchport access vlan 10</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#interface range fa0/18 - 24</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#switchport access vlan 20</span>
</pre></div>
</div>
</li>
<li><p class="first">check if vlans are all assigned to the correct interface and vlan is active with <code class="docutils literal"><span class="pre">show</span> <span class="pre">vlan</span> <span class="pre">brief</span> <span class="pre">|</span> <span class="pre">id</span> <span class="pre">|</span> <span class="pre">name</span></code> command</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#do show vlan brief</span>

<span class="n">VLAN</span> <span class="n">Name</span>                             <span class="n">Status</span>    <span class="n">Ports</span>
<span class="o">----</span> <span class="o">--------------------------------</span> <span class="o">---------</span> <span class="o">-------------------------------</span>
<span class="mi">1</span>    <span class="n">default</span>                          <span class="n">active</span>    <span class="n">Gig0</span><span class="o">/</span><span class="mi">2</span>
<span class="mi">10</span>   <span class="n">Faculty</span><span class="o">/</span><span class="n">Staff</span>                    <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">11</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">13</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">14</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">15</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">17</span>
<span class="mi">20</span>   <span class="n">Students</span>                         <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">18</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">19</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">21</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">22</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">23</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">24</span>
<span class="mi">30</span>   <span class="n">Guest</span><span class="p">(</span><span class="n">Default</span><span class="p">)</span>                   <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">7</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">9</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">10</span>
<span class="mi">56</span>   <span class="n">Management</span><span class="o">&amp;</span><span class="n">Native</span>                <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">4</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">5</span>
<span class="c1"># or check per vlan id or vlan name</span>
<span class="c1"># #################################</span>
<span class="n">S2</span><span class="c1">#show vlan id 56</span>
<span class="o">----</span> <span class="o">--------------------------------</span> <span class="o">---------</span> <span class="o">-------------------------------</span>
<span class="n">VLAN</span> <span class="n">Name</span>                             <span class="n">Status</span>    <span class="n">Ports</span>
<span class="o">----</span> <span class="o">--------------------------------</span> <span class="o">---------</span> <span class="o">-------------------------------</span>
<span class="mi">56</span>   <span class="n">Management</span><span class="o">&amp;</span><span class="n">Native</span>                <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">4</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">5</span>

<span class="n">VLAN</span> <span class="n">Type</span>  <span class="n">SAID</span>       <span class="n">MTU</span>   <span class="n">Parent</span> <span class="n">RingNo</span> <span class="n">BridgeNo</span> <span class="n">Stp</span>  <span class="n">BrdgMode</span> <span class="n">Trans1</span> <span class="n">Trans2</span>
<span class="o">----</span> <span class="o">-----</span> <span class="o">----------</span> <span class="o">-----</span> <span class="o">------</span> <span class="o">------</span> <span class="o">--------</span> <span class="o">----</span> <span class="o">--------</span> <span class="o">------</span> <span class="o">------</span>
<span class="mi">56</span>   <span class="n">enet</span>  <span class="mi">100056</span>     <span class="mi">1500</span>  <span class="o">-</span>      <span class="o">-</span>      <span class="o">-</span>        <span class="o">-</span>    <span class="o">-</span>        <span class="mi">0</span>      <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p class="first">enable a vlan <code class="docutils literal"><span class="pre">interface</span> <span class="pre">vlan</span> <span class="pre">20</span></code></p>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You must hardcode <code class="docutils literal"><span class="pre">switchport</span> <span class="pre">mode</span> <span class="pre">access</span></code> on the ports that are not a trunk. This disables the Dynamic Trunking Protocol, so that’s 1 chance less of accidently creating a trunk. doublecheck via <code class="docutils literal"><span class="pre">show</span> <span class="pre">interfaces</span> <span class="pre">switchport</span></code> you’ll see negotiation is off.</p>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#do show interface switchport</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Switchport</span><span class="p">:</span> <span class="n">Enabled</span>
<span class="n">Administrative</span> <span class="n">Mode</span><span class="p">:</span> <span class="n">static</span> <span class="n">access</span>
<span class="n">Operational</span> <span class="n">Mode</span><span class="p">:</span> <span class="n">down</span>
<span class="n">Administrative</span> <span class="n">Trunking</span> <span class="n">Encapsulation</span><span class="p">:</span> <span class="n">dot1q</span>
<span class="n">Operational</span> <span class="n">Trunking</span> <span class="n">Encapsulation</span><span class="p">:</span> <span class="n">native</span>
<span class="o">**</span><span class="n">Negotiation</span> <span class="n">of</span> <span class="n">Trunking</span><span class="p">:</span> <span class="n">Off</span><span class="o">**</span>
<span class="n">Access</span> <span class="n">Mode</span> <span class="n">VLAN</span><span class="p">:</span> <span class="mi">56</span> <span class="p">(</span><span class="n">VLAN0056</span><span class="p">)</span>
<span class="n">Trunking</span> <span class="n">Native</span> <span class="n">Mode</span> <span class="n">VLAN</span><span class="p">:</span> <span class="mi">1</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
<span class="n">Voice</span> <span class="n">VLAN</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Administrative</span> <span class="n">private</span><span class="o">-</span><span class="n">vlan</span> <span class="n">host</span><span class="o">-</span><span class="n">association</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Administrative</span> <span class="n">private</span><span class="o">-</span><span class="n">vlan</span> <span class="n">mapping</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Administrative</span> <span class="n">private</span><span class="o">-</span><span class="n">vlan</span> <span class="n">trunk</span> <span class="n">native</span> <span class="n">VLAN</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Administrative</span> <span class="n">private</span><span class="o">-</span><span class="n">vlan</span> <span class="n">trunk</span> <span class="n">encapsulation</span><span class="p">:</span> <span class="n">dot1q</span>
<span class="n">Administrative</span> <span class="n">private</span><span class="o">-</span><span class="n">vlan</span> <span class="n">trunk</span> <span class="n">normal</span> <span class="n">VLANs</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Administrative</span> <span class="n">private</span><span class="o">-</span><span class="n">vlan</span> <span class="n">trunk</span> <span class="n">private</span> <span class="n">VLANs</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Operational</span> <span class="n">private</span><span class="o">-</span><span class="n">vlan</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Trunking</span> <span class="n">VLANs</span> <span class="n">Enabled</span><span class="p">:</span> <span class="n">All</span>
<span class="n">Pruning</span> <span class="n">VLANs</span> <span class="n">Enabled</span><span class="p">:</span> <span class="mi">2</span><span class="o">-</span><span class="mi">1001</span>
<span class="n">Capture</span> <span class="n">Mode</span> <span class="n">Disabled</span>
<span class="n">Capture</span> <span class="n">VLANs</span> <span class="n">Allowed</span><span class="p">:</span> <span class="n">ALL</span>
<span class="n">Protected</span><span class="p">:</span> <span class="n">false</span>
<span class="n">Unknown</span> <span class="n">unicast</span> <span class="n">blocked</span><span class="p">:</span> <span class="n">disabled</span>
<span class="n">Unknown</span> <span class="n">multicast</span> <span class="n">blocked</span><span class="p">:</span> <span class="n">disabled</span>
<span class="n">Appliance</span> <span class="n">trust</span><span class="p">:</span> <span class="n">none</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Watch out for unnamed vlans! Easily overlooked :)</p>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#do show vlan</span>

<span class="n">VLAN</span> <span class="n">Name</span>                             <span class="n">Status</span>    <span class="n">Ports</span>
<span class="o">----</span> <span class="o">--------------------------------</span> <span class="o">---------</span> <span class="o">-------------------------------</span>
<span class="mi">1</span>    <span class="n">default</span>                          <span class="n">active</span>
<span class="mi">10</span>   <span class="n">VLAN0010</span>                         <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">11</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">13</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">14</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">15</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">17</span>
<span class="mi">20</span>   <span class="n">VLAN0020</span>                         <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">18</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">19</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">21</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">22</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">23</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">24</span>
<span class="mi">30</span>   <span class="n">VLAN0030</span>                         <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">7</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">9</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">10</span>
<span class="mi">56</span>   <span class="n">VLAN0056</span>                         <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">4</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">5</span>
<span class="mi">1002</span> <span class="n">fddi</span><span class="o">-</span><span class="n">default</span>                     <span class="n">act</span><span class="o">/</span><span class="n">unsup</span>
<span class="mi">1003</span> <span class="n">token</span><span class="o">-</span><span class="n">ring</span><span class="o">-</span><span class="n">default</span>               <span class="n">act</span><span class="o">/</span><span class="n">unsup</span>
<span class="mi">1004</span> <span class="n">fddinet</span><span class="o">-</span><span class="n">default</span>                  <span class="n">act</span><span class="o">/</span><span class="n">unsup</span>
<span class="mi">1005</span> <span class="n">trnet</span><span class="o">-</span><span class="n">default</span>                    <span class="n">act</span><span class="o">/</span><span class="n">unsup</span>

<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#do show vlan</span>

<span class="n">VLAN</span> <span class="n">Name</span>                             <span class="n">Status</span>    <span class="n">Ports</span>
<span class="o">----</span> <span class="o">--------------------------------</span> <span class="o">---------</span> <span class="o">-------------------------------</span>
<span class="mi">1</span>    <span class="n">default</span>                          <span class="n">active</span>    <span class="n">Gig0</span><span class="o">/</span><span class="mi">2</span>
<span class="mi">10</span>   <span class="n">Faculty</span><span class="o">/</span><span class="n">Staff</span>                    <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">11</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">13</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">14</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">15</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">17</span>
<span class="mi">20</span>   <span class="n">Students</span>                         <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">18</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">19</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">21</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">22</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">23</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">24</span>
<span class="mi">30</span>   <span class="n">Guest</span><span class="p">(</span><span class="n">Default</span><span class="p">)</span>                   <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">7</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">9</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">10</span>
<span class="mi">56</span>   <span class="n">Management</span><span class="o">&amp;</span><span class="n">Native</span>                <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">4</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">5</span>

<span class="n">solution</span>
<span class="c1">#########</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#vlan 10</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1">#name Faculty/Staff</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1">#vlan 20</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1">#name Students</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1">#vlan 30</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1">#name Guest(Default)</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1">#vlan 56</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1">#name Management&amp;Native</span>
</pre></div>
</div>
</div>
<div class="section" id="vlan-command-summary-table">
<h4>VLAN Command Summary Table<a class="headerlink" href="#vlan-command-summary-table" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Command</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>vtp mode [server - client - transparent]</td>
<td>In global configuration mode, this command sets the operational VTP mode for the switch.</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>The default is server.</td>
</tr>
<tr class="row-even"><td>vtp domain name</td>
<td>In global configuration mode, this command assigns a VTP domain name,</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>which allows the switch to send VTP advertisements out trunk links.</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>The default is NULL, which would allow a switch to join the first domain it received an update from.</td>
</tr>
<tr class="row-odd"><td>show vtp status</td>
<td>Displays VTP status information including configuration revision number, domain name, and switch mode.</td>
</tr>
<tr class="row-even"><td>switchport mode [trunk-access-dynamic</td>
<td>In interface configuration mode, this configures the behavior of the interface.</td>
</tr>
<tr class="row-odd"><td>[desirable-auto-nonegotiate]]</td>
<td>Trunk mode will force frame tagging. Dynamic mode can become a trunk if  it negotiates</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>with the other side of the link. Access mode is a nontrunk port.</td>
</tr>
<tr class="row-odd"><td>switchport trunk encapsulation dot1q</td>
<td>Used in interface configuration mode to specify a trunking protocol. For some switches,</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>before you can set an interface to trunk mode, you must first specify the encapsulation.</td>
</tr>
<tr class="row-odd"><td>show interface [type module/port] trunk</td>
<td>Displays trunking information about the active or specified trunk links on the switch.</td>
</tr>
<tr class="row-even"><td>show interface [type mod/port] switchport</td>
<td>Displays Layer 2 configuration and operational parameters of the switch.</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>This includes VLAN membership and trunking status.</td>
</tr>
<tr class="row-even"><td>vlan number</td>
<td>In global configuration mode, this command defines a VLAN</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>and puts the switch into VLAN configuration mode. In VLAN configuration mode,</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>commands such as name can be used to further define the VLAN.</td>
</tr>
<tr class="row-odd"><td>show vlan [id vlan#]</td>
<td>Displays VLAN information. The id option allows you to specify a particular VLAN.</td>
</tr>
<tr class="row-even"><td>switchport access vlan [1-4096 / dynamic]</td>
<td>In interface configuration mode, this command assigns an access port to a VLAN</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>or makes it a dynamic port.</td>
</tr>
<tr class="row-even"><td>show vlan brief</td>
<td>Displays a brief table of the VLANs, including the port membership for each VLAN.</td>
</tr>
<tr class="row-odd"><td>show spanning-tree [vlan number]</td>
<td>Displays Spanning Tree information for the switch or a VLAN if the vlan option is used.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="inter-vlan-routing">
<h4>Inter-VLAN Routing<a class="headerlink" href="#inter-vlan-routing" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/what_is_intervlan_routing.png" src="nw/_static/img/what_is_intervlan_routing.png" />
<p>A VLAN is a broadcast domain, so computers on separate VLANs are unable to communicate without the intervention of a routing device. Layer 2 switches have very limited IPv4 and IPv6 functionality and cannot perform the dynamic routing function of routers. While Layer 2 switches are gaining more IP functionality, such as the ability to perform static routing, this is insufficient to handle these large number of VLANs.</p>
<p>Any device that supports Layer 3 routing, such as a router or a multilayer switch, can be used to perform the necessary routing functionality. Regardless of the device used, the process of forwarding network traffic from one VLAN to another VLAN using routing is known as inter-VLAN routing.</p>
<dl class="docutils">
<dt>There are three options for inter-VLAN routing:</dt>
<dd><ul class="first last simple">
<li><dl class="first docutils">
<dt>Legacy inter-VLAN routing:</dt>
<dd>The switch ports connected to the router are placed in access mode and each physical interface is assigned to a different VLAN. Each router interface can then accept traffic from the VLAN associated with the switch interface that it is connected to, and traffic can be routed to the other VLANs connected to the other interfaces.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Router-on-a-Stick:</dt>
<dd>The router interface is configured to operate as a trunk link and is connected to a switch port that is configured in trunk mode. The router performs inter-VLAN routing by accepting VLAN-tagged traffic on the trunk interface coming from the adjacent switch, and then, internally routing between the VLANs using subinterfaces. The router then forwards the routed traffic, VLAN-tagged for the destination VLAN, out the same physical interface as it used to receive the traffic</dd>
</dl>
</li>
<li>Layer 3 switching using SVI’s</li>
</ul>
</dd>
</dl>
<div class="section" id="legacy-intervlan-routing">
<h5>legacy intervlan routing<a class="headerlink" href="#legacy-intervlan-routing" title="Permalink to this headline">¶</a></h5>
<img alt="nw/_static/img/legacy_intervlan_routing.png" src="nw/_static/img/legacy_intervlan_routing.png" />
<p>Router R1 has a separate interface configured for each of the VLANs.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method of inter-VLAN routing is not efficient and is generally no longer implemented in switched networks. It is shown in this course for explanation purposes only.</p>
</div>
<p>Devices use their default gateway as the Layer 2 destination for all traffic that must leave the local subnet. The default gateway is the route that the device uses when it has no other explicitly defined route to the destination network. The IPv4 address of the router interface on the local subnet acts as the default gateway for the sending device.</p>
<p>When the source device has determined that the packet must travel through the local router interface on the connected VLAN, the source device sends out an ARP request to determine the MAC address of the local router interface. When the router sends its ARP reply back to the source device, the source device can use the MAC address to finish framing the packet before it sends it out on the network as unicast traffic.</p>
<p>Because the Ethernet frame has the destination MAC address of the router interface, the switch knows exactly which switch port to forward the unicast traffic out of to reach the router interface for that VLAN. When the frame arrives at the router, the router removes the source and destination MAC address information to examine the destination IPv4 address of the packet. The router compares the destination address to entries in its routing table to determine where it needs to forward the data to reach its final destination. If the router determines that the destination network is a locally connected network, as is the case with inter-VLAN routing, the router sends an ARP request out the interface that is physically connected to the destination VLAN. The destination device responds back to the router with its MAC address, which the router then uses to frame the packet. The router then sends the unicast traffic to the switch, which forwards it out the port where the destination device is connected.</p>
<div class="section" id="lab-configuration">
<h6>Lab configuration<a class="headerlink" href="#lab-configuration" title="Permalink to this headline">¶</a></h6>
<img alt="nw/_static/img/configure_legacy_intervlanning.png" src="nw/_static/img/configure_legacy_intervlanning.png" />
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="18%" />
<col width="22%" />
<col width="22%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway,</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R1</td>
<td>G0/0</td>
<td>192.168.20.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>G0/1</td>
<td>192.168.10</td>
<td>.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>S1</td>
<td>VLAN 10</td>
<td>192.168.10.11</td>
<td>255.255.255.0</td>
<td>192.168.10.1</td>
</tr>
<tr class="row-odd"><td>S2</td>
<td>VLAN 10</td>
<td>192.168.10.12</td>
<td>255.255.255.0</td>
<td>192.168.10.1</td>
</tr>
<tr class="row-even"><td>PC-A</td>
<td>NIC</td>
<td>192.168.10.3</td>
<td>255.255.255.0</td>
<td>192.168.10.1</td>
</tr>
<tr class="row-odd"><td>PC-B</td>
<td>NIC</td>
<td>192.168.20.3</td>
<td>255.255.255.0</td>
<td>192.168.20.1</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><strong>of the switch</strong></li>
</ul>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># vlan 10</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># name students</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># vlan 30</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">vlan</span><span class="p">)</span><span class="c1"># name lolcats</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use the vlan vlan_id global configuration mode command to create VLANs. In this example, VLANs 10 and 30 were created on switch S1.</p>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface f0/11</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport access vlan 10</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># interface f0/4</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport access vlan 10</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># interface f0/6</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport access vlan 30</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># interface f0/5</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport access vlan 30</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip default-gateway 172.17.10.1</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">S1</span><span class="c1"># copy running-config startup-config</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>of the router</strong></li>
</ul>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 172.17.10.1 255.255.255.0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="router-on-a-stick-intervlan-routing">
<h5>router-on-a-stick intervlan routing<a class="headerlink" href="#router-on-a-stick-intervlan-routing" title="Permalink to this headline">¶</a></h5>
<img alt="nw/_static/img/router_on_a_stick_intervlanning.png" src="nw/_static/img/router_on_a_stick_intervlanning.png" />
<p>Subinterfaces are configured for different subnets corresponding to their VLAN assignment to facilitate logical routing. After a routing decision is made based on the destination VLAN, the data frames are VLAN-tagged and sent back out the physical interface.</p>
<ol class="arabic simple">
<li>PC1 on VLAN 10 is communicating with PC3 on VLAN 30 through router R1 using a single, physical router interface.</li>
<li>PC1 sends its unicast traffic to switch S2.</li>
<li>Switch S2 then tags the unicast traffic as originating on VLAN 10 and forwards the unicast traffic out its trunk link to switch S1.</li>
<li>Switch S1 forwards the tagged traffic out the other trunk interface on port F0/3 to the interface on router R1.</li>
<li>Router R1 accepts the tagged unicast traffic on VLAN 10 and routes it to VLAN 30 using its configured subinterfaces.</li>
<li>The unicast traffic is tagged with VLAN 30 as it is sent out the router interface to switch S1.</li>
<li>Switch S1 forwards the tagged unicast traffic out the other trunk link to switch S2.</li>
<li>Switch S2 removes the VLAN tag of the unicast frame and forwards the frame out to PC3 on port F0/23.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The router-on-a-stick method of inter-VLAN routing does not scale beyond 50 VLANs.</p>
</div>
</div>
<div class="section" id="multilayer-switch-intervlanning">
<h5>multilayer switch intervlanning<a class="headerlink" href="#multilayer-switch-intervlanning" title="Permalink to this headline">¶</a></h5>
<img alt="nw/_static/img/multilayer_switch_intervlanning.png" src="nw/_static/img/multilayer_switch_intervlanning.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">outside the scope of course for now..</p>
</div>
</div>
</div>
<div class="section" id="inter-vlan-routing-challenge">
<h4>Inter-VLAN Routing Challenge<a class="headerlink" href="#inter-vlan-routing-challenge" title="Permalink to this headline">¶</a></h4>
<p>Packet Tracer – Inter-VLAN Routing Challenge|Topology|
Addressing Table</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="16%" />
<col width="21%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#160;</td>
<td>G0/0</td>
<td>172.17.25.2</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/1.10</td>
<td>172.17.10.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/1.20</td>
<td>172.17.20.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>R1</td>
<td>G0/1.30</td>
<td>172.17.30.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/1.88</td>
<td>172.17.88.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/1.99</td>
<td>172.17.99.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>S1</td>
<td>VLAN 99</td>
<td>172.17.99.10</td>
<td>255.255.255.0</td>
<td>172.17.99.1</td>
</tr>
<tr class="row-odd"><td>PC1</td>
<td>NIC</td>
<td>172.17.10.21</td>
<td>255.255.255.0</td>
<td>172.17.10.1</td>
</tr>
<tr class="row-even"><td>PC2</td>
<td>NIC</td>
<td>172.17.20.22</td>
<td>255.255.255.0</td>
<td>172.17.20.1</td>
</tr>
<tr class="row-odd"><td>PC3</td>
<td>NIC</td>
<td>172.17.30.23</td>
<td>255.255.255.0</td>
<td>172.17.30.1</td>
</tr>
</tbody>
</table>
<p>VLAN and Port Assignments Table</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="5%" />
<col width="43%" />
<col width="5%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">VLAN</th>
<th class="head">&#160;</th>
<th class="head">Name</th>
<th class="head">&#160;</th>
<th class="head">Interface</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>10</td>
<td>&#160;</td>
<td>Faculty/Staff</td>
<td>&#160;</td>
<td>Fa0/11-17</td>
</tr>
<tr class="row-odd"><td>20</td>
<td>&#160;</td>
<td>Students</td>
<td>&#160;</td>
<td>Fa0/18-24</td>
</tr>
<tr class="row-even"><td>30</td>
<td>&#160;</td>
<td>Guest(Default)</td>
<td>&#160;</td>
<td>Fa0/6-10</td>
</tr>
<tr class="row-odd"><td>88</td>
<td>&#160;</td>
<td>Native</td>
<td>&#160;</td>
<td>G0/1</td>
</tr>
<tr class="row-even"><td>99</td>
<td>&#160;</td>
<td>Management</td>
<td>&#160;</td>
<td>VLAN 99</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Assign IP addressing to R1 and S1 based on the Addressing Table.</li>
<li>Create, name and assign VLANs on S1 based on the VLAN and Port Assignments Table. Ports should be in access mode.</li>
<li>Configure S1 to trunk, allow only the VLANs in the VLAN and Port Assignments Table.</li>
<li>Configure the default gateway on S1.</li>
<li>All ports not assigned to a VLAN should be disabled.</li>
<li>Configure inter-VLAN routing on R1 based on the Addressing Table.</li>
<li>Verify connectivity. R1, S1, and all PCs should be able to ping each other and the cisco.pka server.</li>
</ul>
<ul>
<li><p class="first">configuration for the switch:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>hostname S1
!
!
spanning-tree mode pvst
spanning-tree extend system-id
!
interface FastEthernet0/1
 switchport mode access
!
interface FastEthernet0/2
 switchport mode access
!
interface FastEthernet0/3
 switchport mode access
!
interface FastEthernet0/4
 switchport mode access
!
interface FastEthernet0/5
 switchport mode access
!
interface FastEthernet0/6
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/7
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/8
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/9
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/10
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/11
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/12
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/13
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/14
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/15
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/16
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/17
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/18
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/19
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/20
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/21
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/22
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/23
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/24
 switchport access vlan 20
 switchport mode access
!
interface GigabitEthernet0/1
 switchport trunk native vlan 88
 switchport trunk allowed vlan 10,20,30,88,99
 switchport mode trunk
!
interface GigabitEthernet0/2
!
interface Vlan1
 no ip address
 shutdown
!
interface Vlan99
 mac-address 0030.f236.9801
 ip address 172.17.99.10 255.255.255.0
!
ip default-gateway 172.17.99.1
</pre></div>
</div>
</li>
<li><p class="first">show vlan &amp; trunks:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1">#show vlan brief</span>

<span class="n">VLAN</span> <span class="n">Name</span>                             <span class="n">Status</span>    <span class="n">Ports</span>
<span class="o">----</span> <span class="o">--------------------------------</span> <span class="o">---------</span> <span class="o">-------------------------------</span>
<span class="mi">1</span>    <span class="n">default</span>                          <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">4</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="n">Gig0</span><span class="o">/</span><span class="mi">2</span>
<span class="mi">10</span>   <span class="n">Faculty</span><span class="o">/</span><span class="n">Staff</span>                    <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">11</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">13</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">14</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">15</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">17</span>
<span class="mi">20</span>   <span class="n">Students</span>                         <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">18</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">19</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">21</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">22</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">23</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">24</span>
<span class="mi">30</span>   <span class="n">Guest</span><span class="p">(</span><span class="n">Default</span><span class="p">)</span>                   <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">7</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">9</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">10</span>
<span class="mi">88</span>   <span class="n">Native</span>                           <span class="n">active</span>
<span class="mi">99</span>   <span class="n">Management</span>                       <span class="n">active</span>
<span class="mi">1002</span> <span class="n">fddi</span><span class="o">-</span><span class="n">default</span>                     <span class="n">active</span>
<span class="mi">1003</span> <span class="n">token</span><span class="o">-</span><span class="n">ring</span><span class="o">-</span><span class="n">default</span>               <span class="n">active</span>
<span class="mi">1004</span> <span class="n">fddinet</span><span class="o">-</span><span class="n">default</span>                  <span class="n">active</span>
<span class="mi">1005</span> <span class="n">trnet</span><span class="o">-</span><span class="n">default</span>                    <span class="n">active</span>
<span class="n">S1</span><span class="c1">#</span>
<span class="n">S1</span><span class="c1">#</span>
<span class="n">S1</span><span class="c1">#</span>
<span class="n">S1</span><span class="c1">#</span>
<span class="n">S1</span><span class="c1">#show interfaces trunk</span>
<span class="n">Port</span>        <span class="n">Mode</span>         <span class="n">Encapsulation</span>  <span class="n">Status</span>        <span class="n">Native</span> <span class="n">vlan</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>      <span class="n">on</span>           <span class="mf">802.1</span><span class="n">q</span>         <span class="n">trunking</span>      <span class="mi">88</span>

<span class="n">Port</span>        <span class="n">Vlans</span> <span class="n">allowed</span> <span class="n">on</span> <span class="n">trunk</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>      <span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">99</span>

<span class="n">Port</span>        <span class="n">Vlans</span> <span class="n">allowed</span> <span class="ow">and</span> <span class="n">active</span> <span class="ow">in</span> <span class="n">management</span> <span class="n">domain</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>      <span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">99</span>

<span class="n">Port</span>        <span class="n">Vlans</span> <span class="ow">in</span> <span class="n">spanning</span> <span class="n">tree</span> <span class="n">forwarding</span> <span class="n">state</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pruned</span>
<span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>      <span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">99</span>
</pre></div>
</div>
</li>
<li><p class="first">configuration for the router:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>hostname R1
!
!
ip cef
no ipv6 cef
!
!
spanning-tree mode pvst
!
interface GigabitEthernet0/0
 ip address 172.17.25.2 255.255.255.252
 duplex auto
 speed auto
!
interface GigabitEthernet0/1
 no ip address
 duplex auto
 speed auto
!
interface GigabitEthernet0/1.10
 encapsulation dot1Q 10
 ip address 172.17.10.1 255.255.255.0
!
interface GigabitEthernet0/1.20
 encapsulation dot1Q 20
 ip address 172.17.20.1 255.255.255.0
!
interface GigabitEthernet0/1.30
 encapsulation dot1Q 30
 ip address 172.17.30.1 255.255.255.0
!
interface GigabitEthernet0/1.88
 encapsulation dot1Q 88 native
 ip address 172.17.88.1 255.255.255.0
!
interface GigabitEthernet0/1.99
 encapsulation dot1Q 99
 ip address 172.17.99.1 255.255.255.0
!
interface Vlan1
 no ip address
 shutdown
!
ip classless
ip route 0.0.0.0 0.0.0.0 GigabitEthernet0/0
!
ip flow-export version 9
!
</pre></div>
</div>
</li>
<li><p class="first">show ip route:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1">#show ip route</span>
<span class="n">Codes</span><span class="p">:</span> <span class="n">L</span> <span class="o">-</span> <span class="n">local</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">connected</span><span class="p">,</span> <span class="n">S</span> <span class="o">-</span> <span class="n">static</span><span class="p">,</span> <span class="n">R</span> <span class="o">-</span> <span class="n">RIP</span><span class="p">,</span> <span class="n">M</span> <span class="o">-</span> <span class="n">mobile</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">BGP</span>
       <span class="n">D</span> <span class="o">-</span> <span class="n">EIGRP</span><span class="p">,</span> <span class="n">EX</span> <span class="o">-</span> <span class="n">EIGRP</span> <span class="n">external</span><span class="p">,</span> <span class="n">O</span> <span class="o">-</span> <span class="n">OSPF</span><span class="p">,</span> <span class="n">IA</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">inter</span> <span class="n">area</span>
       <span class="n">N1</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">NSSA</span> <span class="n">external</span> <span class="nb">type</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N2</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">NSSA</span> <span class="n">external</span> <span class="nb">type</span> <span class="mi">2</span>
       <span class="n">E1</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">external</span> <span class="nb">type</span> <span class="mi">1</span><span class="p">,</span> <span class="n">E2</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">external</span> <span class="nb">type</span> <span class="mi">2</span><span class="p">,</span> <span class="n">E</span> <span class="o">-</span> <span class="n">EGP</span>
       <span class="n">i</span> <span class="o">-</span> <span class="n">IS</span><span class="o">-</span><span class="n">IS</span><span class="p">,</span> <span class="n">L1</span> <span class="o">-</span> <span class="n">IS</span><span class="o">-</span><span class="n">IS</span> <span class="n">level</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">L2</span> <span class="o">-</span> <span class="n">IS</span><span class="o">-</span><span class="n">IS</span> <span class="n">level</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">ia</span> <span class="o">-</span> <span class="n">IS</span><span class="o">-</span><span class="n">IS</span> <span class="n">inter</span> <span class="n">area</span>
       <span class="o">*</span> <span class="o">-</span> <span class="n">candidate</span> <span class="n">default</span><span class="p">,</span> <span class="n">U</span> <span class="o">-</span> <span class="n">per</span><span class="o">-</span><span class="n">user</span> <span class="n">static</span> <span class="n">route</span><span class="p">,</span> <span class="n">o</span> <span class="o">-</span> <span class="n">ODR</span>
       <span class="n">P</span> <span class="o">-</span> <span class="n">periodic</span> <span class="n">downloaded</span> <span class="n">static</span> <span class="n">route</span>

<span class="n">Gateway</span> <span class="n">of</span> <span class="n">last</span> <span class="n">resort</span> <span class="ow">is</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="n">to</span> <span class="n">network</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span>

     <span class="mf">172.17</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">16</span> <span class="ow">is</span> <span class="n">variably</span> <span class="n">subnetted</span><span class="p">,</span> <span class="mi">12</span> <span class="n">subnets</span><span class="p">,</span> <span class="mi">3</span> <span class="n">masks</span>
<span class="n">C</span>       <span class="mf">172.17</span><span class="o">.</span><span class="mf">10.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">1.10</span>
<span class="n">L</span>       <span class="mf">172.17</span><span class="o">.</span><span class="mf">10.1</span><span class="o">/</span><span class="mi">32</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">1.10</span>
<span class="n">C</span>       <span class="mf">172.17</span><span class="o">.</span><span class="mf">20.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">1.20</span>
<span class="n">L</span>       <span class="mf">172.17</span><span class="o">.</span><span class="mf">20.1</span><span class="o">/</span><span class="mi">32</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">1.20</span>
<span class="n">C</span>       <span class="mf">172.17</span><span class="o">.</span><span class="mf">25.0</span><span class="o">/</span><span class="mi">30</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">L</span>       <span class="mf">172.17</span><span class="o">.</span><span class="mf">25.2</span><span class="o">/</span><span class="mi">32</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">C</span>       <span class="mf">172.17</span><span class="o">.</span><span class="mf">30.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">1.30</span>
<span class="n">L</span>       <span class="mf">172.17</span><span class="o">.</span><span class="mf">30.1</span><span class="o">/</span><span class="mi">32</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">1.30</span>
<span class="n">C</span>       <span class="mf">172.17</span><span class="o">.</span><span class="mf">88.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">1.88</span>
<span class="n">L</span>       <span class="mf">172.17</span><span class="o">.</span><span class="mf">88.1</span><span class="o">/</span><span class="mi">32</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">1.88</span>
<span class="n">C</span>       <span class="mf">172.17</span><span class="o">.</span><span class="mf">99.0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">1.99</span>
<span class="n">L</span>       <span class="mf">172.17</span><span class="o">.</span><span class="mf">99.1</span><span class="o">/</span><span class="mi">32</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">1.99</span>
<span class="n">S</span><span class="o">*</span>   <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span> <span class="ow">is</span> <span class="n">directly</span> <span class="n">connected</span><span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="skills-integration-challenge">
<h4>Skills integration challenge<a class="headerlink" href="#skills-integration-challenge" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Addressing Table</li>
</ul>
<img alt="nw/_static/img/ch6_skills_integration_challenge.png" src="nw/_static/img/ch6_skills_integration_challenge.png" />
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="15%" />
<col width="20%" />
<col width="21%" />
<col width="24%" />
<col width="8%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
<th class="head">VLAN</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0</td>
<td>172.31.1.2</td>
<td>255.255.255.0</td>
<td>N/A</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0.10</td>
<td>172.31.10.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
<td>10</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/0.20</td>
<td>172.31.20.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>R1</td>
<td>G0/0.30</td>
<td>172.31.30.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
<td>30</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/0.88</td>
<td>172.31.88.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
<td>88</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0.99</td>
<td>172.31.99.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
<td>99</td>
</tr>
<tr class="row-even"><td>S1</td>
<td>VLAN 88</td>
<td>172.31.88.33</td>
<td>255.255.255.0</td>
<td>172.31.88.1</td>
<td>88</td>
</tr>
<tr class="row-odd"><td>PC-A</td>
<td>NIC</td>
<td>172.31.10.21</td>
<td>255.255.255.0</td>
<td>172.31.10.1</td>
<td>10</td>
</tr>
<tr class="row-even"><td>PC-B</td>
<td>NIC</td>
<td>172.31.20.22</td>
<td>255.255.255.0</td>
<td>172.31.20.1</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>PC-C</td>
<td>NIC</td>
<td>172.31.30.23</td>
<td>255.255.255.0</td>
<td>172.31.30.1</td>
<td>30</td>
</tr>
<tr class="row-even"><td>PC-D</td>
<td>NIC</td>
<td>172.31.88.24</td>
<td>255.255.255.0</td>
<td>172.31.88.1</td>
<td>88</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>VLAN Table</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="40%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">VLAN</th>
<th class="head">Name</th>
<th class="head">Interfaces</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>10</td>
<td>Sales</td>
<td>F0/11-15</td>
</tr>
<tr class="row-odd"><td>20</td>
<td>Production</td>
<td>F0/16-20</td>
</tr>
<tr class="row-even"><td>0</td>
<td>Marketing</td>
<td>F0/5-10</td>
</tr>
<tr class="row-odd"><td>88</td>
<td>Management</td>
<td>F0/21-24</td>
</tr>
<tr class="row-even"><td>99</td>
<td>Native</td>
<td>G0/1</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Scenario</li>
</ul>
<p>In this activity, you will demonstrate and reinforce your ability to configure routers for inter-VLAN communication and configure static routes to reach destinations outside of your network. Among the skills you will demonstrate are configuring inter-VLAN routing, static and default routes.</p>
<p>Requirements</p>
<p>· Configure inter-VLAN routing on R1 based on the Addressing Table.
· Configure trunking on S1.
· Configure four directly attached static route on HQ to each VLANs 10, 20, 30 and 88.
· Configure directly attached static routes on HQ to reach Outside Host:</p>
<blockquote>
<div>· Configure the primary path through the Serial 0/1/0 interface.
· Configure the backup route through the Serial 0/1/1 interface with a 10 AD.</div></blockquote>
<p>· Configure a directly attached default route on R1.
· Verify connectivity by making sure all the PCs can ping Outside Host.</p>
<ul>
<li><p class="first">router solution:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>R1(config)#interface G0/0.10
R1(config-subif)#ip address 172.31.10.1 255.255.255.0

% Configuring IP routing on a LAN subinterface is only allowed if that
subinterface is already configured as part of an IEEE 802.10, IEEE 802.1Q,
or ISL vLAN.

R1(config-subif)#encapsulation dot1Q 10
R1(config-subif)#ip address 172.31.10.1 255.255.255.0
R1(config-subif)#interface G0/0.20
R1(config-subif)#encapsulation dot1Q 20
R1(config-subif)#ip address 172.31.20.1 255.255.255.0
R1(config-subif)#interface G0/0.30
R1(config-subif)#encapsulation dot1Q 30
R1(config-subif)#ip address 172.31.30.1 255.255.255.0
R1(config-subif)#interface G0/0.88
R1(config-subif)#encapsulation dot1Q 88
R1(config-subif)#ip address 172.31.88.1 255.255.255.0
R1(config-subif)#interface G0/0.99
R1(config-subif)#encapsulation dot1Q 99 native
R1(config-subif)#ip address 172.31.99.1 255.255.255.0
R1(config-subif)#do show ip int brief
Interface              IP-Address      OK? Method Status                Protocol
GigabitEthernet0/0     unassigned      YES unset  administratively down down
GigabitEthernet0/0.10  172.31.10.1     YES manual administratively down down
GigabitEthernet0/0.20  172.31.20.1     YES manual administratively down down
GigabitEthernet0/0.30  172.31.30.1     YES manual administratively down down
GigabitEthernet0/0.88  172.31.88.1     YES manual administratively down down
GigabitEthernet0/0.99  172.31.99.1     YES manual administratively down down
GigabitEthernet0/1     unassigned      YES unset  administratively down down
Serial0/0/0            172.31.1.2      YES manual up                    up
Serial0/0/1            unassigned      YES unset  administratively down down
Vlan1                  unassigned      YES unset  administratively down down
R1(config-subif)#exit
R1(config)#interface G0/0
R1(config-if)#no shutdown
R1(config-if)#
%LINK-5-CHANGED: Interface GigabitEthernet0/0, changed state to up
%LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/0, changed state to up

%LINK-5-CHANGED: Interface GigabitEthernet0/0.10, changed state to up
%LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/0.10, changed state to up

%LINK-5-CHANGED: Interface GigabitEthernet0/0.20, changed state to up
%LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/0.20, changed state to up

%LINK-5-CHANGED: Interface GigabitEthernet0/0.30, changed state to up
%LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/0.30, changed state to up

%LINK-5-CHANGED: Interface GigabitEthernet0/0.88, changed state to up
%LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/0.88, changed state to up

%LINK-5-CHANGED: Interface GigabitEthernet0/0.99, changed state to up
%LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/0.99, changed state to up

R1(config-if)#do show ip route
Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area
       N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2
       E1 - OSPF external type 1, E2 - OSPF external type 2, E - EGP
       i - IS-IS, L1 - IS-IS level-1, L2 - IS-IS level-2, ia - IS-IS inter area
       * - candidate default, U - per-user static route, o - ODR
       P - periodic downloaded static route

Gateway of last resort is not set

     172.31.0.0/16 is variably subnetted, 12 subnets, 2 masks
C       172.31.1.0/24 is directly connected, Serial0/0/0
L       172.31.1.2/32 is directly connected, Serial0/0/0
C       172.31.10.0/24 is directly connected, GigabitEthernet0/0.10
L       172.31.10.1/32 is directly connected, GigabitEthernet0/0.10
C       172.31.20.0/24 is directly connected, GigabitEthernet0/0.20
L       172.31.20.1/32 is directly connected, GigabitEthernet0/0.20
C       172.31.30.0/24 is directly connected, GigabitEthernet0/0.30
L       172.31.30.1/32 is directly connected, GigabitEthernet0/0.30
C       172.31.88.0/24 is directly connected, GigabitEthernet0/0.88
L       172.31.88.1/32 is directly connected, GigabitEthernet0/0.88
C       172.31.99.0/24 is directly connected, GigabitEthernet0/0.99
L       172.31.99.1/32 is directly connected, GigabitEthernet0/0.99

add directly attached default route
-----------------------------------
R1(config)#ip route 0.0.0.0 0.0.0.0 S0/0/0
%Default route without gateway, if not a point-to-point interface, may impact performance
R1(config)#copy run start
</pre></div>
</div>
</li>
<li><p class="first">Switch Solution:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>S1&gt;enable
S1#show vlan brief

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                                Gig0/1, Gig0/2
10   Sales                            active    Fa0/11, Fa0/12, Fa0/13, Fa0/14
                                                Fa0/15
20   Production                       active    Fa0/16, Fa0/17, Fa0/18, Fa0/19
                                                Fa0/20
30   Marketing                        active    Fa0/5, Fa0/6, Fa0/7, Fa0/8
                                                Fa0/9, Fa0/10
88   Management                       active    Fa0/21, Fa0/22, Fa0/23, Fa0/24
99   Native                           active
1002 fddi-default                     active
1003 token-ring-default               active
1004 fddinet-default                  active
1005 trnet-default                    active
S1#conf t
S1(config)#interface GigabitEthernet 0/1
S1(config-if)#switchport mode trunk
S1(config-if)#
%LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/1, changed state to down
%LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/1, changed state to up
S1(config-if)#switchport trunk native vlan 99
S1(config-if)#switchport trunk allowed vlan 10,20,30,88,99
S1(config-if)#no shutdown
S1(config-if)#exit
S1(config)#interface vlan 88
S1(config-if)#ip address 172.31.88.33 255.255.255.0
S1(config-if)#do show ip int brief
Interface              IP-Address      OK? Method Status                Protocol
FastEthernet0/1        unassigned      YES manual down                  down
FastEthernet0/2        unassigned      YES manual down                  down
FastEthernet0/3        unassigned      YES manual down                  down
FastEthernet0/4        unassigned      YES manual down                  down
FastEthernet0/5        unassigned      YES manual down                  down
FastEthernet0/6        unassigned      YES manual down                  down
FastEthernet0/7        unassigned      YES manual down                  down
FastEthernet0/8        unassigned      YES manual up                    up
FastEthernet0/9        unassigned      YES manual down                  down
FastEthernet0/10       unassigned      YES manual down                  down
FastEthernet0/11       unassigned      YES manual up                    up
FastEthernet0/12       unassigned      YES manual down                  down
FastEthernet0/13       unassigned      YES manual down                  down
FastEthernet0/14       unassigned      YES manual down                  down
FastEthernet0/15       unassigned      YES manual down                  down
FastEthernet0/16       unassigned      YES manual up                    up
FastEthernet0/17       unassigned      YES manual down                  down
FastEthernet0/18       unassigned      YES manual down                  down
FastEthernet0/19       unassigned      YES manual down                  down
FastEthernet0/20       unassigned      YES manual down                  down
FastEthernet0/21       unassigned      YES manual down                  down
FastEthernet0/22       unassigned      YES manual down                  down
FastEthernet0/23       unassigned      YES manual down                  down
FastEthernet0/24       unassigned      YES manual up                    up
GigabitEthernet0/1     unassigned      YES manual up                    up
GigabitEthernet0/2     unassigned      YES manual down                  down
Vlan1                  unassigned      YES manual administratively down down
Vlan88                 172.31.88.33    YES manual up                    up
S1(config-if)#do show vlan brief

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                                Gig0/2
10   Sales                            active    Fa0/11, Fa0/12, Fa0/13, Fa0/14
                                                Fa0/15
20   Production                       active    Fa0/16, Fa0/17, Fa0/18, Fa0/19
                                                Fa0/20
30   Marketing                        active    Fa0/5, Fa0/6, Fa0/7, Fa0/8
                                                Fa0/9, Fa0/10
88   Management                       active    Fa0/21, Fa0/22, Fa0/23, Fa0/24
99   Native                           active
1002 fddi-default                     active
1003 token-ring-default               active
1004 fddinet-default                  active
1005 trnet-default                    active
S1(config-if)# exit
S1(config)#interface Gig0/1
S1(config-if)#switchport mode trunk
S1(config-if)#switchport trunk native vlan 99
S1(config-if)#switchport trunk allowed vlan 10,20,30,88,99
S1(config-if)#exit
S1(config)#do show vlan brief

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                                Gig0/2
10   Sales                            active    Fa0/11, Fa0/12, Fa0/13, Fa0/14
                                                Fa0/15
20   Production                       active    Fa0/16, Fa0/17, Fa0/18, Fa0/19
                                                Fa0/20
30   Marketing                        active    Fa0/5, Fa0/6, Fa0/7, Fa0/8
                                                Fa0/9, Fa0/10
88   Management                       active    Fa0/21, Fa0/22, Fa0/23, Fa0/24
99   Native                           active
S1(config)#do show interfaces trunk
Port        Mode         Encapsulation  Status        Native vlan
Gig0/1      on           802.1q         trunking      99

Port        Vlans allowed on trunk
Gig0/1      10,20,30,88,99

Port        Vlans allowed and active in management domain
Gig0/1      10,20,30,88,99

Port        Vlans in spanning tree forwarding state and not pruned
Gig0/1      10,20,30,88,99
</pre></div>
</div>
</li>
<li><p class="first">Router HQ Solution:</p>
<blockquote>
<div><div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">directly</span> <span class="n">attached</span> <span class="n">static</span> <span class="n">routes</span> <span class="n">to</span> <span class="n">each</span> <span class="n">VLAN</span>
<span class="o">--------------------------------------------</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip route 172.31.10.0 255.255.255.0 Serial0/0/0</span>
<span class="o">%</span><span class="n">Default</span> <span class="n">route</span> <span class="n">without</span> <span class="n">gateway</span><span class="p">,</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">point</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">point</span> <span class="n">interface</span><span class="p">,</span> <span class="n">may</span> <span class="n">impact</span> <span class="n">performance</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip route 172.31.20.0 255.255.255.0 Serial0/0/0</span>
<span class="o">%</span><span class="n">Default</span> <span class="n">route</span> <span class="n">without</span> <span class="n">gateway</span><span class="p">,</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">point</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">point</span> <span class="n">interface</span><span class="p">,</span> <span class="n">may</span> <span class="n">impact</span> <span class="n">performance</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip route 172.31.30.0 255.255.255.0 Serial0/0/0</span>
<span class="o">%</span><span class="n">Default</span> <span class="n">route</span> <span class="n">without</span> <span class="n">gateway</span><span class="p">,</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">point</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">point</span> <span class="n">interface</span><span class="p">,</span> <span class="n">may</span> <span class="n">impact</span> <span class="n">performance</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip route 172.31.88.0 255.255.255.0 Serial0/0/0</span>
<span class="o">%</span><span class="n">Default</span> <span class="n">route</span> <span class="n">without</span> <span class="n">gateway</span><span class="p">,</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">point</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">point</span> <span class="n">interface</span><span class="p">,</span> <span class="n">may</span> <span class="n">impact</span> <span class="n">performance</span>

<span class="n">primary</span> <span class="o">&amp;</span> <span class="n">backup</span> <span class="n">static</span> <span class="n">route</span> <span class="n">to</span> <span class="n">reach</span> <span class="n">Outside</span> <span class="n">Host</span>
<span class="o">---------------------------------------------------</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip route 209.165.200.0 255.255.255.224 Serial0/1/0</span>
<span class="o">%</span><span class="n">Default</span> <span class="n">route</span> <span class="n">without</span> <span class="n">gateway</span><span class="p">,</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">point</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">point</span> <span class="n">interface</span><span class="p">,</span> <span class="n">may</span> <span class="n">impact</span> <span class="n">performance</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip route 209.165.200.0 255.255.255.224 Serial0/1/1 10</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To place a switch into its factory default condition with 1 default VLAN, use the commands <code class="docutils literal"><span class="pre">delete</span> <span class="pre">flash:vlan.dat</span></code> and <code class="docutils literal"><span class="pre">erase</span> <span class="pre">startup-config</span></code>.</p>
</div>
</div>
<div class="section" id="qna-chapter-6">
<h4>QnA Chapter 6<a class="headerlink" href="#qna-chapter-6" title="Permalink to this headline">¶</a></h4>
<p>1 to 1005 = normal range vlans
1006 to 4094 = extended range vlans
.. note:: a VLAN containing user generated traffic is a <strong>data vlan</strong>
.. note:: a VLAN that contains all the unused switch ports on a device is a <strong>black hole VLAN</strong></p>
<p>to prohibit vlan on the trunk interface:<code class="docutils literal"><span class="pre">switchport</span> <span class="pre">trunk</span> <span class="pre">allowed</span> <span class="pre">vlan</span> <span class="pre">remove</span> <span class="pre">10</span></code></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If the VLAN that is associated with a port is deleted, the port becomes inactive and cannot communicate with the network any more. To verify that a port is in an inactive state, use the show interfaces switchport command.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">in a router-on-a-stick configuration, the router isn’t making any decision on what vlan’s are allowed to communicatewith eachother, it just forwards it to the subinterface looking at the destination address. Its then the switch that will decide if the vlan is allowed to pass on the trunk.</p>
</div>
</div>
</div>
<div class="section" id="chapter-7-acls">
<h3>Chapter 7 ACLs<a class="headerlink" href="#chapter-7-acls" title="Permalink to this headline">¶</a></h3>
<p>When configured, ACLs perform the following tasks:</p>
<blockquote>
<div><ul class="simple">
<li>Limit network traffic to increase network performance. For example, if corporate policy does not allow video traffic on the network, ACLs that block video traffic could be configured and applied. This would greatly reduce the network load and increase network performance.</li>
<li>Provide traffic flow control. ACLs can restrict the delivery of routing updates to ensure that the updates are from a known source.</li>
<li>Provide a basic level of security for network access. ACLs can allow one host to access a part of the network and prevent another host from accessing the same area. For example, access to the Human Resources network can be restricted to authorized users.</li>
<li>Filter traffic based on traffic type. For example, an ACL can permit email traffic, but block all Telnet traffic.</li>
<li>Screen hosts to permit or deny access to network services. ACLs can permit or deny a user to access file types, such as FTP or HTTP.</li>
</ul>
</div></blockquote>
<p>By default, a router does not have ACLs configured; therefore, by default a router does not filter traffic. Traffic that enters the router is routed solely based on information within the routing table. However, when an ACL is applied to an interface, the router performs the additional task of evaluating all network packets as they pass through the interface to determine if the packet can be forwarded.</p>
<p>In addition to either permitting or denying traffic, ACLs can be used for selecting types of traffic to be analyzed, forwarded, or processed in other ways. For example, ACLs can be used to classify traffic to enable priority processing.</p>
<p><strong>An ACL is a sequential list of permit or deny statements, known as access control entries (ACEs)</strong>. ACEs are also commonly called ACL statements. When network traffic passes through an interface configured with an ACL, the router compares the information within the packet against each ACE, in sequential order, to determine if the packet matches one of the ACEs. This process is called packet filtering.</p>
<p>Packet filtering controls access to a network by analyzing the incoming and outgoing packets and forwarding them or discarding them based on given criteria. Packet filtering can occur at Layer 3 or Layer 4.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Standard ACLs only filter at Layer 3. Extended ACLs filter at Layer 3 and Layer 4.</p>
</div>
<p>Note: Extended ACLs are beyond the scope of this course.</p>
<div class="section" id="acl-operation">
<h4>ACL operation<a class="headerlink" href="#acl-operation" title="Permalink to this headline">¶</a></h4>
<p>The source IPv4 address is the filtering criteria set in each ACE of a standard IPv4 ACL. A router configured with a standard IPv4 ACL <strong>extracts the source IPv4 address from the packet header</strong>. The router <em>starts at the top of the ACL and compares the address to each ACE sequentially. When a match is made, the router carries out the instruction, either permitting or denying the packet. After a match is made, the remaining ACEs in the ACL, if any</em> <strong>are not analyzed</strong>.</p>
<p>If the source IPv4 address does not match any ACEs in the ACL, the packet is discarded.The last statement of an ACL is always an implicit deny. This statement is automatically inserted at the end of each ACL even though it is not physically present. The implicit deny blocks all traffic. <strong>Because of this implicit deny, an ACL that does not have at least one permit statement will block all traffic</strong></p>
<p>ACLs define the set of rules that give added control for packets that enter inbound interfaces, packets that relay through the router, and packets that exit outbound interfaces of the router. ACLs do not act on packets that originate from the router itself.</p>
<p>ACLs can be configured to apply to inbound traffic and outbound traffic as shown in the figure.</p>
<img alt="nw/_static/img/inbound_outbound_acl.png" src="nw/_static/img/inbound_outbound_acl.png" />
<p><strong>Inbound ACLs</strong>
Incoming packets are processed before they are routed to the outbound interface. An inbound ACL is efficient because it saves the overhead of routing lookups if the packet is discarded. If the packet is permitted by the ACL, it is then processed for routing. Inbound ACLs are best used to filter packets when the network attached to an inbound interface is the only source of packets that need to be examined.
<strong>Outbound ACLs</strong>
Incoming packets are routed to the outbound interface, and then they are processed through the outbound ACL. Outbound ACLs are best used when the same filter will be applied to packets coming from multiple inbound interfaces before exiting the same outbound interface.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show access- lists</span>
<span class="n">Standard</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="mi">11</span>
    <span class="mi">10</span> <span class="n">deny</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="mi">20</span> <span class="n">permit</span> <span class="nb">any</span>
</pre></div>
</div>
<p>The first line of the ACL prevent s any packets originating in the 192.168.10.0/24 network, which includes Internet Control Message Protocol (ICMP) echoe s (ping requests). The second line of the ACL allows all other ip traffic from any source to transverse the router.</p>
<p>Remove access list 11 from the configuration</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">no</span> <span class="pre">access-list</span></code> command deletes all ACLs configured on the router . The <code class="docutils literal"><span class="pre">no</span> <span class="pre">access-list</span> <span class="pre">#</span></code> command removes only a specific ACL.</p>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># int se0/0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no ip access-group 11 out</span>

<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no access-list 11</span>
</pre></div>
</div>
</div>
<div class="section" id="acl-wildcard-masking">
<h4>ACL Wildcard Masking<a class="headerlink" href="#acl-wildcard-masking" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">0 means to match ip address bit - 1 means ignore address bit and zerofy</p>
</div>
<ol class="arabic simple">
<li>write out ip in binary</li>
<li>write WM in binary</li>
<li>0 match the address bit, 1 ignore address bit and put on 0</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="25%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">Decimal Address</th>
<th class="head">Binary Address</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>IP to process</td>
<td>192.168.10.0</td>
<td>11000000.10101000.00001010.00000000</td>
</tr>
<tr class="row-odd"><td>Wildcard Mask</td>
<td>0.0.255.255</td>
<td>00000000.00000000.11111111.11111111</td>
</tr>
<tr class="row-even"><td>Resulting IP</td>
<td>192.168.0.0</td>
<td>11000000.10101000.00000000.00000000</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Unlike IPv4 ACLs, IPv6 ACLs do not use wildcard masks. Instead, the prefix-length is used to indicate how much of an IPv6 source or destination address should be matched</p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="24%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">Decimal</th>
<th class="head">Binary</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>IP Address</td>
<td>192.168.16.0</td>
<td>11000000.10101000.00010000.00000000</td>
</tr>
<tr class="row-odd"><td>Wildcard Mask</td>
<td>0.0.15.255</td>
<td>00000000.00000000.00001111.11111111</td>
</tr>
<tr class="row-even"><td>Result Range</td>
<td>192.168.16.0</td>
<td>11000000.10101000.00010000.00000000</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>to</td>
<td>to</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>192.168.31.255</td>
<td>11000000.10101000.00011111.11111111</td>
</tr>
</tbody>
</table>
<p>The first two octets and first four bits of the third octet must match exactly.
The last four bits in the third octet and the last octet can be any valid number.
This results in a mask that checks for the range of networks 192.168.16.0 to 192.168.31.0.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="20%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">Decimal</th>
<th class="head">Binary</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>IP Address</td>
<td>192.168.1.0</td>
<td>11000000.10101000.00000001.00000000</td>
</tr>
<tr class="row-odd"><td>Wildcard Mask</td>
<td>0.0.254.255</td>
<td>00000000.00000000.11111110.11111111</td>
</tr>
<tr class="row-even"><td>Result</td>
<td>192.168.1.0</td>
<td>11000000.10101000.00000001.00000000</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>all odd numbered subnets</td>
</tr>
</tbody>
</table>
<p>a wildcard mask that matches the first two octets, and the least significant bit in the third octet.
The last octet and the first seven bits in the third octet can be any valid number.
The result is a mask that would permit or deny all hosts from odd subnets from the 192.168.0.0 major network.</p>
<p>calculate WM for 192.168.3.32/28 Permit nw access for the 14 users in the nw</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">255.255.255.255</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>(-)</td>
<td>255.255.255.240</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>0.0.0.15</td>
</tr>
</tbody>
</table>
<p>match only networks 192.168.10.0 and 192.168.11.0</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">255.255.255.255</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>(-)</td>
<td>255.255.254.0</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>0.0.1.255</td>
</tr>
</tbody>
</table>
<p>You could accomplish the same result with statements like the two shown below:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 10 permit 192.168.10.0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 10 permit 192.168.11.0</span>

<span class="n">It</span> <span class="ow">is</span> <span class="n">far</span> <span class="n">more</span> <span class="n">efficient</span> <span class="n">to</span> <span class="n">configure</span> <span class="n">the</span> <span class="n">wildcard</span> <span class="n">mask</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">following</span> <span class="n">way</span>
      <span class="o">-------------------------------------------------</span>

<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 10 permit 192.168.10.0 0.0.1.255</span>
</pre></div>
</div>
</div>
<div class="section" id="wildcard-mask-abbreviations">
<h4>Wildcard Mask Abbreviations<a class="headerlink" href="#wildcard-mask-abbreviations" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/wildcard_abbreviations.png" src="nw/_static/img/wildcard_abbreviations.png" />
<div class="code highlight-default"><div class="highlight"><pre><span></span>R1(config)# access-list 1 permit 0.0.0.0 255.255.255.255
!OR
R1(config)# access-list 1 permit any

R1(config)# access-list 1 permit 192.168.10.10 0.0.0.0
R1(config)# access-list 1 permit host 192.168.10.10
</pre></div>
</div>
<img alt="nw/_static/img/permit_or_deny.png" src="nw/_static/img/permit_or_deny.png" />
</div>
<div class="section" id="rules-for-applying-acls">
<h4>Rules for applying ACLs<a class="headerlink" href="#rules-for-applying-acls" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/acl_rules1.png" src="nw/_static/img/acl_rules1.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If we needed ACLs for both protocols, on both interfaces and in both directions, this would require eight separate ACLs. Each interface would have four ACLs; two ACLs for IPv4 and two ACLs for IPv6. For each protocol, one ACL is for inbound traffic and one for outbound traffic.</p>
</div>
<ul class="simple">
<li>Use ACLs in firewall routers positioned between your internal network and an external network such as the Internet.</li>
<li>Use ACLs on a router positioned between two parts of your network to control traffic entering or exiting a specific part of your internal network.</li>
<li>Configure ACLs on border routers, that is, routers situated at the edges of your networks. This provides a very basic buffer from the outside network, or between a less controlled area of your own network and a more sensitive area of your network.</li>
<li><strong>Configure ACLs for each network protocol configured on the border router</strong> interfaces.</li>
</ul>
<dl class="docutils">
<dt>One ACL per protocol:</dt>
<dd>To controll traffic flow on an interface an ACL must be defined for EACH Protocol enabled on the interface</dd>
<dt>One ACL per direction:</dt>
<dd>ACLs control traffic in one direction at a time on an interface. Two seperate ACLs must be created to control inbound &amp; outbound traffic</dd>
<dt>One ACL per interface:</dt>
<dd>ACLs control traffic for an interface, eg. GigabitEthernet 0/0</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Test your ACLs on a development network before implementing them.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Inbound ACLs, packets are processed before routing, Outbound ACLs after routing has performed</p>
</div>
</div>
<div class="section" id="acl-placement">
<h4>ACL Placement<a class="headerlink" href="#acl-placement" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Locate extended ACLs as close as possible to the source of the traffic to be filtered. This way, undesirable traffic is denied close to the source network without crossing the network infrastructure.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Because standard ACLs do not specify destination addresses, place them as close to the destination as possible. Placing a standard ACL at the source of the traffic will effectively prevent that traffic from reaching any other networks through the interface where the ACL is applied.</p>
</div>
<p><strong>extended ACLs are placed as close as possible to the source and standard ACLs are placed as close as possible to the destination</strong></p>
<ul class="simple">
<li>Placement of the ACL and therefore, the type of ACL used may also depend on</li>
</ul>
<dl class="docutils">
<dt>The extent of the network administrator’s control:</dt>
<dd>Placement of the ACL can depend on whether or not the network administrator has control of both the source and destination networks.</dd>
<dt>Bandwidth of the networks involved:</dt>
<dd>Filtering unwanted traffic at the source prevents transmission of the traffic before it consumes bandwidth on the path to a destination. This is especially important in low bandwidth networks.</dd>
<dt>Ease of configuration:</dt>
<dd>If a network administrator wants to deny traffic coming from several networks, one option is to use a single standard ACL on the router closest to the destination. The disadvantage is that traffic from these networks will use bandwidth unnecessarily. An extended ACL could be used on each router where the traffic originated. This will save bandwidth by filtering the traffic at the source but requires creating extended ACLs on multiple routers.</dd>
</dl>
<div class="section" id="standard-acl-placement">
<h5>Standard ACL placement<a class="headerlink" href="#standard-acl-placement" title="Permalink to this headline">¶</a></h5>
<img alt="nw/_static/img/standard_acl_placement.png" src="nw/_static/img/standard_acl_placement.png" />
<dl class="docutils">
<dt>R3 S0/0/1 interface:</dt>
<dd>Applying a standard ACL to prevent traffic from 192.168.10.0/24 from entering the S0/0/1 interface will prevent this traffic from reaching 192.168.30.0/24 and all other networks reachable by R3. This includes the 192.168.31.0/24 network. Because the intent of the ACL is to filter traffic destined only for 192.168.30.0/24, a standard ACL should not be applied to this interface.</dd>
<dt>R3 G0/0 interface:</dt>
<dd>Applying the standard ACL to traffic exiting the G0/0 interface will filter packets from 192.168.10.0/24 to 192.168.30.0/24. This will not affect other networks reachable by R3. Packets from 192.168.10.0/24 will still be able to reach 192.168.31.0/24.</dd>
</dl>
<p>Access-list: defines a standard ACL with a number in the range of 1 through 99</p>
<p>Router(config)# <strong>access-list</strong> 10 {<strong>deny | permit | remark</strong>} source [source-wildcard] [<strong>log</strong>]</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 10 permit 192.168.10.0 0.0.0.255</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R1</span><span class="c1"># show access-lists</span>
<span class="n">Standard</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="mi">10</span>
    <span class="mi">10</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">wildcard</span> <span class="n">bits</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
<span class="n">R1</span><span class="c1"># conf t</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no access-list 10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># show access-lists</span>
<span class="n">R1</span><span class="c1">#</span>

<span class="n">use</span> <span class="n">the</span> <span class="n">ability</span> <span class="n">to</span> <span class="n">use</span> <span class="n">remark</span>
<span class="o">-----------------------------</span>

<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 10 remark Permit hosts from the 192.168.10.0 LAN</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 10 permit 192.168.10.0 0.0.0.255</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R1</span><span class="c1"># show running-config | include access-list 10</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">10</span> <span class="n">remark</span> <span class="n">Permit</span> <span class="n">hosts</span> <span class="kn">from</span> <span class="nn">the</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.0</span> <span class="n">LAN</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">10</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
<span class="n">R1</span><span class="c1">#</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="applying-standard-ipv4-acls-to-interface">
<h4>Applying standard ipv4 ACLs to interface<a class="headerlink" href="#applying-standard-ipv4-acls-to-interface" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Router(config-if)# <strong>ip access-group</strong> { access-list-number | access-list-name } { <strong>in | out</strong> }</li>
</ul>
<dl class="docutils">
<dt>to remove ACL from interface:</dt>
<dd><code class="docutils literal"><span class="pre">no</span> <span class="pre">ip</span> <span class="pre">access-group</span> <span class="pre">10</span></code> and then <code class="docutils literal"><span class="pre">no</span> <span class="pre">access-list</span> <span class="pre">10</span></code></dd>
</dl>
<ol class="arabic simple">
<li>create the entry:
R1(config)# access-<strong>list</strong> 1 permit 192.168.10.0 0.0.0.255</li>
<li>select the interface:
R1(config)# interface serial 0/0/0</li>
<li>activate on interface:
R1(config-if)# ip access-<strong>group</strong> 1 <strong>out</strong></li>
</ol>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no access-list 1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 deny host 192.168.10.10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit 192.168.10.0 0.0.0.255</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface **S0/0/0**</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip access-group 1 **out**</span>
</pre></div>
</div>
<p>This is not very efficient, better to apply it to the inbound interface so the router doesn’t have to examine packets</p>
<img alt="nw/_static/img/efficiency_standard_acl_deny_host.png" src="nw/_static/img/efficiency_standard_acl_deny_host.png" />
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no access-list 1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 deny host 192.168.10.10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit any</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface **g0/0**</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip access-group 1 **in**</span>
</pre></div>
</div>
</div>
<div class="section" id="named-standard-acls">
<h4>Named Standard ACLs<a class="headerlink" href="#named-standard-acls" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Router(config)# <strong>ip</strong> access-list [<strong>standard | extended</strong>] name</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">name must be unique and cannot begin with number</p>
</div>
</li>
<li><p class="first">Router(config-std-nacl)# [<strong>permit | deny | remark</strong>] {source [source-wildcard]} [<strong>log</strong>]</p>
</li>
<li><p class="first">Router(config-if)# <strong>ip access-group</strong> name [<strong>in | out</strong>]</p>
<ul class="simple">
<li>Activates the named IP ACL on an interface</li>
</ul>
</li>
</ol>
<img alt="nw/_static/img/named_acl_example.png" src="nw/_static/img/named_acl_example.png" />
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip access-list standard NO_ACCESS</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1"># deny host 192.168.11.10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1"># permit any</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip access-group NO_ACCESS out</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">mnemonics -&gt; X to the source, X’ersource :) standard to destination = STD</p>
</div>
</div>
<div class="section" id="exercises">
<h4>exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h4>
<div class="section" id="pt-configuring-numbered-standard-ipv4-acls">
<h5>PT Configuring Numbered Standard IPv4 ACLs<a class="headerlink" href="#pt-configuring-numbered-standard-ipv4-acls" title="Permalink to this headline">¶</a></h5>
<p>Addressing Table</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="15%" />
<col width="22%" />
<col width="24%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R1</td>
<td>G0/0</td>
<td>192.168.10.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/1</td>
<td>192.168.11.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0</td>
<td>10.1.1.1</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>10.3.3.1</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>R2</td>
<td>G0/0</td>
<td>192.168.20.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/0</td>
<td>10.1.1.2</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/1</td>
<td>10.2.2.1</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>R3</td>
<td>G0/0</td>
<td>192.168.30.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0</td>
<td>10.3.3.2</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>10.2.2.2</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>PC1</td>
<td>NIC</td>
<td>192.168.10.10</td>
<td>255.255.255.0</td>
<td>192.168.10.1</td>
</tr>
<tr class="row-odd"><td>PC2</td>
<td>NIC</td>
<td>192.168.11.10</td>
<td>255.255.255.0</td>
<td>192.168.11.1</td>
</tr>
<tr class="row-even"><td>PC3</td>
<td>NIC</td>
<td>192.168.30.10</td>
<td>255.255.255.0</td>
<td>192.168.30.1</td>
</tr>
<tr class="row-odd"><td>WebServer</td>
<td>NIC</td>
<td>192.168.20.254</td>
<td>255.255.255.0</td>
<td>192.168.20.1</td>
</tr>
</tbody>
</table>
<img alt="nw/_static/img/ex1_std_acls.png" src="nw/_static/img/ex1_std_acls.png" />
<p>Objectives
* Part 1: Plan an ACL Implementation
* Part 2: Configure, Apply, and verify a STanDard ACL</p>
<p>Scenario
defining filtering criteria, configuring standard ACLs, applying ACLs to router interfaces, and verifying and testing the ACL implementation. The routers are already configured, including IP addresses and Enhanced Interior Gateway Routing Protocol (EIGRP) routing.</p>
<ol class="arabic">
<li><p class="first">Verify full connectivity before applying ACLs</p>
</li>
<li><p class="first">apply following policies on R2</p>
<ol class="loweralpha simple">
<li>The 192.168.11.0/24 network is not allowed access to the WebServer on the 192.168.20.0/24 network.</li>
<li>All other access is permitted</li>
</ol>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 deny 192.168.11.0 0.0.0.255</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit any</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface G0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip access-group 1 out</span>
</pre></div>
</div>
</li>
<li><p class="first">apply following policies on R3</p>
<ol class="loweralpha simple">
<li>The 192.168.10.0/24 network is not allowed to communicate with the 192.168.30.0/24 network</li>
<li>All other access is permitted</li>
</ol>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#do show access-list</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#access-list 1 deny 192.168.10.0 0.0.0.255</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#access-list 1 permit any</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface g0/0</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip access-group 1 out</span>
</pre></div>
</div>
</li>
<li><p class="first">Use the <code class="docutils literal"><span class="pre">show</span> <span class="pre">access-list</span></code> &amp; <code class="docutils literal"><span class="pre">show</span> <span class="pre">run</span></code> or <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">interface</span> <span class="pre">gigabitethernet</span> <span class="pre">0/0</span></code> command to verify ACL placements</p>
</li>
<li><p class="first">time to ping around to see what succeeds and fails</p>
<ol class="arabic simple">
<li>A ping from 192.168.10.10 to 192.168.11.10 succeeds.</li>
<li>A ping from 192.168.10.10 to 192.168.20.254 succeeds.</li>
<li>A ping from 192.168.11.10 to 192.168.20.254 fails.</li>
<li>A ping from 192.168.10.10 to 192.168.30.10 fails.</li>
<li>A ping from 192.168.11.10 to 192.168.30.10 succeeds.</li>
<li>A ping from 192.168.30.10 to 192.168.20.254 succeeds.</li>
</ol>
</li>
</ol>
</div>
<div class="section" id="pt-configuring-named-standard-ipv4-acls">
<h5>PT Configuring Named Standard IPv4 ACLs<a class="headerlink" href="#pt-configuring-named-standard-ipv4-acls" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="15%" />
<col width="23%" />
<col width="21%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R1</td>
<td>F0/0</td>
<td>192.168.10.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>R1</td>
<td>F0/1</td>
<td>192.168.20.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>R1</td>
<td>E0/0/0</td>
<td>192.168.100.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>R1</td>
<td>E0/1/0</td>
<td>192.168.200.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>File Server</td>
<td>NIC</td>
<td>192.168.200.100</td>
<td>255.255.255.0</td>
<td>192.168.200.1</td>
</tr>
<tr class="row-odd"><td>WebServer</td>
<td>NIC</td>
<td>192.168.100.100</td>
<td>255.255.255.0</td>
<td>192.168.100.1</td>
</tr>
<tr class="row-even"><td>PC0</td>
<td>NIC</td>
<td>192.168.20.3</td>
<td>255.255.255.0</td>
<td>192.168.20.1</td>
</tr>
<tr class="row-odd"><td>PC1</td>
<td>NIC</td>
<td>192.168.20.4</td>
<td>255.255.255.0</td>
<td>192.168.20.1</td>
</tr>
<tr class="row-even"><td>PC2</td>
<td>NIC</td>
<td>192.168.10.3</td>
<td>255.255.255.0</td>
<td>192.168.10.1</td>
</tr>
</tbody>
</table>
<p>solution:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1">#show access-list</span>
<span class="n">R1</span><span class="c1">#show ip access-lists</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip access-list standard File_Server_Restrictions</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#permit host 192.168.20.4</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#deny any</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#?</span>
  <span class="o">&lt;</span><span class="mi">1</span><span class="o">-</span><span class="mi">2147483647</span><span class="o">&gt;</span>  <span class="n">Sequence</span> <span class="n">Number</span>
  <span class="n">default</span>         <span class="n">Set</span> <span class="n">a</span> <span class="n">command</span> <span class="n">to</span> <span class="n">its</span> <span class="n">defaults</span>
  <span class="n">deny</span>            <span class="n">Specify</span> <span class="n">packets</span> <span class="n">to</span> <span class="n">reject</span>
  <span class="n">exit</span>            <span class="n">Exit</span> <span class="kn">from</span> <span class="nn">access</span><span class="o">-</span><span class="nb">list</span> <span class="n">configuration</span> <span class="n">mode</span>
  <span class="n">no</span>              <span class="n">Negate</span> <span class="n">a</span> <span class="n">command</span> <span class="ow">or</span> <span class="nb">set</span> <span class="n">its</span> <span class="n">defaults</span>
  <span class="n">permit</span>          <span class="n">Specify</span> <span class="n">packets</span> <span class="n">to</span> <span class="n">forward</span>
  <span class="n">remark</span>          <span class="n">Access</span> <span class="nb">list</span> <span class="n">entry</span> <span class="n">comment</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#do show access-list</span>
<span class="n">Standard</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="n">File_Server_Restrictions</span>
    <span class="mi">10</span> <span class="n">permit</span> <span class="n">host</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">20.4</span>
    <span class="mi">20</span> <span class="n">deny</span> <span class="nb">any</span>

<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#do show ip access-list</span>
<span class="n">Standard</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="n">File_Server_Restrictions</span>
    <span class="mi">10</span> <span class="n">permit</span> <span class="n">host</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">20.4</span>
    <span class="mi">20</span> <span class="n">deny</span> <span class="nb">any</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">&#64; this point no difference is noticable between show or show ip access-list</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the answer: There may be more than just IPv4 access-lists on the router. If so, the command show access-lists would show them all, including IPX or other types that may exist. On that same router, the command show ip access-lists would only show the IP access-lists, and not the IPX or other types.</p>
</div>
</div>
<div class="section" id="lab-config-mod-std-ipv4-acls">
<h5>Lab Config/Mod Std IPv4 ACLs<a class="headerlink" href="#lab-config-mod-std-ipv4-acls" title="Permalink to this headline">¶</a></h5>
<img alt="nw/_static/img/Lab_7.2.2.6.png" src="nw/_static/img/Lab_7.2.2.6.png" />
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="19%" />
<col width="23%" />
<col width="23%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R1</td>
<td>G0/1</td>
<td>192.168.10.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Lo0</td>
<td>192.168.20.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0 (DCE)</td>
<td>10.1.1.1</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>ISP</td>
<td>S0/0/0</td>
<td>10.1.1.2</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/1 (DCE)</td>
<td>10.2.2.2</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Lo0</td>
<td>209.165.200.225</td>
<td>255.255.255.224</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>R3</td>
<td>G0/1</td>
<td>192.168.30.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Lo0</td>
<td>192.168.40.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/1</td>
<td>10.2.2.1</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>S1</td>
<td>VLAN 1</td>
<td>192.168.10.11</td>
<td>255.255.255.0</td>
<td>192.168.10.1</td>
</tr>
<tr class="row-even"><td>S3</td>
<td>VLAN 1</td>
<td>192.168.30.11</td>
<td>255.255.255.0</td>
<td>192.168.30.1</td>
</tr>
<tr class="row-odd"><td>PC-A</td>
<td>NIC</td>
<td>192.168.10.3</td>
<td>255.255.255.0</td>
<td>192.168.10.1</td>
</tr>
<tr class="row-even"><td>PC-C</td>
<td>NIC</td>
<td>192.168.30.3</td>
<td>255.255.255.0</td>
<td>192.168.30.1</td>
</tr>
</tbody>
</table>
<ol class="arabic simple">
<li>Configure IP addresses on PC-A and PC-C</li>
<li>configure basic settings for routers</li>
</ol>
<blockquote>
<div><ul>
<li><p class="first">Console into router and enter global config</p>
</li>
<li><p class="first">copy following and paste it to the running config</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">no</span> <span class="n">ip</span> <span class="n">domain</span><span class="o">-</span><span class="n">lookup</span>
<span class="n">hostname</span> <span class="n">R1</span>
<span class="n">service</span> <span class="n">password</span><span class="o">-</span><span class="n">encryption</span>
<span class="n">enable</span> <span class="n">secret</span> <span class="k">class</span>
<span class="nc">banner</span> <span class="n">motd</span> <span class="c1">#</span>
<span class="n">Unauthorized</span> <span class="n">access</span> <span class="ow">is</span> <span class="n">strictly</span> <span class="n">prohibited</span><span class="o">.</span> <span class="c1">#</span>
<span class="n">Line</span> <span class="n">con</span> <span class="mi">0</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
<span class="n">logging</span> <span class="n">synchronous</span>
<span class="n">line</span> <span class="n">vty</span> <span class="mi">0</span> <span class="mi">4</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure the device name as shown in the topology.</p>
</li>
<li><p class="first">Create loopback interfaces on each router as shown in the Addressing Table.</p>
</li>
<li><p class="first">Configure interface IP addresses as shown in the Topology and Addressing Table.</p>
</li>
<li><p class="first">Assign a clock rate of <strong>128000</strong> to the DCE serial interfaces.</p>
</li>
<li><p class="first">Enable Telnet access.</p>
</li>
<li><p class="first">Copy the running configuration to the startup configuration.</p>
</li>
</ul>
</div></blockquote>
<ol class="arabic">
<li><p class="first">(optional)Configure basics on the switches</p>
<ul>
<li><p class="first">Console into switch and enter global config mode</p>
</li>
<li><p class="first">Copy the following and paste it into the running config</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">no</span> <span class="n">ip</span> <span class="n">domain</span><span class="o">-</span><span class="n">lookup</span>
<span class="n">service</span> <span class="n">password</span><span class="o">-</span><span class="n">encryption</span>
<span class="n">enable</span> <span class="n">secret</span> <span class="k">class</span>
<span class="nc">banner</span> <span class="n">motd</span> <span class="c1">#</span>
<span class="n">Unauthorized</span> <span class="n">access</span> <span class="ow">is</span> <span class="n">strictly</span> <span class="n">prohibited</span><span class="o">.</span> <span class="c1">#</span>
<span class="n">Line</span> <span class="n">con</span> <span class="mi">0</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
<span class="n">logging</span> <span class="n">synchronous</span>
<span class="n">line</span> <span class="n">vty</span> <span class="mi">0</span> <span class="mi">15</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
<span class="n">exit</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure the device name as shown in the topology.</p>
</li>
<li><p class="first">Configure the management interface IP address as shown in the Topology and Addressing Table.</p>
</li>
<li><p class="first">Configure a default gateway.</p>
</li>
<li><p class="first">Enable Telnet access.</p>
</li>
<li><p class="first">Copy the running configuration to the startup configuration.</p>
</li>
</ul>
</li>
<li><p class="first">Configure RIP routing on R1, ISP and R3</p>
<ul>
<li><p class="first">Configure RIP version 2 and advertise all networks on R1, ISP, and R3. The OSPF configuration for R1 and ISP is included for reference.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router rip</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># version 2</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># network 192.168.10.0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># network 192.168.20.0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># network 10.1.1.0</span>
<span class="n">ISP</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router rip</span>
<span class="n">ISP</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># version 2</span>
<span class="n">ISP</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># network 209.165.200.224</span>
<span class="n">ISP</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># network 10.1.1.0</span>
<span class="n">ISP</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># network 10.2.2.0</span>
</pre></div>
</div>
</li>
<li><p class="first">After configuring Rip on R1, ISP, and R3, verify that all routers have complete routing tables, listing all networks. Troubleshoot if this is not the case.</p>
</li>
</ul>
</li>
<li><p class="first">Verify connectivity between devices.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is very important to test whether connectivity is working before you configure and apply access lists!</p>
</div>
<ul class="simple">
<li>From PC-A, ping PC-C and the loopback interface on R3. Were your pings successful?</li>
<li>From R1, ping PC-C and the loopback interface on R3. Were your pings successful?</li>
<li>From PC-C, ping PC-A and the loopback interface on R1. Were your pings successful?</li>
<li>From R3, ping PC-A and the loopback interface on R1. Were your pings successful?</li>
</ul>
</li>
<li><p class="first">Configure numbered standard ACL</p>
<ul>
<li><p class="first">Standard ACLs filter traffic based on the source IP address only. A typical best practice for standard ACLs is to configure and apply it as close to the destination as possible. For the first access list, create a standard numbered ACL that allows traffic from all hosts on the 192.168.10.0/24 network and all hosts on the 192.168.20.0/24 network to access all hosts on the 192.168.30.0/24 network.</p>
</li>
<li><p class="first">The security policy also states that a deny any access control entry (ACE), also referred to as an ACL statement, should be present at the end of all ACLs. What wildcard mask would you use to allow all hosts on the 192.168.10.0/24 network to access the 192.168.30.0/24 network?</p>
</li>
<li><p class="first">Following Cisco’s recommended best practices, on which router would you place this ACL? On which interface would you place this ACL? In what direction would you apply it?</p>
</li>
<li><p class="first">Configure the ACL on R3. Use 1 for the access list number.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 remark Allow R1 LANs Access</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit 192.168.10.0 0.0.0.255</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit 192.168.20.0 0.0.0.255</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 deny any</span>
</pre></div>
</div>
</li>
<li><p class="first">Apply the ACL to the appropriate interface in the proper direction.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/1</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip access-group 1 out</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify a numbered ACL.
The use of varios show commands can aid you in verifying both the syntax and placement of your ACLs in your router.
To see access list 1 in its entirety with all ACEs, which command would you use?</p>
</li>
</ul>
</li>
<li><p class="first">On R3, issue the <code class="docutils literal"><span class="pre">show</span> <span class="pre">access-lists</span> <span class="pre">1</span></code> command.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R3</span><span class="c1"># show access-list 1</span>
<span class="n">Standard</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="mi">1</span>
    <span class="mi">10</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">wildcard</span> <span class="n">bits</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="mi">20</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">wildcard</span> <span class="n">bits</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="mi">30</span> <span class="n">deny</span>   <span class="nb">any</span>
</pre></div>
</div>
</li>
<li><p class="first">On R3, issue the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">interface</span> <span class="pre">g0/1</span></code> command.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R3</span><span class="c1"># show ip interface g0/1</span>
<span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">Internet</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">30.1</span><span class="o">/</span><span class="mi">24</span>
  <span class="n">Broadcast</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
  <span class="n">Address</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">non</span><span class="o">-</span><span class="n">volatile</span> <span class="n">memory</span>
  <span class="n">MTU</span> <span class="ow">is</span> <span class="mi">1500</span> <span class="nb">bytes</span>
  <span class="n">Helper</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="n">Directed</span> <span class="n">broadcast</span> <span class="n">forwarding</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">Multicast</span> <span class="n">reserved</span> <span class="n">groups</span> <span class="n">joined</span><span class="p">:</span> <span class="mf">224.0</span><span class="o">.</span><span class="mf">0.10</span>
  <span class="n">Outgoing</span> <span class="n">access</span> <span class="nb">list</span> <span class="ow">is</span> <span class="mi">1</span>
  <span class="n">Inbound</span> <span class="n">access</span> <span class="nb">list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="n">Output</span> <span class="n">omitted</span>
</pre></div>
</div>
</li>
<li><p class="first">Test the ACL to see if it allows traffic from the 192.168.10.0/24 network access to the 192.168.30.0/24 network. From the PC-A command prompt, ping the PC-C IP address. Were the pings successful?</p>
</li>
<li><p class="first">Test the ACL to see if it allows traffic from the 192.168.20.0/24 network access to the 192.168.30.0/24 network. You must do an extended ping and use the loopback 0 address on R1 as your source. Ping PC-C’s IP address. Were the pings successful?</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>R1#
ping
Protocol [ip]:
Target IP address:
192.168.30.3
Repeat count [5]:
Datagram size [100]:
Timeout in seconds [2]:
Extended commands [n]:
y
Source address or interface:
192.168.20.1
Type of service [0]:
Set DF bit in IP header? [no]:
Validate reply data? [no]:
Data pattern [0xABCD]:
Loose, Strict, Record, Timestamp, Verbose[none]:
Sweep range of sizes [n]:
Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 192.168.30.3, timeout is 2 seconds:
Packet sent with a source address of 192.168.20.1
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 28/29/32 ms
</pre></div>
</div>
<ul class="simple">
<li>From the R1 prompt, ping PC-C’s IP address again.
<code class="docutils literal"><span class="pre">R1#</span> <span class="pre">ping</span> <span class="pre">192.168.30.3</span></code> Was the ping successful? Why or why not?</li>
</ul>
</li>
<li><p class="first">Configure a named standard ACL. Create a named standard ACL that conforms to the following policy: allow traffic from all hosts on the 192.168.40.0/24 network access to all hosts on the 192.168.10.0/24 network. Also, only allow host PC-C access to the 192.168.10.0/24 network. The name of this access list should be called BRANCH-OFFICE-POLICY.
Following Cisco’s recommended best practices, on which router would you place this ACL? On which interface would you place this ACL? In what direction would you apply it?</p>
<ul>
<li><p class="first">Create the standard named ACL BRANCH-OFFICE-POLICY on R1.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip access-list standard BRANCH-OFFICE-POLICY</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1"># permit host 192.168.30.3</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1"># permit 192.168.40.0 0.0.0.255</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">R1</span><span class="c1">#</span>
<span class="n">Feb</span> <span class="mi">15</span> <span class="mi">15</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">55.707</span><span class="p">:</span> <span class="o">%</span><span class="n">SYS</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">CONFIG_I</span><span class="p">:</span> <span class="n">Configured</span> <span class="kn">from</span> <span class="nn">console</span> <span class="n">by</span> <span class="n">console</span>
</pre></div>
</div>
<p>Looking at the first permit ACE in the access list, what is another way to write this?</p>
</li>
<li><p class="first">Apply the ACL to the appropriate interface in the proper direction.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># config t</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip access-group BRANCH-OFFICE-POLICY out</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify a named ACL.</p>
<ol class="arabic">
<li><p class="first">On R1, issue the show access-lists command.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show access-lists</span>
<span class="n">Standard</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="n">BRANCH</span><span class="o">-</span><span class="n">OFFICE</span><span class="o">-</span><span class="n">POLICY</span>
 <span class="mi">10</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">30.3</span>
 <span class="mi">20</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">40.0</span><span class="p">,</span> <span class="n">wildcard</span> <span class="n">bits</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
</pre></div>
</div>
<p>Is there any difference between this ACL on R1 with the ACL on R3? If so, what is it?</p>
</li>
<li><p class="first">On R1, issue the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">interface</span> <span class="pre">g0/1</span></code> command.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1">#</span>
<span class="n">show</span> <span class="n">ip</span> <span class="n">interface</span> <span class="n">g0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">Internet</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.1</span><span class="o">/</span><span class="mi">24</span>
  <span class="n">Broadcast</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
  <span class="n">Address</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">non</span><span class="o">-</span><span class="n">volatile</span> <span class="n">memory</span>
  <span class="n">MTU</span> <span class="ow">is</span> <span class="mi">1500</span> <span class="nb">bytes</span>
  <span class="n">Helper</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="n">Directed</span> <span class="n">broadcast</span> <span class="n">forwarding</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">Multicast</span> <span class="n">reserved</span> <span class="n">groups</span> <span class="n">joined</span><span class="p">:</span> <span class="mf">224.0</span><span class="o">.</span><span class="mf">0.10</span>
  <span class="n">Outgoing</span> <span class="n">access</span> <span class="nb">list</span> <span class="ow">is</span> <span class="n">BRANCH</span><span class="o">-</span><span class="n">OFFICE</span><span class="o">-</span><span class="n">POLICY</span>
  <span class="n">Inbound</span> <span class="n">access</span> <span class="nb">list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
<span class="o">&lt;</span><span class="n">Output</span> <span class="n">omitted</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Test the ACL. From the command prompt on PC-C, ping PC-A’s IP address. Were the pingssuccessful?</p>
</li>
<li><p class="first">Test the ACL to ensure that only the PC-C host is allowed access to the 192.168.10.0/24 network. You must do an extended ping and use the G0/1 address on R3 as your source. Ping PC-A’s IP address. Were the pings successful?</p>
</li>
<li><p class="first">Test the ACL to see if it allows traffic from the 192.168.40.0/24 network access to the 192.168.10.0/24 network. You must perform an extended ping and use the loopback 0 address on R3 as your source. Ping PC-A’s IP address. Were the pings successful?</p>
</li>
</ol>
</li>
</ul>
</li>
<li><p class="first">Management has decided that users from the 209.165.200.224/27 network should be allowed full access to the 192.168.10.0/24 network. Management also wants ACLs on all of their router s to follow consistent rules. A deny any ACE should be placed at the end of all ACLs. You must modify the BRANCH-OFFICE-POLICY ACL. You will add two additional lines to this ACL. There are two ways you could do this:</p>
<ul>
<li><p class="first">OPTION 1: Issue a no ip access-list standard BRANCH-OFFICE-POLICY command in global configuration mode. This would effectively take the whole ACL out of the router. Depending upon the router IOS, one of the following scenarios would occur:</p>
<p>all filtering of packets would be cancelled and all packets would be allowed through the router; or, because you did not take off the ip access-group command on the G0/1 interface, filtering is still in place. Regardless, when the ACL is gone, you could retype the whole ACL, or cut and paste it in from a text editor.</p>
</li>
<li><p class="first">OPTION 2: You can modify ACLs in place by adding or deleting specific lines within the ACL itself. This can come in handy, especially with ACLs that have many lines of code. The retyping of the whole ACL or cutting and pasting can easily lead to errors. Modifying specific lines within the ACL is easily accomplished. For this lab, use Option 2.</p>
</li>
<li><p class="first">From R1 privileged EXEC mode, issue a show access-lists command.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show access-lists</span>
<span class="n">Standard</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="n">BRANCH</span><span class="o">-</span><span class="n">OFFICE</span><span class="o">-</span><span class="n">POLICY</span>
    <span class="mi">10</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">30.3</span> <span class="p">(</span><span class="mi">8</span> <span class="n">matches</span><span class="p">)</span>
    <span class="mi">20</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">40.0</span><span class="p">,</span> <span class="n">wildcard</span> <span class="n">bits</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span> <span class="p">(</span><span class="mi">5</span> <span class="n">matches</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Add two additional lines at the end of the ACL. From global config mode, modify the ACL, BRANCH-OFFICE-POLICY.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1">#(config)# ip access-list standard BRANCH-OFFICE-POLICY</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1"># 30 permit 209.165.200.224 0.0.0.31</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1"># 40 deny any</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1"># end</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify the ACL.</p>
<ol class="arabic">
<li><p class="first">On R1, issue the show access-lists command.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show access-lists</span>
<span class="n">Standard</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="n">BRANCH</span><span class="o">-</span><span class="n">OFFICE</span><span class="o">-</span><span class="n">POLICY</span>
    <span class="mi">10</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">30.3</span> <span class="p">(</span><span class="mi">8</span> <span class="n">matches</span><span class="p">)</span>
    <span class="mi">20</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">40.0</span><span class="p">,</span> <span class="n">wildcard</span> <span class="n">bits</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span> <span class="p">(</span><span class="mi">5</span> <span class="n">matches</span><span class="p">)</span>
    <span class="mi">30</span> <span class="n">permit</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.224</span><span class="p">,</span> <span class="n">wildcard</span> <span class="n">bits</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.31</span>
    <span class="mi">40</span> <span class="n">deny</span>   <span class="nb">any</span>
</pre></div>
</div>
<p>Do you have to apply the BRANCH-OFFICE-POLICY to the G0/1 interface on R1?</p>
</li>
<li><p class="first">From the ISP command prompt, issue an extended ping. Test the ACL to see if it allows traffic from the 209.165.200.224/27 network access to the 192.168.10.0/24 network. You must do an extended ping and use the loopback 0 address on ISP as your source. Ping PC-A’s IP address. Were the pings successful?</p>
</li>
</ol>
</li>
</ul>
</li>
</ol>
<p>Reflection
1. As you can see, standard ACLs are very powerful and work quite well. Why would you ever have the need for
using extended ACLs?
2. Typically, more typing is required when using a named ACL as opposed to a numbered ACL. Why would you
choose named ACLs over numbered?</p>
</div>
</div>
<div class="section" id="editing-numbered-acls">
<h4>Editing Numbered ACLs<a class="headerlink" href="#editing-numbered-acls" title="Permalink to this headline">¶</a></h4>
<div class="section" id="method-1-use-a-text-editor">
<h5>Method 1 - Use a Text Editor<a class="headerlink" href="#method-1-use-a-text-editor" title="Permalink to this headline">¶</a></h5>
<p>After someone is familiar with creating and editing ACLs, it may be easier to construct the ACL using a text editor such as Microsoft Notepad. This allows you to create or edit the ACL and then paste it into the router interface. For an existing ACL, you can use the show running-config command to display the ACL, copy and paste it into the text editor, make the necessary changes, and paste it back in to the router interface.</p>
<p>Configuration: For example, assume that the host IPv4 address in the figure was incorrectly entered. Instead of the 192.168.10.99 host, it should have been the 192.168.10.10 host. Here are the steps to edit and correct ACL 1:</p>
<ol class="arabic simple">
<li>Display the ACL using the show running-config command. The example in the figure uses the include keyword to display only the ACEs.</li>
<li>Highlight the ACL, copy it, and then paste it into a Notepad. Edit the list as required. After the ACL is correctly displayed in Notepad, highlight it and copy it.</li>
</ol>
<p>Step 3. In global configuration mode, remove the access list using the no access-list 1 command. Otherwise, the new statements would be appended to the existing ACL. Then paste the new ACL into the configuration of the router.</p>
<p>Step 4. Using the show running-config command, verify the changes</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">when using the no access-list command, different IOS software releases act differently. If the ACL that has been deleted is still applied to an interface, some IOS versions act as if <strong>no ACL is protecting your network while others deny all traffic</strong></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For this reason it is <strong>good practice to remove the reference to the access list from the interface</strong> before modifying the access list. If there is an error in the new list, disable it and troubleshoot the problem. In that instance, the network has no ACL during the correction process.</p>
</div>
</div>
<div class="section" id="method-2-use-sequence-numbers">
<h5>Method 2 - Use Sequence Numbers<a class="headerlink" href="#method-2-use-sequence-numbers" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">goto</span> <span class="n">acl</span>
<span class="o">--------</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="n">ip</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="n">standard</span> <span class="mi">1</span>

<span class="n">fix</span> <span class="n">line</span>
<span class="o">--------</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1"># no 10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1"># 10 deny host 192.168.10.10</span>

<span class="n">verify</span>
<span class="o">------</span>
<span class="n">R1</span><span class="c1"># show access-lists</span>
<span class="n">R1</span><span class="c1"># show running-config | include access-list 1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Cisco IOS implements an internal logic to standard access lists. The order in which standard ACEs are entered may not be the order in which they are stored, displayed or processed by the router. The show access-lists command displays the ACEs with their sequence numbers.</p>
</div>
</div>
</div>
<div class="section" id="adding-a-line-to-nacl">
<h4>adding a line to NACL<a class="headerlink" href="#adding-a-line-to-nacl" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1">#show access-lists</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="n">ip</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="n">standard</span> <span class="n">NAME_OF_ACCESS_LIST</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1"># 15 deny host 192.168.11.11</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1"># end</span>
</pre></div>
</div>
</div>
<div class="section" id="verifying-standard-acl-interfaces">
<h4>verifying standard ACL interfaces<a class="headerlink" href="#verifying-standard-acl-interfaces" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">R1#</span> <span class="pre">show</span> <span class="pre">ip</span> <span class="pre">interface</span> <span class="pre">s0/0/0</span></code></p>
<p>Outgoing access list is 1
Inbound  access list is not set</p>
<p><code class="docutils literal"><span class="pre">R1#</span> <span class="pre">show</span> <span class="pre">ip</span> <span class="pre">interface</span> <span class="pre">g0/0</span></code></p>
<p>Outgoing access list is NO_ACCESS
Inbound  access list is not set</p>
<p><code class="docutils literal"><span class="pre">R1#</span> <span class="pre">show</span> <span class="pre">access-lists</span></code></p>
</div>
<div class="section" id="acl-vs-ip-acl">
<h4>ACL VS IP ACL<a class="headerlink" href="#acl-vs-ip-acl" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">access-list</span></code> command is used to define a numbered ACL, meaning that the ACL will be identified in the configuration by its number. This number also designates the type of this ACL, i.e. standard IP, extended IP, MAC, etc. See here:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#access-list ?</span>
 <span class="o">&lt;</span><span class="mi">1</span><span class="o">-</span><span class="mi">99</span><span class="o">&gt;</span>            <span class="n">IP</span> <span class="n">standard</span> <span class="n">access</span> <span class="nb">list</span>
 <span class="o">&lt;</span><span class="mi">100</span><span class="o">-</span><span class="mi">199</span><span class="o">&gt;</span>         <span class="n">IP</span> <span class="n">extended</span> <span class="n">access</span> <span class="nb">list</span>
 <span class="o">&lt;</span><span class="mi">1100</span><span class="o">-</span><span class="mi">1199</span><span class="o">&gt;</span>       <span class="n">Extended</span> <span class="mi">48</span><span class="o">-</span><span class="n">bit</span> <span class="n">MAC</span> <span class="n">address</span> <span class="n">access</span> <span class="nb">list</span>
 <span class="o">&lt;</span><span class="mi">1300</span><span class="o">-</span><span class="mi">1999</span><span class="o">&gt;</span>       <span class="n">IP</span> <span class="n">standard</span> <span class="n">access</span> <span class="nb">list</span> <span class="p">(</span><span class="n">expanded</span> <span class="nb">range</span><span class="p">)</span>
 <span class="o">&lt;</span><span class="mi">200</span><span class="o">-</span><span class="mi">299</span><span class="o">&gt;</span>         <span class="n">Protocol</span> <span class="nb">type</span><span class="o">-</span><span class="n">code</span> <span class="n">access</span> <span class="nb">list</span>
 <span class="o">&lt;</span><span class="mi">2000</span><span class="o">-</span><span class="mi">2699</span><span class="o">&gt;</span>       <span class="n">IP</span> <span class="n">extended</span> <span class="n">access</span> <span class="nb">list</span> <span class="p">(</span><span class="n">expanded</span> <span class="nb">range</span><span class="p">)</span>
 <span class="o">&lt;</span><span class="mi">700</span><span class="o">-</span><span class="mi">799</span><span class="o">&gt;</span>         <span class="mi">48</span><span class="o">-</span><span class="n">bit</span> <span class="n">MAC</span> <span class="n">address</span> <span class="n">access</span> <span class="nb">list</span>
</pre></div>
</div>
<p>Following this help output, if you want to define a standard IP ACL, it has to be identified by a number in the range 1-99 or 1300-1999. Analogously, if you want to define an extended IP ACL, it must be numbered from the range 100-199 or 2000-2699. MAC ACLs would use the range 700-799 for standard ACL and 1100-1199 for extended ACL.</p>
<p>The ip access-list command defines a named IPv4 ACL, either standard or extended. A named IP ACL is totally equivalent to a numbered IP ACL in its behavior - the only difference is in the way it is configured and referenced in the configuration. Also, using the ip access-list command, you can not define different types of ACLs like MAC ACLs. Otherwise, a named and a numbered ACLs behave identically.</p>
<p>For example, these two ACLs would provide identical results:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">deny</span> <span class="n">host</span> <span class="mf">192.0</span><span class="o">.</span><span class="mf">2.4</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">deny</span> <span class="mf">192.0</span><span class="o">.</span><span class="mf">2.128</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.127</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">permit</span> <span class="nb">any</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="n">standard</span> <span class="n">MyACL1</span>
 <span class="n">deny</span> <span class="n">host</span> <span class="mf">192.0</span><span class="o">.</span><span class="mf">2.4</span>
 <span class="n">deny</span> <span class="mf">192.0</span><span class="o">.</span><span class="mf">2.128</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.127</span>
 <span class="n">permit</span> <span class="nb">any</span>
</pre></div>
</div>
<p>Also, these two ACLs would provide identical results:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">100</span> <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="mi">80</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">100</span> <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="mi">443</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">100</span> <span class="n">permit</span> <span class="n">udp</span> <span class="nb">any</span> <span class="n">host</span> <span class="mf">192.0</span><span class="o">.</span><span class="mf">2.1</span> <span class="n">eq</span> <span class="mi">53</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="n">extended</span> <span class="n">MyACL2</span>
  <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="mi">80</span>
  <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="mi">443</span>
  <span class="n">permit</span> <span class="n">udp</span> <span class="nb">any</span> <span class="n">host</span> <span class="mf">192.0</span><span class="o">.</span><span class="mf">2.1</span> <span class="n">eq</span> <span class="mi">53</span>
</pre></div>
</div>
<p>Apart from the obvious advantage of giving ACLs meaningful names instead of just numbers, the <strong>named ACLs have another advantage: they can actually be edited. Numbered ACLs cannot really be edited - you can only add new entries to their end but if you need to remove or replace an entry, you need to remove the entire ACL</strong> and enter it anew. With named ACLs, it is actually possible to perform in-place editing.</p>
<p>Let’s take the last <strong>named ACL</strong> posted. If you perform <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">access-lists</span></code> you will get the following output:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Router</span><span class="c1">#show ip access-lists</span>
<span class="n">Extended</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="n">MyACL2</span>
 <span class="mi">10</span> <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="n">www</span>
 <span class="mi">20</span> <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="mi">443</span>
 <span class="mi">30</span> <span class="n">permit</span> <span class="n">udp</span> <span class="nb">any</span> <span class="n">host</span> <span class="mf">192.0</span><span class="o">.</span><span class="mf">2.1</span> <span class="n">eq</span> <span class="n">domain</span>
</pre></div>
</div>
<p>Note the numbers 10,20,30 at the each line. They allow you to remove that particular line or insert a new line between them. For example, if I wanted to insert a new rule between the first and second entry, it would be done as follows:
ch7_named_acl_ipv4_pt.pn
.. code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="n">extended</span> <span class="n">MyACL2</span>
 <span class="mi">15</span> <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="mi">110</span>
</pre></div>
</div>
<p>Now the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">access-lists</span></code> would say:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Extended</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="n">MyACL2</span>
 <span class="mi">10</span> <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="n">www</span>
 <span class="mi">15</span> <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="n">pop3</span>
 <span class="mi">20</span> <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="mi">443</span>
 <span class="mi">30</span> <span class="n">permit</span> <span class="n">udp</span> <span class="nb">any</span> <span class="n">host</span> <span class="mf">192.0</span><span class="o">.</span><span class="mf">2.1</span> <span class="n">eq</span> <span class="n">domain</span>
</pre></div>
</div>
<p>I could use any number bch7_named_acl_ipv4_pt.pnetween 11 and 19, inclusive.</p>
<p>Now, if I wanted to remove the line 30 (the one permitting the DNS access), the command would be:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="n">extended</span> <span class="n">MyACL2</span>
<span class="n">no</span> <span class="mi">30</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">access-lists</span></code> would now produce:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Extended</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="n">MyACL2</span>
 <span class="mi">10</span> <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="n">www</span>
 <span class="mi">15</span> <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="n">pop3</span>
 <span class="mi">20</span> <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="mi">443</span>
</pre></div>
</div>
<p>These numbers are not really stored in the configuration - they are only runtime-remembered. If you restart the router, they will be reset again to 10,20,30,etc. In case you need to resequence the ACL without restarting the router, you can use the command <code class="docutils literal"><span class="pre">ip</span> <span class="pre">access-list</span> <span class="pre">resequence</span> <span class="pre">MyACL2</span> <span class="pre">10</span> <span class="pre">10</span></code> where the <strong>first “10” number specifies the starting number of the ACL entry, and the second “10” represents the increment</strong>. After entering this command in the global configuration mode, the show ip access-lists again shows:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Extended</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="n">MyACL2</span>
 <span class="mi">10</span> <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="n">www</span>
 <span class="mi">20</span> <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="n">pop3</span>
 <span class="mi">30</span> <span class="n">permit</span> <span class="n">tcp</span> <span class="nb">any</span> <span class="nb">any</span> <span class="n">eq</span> <span class="mi">443</span>
</pre></div>
</div>
<p>So to wrap it up, <em>numbered ACLs and named ACLs defined using the ip access-list command have the same effect</em>. However, <strong>the named ACLs are more flexible</strong> in the way they are defined, managed and referenced.</p>
</div>
<div class="section" id="clearing-acl-statistics">
<h4>Clearing ACL Statistics<a class="headerlink" href="#clearing-acl-statistics" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">R1#</span> <span class="pre">clear</span> <span class="pre">access-list</span> <span class="pre">counters</span> <span class="pre">1</span></code> or <code class="docutils literal"><span class="pre">clear</span> <span class="pre">access-list</span> <span class="pre">counters</span> <span class="pre">ACL_NAME</span></code></p>
<img alt="nw/_static/img/clear_matches_acl.png" src="nw/_static/img/clear_matches_acl.png" />
</div>
<div class="section" id="accesss-class-command">
<h4>Accesss-class command<a class="headerlink" href="#accesss-class-command" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">access-class</span></code> command configured in line configuration mode restricts incoming and outgoing connections between a particular VTY (into a Cisco device) and the addresses in an access list.</p>
<p>The command syntax of the access-class command is:</p>
<p><code class="docutils literal"><span class="pre">Router(config-line)#</span> <span class="pre">access-class</span> <span class="pre">access-list-number</span> <span class="pre">{</span> <span class="pre">in</span> <span class="pre">[</span> <span class="pre">vrf-also</span> <span class="pre">]</span> <span class="pre">|</span> <span class="pre">out</span> <span class="pre">}</span></code></p>
<p>The parameter in restricts incoming connections between the addresses in the access list and the Cisco device, while the parameter out restricts outgoing connections between a particular Cisco device and the addresses in the access list.</p>
<p>The following should be considered when configuring access lists on VTYs:</p>
<blockquote>
<div>Both named and numbered access lists can be applied to VTYs.
Identical restrictions should be set on all the VTYs, because a user can attempt to connect to any of them.</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Access lists apply to packets that travel through a router. They are not designed to block packets that originate within the router. By default, an outbound ACL does not prevent remote access connections initiated from the router.</p>
</div>
<img alt="nw/_static/img/ch7_access_class_1.png" src="nw/_static/img/ch7_access_class_1.png" />
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># line vty 0 15</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">line</span><span class="p">)</span><span class="c1"># login local</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">line</span><span class="p">)</span><span class="c1"># transport input ssh</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">line</span><span class="p">)</span><span class="c1"># access-class 21 in</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">line</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 21 permit 192.168.10.0 0.0.0.255</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 21 deny any</span>
</pre></div>
</div>
</div>
<div class="section" id="the-implicit-deny-any">
<h4>The implicit Deny Any<a class="headerlink" href="#the-implicit-deny-any" title="Permalink to this headline">¶</a></h4>
<p>A single-entry ACL with only one deny entry has the effect of denying all traffic. At least one permit ACE must be configured in an ACL or all traffic is blocked.</p>
<p>For the network in the figure, applying either ACL 1 or ACL 2 to the S0/0/0 interface of R1 in the outbound direction will have the same effect. Network 192.168.10.0 will be permitted to access the networks reachable through S0/0/0, while 192.168.11.0 will not be allowed to access those networks. In ACL 1, if a packet does not match the permit statement, it is discarded.</p>
<img alt="nw/_static/img/Ch7_implicit_deny_any.png" src="nw/_static/img/Ch7_implicit_deny_any.png" />
<p>ACL 1</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit 192.168.10.0 0.0.0.255</span>
</pre></div>
</div>
<p>ACL 2</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 2 permit 192.168.10.0 0.0.0.255</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 2 deny any</span>
</pre></div>
</div>
</div>
<div class="section" id="the-order-of-aces-in-an-acl">
<h4>The order of ACEs in an ACL<a class="headerlink" href="#the-order-of-aces-in-an-acl" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 3 deny 192.168.10.0 0.0.0.255</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 3 permit host 192.168.10.10</span>
<span class="o">%</span> <span class="n">Access</span> <span class="n">rule</span> <span class="n">can</span><span class="s1">&#39;t be configured at higher sequence num as it is part of the existing rule at sequence num 10</span>
</pre></div>
</div>
<p>ACL 3 Host statement conflicts with previous range statement</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 4 permit host 192.168.10.10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 4 deny 192.168.10.0 0.0.0.255</span>
</pre></div>
</div>
<p>ACL 4
.. note:: Host statement can always be configured before range statements</p>
<p>ACL 5</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 5 deny 192.168.10.0 0.0.0.255</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 5 permit host 192.168.11.10</span>
</pre></div>
</div>
<p>Host statement can be configured if there’s no conflict</p>
</div>
<div class="section" id="sequencing-considerations-during-configuration">
<h4>Sequencing considerations during configuration<a class="headerlink" href="#sequencing-considerations-during-configuration" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch7_sequencing_config.png" src="nw/_static/img/Ch7_sequencing_config.png" />
<img alt="nw/_static/img/Ch7_sequencing_after_reload.png" src="nw/_static/img/Ch7_sequencing_after_reload.png" />
<p>The order in which the standard ACEs are listed is the sequence used by the IOS to process the list. Notice that the statements are grouped into two sections, host statements followed by range statements. The sequence number indicates the order that the statement was entered, not the order the statement will be processed.</p>
<p><strong>The host statements are listed first but not necessarily in the order that they were entered. The IOS puts host statements in an order using a special hashing function</strong>. The resulting order optimizes the search for a host ACL entry. <strong>The range statements are displayed after the host statements. These statements are listed in the order in which they were entered</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The hashing function is only applied to host statements in an IPv4 standard access list.</p>
</div>
<p>Recall that standard and numbered ACLs can be edited using sequence numbers. When inserting a new ACL statement, the sequence number will only affect the location of a range statement in the list. <strong>Host statements will always be put in order using the hashing function.</strong></p>
</div>
<div class="section" id="acl-and-routing-processes">
<h4>ACL and Routing Processes<a class="headerlink" href="#acl-and-routing-processes" title="Permalink to this headline">¶</a></h4>
<p>open in new tab to view properly</p>
<a class="reference internal image-reference" href="nw/_static/img/Ch7_acl_router_processes.png"><img alt="nw/_static/img/Ch7_acl_router_processes.png" src="nw/_static/img/Ch7_acl_router_processes.png" style="width: 1874px; height: 360px;" /></a>
<p>When a packet arrives at a router interface, the router process is the same, whether ACLs are used or not. As a frame enters an interface, the router checks to see whether the destination Layer 2 address matches its interface Layer 2 address, or whether the frame is a broadcast frame.</p>
<p>If the frame address is accepted, the frame information is stripped off and the router checks for an ACL on the inbound interface. If an ACL exists, the packet is tested against the statements in the list.</p>
<p>If the packet matches a statement, the packet is either permitted or denied. If the packet is accepted, it is then checked against routing table entries to determine the destination interface. If a routing table entry exists for the destination, the packet is then switched to the outgoing interface, otherwise the packet is dropped.</p>
<p>Next, the router checks whether the outgoing interface has an ACL. If an ACL exists, the packet is tested against the statements in the list.</p>
<p>If the packet matches a statement, it is either permitted or denied.</p>
<p>If there is no ACL or the packet is permitted, the packet is encapsulated in the new Layer 2 protocol and forwarded out the interface to the next device.</p>
</div>
<div class="section" id="troubleshooting-std-ipv4-acls">
<h4>Troubleshooting StD IPv4 ACLs<a class="headerlink" href="#troubleshooting-std-ipv4-acls" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">show</span> <span class="pre">access-list</span></code></li>
<li><code class="docutils literal"><span class="pre">R1#</span> <span class="pre">show</span> <span class="pre">run</span> <span class="pre">|</span> <span class="pre">section</span> <span class="pre">interface</span></code></li>
<li><code class="docutils literal"><span class="pre">R1#</span> <span class="pre">show</span> <span class="pre">run</span> <span class="pre">|</span> <span class="pre">section</span> <span class="pre">line</span> <span class="pre">vty</span></code></li>
<li><code class="docutils literal"><span class="pre">R1(config)#</span> <span class="pre">ip</span> <span class="pre">access-list</span> <span class="pre">standard</span> <span class="pre">PC1-SSH</span></code> followed by <code class="docutils literal"><span class="pre">R1(config-std-nacl)#</span> <span class="pre">no</span> <span class="pre">10</span></code> followed by correction <code class="docutils literal"><span class="pre">R1(config-std-nacl)#</span> <span class="pre">10</span> <span class="pre">permit</span> <span class="pre">host</span> <span class="pre">192.168.10.10</span></code></li>
<li><code class="docutils literal"><span class="pre">R1#</span> <span class="pre">clear</span> <span class="pre">access-list</span> <span class="pre">counters</span></code> to only show new matches</li>
</ul>
<ol class="arabic">
<li><p class="first">check access-list</p>
</li>
<li><p class="first">check if access-list is applied to the correct interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># conf t</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no ip access-group 20 in</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># interface g0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip access-group 20 out</span>
</pre></div>
</div>
</li>
<li><p class="first">check if access-list is applied via access-class on vty’s</p>
</li>
</ol>
</div>
<div class="section" id="exercices">
<h4>Exercices<a class="headerlink" href="#exercices" title="Permalink to this headline">¶</a></h4>
<div class="section" id="pt-troubleshooting-std-ipv4-acls">
<h5>PT Troubleshooting StD IPv4 ACLs<a class="headerlink" href="#pt-troubleshooting-std-ipv4-acls" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt>Policy:</dt>
<dd><ul class="first last simple">
<li>Hosts from the 192.168.0.0/24 network are unable to access network 10.0.0.0/8.</li>
<li>L3 can’t access any devices in network 192.168.0.0/24.</li>
<li>L3 can’t access Server1 or Server2. L3 should only access Server3.</li>
<li>Hosts from the 172.16.0.0/16 network have full access to Server1, Server2 and Server3.</li>
</ul>
</dd>
</dl>
<table border="1" class="docutils" id="id196">
<caption><span class="caption-text">7.3.2.4 Packet Tracer</span><a class="headerlink" href="#id196" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">given:</p>
<div class="code last highlight-default"><div class="highlight"><pre><span></span>interface GigabitEthernet0/0
 ip address 10.0.0.1 255.0.0.0
 ip access-group FROM_10 in
 duplex auto
 speed auto
!
interface GigabitEthernet0/1
 ip address 172.16.0.1 255.255.0.0
 ip access-group FROM_172 in
 duplex auto
 speed auto
!
interface GigabitEthernet0/2
 ip address 192.168.0.1 255.255.255.0
 duplex auto
 speed auto
!
interface Vlan1
 no ip address
 shutdown
!
ip classless
!
ip flow-export version 9
!
!
ip access-list standard FROM_192
 deny 192.168.0.0 0.0.0.255
 permit any
ip access-list standard FROM_10
 deny host 10.0.0.22
 permit any
ip access-list standard FROM_172
 deny host 172.16.0.2
 permit any
!
</pre></div>
</div>
</td>
<td><p class="first">solution:</p>
<div class="code last highlight-default"><div class="highlight"><pre><span></span>interface GigabitEthernet0/0
 ip address 10.0.0.1 255.0.0.0
 ip access-group FROM_10 in
 ip access-group FROM_192 out
 duplex auto
 speed auto
!
interface GigabitEthernet0/1
 ip address 172.16.0.1 255.255.0.0
 ip access-group FROM_172 in
 duplex auto
 speed auto
!
interface GigabitEthernet0/2
 ip address 192.168.0.1 255.255.255.0
 duplex auto
 speed auto
!
interface Vlan1
 no ip address
 shutdown
!
ip classless
!
ip flow-export version 9
!
!
ip access-list standard FROM_192
 deny 192.168.0.0 0.0.0.255
 permit any
ip access-list standard FROM_10
 deny host 10.0.0.2
 permit any
ip access-list standard FROM_172
!
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pt-ch7-skills-integration-challenge">
<h5>PT Ch7 Skills Integration Challenge<a class="headerlink" href="#pt-ch7-skills-integration-challenge" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="14%" />
<col width="20%" />
<col width="22%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="4"><blockquote class="first">
<div>HQ1</div></blockquote>
<p>HQServer HQ2</p>
<blockquote class="last">
<div><p>Branch</p>
<blockquote>
<div>ISP</div></blockquote>
</div></blockquote>
</td>
<td>G0/0</td>
<td>172.16.127.254</td>
<td>255.255.192.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>G0/1</td>
<td>172.16.63.254</td>
<td>255.255.192.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>S0/0/0</td>
<td>192.168.0.1</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>S0/0/1</td>
<td>64.104.34.2</td>
<td>255.255.255.252</td>
<td>64.104.34.1</td>
</tr>
<tr class="row-even"><td rowspan="3"><p class="first">BranchServer,B2</p>
<blockquote class="last">
<div><p>B1</p>
<p>HQ</p>
</div></blockquote>
</td>
<td>G0/0</td>
<td>172.16.159.254</td>
<td>255.255.240.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>G0/1</td>
<td>172.16.143.254</td>
<td>255.255.240.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>S0/0/0</td>
<td>192.168.0.2</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>HQ1</td>
<td>NIC</td>
<td>172.16.64.1</td>
<td>255.255.192.0</td>
<td>172.16.127.254</td>
</tr>
<tr class="row-even"><td>HQ2</td>
<td>NIC</td>
<td>172.16.0.2</td>
<td>255.255.192.0</td>
<td>172.16.63.254</td>
</tr>
<tr class="row-odd"><td>HQServer.pka</td>
<td>NIC</td>
<td>172.16.0.1</td>
<td>255.255.192.0</td>
<td>172.16.63.254</td>
</tr>
<tr class="row-even"><td>B1</td>
<td>NIC</td>
<td>172.16.144.1</td>
<td>255.255.240.0</td>
<td>172.16.159.254</td>
</tr>
<tr class="row-odd"><td>B2</td>
<td>NIC</td>
<td>172.16.128.2</td>
<td>255.255.240.0</td>
<td>172.16.143.254</td>
</tr>
<tr class="row-even"><td>BranchServer.pka</td>
<td>NIC</td>
<td>172.16.128.1</td>
<td>255.255.240.0</td>
<td>172.16.143.254</td>
</tr>
</tbody>
</table>
<img alt="nw/_static/img/Ch7_Skills_Integration.png" src="nw/_static/img/Ch7_Skills_Integration.png" />
<ol class="arabic">
<li><p class="first">Configure HQ &amp; Branch with RIPv2 routing:</p>
<ul>
<li><p class="first">Advertise all three attached networks. Do not advertise the link to the internet.</p>
</li>
<li><p class="first">Configure appropriate interfaces as passive</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#router rip</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#version 2</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#network 172.16.0.0</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#network 192.168.0.0</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#passive-interface GigabitEthernet 0/1</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#passive-interface GigabitEthernet 0/0</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#passive-interface Serial 0/0/1</span>


<span class="n">Branch</span><span class="o">&gt;</span><span class="n">enable</span>
<span class="n">Branch</span><span class="c1">#conf t</span>
<span class="n">Branch</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#router rip</span>
<span class="n">Branch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#version 2</span>
<span class="n">Branch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#passive-interface GigabitEthernet 0/0</span>
<span class="n">Branch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#passive-interface GigabitEthernet 0/1</span>
<span class="n">Branch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#no auto-summary</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default routing protocol like RIP and EIGRP summarize subnets into major classful network at classful boundary. In other word, these protocols perform an auto-summarization each time they crosses a border between two different major networks. To disable this behavior and advertise subnets, ‘no auto-summary’ command is used. Let’s say router has two subnets 172.16.8.0/24 and 172.16.4.0/24 of Class B network and one subnet 10.2.0.0/16 of Class A. When auto-summary is enabled, router will advertise only summarized major classful network 172.16.0.0/16.</p>
</div>
<ol class="arabic">
<li><p class="first">Set a default route on HQ that directs traffic to S0/0/1 interface. Redistribute the route to Branch.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip route 0.0.0.0 0.0.0.0 Serial 0/0/1</span>
<span class="o">%</span><span class="n">Default</span> <span class="n">route</span> <span class="n">without</span> <span class="n">gateway</span><span class="p">,</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">point</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">point</span> <span class="n">interface</span><span class="p">,</span> <span class="n">may</span> <span class="n">impact</span> <span class="n">performance</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#router rip</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#default-information originate</span>
</pre></div>
</div>
</li>
<li><p class="first">design NACL HQServer to prevent any pc’s attached to Branch G0/1 from accessing HQServer.pka. All other traffic is permitted. Configure on appropriate router, apply it to the appropriate interface and in the appropriate direction.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip access-list standard HQServer</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#deny 172.16.128.0 0.0.15.255</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#permit any</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#exit</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface GigabitEthernet 0/1</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip access-group HQServer out</span>
</pre></div>
</div>
</li>
<li><p class="first">design NACL BranchServer to prevent any pc’s attached to HQ G0/0 from accessing the Branch server. All other traffic is permitted. Configure access list on appropriate router,interface,direction.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip access-list standard BranchServer</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#deny 172.16.64.0 0.0.63.255</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#permit any</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#exit</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface GigabitEthernet 0/1</span>
<span class="n">HQ</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip access-group BranchServer</span>
</pre></div>
</div>
</li>
</ol>
<table border="1" class="docutils" id="id197">
<caption><span class="caption-text">7.4.2.1 Packet Tracer</span><a class="headerlink" href="#id197" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">HQ:</p>
<div class="code last highlight-default"><div class="highlight"><pre><span></span>interface GigabitEthernet0/0
ip address 172.16.127.254 255.255.192.0
 duplex auto
 speed auto
!
interface GigabitEthernet0/1
 ip address 172.16.63.254 255.255.192.0
 ip access-group HQServer out
 duplex auto
 speed auto
!
interface GigabitEthernet0/2
 no ip address
 duplex auto
 speed auto
 shutdown
!
interface Serial0/0/0
 ip address 192.168.0.1 255.255.255.252
 clock rate 2000000
!
interface Serial0/0/1
 description link_ISP
 ip address 64.104.34.2 255.255.255.252
!
interface Vlan1
 no ip address
 shutdown
!
router rip
 version 2
 passive-interface GigabitEthernet0/0
 passive-interface GigabitEthernet0/1
 passive-interface Serial0/0/1
 network 172.16.0.0
 network 192.168.0.0
 default-information originate
 no auto-summary
!
ip classless
ip route 0.0.0.0 0.0.0.0 Serial0/0/1
!
ip flow-export version 9
!
!
ip access-list standard BranchServer
 deny 172.16.64.0 0.0.63.255
 permit any
ip access-list standard HQServer
 deny 172.16.144.0 0.0.15.255
 permit any
!
</pre></div>
</div>
</td>
<td><p class="first">Branch:</p>
<div class="code last highlight-default"><div class="highlight"><pre><span></span>interface GigabitEthernet0/0
 ip address 172.16.159.254 255.255.240.0
 duplex auto
 speed auto
!
interface GigabitEthernet0/1
 ip address 172.16.143.254 255.255.240.0
 ip access-group BranchServer out
 duplex auto
 speed auto
!
interface GigabitEthernet0/2
 no ip address
 duplex auto
 speed auto
 shutdown
!
interface Serial0/0/0
 ip address 192.168.0.2 255.255.255.252
!
interface Serial0/0/1
 no ip address
 clock rate 2000000
!
interface Vlan1
 no ip address
 shutdown
!
router rip
 version 2
 passive-interface GigabitEthernet0/0
 passive-interface GigabitEthernet0/1
 no auto-summary
!
ip classless
!
ip flow-export version 9
!
!
ip access-list standard BranchServer
 deny 172.16.64.0 0.0.63.255
 permit any
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>using debugging to see update entries: <code class="docutils literal"><span class="pre">router#debug</span> <span class="pre">ip</span> <span class="pre">rip</span></code></p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">HQ</span><span class="c1">#debug ip ?</span>
  <span class="n">eigrp</span>    <span class="n">IP</span><span class="o">-</span><span class="n">EIGRP</span> <span class="n">information</span>
  <span class="n">icmp</span>     <span class="n">ICMP</span> <span class="n">transactions</span>
  <span class="n">nat</span>      <span class="n">NAT</span> <span class="n">events</span>
  <span class="n">ospf</span>     <span class="n">OSPF</span> <span class="n">information</span>
  <span class="n">packet</span>   <span class="n">Packet</span> <span class="n">information</span>
  <span class="n">rip</span>      <span class="n">RIP</span> <span class="n">protocol</span> <span class="n">transactions</span>
  <span class="n">routing</span>  <span class="n">Routing</span> <span class="n">table</span> <span class="n">events</span>
<span class="n">HQ</span><span class="c1">#debug ipv6 ?</span>
  <span class="n">dhcp</span>     <span class="n">IPv6</span> <span class="n">DHCP</span> <span class="n">debugging</span>
  <span class="n">inspect</span>  <span class="n">Stateful</span> <span class="n">inspection</span> <span class="n">events</span>
  <span class="n">nd</span>       <span class="n">IPv6</span> <span class="n">Neighbor</span> <span class="n">Discovery</span> <span class="n">debugging</span>
  <span class="n">ospf</span>     <span class="n">OSPF</span> <span class="n">information</span>
<span class="o">---------------</span>
<span class="n">HQ</span><span class="c1">#debug ip rip</span>
<span class="o">---------------</span>
   <span class="n">RIP</span><span class="p">:</span> <span class="n">sending</span>  <span class="n">v2</span> <span class="n">update</span> <span class="n">to</span> <span class="mf">224.0</span><span class="o">.</span><span class="mf">0.9</span> <span class="n">via</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span> <span class="p">(</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">0.1</span><span class="p">)</span>
   <span class="n">RIP</span><span class="p">:</span> <span class="n">build</span> <span class="n">update</span> <span class="n">entries</span>
         <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span> <span class="n">via</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">metric</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tag</span> <span class="mi">0</span>
         <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">18</span> <span class="n">via</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">metric</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tag</span> <span class="mi">0</span>
         <span class="mf">172.16</span><span class="o">.</span><span class="mf">64.0</span><span class="o">/</span><span class="mi">18</span> <span class="n">via</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">metric</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tag</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="chapter-7-exam">
<h5>Chapter 7 exam<a class="headerlink" href="#chapter-7-exam" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="19%" />
<col width="32%" />
<col width="27%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">device name</th>
<th class="head">interface</th>
<th class="head">ipaddress/submask</th>
<th class="head">gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Atom</td>
<td>Gi0/0.20</td>
<td>172.16.20.0/24</td>
<td>172.16.20.254</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Gi0/0.40</td>
<td>172.16.40.0/24</td>
<td>172.16.40.254</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Gi0/0.60</td>
<td>172.16.60.0/24</td>
<td>172.16.60.254</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Gi0/0.88</td>
<td>172.16.88.0/24</td>
<td>172.16.88.254</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Gi0/1.250</td>
<td>172.16.250.0/24</td>
<td>172.16.250.254</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Gi0/1.254</td>
<td>172.16.254.0/24</td>
<td>172.16.254.254</td>
</tr>
<tr class="row-even"><td>Neutron</td>
<td>SVI</td>
<td>172.16.88.101/24</td>
<td>172.16.88.254</td>
</tr>
<tr class="row-odd"><td>Proton</td>
<td>SVI</td>
<td>172.16.88.102/24</td>
<td>172.16.88.254</td>
</tr>
<tr class="row-even"><td>Electron</td>
<td>SVI</td>
<td>172.16.88.103/24</td>
<td>172.16.88.254</td>
</tr>
<tr class="row-odd"><td>Lab 1</td>
<td>NIC</td>
<td>172.16.20.10/24</td>
<td>172.16.20.254</td>
</tr>
<tr class="row-even"><td>Research 1</td>
<td>NIC</td>
<td>172.16.40.10/24</td>
<td>172.16.40.254</td>
</tr>
<tr class="row-odd"><td>Prod 1</td>
<td>NIC</td>
<td>172.16.60.10/24</td>
<td>172.16.60.254</td>
</tr>
<tr class="row-even"><td>Lab 2</td>
<td>NIC</td>
<td>172.16.20.20/24</td>
<td>172.16.20.254</td>
</tr>
<tr class="row-odd"><td>Research 2</td>
<td>NIC</td>
<td>172.16.40.20/24</td>
<td>172.16.40.254</td>
</tr>
<tr class="row-even"><td>Prod 2</td>
<td>NIC</td>
<td>172.16.60.20/24</td>
<td>172.16.60.254</td>
</tr>
<tr class="row-odd"><td>DNS Server</td>
<td>NIC</td>
<td>172.16.254.252</td>
<td>172.16.254.254</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="23%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">VLAN Number</th>
<th class="head">VLAN Name</th>
<th class="head">Device/Ports</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>20</td>
<td>Lab</td>
<td>Proton: Fa0/1 - Fa0/5</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>Electron: Fa0/1 - Fa0/5</td>
</tr>
<tr class="row-even"><td>40</td>
<td>Research</td>
<td>Proton: Fa0/6 - Fa0/10</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>Electron: Fa0/6 - Fa0/10</td>
</tr>
<tr class="row-even"><td>60</td>
<td>Production</td>
<td>Proton: Fa0/11 - Fa0/15</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>Electron: Fa0/11 - Fa0/15</td>
</tr>
<tr class="row-even"><td>88</td>
<td>NetOps</td>
<td>Neutron: SVI</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>Proton: SVI</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>&#160;</td>
<td>Electron: SVI</td>
</tr>
</tbody>
</table>
<p>solution on router Atom</p>
<p>commands used on the switches</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">interface</span> <span class="nb">range</span> <span class="n">FastEthernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">23</span> <span class="o">-</span> <span class="mi">24</span>
<span class="n">switchport</span> <span class="n">mode</span> <span class="n">trunk</span>
<span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="mi">20</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">88</span>

<span class="n">interface</span> <span class="n">GigabitEthernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">switchport</span> <span class="n">mode</span> <span class="n">trunk</span>
<span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="mi">20</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">88</span>

<span class="n">interface</span> <span class="nb">range</span> <span class="n">FastEthernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">22</span>
<span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span>

<span class="n">interface</span> <span class="n">vlan</span> <span class="mi">88</span>
<span class="n">ip</span> <span class="n">address</span> <span class="mf">171.16</span><span class="o">.</span><span class="mf">88.101</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>
<span class="n">no</span> <span class="n">shutdown</span>

<span class="n">interface</span> <span class="nb">range</span> <span class="n">FastEthernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">5</span>
<span class="n">switchport</span> <span class="n">access</span> <span class="n">vlan</span> <span class="mi">20</span>
<span class="n">no</span> <span class="n">shutdown</span>

<span class="n">interface</span> <span class="nb">range</span> <span class="n">FastEthernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">6</span> <span class="o">-</span> <span class="mi">10</span>
<span class="n">switchport</span> <span class="n">access</span> <span class="n">vlan</span> <span class="mi">40</span>
<span class="n">no</span> <span class="n">shutdown</span>

<span class="n">interface</span> <span class="nb">range</span> <span class="n">FastEthernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">11</span> <span class="o">-</span> <span class="mi">15</span>
<span class="n">switchport</span> <span class="n">access</span> <span class="n">vlan</span> <span class="mi">60</span>
<span class="n">no</span> <span class="n">shutdown</span>

<span class="n">vtp</span> <span class="n">domain</span> <span class="n">School</span>
<span class="n">vtp</span> <span class="n">version</span> <span class="mi">2</span>
<span class="n">vtp</span> <span class="n">mode</span> <span class="n">client</span>
</pre></div>
</div>
<p>don’t forget to configure the gateway for switches
and ip address for mgmt vlan on every switch</p>
<dl class="docutils">
<dt>make sure you apply ACL on subinterface</dt>
<dd><code class="docutils literal"><span class="pre">Network:[[R1name]]:Ports:GigabitEthernet0/1.250:Access-group</span> <span class="pre">Out</span></code></dd>
</dl>
<p>Router configuration</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>Atom#show run
Building configuration...

Current configuration : 1841 bytes
!
version 15.1
no service timestamps log datetime msec
no service timestamps debug datetime msec
service password-encryption
!
hostname Atom
!
enable secret 5 $1$mERr$hx5rVt7rPNoS4wqbXKX7m0
!
!
!
no ip cef
no ipv6 cef
!
!
!
!
no ip domain-lookup
!
!spanning-tree mode pvst
!
!
!
interface GigabitEthernet0/0
 no ip address
 duplex auto
 speed auto
!
interface GigabitEthernet0/0.20
 encapsulation dot1Q 20
 ip address 172.16.20.254 255.255.255.0
!
interface GigabitEthernet0/0.40
 encapsulation dot1Q 40
 ip address 172.16.40.254 255.255.255.0
!
interface GigabitEthernet0/0.60
 encapsulation dot1Q 60
 ip address 172.16.60.254 255.255.255.0
!
interface GigabitEthernet0/0.88
 encapsulation dot1Q 88
 ip address 172.16.88.254 255.255.255.0
!
interface GigabitEthernet0/1
 no ip address
 duplex auto
 speed auto
!
interface GigabitEthernet0/1.250
 encapsulation dot1Q 250
 ip address 172.16.250.254 255.255.255.0
 ip access-group INT-WEB out
!
interface GigabitEthernet0/1.254
 encapsulation dot1Q 254
 ip address 172.16.254.254 255.255.255.0
!
interface Serial0/0/0
 ip address 209.165.200.226 255.255.255.252
!
interface Serial0/0/1
 no ip address
 clock rate 2000000
 shutdown
!
interface Vlan1
 no ip address
 shutdown
!
ip classless
ip route 0.0.0.0 0.0.0.0 209.165.200.225
!
ip flow-export version 9
!
!
access-list 10 permit 172.16.60.0 0.0.0.255
ip access-list standard INT-WEB
 permit 172.16.40.0 0.0.0.255
 permit 172.16.60.0 0.0.0.255
 remark allow Research and Production VLANs to reach www.int.com
!
!
!
line con 0
 exec-timeout 180 0
 password 7 0822455D0A16
 logging synchronous
 login
!
line aux 0
!
line vty 0 4
 access-class 10 in
 password 7 0822455D0A16
 login
line vty 5 15
 access-class 10 in
 password 7 0822455D0A16
 login
!
!
!
end
</pre></div>
</div>
</div>
</div>
<div class="section" id="ch7-qna">
<h4>Ch7 QnA<a class="headerlink" href="#ch7-qna" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>ACL:</dt>
<dd>a method of controlling packet flow</dd>
<dt>ACE:</dt>
<dd>one line in an ACL</dd>
<dt>Standard ACL:</dt>
<dd>IP-based ACLs that can be numbered 1 to 99</dd>
<dt>ip access-group:</dt>
<dd>a command that is used to apply a standard ACL to an interface</dd>
<dt>access-class:</dt>
<dd>a command that is used to apply a standard ACL to one or more VTY ports</dd>
<dt>goes to next ACE:</dt>
<dd>the action taken when the criteria specified in an ACE does not match</dd>
<dt>0.0.0.31:</dt>
<dd>wildcard mask for a /27 network</dd>
<dt>match the address bit value:</dt>
<dd>the purpose of a zero in a wildcard mask</dd>
<dt>closest to destination:</dt>
<dd>the common placement location for a standard ACL</dd>
<dt>one:</dt>
<dd>the number of IP-based ACLs that can be applied to one router interface in the inbound direction</dd>
<dt>easy to modify:</dt>
<dd>an advantage of using a named ACL</dd>
<dt>host:</dt>
<dd>the common keyword that is used when only one IP address is to be matched</dd>
<dt>any:</dt>
<dd>the keyword that is the same as using an address of 0.0.0.0 255.255.255.255</dd>
<dt>permit or deny:</dt>
<dd>the actions that can be taken when a router matches an address in an ACE</dd>
<dt>Which scenario would cause an ACL misconfiguration and deny all traffic?</dt>
<dd>Apply an ACL that has all deny ACE statements</dd>
<dt>Which type of standard ACL is easiest to modify on a production router?</dt>
<dd>A named ACL that has not been applied yet</dd>
<dt>Two common reasons for having a named ACL are</dt>
<dd>its function is easier to identify
the ACL is easier to modify</dd>
</dl>
<ul class="simple">
<li>ACLs can be used for the following:<ul>
<li>Limit network traffic in order to provide adequate network performance</li>
<li>Restrict the delivery of routing updates</li>
<li>Provide a basic level of security</li>
<li>Filter traffic based on the type of traffic being sent</li>
<li>Filter traffic based on IP addressing</li>
</ul>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <code class="docutils literal"><span class="pre">R1(config)#</span> <span class="pre">no</span> <span class="pre">access-list</span> <span class="pre">#</span></code> command removes the ACL from the running-config immediately. HOWEVER, to disable an ACL on an interface, the command <code class="docutils literal"><span class="pre">R1(config-if)#</span> <span class="pre">no</span> <span class="pre">ip</span> <span class="pre">access-group</span></code> should be entered.</p>
</div>
<img alt="nw/_static/img/Ch7_qna_1.png" src="nw/_static/img/Ch7_qna_1.png" />
<dl class="docutils">
<dt>If a router has two interfaces and is routing both IPv4 and IPv6 traffic, how many ACLs could be created and applied to it?</dt>
<dd>3P rule: 1 ACL per Protocol, 1 per Direction, 1 per Interface (PDI). In this case 2 interfaces x 2 protocols x 2 directions = 8</dd>
</dl>
<img alt="nw/_static/img/Ch7_qna_2.png" src="nw/_static/img/Ch7_qna_2.png" />
<img alt="nw/_static/img/Ch7_qna_3.png" src="nw/_static/img/Ch7_qna_3.png" />
<img alt="nw/_static/img/Ch7_qna_4.png" src="nw/_static/img/Ch7_qna_4.png" />
</div>
</div>
<div class="section" id="chapter-8-dhcp">
<h3>Chapter 8 DHCP<a class="headerlink" href="#chapter-8-dhcp" title="Permalink to this headline">¶</a></h3>
<p>The DHCPv4 server dynamically assigns, or leases, an IPv4 address from a pool of addresses for a limited period of time chosen by the server, or until the client no longer needs the address.</p>
<p>Clients lease the information from the server for an administratively defined period. Administrators configure DHCPv4 servers to set the leases to time out at different intervals. The lease is typically anywhere from 24 hours to a week or more. When the lease expires, the client must ask for another address, although the client is typically reassigned the same address.</p>
<p>Lease Origination</p>
<img alt="nw/_static/img/Ch8_dhcp4_lease_origination.png" src="nw/_static/img/Ch8_dhcp4_lease_origination.png" />
<p>When the client boots (or otherwise wants to join a network), it begins a four step process to obtain a lease. As shown in Figure 2, a client starts the process with a broadcast DHCPDISCOVER message with its own MAC address to discover available DHCPv4 servers.</p>
<p>DHCP Discover (DHCPDISCOVER)</p>
<p>The DHCPDISCOVER message finds DHCPv4 servers on the network. Because the client has no valid IPv4 information at bootup, it uses Layer 2 and Layer 3 broadcast addresses to communicate with the server.</p>
<p>DHCP Offer (DHCPOFFER)</p>
<p>When the DHCPv4 server receives a DHCPDISCOVER message, it reserves an available IPv4 address to lease to the client. The server also creates an ARP entry consisting of the MAC address of the requesting client and the leased IPv4 address of the client. As shown in Figure 3, the DHCPv4 server sends the binding DHCPOFFER message to the requesting client. The DHCPOFFER message is sent as a unicast, using the Layer 2 MAC address of the server as the source address and the Layer 2 MAC address of the client as the destination.</p>
<p>DHCP Request (DHCPREQUEST)</p>
<p>When the client receives the DHCPOFFER from the server, it sends back a DHCPREQUEST message as shown in Figure 4. This message is used for both lease origination and lease renewal. When used for lease origination, the DHCPREQUEST serves as a binding acceptance notice to the selected server for the parameters it has offered and an implicit decline to any other servers that may have provided the client a binding offer.</p>
<p>Many enterprise networks use multiple DHCPv4 servers. The DHCPREQUEST message is sent in the form of a broadcast to inform this DHCPv4 server and any other DHCPv4 servers about the accepted offer.</p>
<p>DHCP Acknowledgment (DHCPACK)</p>
<p>On receiving the DHCPREQUEST message, the server verifies the lease information with an ICMP ping to that address to ensure it is not being used already, creates a new ARP entry for the client lease, and replies with a unicast DHCPACK message as shown in Figure 5. The DHCPACK message is a duplicate of the DHCPOFFER, except for a change in the message type field. When the client receives the DHCPACK message, it logs the configuration information and performs an ARP lookup for the assigned address. If there is no reply to the ARP, the client knows that the IPv4 address is valid and starts using it as its own.</p>
<img alt="nw/_static/img/Ch8_dhcp4_lease_renewal.png" src="nw/_static/img/Ch8_dhcp4_lease_renewal.png" />
<p>Lease Renewal</p>
<p>DHCP Request (DHCPREQUEST)</p>
<p>As shown in Figure 6, before the lease expires, the client sends a DHCPREQUEST message directly to the DHCPv4 server that originally offered the IPv4 address. If a DHCPACK is not received within a specified amount of time, the client broadcasts another DHCPREQUEST so that one of the other DHCPv4 servers can extend the lease.</p>
<p>DHCP Acknowledgment (DHCPACK)</p>
<p>On receiving the DHCPREQUEST message, the server verifies the lease information by returning a DHCPACK, as shown in Figure.</p>
<div class="section" id="dhcpv4-message-format">
<h4>DHCPv4 Message Format<a class="headerlink" href="#dhcpv4-message-format" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch8_dhcp4_message_format.png" src="nw/_static/img/Ch8_dhcp4_message_format.png" />
<ul class="simple">
<li>Operation (OP) Code - Specifies the general type of message. A value of 1 indicates a request message; a value of 2 is a reply message.</li>
<li>Hardware Type - Identifies the type of hardware used in the network. For example, 1 is Ethernet, 15 is Frame Relay, and 20 is a serial line. These are the same codes used in ARP messages.</li>
<li>Hardware Address Length - Specifies the length of the address.</li>
<li>Hops - Controls the forwarding of messages. Set to 0 by a client before transmitting a request.</li>
<li>Transaction Identifier - Used by the client to match the request with replies received from DHCPv4 servers.</li>
<li>Seconds - Identifies the number of seconds elapsed since a client began attempting to acquire or renew a lease. Used by DHCPv4 servers to prioritize replies when multiple client requests are outstanding.</li>
<li>Flags - Used by a client that does not know its IPv4 address when it sends a request. Only one of the 16 bits is used, which is the broadcast flag. A value of 1 in this field tells the DHCPv4 server or relay agent receiving the request that the reply should be sent as a broadcast.</li>
<li>Client IP Address - Used by a client during lease renewal when the address of the client is valid and usable, not during the process of acquiring an address. The client puts its own IPv4 address in this field if and only if it has a valid IPv4 address while in the bound state; otherwise, it sets the field to 0.</li>
<li>Your IP Address - Used by the server to assign an IPv4 address to the client.</li>
<li>Server IP Address - Used by the server to identify the address of the server that the client should use for the next step in the bootstrap process, which may or may not be the server sending this reply. The sending server always includes its own IPv4 address in a special field called the Server Identifier DHCPv4 option.</li>
<li>Gateway IP Address - Routes DHCPv4 messages when DHCPv4 relay agents are involved. The gateway address facilitates communications of DHCPv4 requests and replies between the client and a server that are on different subnets or networks.</li>
<li>Client Hardware Address - Specifies the physical layer of the client.</li>
<li>Server Name - Used by the server sending a DHCPOFFER or DHCPACK message. The server may optionally put its name in this field. This can be a simple text nickname or a DNS domain name, such as dhcpserver.netacad.net.</li>
<li>Boot Filename - Optionally used by a client to request a particular type of boot file in a DHCPDISCOVER message. Used by a server in a DHCPOFFER to fully specify a boot file directory and filename.</li>
<li>DHCP Options - Holds DHCP options, including several parameters required for basic DHCP operation. This field is variable in length. Both client and server may use this field.</li>
</ul>
</div>
<div class="section" id="dhcpv4-discover-message">
<h4>DHCPv4 Discover Message<a class="headerlink" href="#dhcpv4-discover-message" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch8_dhcp4_discover_message.png" src="nw/_static/img/Ch8_dhcp4_discover_message.png" />
<p>As shown in Figure 1, the client IPv4 address (CIADDR), default gateway address (GIADDR), and subnet mask are all marked to indicate that the address 0.0.0.0 is used.</p>
<p>Note: Unknown information is sent as 0.0.0.0.</p>
<p>When the DHCPv4 server receives the DHCPDISCOVER message, it responds with a DHCPOFFER message. This message contains initial configuration information for the client, including the IPv4 address that the server offers, the subnet mask, the lease duration, and the IPv4 address of the DHCPv4 server making the offer.</p>
<p>The DHCPOFFER message can be configured to include other information, such as the lease renewal time and DNS address.</p>
<img alt="nw/_static/img/Ch8_dhcp4_offer_message.png" src="nw/_static/img/Ch8_dhcp4_offer_message.png" />
<p>As shown now, the DHCP server responds to the DHCPDISCOVER by assigning values to the CIADDR and subnet mask. The frame is constructed using the client hardware address (CHADDR) and sent to the requesting client.</p>
<p>The client and server send acknowledgment messages, and the process is complete.</p>
</div>
<div class="section" id="dhcpv4-basic-server-configuration">
<h4>DHCPv4 basic server configuration<a class="headerlink" href="#dhcpv4-basic-server-configuration" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">step</span> <span class="mi">1</span> <span class="n">excluding</span> <span class="n">addresses</span>
<span class="o">--------------------------</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp excluded-address 192.168.10.1 192.168.10.9</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp excluded-address 192.168.10.254</span>

<span class="n">step</span> <span class="mi">2</span> <span class="n">configuring</span> <span class="n">a</span> <span class="n">pool</span>
<span class="o">-------------------------</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp pool LAN-POOL-1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#</span>

<span class="n">step</span> <span class="mi">3</span> <span class="n">configuring</span> <span class="n">specific</span> <span class="n">tasks</span>
<span class="o">---------------------------------</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># network network-number [mask | /prefix-length]</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># network 192.168.10.0 255.255.255.0</span>

<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># default-router address address2...address8</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># default-router 192.168.10.1</span>

<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># dns-server address address2...address8</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># dns-server 192.168.11.5</span>

<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># domain-name example.com</span>

<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># lease {days [hours] [minutes] | infinite}</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#</span>

<span class="n">optional</span>
<span class="o">--------</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># netbios-name-server 192.168.x.x addr2..addr8</span>
</pre></div>
</div>
<p>disable DHCPv4 with the <code class="docutils literal"><span class="pre">no</span> <span class="pre">service</span> <span class="pre">dhcp</span></code> global config mode command</p>
</div>
<div class="section" id="verifying-dhcpv4">
<h4>Verifying DHCPv4<a class="headerlink" href="#verifying-dhcpv4" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">show</span> <span class="pre">running-config</span> <span class="pre">|</span> <span class="pre">section</span> <span class="pre">dhcp</span></code></p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Router</span><span class="o">&gt;</span> <span class="n">show</span> <span class="n">ip</span> <span class="n">dhcp</span> <span class="n">server</span> <span class="n">statistics</span>
<span class="o">--------------------------------------</span>
<span class="n">Memory</span> <span class="n">usage</span>          <span class="mi">40392</span>
<span class="n">Address</span> <span class="n">pools</span>         <span class="mi">3</span>
<span class="n">Database</span> <span class="n">agents</span>       <span class="mi">1</span>
<span class="n">Automatic</span> <span class="n">bindings</span>    <span class="mi">190</span>
<span class="n">Manual</span> <span class="n">bindings</span>       <span class="mi">1</span>
<span class="n">Expired</span> <span class="n">bindings</span>      <span class="mi">3</span>
<span class="n">Malformed</span> <span class="n">messages</span>    <span class="mi">0</span>

<span class="n">Message</span>               <span class="n">Received</span>
<span class="n">BOOTREQUEST</span>           <span class="mi">12</span>
<span class="n">DHCPDISCOVER</span>          <span class="mi">200</span>
<span class="n">DHCPREQUEST</span>           <span class="mi">178</span>
<span class="n">DHCPDECLINE</span>           <span class="mi">0</span>
<span class="n">DHCPRELEASE</span>           <span class="mi">0</span>
<span class="n">DHCPINFORM</span>            <span class="mi">0</span>

<span class="n">Message</span>               <span class="n">Sent</span>
<span class="n">BOOTREPLY</span>             <span class="mi">12</span>
<span class="n">DHCPOFFER</span>             <span class="mi">190</span>
<span class="n">DHCPACK</span>               <span class="mi">172</span>
<span class="n">DHCPNAK</span>               <span class="mi">6</span>
<span class="n">Release</span>

<span class="n">Router</span><span class="c1">#show ip dhcp binding</span>
<span class="o">---------------------------</span>
<span class="n">Bindings</span> <span class="kn">from</span> <span class="nn">all</span> <span class="n">pools</span> <span class="ow">not</span> <span class="n">associated</span> <span class="k">with</span> <span class="n">VRF</span><span class="p">:</span>
<span class="n">IP</span> <span class="n">address</span>   <span class="n">Client</span><span class="o">-</span><span class="n">ID</span><span class="o">/</span>    <span class="n">Lease</span> <span class="n">expiration</span>     <span class="n">Type</span>
             <span class="n">Hardware</span> <span class="n">address</span><span class="o">/</span>
             <span class="n">User</span> <span class="n">name</span>
<span class="mf">10.0</span><span class="o">.</span><span class="mf">2.1</span> <span class="mf">0100.1e68</span><span class="o">.</span><span class="n">ffd3</span><span class="o">.</span><span class="mi">5</span><span class="n">f</span> <span class="n">Oct</span> <span class="mi">12</span> <span class="mi">2016</span> <span class="mi">10</span><span class="p">:</span><span class="mi">08</span> <span class="n">PM</span> <span class="n">Automatic</span>

<span class="n">Router</span><span class="c1">#show ip dhcp pool</span>
<span class="o">------------------------</span>
<span class="n">Pool</span> <span class="n">dmz</span> <span class="p">:</span>
<span class="n">Utilization</span> <span class="n">mark</span> <span class="p">(</span><span class="n">high</span><span class="o">/</span><span class="n">low</span><span class="p">)</span> <span class="p">:</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">0</span>
<span class="n">Subnet</span> <span class="n">size</span> <span class="p">(</span><span class="n">first</span><span class="o">/</span><span class="nb">next</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0</span> <span class="o">/</span> <span class="mi">0</span>
<span class="n">Total</span> <span class="n">addresses</span> <span class="p">:</span> <span class="mi">254</span>
<span class="n">Leased</span> <span class="n">addresses</span> <span class="p">:</span> <span class="mi">1</span>
<span class="n">Pending</span> <span class="n">event</span> <span class="p">:</span> <span class="n">none</span>
<span class="mi">1</span> <span class="n">subnet</span> <span class="ow">is</span> <span class="n">currently</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">pool</span> <span class="p">:</span>
<span class="n">Current</span> <span class="n">index</span> <span class="n">IP</span> <span class="n">address</span> <span class="nb">range</span> <span class="n">Leased</span> <span class="n">addresses</span>
<span class="mf">10.0</span><span class="o">.</span><span class="mf">2.2</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.1</span> <span class="o">-</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.254</span> <span class="mi">1</span>
</pre></div>
</div>
<p>show dhcp lease information on debian</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>patrick@debian:~[brunswyck:docu.git master|!?]$ cat /var/lib/dhcp/dhclient.leases
lease {
  interface &quot;eno2&quot;;
  fixed-address 192.168.111.116;
  option subnet-mask 255.255.255.0;
  option routers 192.168.110.1;
  option dhcp-lease-time 7200;
  option dhcp-message-type 5;
  option domain-name-servers 208.67.222.222,208.67.220.220,8.8.8.8;
  option dhcp-server-identifier 192.168.111.1;
  option domain-name &quot;home&quot;;
  renew 3 2017/09/13 08:33:03;
  rebind 3 2017/09/13 09:23:03;
  expire 3 2017/09/13 09:38:03;
}
</pre></div>
</div>
</div>
<div class="section" id="configure-dhcpv4-relay">
<h4>Configure DHCPv4 relay<a class="headerlink" href="#configure-dhcpv4-relay" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip helper-address 192.168.11.6</span>
<span class="n">confirm</span> <span class="k">with</span>
<span class="n">R1</span><span class="c1"># show ip interface g0/0</span>
<span class="o">...</span><span class="n">Helper</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">11.6</span><span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="dhcpv4-exercises">
<h4>DHCPv4 Exercises<a class="headerlink" href="#dhcpv4-exercises" title="Permalink to this headline">¶</a></h4>
<div class="section" id="lab-configuring-basic-dhcpv4">
<h5>8.1.2.3 lab - configuring basic dhcpv4<a class="headerlink" href="#lab-configuring-basic-dhcpv4" title="Permalink to this headline">¶</a></h5>
<img alt="nw/_static/img/Ch8_lab_8.1.2.3_cfg_dhcpv4.png" src="nw/_static/img/Ch8_lab_8.1.2.3_cfg_dhcpv4.png" />
<p>Required Resources
+ 3 Routers (Cisco 1941 with Cisco IOS Release 15.2(4)M3 universal image or comparable)
+ 2 Switches (Cisco 2960 with Cisco IOS Release 15.0(2) lanbasek9 image or comparable)</p>
<p>R1 = relay agent</p>
<p>R2 = DHCPv4 server</p>
<p>you will configure a DHCP address pool for each of the R1 LANs. Use the pool name R1G0for the G0/0 LAN and R1G1for the G0/1 LAN.</p>
<p>You will also configure the addresses to be excluded from the address pools. Best practice dictates that excluded addresses be configured first, to guarantee that they are not accidentally leased to other devices.</p>
<p>Exclude the first 9 addresses in each R1 LAN starting with .1. All other addresses should be available in the DHCP address pool. Make sure that each DHCP address pool includes a default gateway, the domain ccna-lab.com, a DNS server (209.165.200.225), and a lease time of 2 days.</p>
<p>On the lines below, write the commands necessary for configuring DHCP services on router R2, including the DHCP-excluded addresses and the DHCP address pools.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="19%" />
<col width="23%" />
<col width="23%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R1</td>
<td>G0/0</td>
<td>192.168.0.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/1</td>
<td>192.168.1.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0 (DCE)</td>
<td>192.168.2.253</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>R2</td>
<td>S0/0/0</td>
<td>192.168.2.254</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/1 (DCE)</td>
<td>209.165.200.226</td>
<td>255.255.255.224</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>ISP</td>
<td>S0/0/1</td>
<td>209.165.200.225</td>
<td>255.255.255.224</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>PC-A</td>
<td>NIC</td>
<td>DHCP</td>
<td>DHCP</td>
<td>DHCP</td>
</tr>
<tr class="row-odd"><td>PC-B</td>
<td>NIC</td>
<td>DHCP</td>
<td>DHCP</td>
<td>DHCP</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">basic</span> <span class="n">config</span>
<span class="o">------------</span>
<span class="n">no</span> <span class="n">ip</span> <span class="n">domain</span><span class="o">-</span><span class="n">lookup</span>
<span class="n">service</span> <span class="n">password</span><span class="o">-</span><span class="n">encryption</span>
<span class="n">enable</span> <span class="n">secret</span> <span class="k">class</span>
<span class="nc">banner</span> <span class="n">motd</span> <span class="c1">#</span>
<span class="n">Unauthorized</span> <span class="n">access</span> <span class="ow">is</span> <span class="n">strictly</span> <span class="n">prohibited</span><span class="o">.</span> <span class="c1">#</span>
<span class="n">line</span> <span class="n">con</span> <span class="mi">0</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
<span class="n">logging</span> <span class="n">synchronous</span>
<span class="n">line</span> <span class="n">vty</span> <span class="mi">0</span> <span class="mi">4</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Configure</span> <span class="n">RIPv2</span> <span class="k">for</span> <span class="n">R1</span>
<span class="o">----------------------</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router rip</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># version 2</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># network 192.168.0.0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># network 192.168.1.0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># network 192.168.2.252</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># no auto-summary</span>

<span class="n">Configure</span> <span class="n">RIPv2</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">default</span> <span class="n">route</span> <span class="n">to</span> <span class="n">the</span> <span class="n">ISP</span> <span class="n">on</span> <span class="n">R2</span>
<span class="o">----------------------------------------------------</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router rip</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># version 2</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># network 192.168.2.252</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># default-information originate</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 0.0.0.0 0.0.0.0 209.165.200.225</span>

<span class="n">Configure</span>  <span class="n">a</span> <span class="n">summary</span> <span class="n">static</span> <span class="n">route</span> <span class="n">on</span> <span class="n">ISP</span> <span class="n">to</span> <span class="n">reach</span> <span class="n">the</span> <span class="n">networks</span> <span class="n">on</span> <span class="n">the</span> <span class="n">R1</span> <span class="ow">and</span> <span class="n">R2</span> <span class="n">routers</span>
<span class="o">---------------------------------------------------------------------------------------</span>
<span class="n">ISP</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 192.168.0.0 255.255.252.0 209.165.200.226</span>

<span class="n">Router</span> <span class="n">R1</span> <span class="k">as</span> <span class="n">a</span> <span class="n">DHCP</span> <span class="n">relay</span> <span class="n">agent</span>
<span class="o">-------------------------------</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip helper-address 192.168.2.254</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># interface g0/1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip helper-address 192.168.2.254</span>

<span class="n">Router</span> <span class="n">R2</span>
<span class="o">---------</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip dhcp excluded-address 192.168.0.1 192.168.0.9</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip dhcp excluded-address 192.168.1.1 192.168.1.9</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip dhcp pool R1G1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># network 192.168.1.0 255.255.255.0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># default-router 192.168.1.1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># dns-server 209.165.200.225</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># domain-name ccna-lab.com</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># lease 2</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip dhcp pool R1G0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># network 192.168.0.0 255.255.255.0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># default-router 192.168.0.1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># dns-server 209.165.200.225</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># domain-name ccna-lab.com</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># lease 2</span>
</pre></div>
</div>
<p>verify with <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">dhcp</span> <span class="pre">binding</span></code> &amp; <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">dhcp</span> <span class="pre">server</span> <span class="pre">statistics</span></code> &amp; <code class="docutils literal"><span class="pre">show</span> <span class="pre">run</span> <span class="pre">|</span> <span class="pre">section</span> <span class="pre">dhcp</span></code></p>
</div>
<div class="section" id="lab-basic-dhcpv4-on-a-switch">
<h5>8.1.2.5 lab - basic dhcpv4 on a switch<a class="headerlink" href="#lab-basic-dhcpv4-on-a-switch" title="Permalink to this headline">¶</a></h5>
<img alt="nw/_static/img/Ch8_lab_8.1.2.5_cfg_dhcpv4_on_switch.png" src="nw/_static/img/Ch8_lab_8.1.2.5_cfg_dhcpv4_on_switch.png" />
<p>Required Resources
+ Router (Cisco 1941 with Cisco IOS Release 15.2(4)M3 universal image or comparable)
+ 2 Switches (Cisco 2960 with Cisco IOS Release 15.0(2) lanbasek9 image or comparable)</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="21%" />
<col width="32%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R1</td>
<td>G0/1</td>
<td>192.168.1.10</td>
<td>255.255.255.0</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Lo0</td>
<td>209.165.200.225</td>
<td>255.255.255.224</td>
</tr>
<tr class="row-even"><td>S1</td>
<td>VLAN 1</td>
<td>192.168.1.1</td>
<td>255.255.255.0</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>VLAN 2</td>
<td>192.168.2.1</td>
<td>255.255.255.0</td>
</tr>
</tbody>
</table>
<p>display SDM preference on S1</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1">#show sdm prefer</span>
<span class="n">The</span> <span class="n">current</span> <span class="n">template</span> <span class="ow">is</span> <span class="s2">&quot;default&quot;</span> <span class="n">template</span><span class="o">.</span>
<span class="n">The</span> <span class="n">selected</span> <span class="n">template</span> <span class="n">optimizes</span> <span class="n">the</span> <span class="n">resources</span> <span class="ow">in</span>
<span class="n">the</span> <span class="n">switch</span> <span class="n">to</span> <span class="n">support</span> <span class="n">this</span> <span class="n">level</span> <span class="n">of</span> <span class="n">features</span> <span class="k">for</span>
<span class="mi">0</span> <span class="n">routed</span> <span class="n">interfaces</span> <span class="ow">and</span> <span class="mi">255</span> <span class="n">VLANs</span><span class="o">.</span>
  <span class="n">number</span> <span class="n">of</span> <span class="n">unicast</span> <span class="n">mac</span> <span class="n">addresses</span><span class="p">:</span>                  <span class="mi">8</span><span class="n">K</span>
  <span class="n">number</span> <span class="n">of</span> <span class="n">IPv4</span> <span class="n">IGMP</span> <span class="n">groups</span><span class="p">:</span>                       <span class="mf">0.25</span><span class="n">K</span>
  <span class="n">number</span> <span class="n">of</span> <span class="n">IPv4</span><span class="o">/</span><span class="n">MAC</span> <span class="n">qos</span> <span class="n">aces</span><span class="p">:</span>                      <span class="mf">0.125</span><span class="n">k</span>
  <span class="n">number</span> <span class="n">of</span> <span class="n">IPv4</span><span class="o">/</span><span class="n">MAC</span> <span class="n">security</span> <span class="n">aces</span><span class="p">:</span>                 <span class="mf">0.375</span><span class="n">k</span>
</pre></div>
</div>
<p>change SDM preference to lanbase-routing</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># sdm prefer lanbase-routing</span>
<span class="n">Changes</span> <span class="n">to</span> <span class="n">the</span> <span class="n">running</span> <span class="n">SDM</span> <span class="n">preferences</span> <span class="n">have</span> <span class="n">been</span> <span class="n">stored</span><span class="p">,</span> <span class="n">but</span> <span class="n">cannot</span> <span class="n">take</span> <span class="n">effect</span>
<span class="n">until</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">reload</span><span class="o">.</span>
<span class="n">Use</span> <span class="s1">&#39;show sdm prefer&#39;</span> <span class="n">to</span> <span class="n">see</span> <span class="n">what</span> <span class="n">SDM</span> <span class="n">preference</span> <span class="ow">is</span> <span class="n">currently</span> <span class="n">active</span><span class="o">.</span>

<span class="n">S1</span><span class="c1"># reload</span>
<span class="n">S1</span><span class="c1"># show sdm prefer</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The new template will be used after reboot even if the running configuration has not been saved. To save the running configuration, answer yes after reload command.</p>
</div>
<div class="section" id="configure-dhcp-for-vlan-1">
<h6>Configure DHCP for VLAN 1<a class="headerlink" href="#configure-dhcp-for-vlan-1" title="Permalink to this headline">¶</a></h6>
<ol class="loweralpha simple">
<li>Exclude the first 10 valid host addresses from network 192.168.1.0/24</li>
<li>Create a DHCP pool named DHCP1</li>
<li>Assign the network 192.168.1.0/24 for available addresses</li>
<li>Assign the default gateway as 192.168.1.1</li>
<li>Assign the DNS server as 192.168.1.9</li>
<li>Assign a lease time of 3 day</li>
<li>Save the running configuration to the startup configuration file</li>
</ol>
</div>
<div class="section" id="configure-dhcpv4-for-multiple-vlans">
<h6>Configure DHCPv4 for Multiple VLANs<a class="headerlink" href="#configure-dhcpv4-for-multiple-vlans" title="Permalink to this headline">¶</a></h6>
<p>assign PC-A to a port accessing VLAN 2, configure DHCPv4 for VLAN 2, renew the IP configuration of PC-A to validate DHCPv4, and verify connectivity within the VLAN.</p>
<p>Assign a port to VLAN 2. Place port F0/6 into VLAN 2</p>
<ol class="loweralpha simple">
<li>Exclude the first 10 valid host addresses from network 192.168.2.0</li>
<li>Create a DHCP pool named DHCP2</li>
<li>Assign the network 192.168.2.0/24 for available addresses</li>
<li>Assign the default gateway as 192.168.2.1</li>
<li>Assign the DNS server as 192.168.2.9</li>
<li>Assign a lease time of 3 days</li>
<li>Save the running configuration to the startup configuration file</li>
</ol>
<p>Enable IP routing on S1 <code class="docutils literal"><span class="pre">S1(config)#</span> <span class="pre">ip</span> <span class="pre">routing</span></code>
Verify inter-VLAN connectivity</p>
</div>
<div class="section" id="assign-static-routes">
<h6>Assign static routes<a class="headerlink" href="#assign-static-routes" title="Permalink to this headline">¶</a></h6>
<ol class="loweralpha simple">
<li>On S1, create a default static route to R1</li>
<li>On R1, create a static route to VLAN 2</li>
<li>View the routing table information for S1.How is the default static route represented?</li>
<li>View the routing table information for R1.How is the default static route represented?</li>
<li>From PC-A, is it possible to ping R1? From PC-A, is it possible to ping Lo0?</li>
</ol>
<p>Configure DHCPv4</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip dhcp excluded-address 192.168.1.1 192.168.1.10</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip dhcp pool DHCP1</span>
<span class="n">S1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># network 192.168.1.0 255.255.255.0</span>
<span class="n">S1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># default-router 192.168.1.1</span>
<span class="n">S1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># dns-server 192.168.1.9</span>
<span class="n">S1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># lease 3</span>
</pre></div>
</div>
<p>Configure DHCPv4 for Multiple VLANs</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface f0/6</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># switchport access vlan 2</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip dhcp excluded-address 192.168.2.1 192.168.2.10</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip dhcp pool DHCP2</span>
<span class="n">S1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># network 192.168.2.0 255.255.255.0</span>
<span class="n">S1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># default-router 192.168.2.1</span>
<span class="n">S1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># dns-server 192.168.2.9</span>
<span class="n">S1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># lease 3</span>
</pre></div>
</div>
<p>Enable IP Routing</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip routing</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 0.0.0.0 0.0.0.0 192.168.1.10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 192.168.2.0 255.255.255.0 g0/1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lab-configuring-dhcp-ios-pt">
<h5>8.1.3.3 lab - configuring dhcp ios pt<a class="headerlink" href="#lab-configuring-dhcp-ios-pt" title="Permalink to this headline">¶</a></h5>
<img alt="nw/_static/img/Ch8_lab_8.1.3.3_cfg_dhcpv4_ios.png" src="nw/_static/img/Ch8_lab_8.1.3.3_cfg_dhcpv4_ios.png" />
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="15%" />
<col width="22%" />
<col width="23%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IPv4 Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R1</td>
<td>G0/0</td>
<td>192.168.10.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/0</td>
<td>10.1.1.1</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>R2</td>
<td>G0/0</td>
<td>192.168.20.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/1</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0</td>
<td>10.1.1.2</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>10.2.2.2</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>R3</td>
<td>G0/0</td>
<td>192.168.30.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>10.2.2.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>PC1</td>
<td>NIC</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
</tr>
<tr class="row-odd"><td>PC2</td>
<td>NIC</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
</tr>
<tr class="row-even"><td>DNS Server</td>
<td>NIC</td>
<td>192.168.20.254</td>
<td>255.255.255.0</td>
<td>192.168.20.1</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">Configure R2 to exclude first 10 addresses from R1 and R3 LANs. All others should be available in the DHCP address pool</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="o">&gt;</span><span class="n">enable</span>
<span class="n">R2</span><span class="c1">#conf t</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp ?</span>
 <span class="n">excluded</span><span class="o">-</span><span class="n">address</span>  <span class="n">Prevent</span> <span class="n">DHCP</span> <span class="kn">from</span> <span class="nn">assigning</span> <span class="n">certain</span> <span class="n">addresses</span>
 <span class="n">pool</span>              <span class="n">Configure</span> <span class="n">DHCP</span> <span class="n">address</span> <span class="n">pools</span>
 <span class="n">relay</span>             <span class="n">DHCP</span> <span class="n">relay</span> <span class="n">agent</span> <span class="n">parameters</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp excluded-address 192.168.10.1 192.168.10.10</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp excluded-address 192.168.30.1 192.168.30.10</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp pool R1-LAN</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#network 192.168.10.0 255.255.255.0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#?</span>
 <span class="n">default</span><span class="o">-</span><span class="n">router</span>  <span class="n">Default</span> <span class="n">routers</span>
 <span class="n">dns</span><span class="o">-</span><span class="n">server</span>      <span class="n">Set</span> <span class="n">name</span> <span class="n">server</span>
 <span class="n">exit</span>            <span class="n">Exit</span> <span class="kn">from</span> <span class="nn">DHCP</span> <span class="n">pool</span> <span class="n">configuration</span> <span class="n">mode</span>
 <span class="n">network</span>         <span class="n">Network</span> <span class="n">number</span> <span class="ow">and</span> <span class="n">mask</span>
 <span class="n">no</span>              <span class="n">Negate</span> <span class="n">a</span> <span class="n">command</span> <span class="ow">or</span> <span class="nb">set</span> <span class="n">its</span> <span class="n">defaults</span>
 <span class="n">option</span>          <span class="n">Raw</span> <span class="n">DHCP</span> <span class="n">options</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#default-router 192.168.10.1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#dns-server 192.168.20.254</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp pool R3-LAN</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#network 192.168.30.0 255.255.255.0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#defautl</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#default-router 192.168.30.1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#dns-server 192.168.20.254</span>
</pre></div>
</div>
</li>
<li><p class="first">Set PC1 and PC2 to receive IP addressing information from DHCP.</p>
</li>
<li><p class="first">Configure R1 and R3 as a DHCP relay agent.
Okay so lets check if R2 can reach these LANs first:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>check interfaces
----------------
R2#show ip int brief
Interface              IP-Address      OK? Method Status                Protocol
GigabitEthernet0/0     192.168.20.1    YES manual up                    up
GigabitEthernet0/1     unassigned      YES unset  administratively down down
Serial0/0/0            10.1.1.2        YES manual up                    up
Serial0/0/1            10.2.2.2        YES manual up                    up
Serial0/1/0            unassigned      YES unset  down                  down
Serial0/1/1            unassigned      YES unset  down                  down
Vlan1                  unassigned      YES unset  administratively down down

G0/1 is down, lets give it a dhcp address from ISP
--------------------------------------------------
R2#conf t
R2(config)#interface gigabitEthernet 0/1
R2(config-if)#ip address dhcp
R2(config-if)#no shutdown
R2(config-if)#
%LINK-5-CHANGED: Interface GigabitEthernet0/1, changed state to up
%LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/1, changed state to up
R2#
%DHCP-6-ADDRESS_ASSIGN: Interface GigabitEthernet0/1 assigned DHCP address 209.165.200.231, mask 255.255.255.224, hostname R2
%DUAL-5-NBRCHANGE: IP-EIGRP 1: Neighbor 209.165.200.225 (GigabitEthernet0/1) is up: new adjacency

Now lets check R1 and R2 routes to LAN are known to R2
------------------------------------------------------
R2#show ip route
Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area
       N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2
       E1 - OSPF external type 1, E2 - OSPF external type 2, E - EGP
       i - IS-IS, L1 - IS-IS level-1, L2 - IS-IS level-2, ia - IS-IS inter area
       * - candidate default, U - per-user static route, o - ODR
       P - periodic downloaded static route

Gateway of last resort is not set

     10.0.0.0/8 is variably subnetted, 4 subnets, 2 masks
C       10.1.1.0/30 is directly connected, Serial0/0/0
L       10.1.1.2/32 is directly connected, Serial0/0/0
C       10.2.2.0/30 is directly connected, Serial0/0/1
L       10.2.2.2/32 is directly connected, Serial0/0/1
D    192.168.10.0/24 [90/2170112] via 10.1.1.1, 00:59:31, Serial0/0/0
     192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks
C       192.168.20.0/24 is directly connected, GigabitEthernet0/0
L       192.168.20.1/32 is directly connected, GigabitEthernet0/0
D    192.168.30.0/24 [90/2170112] via 10.2.2.1, 00:59:32, Serial0/0/1
     209.165.200.0/24 is variably subnetted, 2 subnets, 2 masks
C       209.165.200.224/27 is directly connected, GigabitEthernet0/1
L       209.165.200.231/32 is directly connected, GigabitEthernet0/1
     209.165.202.0/27 is subnetted, 1 subnets
D       209.165.202.128/27 [90/3072] via 209.165.200.225, 00:01:10, GigabitEthernet0/1

Looking good, configure R1 and R3 as dhcpv4 relay agents
--------------------------------------------------------
R1(config)#interface gigabitEthernet 0/0
R1(config-if)#ip helper-address 10.1.1.2

R3(config)#do show ip int brief | include 192.168.30
GigabitEthernet0/0     192.168.30.1    YES manual up                    up
R3(config)#interface GigabitEthernet0/0
R3(config-if)#ip helper-address 10.2.2.2
</pre></div>
</div>
</li>
<li><p class="first">Verify DHCP</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1">#show ip dhcp binding</span>
<span class="o">-----------------------</span>
<span class="n">IP</span> <span class="n">address</span>       <span class="n">Client</span><span class="o">-</span><span class="n">ID</span><span class="o">/</span>              <span class="n">Lease</span> <span class="n">expiration</span>        <span class="n">Type</span>
                 <span class="n">Hardware</span> <span class="n">address</span>
<span class="mf">192.168</span><span class="o">.</span><span class="mf">10.11</span>    <span class="mf">0002.4</span><span class="n">AA5</span><span class="o">.</span><span class="mi">1470</span>           <span class="o">--</span>                     <span class="n">Automatic</span>
<span class="mf">192.168</span><span class="o">.</span><span class="mf">30.11</span>    <span class="mf">0004.9</span><span class="n">A97</span><span class="o">.</span><span class="mi">2535</span>           <span class="o">--</span>                     <span class="n">Automatic</span>
<span class="n">R2</span><span class="c1">#</span>

<span class="n">R2</span><span class="c1">#show ip dhcp pool</span>
<span class="o">--------------------</span>
<span class="n">Pool</span> <span class="n">R1</span><span class="o">-</span><span class="n">LAN</span> <span class="p">:</span>
 <span class="n">Utilization</span> <span class="n">mark</span> <span class="p">(</span><span class="n">high</span><span class="o">/</span><span class="n">low</span><span class="p">)</span>    <span class="p">:</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">0</span>
 <span class="n">Subnet</span> <span class="n">size</span> <span class="p">(</span><span class="n">first</span><span class="o">/</span><span class="nb">next</span><span class="p">)</span>       <span class="p">:</span> <span class="mi">0</span> <span class="o">/</span> <span class="mi">0</span>
 <span class="n">Total</span> <span class="n">addresses</span>                <span class="p">:</span> <span class="mi">254</span>
 <span class="n">Leased</span> <span class="n">addresses</span>               <span class="p">:</span> <span class="mi">1</span>
 <span class="n">Excluded</span> <span class="n">addresses</span>             <span class="p">:</span> <span class="mi">2</span>
 <span class="n">Pending</span> <span class="n">event</span>                  <span class="p">:</span> <span class="n">none</span>

 <span class="mi">1</span> <span class="n">subnet</span> <span class="ow">is</span> <span class="n">currently</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">pool</span>
 <span class="n">Current</span> <span class="n">index</span>        <span class="n">IP</span> <span class="n">address</span> <span class="nb">range</span>                    <span class="n">Leased</span><span class="o">/</span><span class="n">Excluded</span><span class="o">/</span><span class="n">Total</span>
 <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.1</span>         <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.1</span>     <span class="o">-</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.254</span>    <span class="mi">1</span>    <span class="o">/</span> <span class="mi">2</span>     <span class="o">/</span> <span class="mi">254</span>

<span class="n">Pool</span> <span class="n">R3</span><span class="o">-</span><span class="n">LAN</span> <span class="p">:</span>
 <span class="n">Utilization</span> <span class="n">mark</span> <span class="p">(</span><span class="n">high</span><span class="o">/</span><span class="n">low</span><span class="p">)</span>    <span class="p">:</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">0</span>
 <span class="n">Subnet</span> <span class="n">size</span> <span class="p">(</span><span class="n">first</span><span class="o">/</span><span class="nb">next</span><span class="p">)</span>       <span class="p">:</span> <span class="mi">0</span> <span class="o">/</span> <span class="mi">0</span>
 <span class="n">Total</span> <span class="n">addresses</span>                <span class="p">:</span> <span class="mi">254</span>
 <span class="n">Leased</span> <span class="n">addresses</span>               <span class="p">:</span> <span class="mi">1</span>
 <span class="n">Excluded</span> <span class="n">addresses</span>             <span class="p">:</span> <span class="mi">2</span>
 <span class="n">Pending</span> <span class="n">event</span>                  <span class="p">:</span> <span class="n">none</span>

 <span class="mi">1</span> <span class="n">subnet</span> <span class="ow">is</span> <span class="n">currently</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">pool</span>
 <span class="n">Current</span> <span class="n">index</span>        <span class="n">IP</span> <span class="n">address</span> <span class="nb">range</span>                    <span class="n">Leased</span><span class="o">/</span><span class="n">Excluded</span><span class="o">/</span><span class="n">Total</span>
 <span class="mf">192.168</span><span class="o">.</span><span class="mf">30.1</span>         <span class="mf">192.168</span><span class="o">.</span><span class="mf">30.1</span>     <span class="o">-</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">30.254</span>    <span class="mi">1</span>    <span class="o">/</span> <span class="mi">2</span>     <span class="o">/</span> <span class="mi">254</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="configuring-a-router-as-dhcp-client">
<h4>Configuring a Router as DHCP Client<a class="headerlink" href="#configuring-a-router-as-dhcp-client" title="Permalink to this headline">¶</a></h4>
<p>To configure an Ethernet interface as a DHCP client, use the <code class="docutils literal"><span class="pre">ip</span> <span class="pre">address</span> <span class="pre">dhcp</span></code> interface configuration mode command.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">SOHO</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/1</span>
<span class="n">SOHO</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address dhcp</span>
<span class="n">SOHO</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no shutdown</span>
<span class="n">SOHO</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
 <span class="o">%</span><span class="n">DHCP</span><span class="o">-</span><span class="mi">6</span><span class="o">-</span><span class="n">ADDRESS_ASSIGN</span><span class="p">:</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="n">assigned</span> <span class="n">DHCP</span> <span class="n">address</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.12</span><span class="p">,</span> <span class="n">mask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.224</span><span class="p">,</span> <span class="n">hostname</span> <span class="n">SOHO</span>
<span class="n">SOHO</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">SOHO</span><span class="c1"># show ip interface g0/1</span>
<span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">Internet</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.12</span><span class="o">/</span><span class="mi">27</span>
  <span class="n">Broadcast</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
  <span class="n">Address</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">DHCP</span>
</pre></div>
</div>
</div>
<div class="section" id="troubleshooting-dhcp">
<h4>Troubleshooting DHCP<a class="headerlink" href="#troubleshooting-dhcp" title="Permalink to this headline">¶</a></h4>
<div class="section" id="dhcp-service">
<h5>DHCP Service<a class="headerlink" href="#dhcp-service" title="Permalink to this headline">¶</a></h5>
<img alt="nw/_static/img/dhcp-client-server-cisco-routers.png" src="nw/_static/img/dhcp-client-server-cisco-routers.png" />
<p>Let’s verify by checking if the interfaces are up and running:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>DHCPClient#show ip interface brief
Interface                  IP-Address      OK? Method Status                Protocol
FastEthernet0/0            unassigned      YES DHCP   up                   up
</pre></div>
</div>
<p>First I’ll verify if the interface on the DHCP client is up/up and that it has been configured for DHCP, this is indeed the case. Let’s check the DHCP server:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>DHCPServer#show ip interface brief
Interface                  IP-Address      OK? Method Status                Protocol
FastEthernet0/0            192.168.12.2    YES manual up                   up
</pre></div>
</div>
<p>I also want to make sure the interface on the DHCP server is up/up and that it has an IP address. This looks fine to me. Let’s start by looking at the DHCP client:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">DHCPClient</span><span class="c1">#debug dhcp detail</span>
<span class="n">DHCP</span> <span class="n">client</span> <span class="n">activity</span> <span class="n">debugging</span> <span class="ow">is</span> <span class="n">on</span> <span class="p">(</span><span class="n">detailed</span><span class="p">)</span>
</pre></div>
</div>
<p>I want to be absolutely sure that the client is not the issue I can enable debug dhcp detail to see if the DHCP client is sending DHCP discover messages. Here’s what we see:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">DHCPClient</span><span class="c1"># Hostname: DHCPClient</span>
<span class="n">DHCP</span><span class="p">:</span> <span class="n">new</span> <span class="n">entry</span><span class="o">.</span> <span class="n">add</span> <span class="n">to</span> <span class="n">queue</span><span class="p">,</span> <span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="s1">&#39;DHCP: SDiscover attempt # 1 for entry:&#39;</span>
<span class="n">Temp</span> <span class="n">IP</span> <span class="n">addr</span><span class="p">:</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span>  <span class="k">for</span> <span class="n">peer</span> <span class="n">on</span> <span class="n">Interface</span><span class="p">:</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Temp</span>  <span class="n">sub</span> <span class="n">net</span> <span class="n">mask</span><span class="p">:</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span>
<span class="n">DHCP</span> <span class="n">Lease</span> <span class="n">server</span><span class="p">:</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="mi">1</span> <span class="n">Selecting</span>
<span class="n">DHCP</span> <span class="n">transaction</span> <span class="nb">id</span><span class="p">:</span> <span class="mi">289</span>
<span class="n">Lease</span><span class="p">:</span> <span class="mi">0</span> <span class="n">secs</span><span class="p">,</span>  <span class="n">Renewal</span><span class="p">:</span> <span class="mi">0</span> <span class="n">secs</span><span class="p">,</span>  <span class="n">Rebind</span><span class="p">:</span> <span class="mi">0</span> <span class="n">secs</span>
<span class="n">Next</span> <span class="n">timer</span> <span class="n">fires</span> <span class="n">after</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">04</span>
<span class="n">Retry</span> <span class="n">count</span><span class="p">:</span> <span class="mi">1</span>   <span class="n">Client</span><span class="o">-</span><span class="n">ID</span><span class="p">:</span> <span class="n">cisco</span><span class="o">-</span><span class="n">cc00</span><span class="o">.</span><span class="mi">1</span><span class="n">ab0</span><span class="o">.</span><span class="mi">0000</span><span class="o">-</span><span class="n">Fa0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Client</span><span class="o">-</span><span class="n">ID</span> <span class="nb">hex</span> <span class="n">dump</span><span class="p">:</span> <span class="mi">636973636</span><span class="n">F2D636330302E316162302E</span>
                    <span class="mi">303030302</span><span class="n">D4661302F30</span>
</pre></div>
</div>
<p>You’ll see some debug output like above. This proves that my DHCP client is sending DHCP Discover messages; the client doesn’t seem to be the problem here. Let’s check the DHCP server:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">DHCPServer</span><span class="c1">#show ip dhcp pool</span>

<span class="n">Pool</span> <span class="n">MYPOOL</span> <span class="p">:</span>
 <span class="n">Utilization</span> <span class="n">mark</span> <span class="p">(</span><span class="n">high</span><span class="o">/</span><span class="n">low</span><span class="p">)</span>    <span class="p">:</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">0</span>
 <span class="n">Subnet</span> <span class="n">size</span> <span class="p">(</span><span class="n">first</span><span class="o">/</span><span class="nb">next</span><span class="p">)</span>       <span class="p">:</span> <span class="mi">0</span> <span class="o">/</span> <span class="mi">0</span>
 <span class="n">Total</span> <span class="n">addresses</span>                <span class="p">:</span> <span class="mi">254</span>
 <span class="n">Leased</span> <span class="n">addresses</span>               <span class="p">:</span> <span class="mi">0</span>
 <span class="n">Pending</span> <span class="n">event</span>                  <span class="p">:</span> <span class="n">none</span>
 <span class="mi">1</span> <span class="n">subnet</span> <span class="ow">is</span> <span class="n">currently</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">pool</span> <span class="p">:</span>
 <span class="n">Current</span> <span class="n">index</span>        <span class="n">IP</span> <span class="n">address</span> <span class="nb">range</span>                    <span class="n">Leased</span> <span class="n">addresses</span>
 <span class="mf">192.168</span><span class="o">.</span><span class="mf">12.1</span>         <span class="mf">192.168</span><span class="o">.</span><span class="mf">12.1</span>     <span class="o">-</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">12.254</span>    <span class="mi">0</span>
</pre></div>
</div>
<p>We’ll use the show ip dhcp pool command to check if there is a DHCP pool. You can see that we do have a DHCP pool called “MYPOOL” and it’s configured for the 192.168.12.0 /24 subnet. This is looking fine to me. Let’s find out if the DHCP server is doing anything:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">DHCPServer</span><span class="c1">#show ip dhcp server statistics</span>
<span class="n">Memory</span> <span class="n">usage</span>         <span class="mi">8754</span>
<span class="n">Address</span> <span class="n">pools</span>        <span class="mi">1</span>
<span class="n">Database</span> <span class="n">agents</span>      <span class="mi">0</span>
<span class="n">Automatic</span> <span class="n">bindings</span>   <span class="mi">0</span>
<span class="n">Manual</span> <span class="n">bindings</span>      <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">bindings</span>     <span class="mi">0</span>
<span class="n">Malformed</span> <span class="n">messages</span>   <span class="mi">0</span>
<span class="n">Secure</span> <span class="n">arp</span> <span class="n">entries</span>   <span class="mi">0</span>

<span class="n">Message</span>              <span class="n">Received</span>
<span class="n">BOOTREQUEST</span>          <span class="mi">0</span>
<span class="n">DHCPDISCOVER</span>         <span class="mi">0</span>
<span class="n">DHCPREQUEST</span>          <span class="mi">0</span>
<span class="n">DHCPDECLINE</span>          <span class="mi">0</span>
<span class="n">DHCPRELEASE</span>          <span class="mi">0</span>
<span class="n">DHCPINFORM</span>           <span class="mi">0</span>

<span class="n">Message</span>              <span class="n">Sent</span>
<span class="n">BOOTREPLY</span>            <span class="mi">0</span>
<span class="n">DHCPOFFER</span>            <span class="mi">0</span>
<span class="n">DHCPACK</span>              <span class="mi">0</span>
<span class="n">DHCPNAK</span>              <span class="mi">0</span>
</pre></div>
</div>
<p>We can use show ip dhcp server statistics to see if the DHCP server is doing anything. You can see that it’s not doing anything…what could this mean? Take a look below:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">DHCPServer</span><span class="c1">#show ip sockets</span>
<span class="n">Proto</span>    <span class="n">Remote</span>      <span class="n">Port</span>      <span class="n">Local</span>       <span class="n">Port</span>  <span class="n">In</span> <span class="n">Out</span> <span class="n">Stat</span> <span class="n">TTY</span> <span class="n">OutputIF</span>
</pre></div>
</div>
<p>This is a command you probably don’t see every day. Show ip sockets shows us on which ports the router is listening. As you can see it’s not listening on any ports…if I don’t see port 67 here (DHCP) it means that the DHCP service has been disabled. Let’s enable it:</p>
<p><code class="docutils literal"><span class="pre">DHCPServer(config)#service</span> <span class="pre">dhcp</span></code></p>
<p>Let’s enable the service. Take a look at the sockets again:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">DHCPServer</span><span class="c1">#show ip sockets</span>
<span class="n">Proto</span>    <span class="n">Remote</span>      <span class="n">Port</span>      <span class="n">Local</span>       <span class="n">Port</span>  <span class="n">In</span> <span class="n">Out</span> <span class="n">Stat</span> <span class="n">TTY</span> <span class="n">OutputIF</span>
 <span class="mi">17</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span>             <span class="mi">0</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">12.2</span>       <span class="mi">67</span>   <span class="mi">0</span>   <span class="mi">0</span> <span class="mi">2211</span>   <span class="mi">0</span>
</pre></div>
</div>
<p>That’s better! Now we see the router is listening on port 67, this means the DHCP service is active. After a few seconds, the client will receive an IP address:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">DHCPClient</span><span class="c1"># %DHCP-6-ADDRESS_ASSIGN: Interface FastEthernet0/0 assigned DHCP address 192.168.12.1, mask 255.255.255.0, hostname DHCPClient</span>
</pre></div>
</div>
<p>As soon as the DHCP service is running you can see the client receives an IP address through DHCP…problem solved!</p>
<p><strong>Lesson learned: If everything is OK, make sure the DHCP service is running.</strong></p>
</div>
</div>
<div class="section" id="dhcpv4-troubleshooting-tasks">
<h4>DHCPv4 Troubleshooting Tasks<a class="headerlink" href="#dhcpv4-troubleshooting-tasks" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Resolve address conflicts</dt>
<dd><p class="first">The <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">dhcp</span> <span class="pre">conflict</span></code> command displays all address conflicts recorded by the DHCPv4 server, as shown in Figure 2. The server uses the ping command to detect clients. The client uses Address Resolution Protocol (ARP) to detect conflicts. If an address conflict is detected, the address is removed from the pool and not assigned until an administrator resolves the conflict.</p>
<p class="last">This output displays IP addresses that have conflicts with the DHCP server. It shows the detection method and detection time for conflicting IP addresses that the DHCP server has offered.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Verify physical connectivity</dt>
<dd><p class="first last">use the <code class="docutils literal"><span class="pre">show</span> <span class="pre">interfaces</span> <span class="pre">interface</span></code> command to confirm that the router interface acting as the default gateway for the client is operational. If the state of the interface is anything other than up, the port does not pass traffic, including DHCP client requests.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Test with a static IPv4 address</dt>
<dd><p class="first last">If the workstation is unable to reach network resources with a statically configured IPv4 address, the root cause of the problem is not DHCPv4. At this point, network connectivity troubleshooting is required.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Verify switch port configuration</dt>
<dd><p class="first">If the DHCPv4 client is unable to obtain an IPv4 address from the DHCPv4 server on startup, attempt to obtain an IPv4 address from the DHCPv4 server by manually forcing the client to send a DHCPv4 request. In linux that is <code class="docutils literal"><span class="pre">dhclient</span> <span class="pre">-4</span></code></p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">if there is a switch between the client and the DHCPv4 server, and the client is unable to obtain the DHCP configuration, switch port configuration issues may be the cause. These causes may include issues from trunking and channeling, STP, and RSTP. PortFast and edge port configurations resolve the most common DHCPv4 client issues that occur with an initial installation of a Cisco switch.</p>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Test from the same subnet or VLAN</dt>
<dd><p class="first last">It is important to distinguish whether DHCPv4 is functioning correctly when the client is on the same subnet or VLAN as the DHCPv4 server. If DHCPv4 is working correctly when the client is on the same subnet or VLAN, the problem may be the DHCP relay agent. If the problem persists even with testing DHCPv4 on the same subnet or VLAN as the DHCPv4 server, the problem may actually be with the DHCPv4 server.</p>
</dd>
</dl>
</li>
</ol>
<p>Verify Router DHCPv4 Configuration</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show running-config | section interface GigabitEthernet0/0</span>
<span class="n">interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
 <span class="n">ip</span> <span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.1</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>
 <span class="n">ip</span> <span class="n">helper</span><span class="o">-</span><span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">11.6</span>
 <span class="n">duplex</span> <span class="n">auto</span>
 <span class="n">speed</span> <span class="n">auto</span>
<span class="n">R1</span><span class="c1">#</span>
<span class="n">R1</span><span class="c1"># show running-config | include no service dhcp</span>
</pre></div>
</div>
<p>Debug DHCPv4 using router debug commands</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 100 permit udp any any eq 67</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 100 permit udp any any eq 68</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">R1</span><span class="c1"># debug ip packet 100</span>
<span class="n">IP</span> <span class="n">packet</span> <span class="n">debugging</span> <span class="ow">is</span> <span class="n">on</span> <span class="k">for</span> <span class="n">access</span> <span class="nb">list</span> <span class="mi">100</span>
<span class="o">*</span><span class="n">IP</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="p">(</span><span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span><span class="p">),</span> <span class="n">d</span><span class="o">=</span><span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span><span class="p">,</span> <span class="nb">len</span> <span class="mi">333</span><span class="p">,</span> <span class="n">rcvd</span> <span class="mi">2</span>
<span class="o">*</span><span class="n">IP</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="p">(</span><span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span><span class="p">),</span> <span class="n">d</span><span class="o">=</span><span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span><span class="p">,</span> <span class="nb">len</span> <span class="mi">333</span><span class="p">,</span> <span class="n">stop</span> <span class="n">process</span> <span class="n">pak</span> <span class="k">for</span> <span class="n">forus</span> <span class="n">packet</span>
<span class="o">*</span><span class="n">IP</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">11.1</span> <span class="p">(</span><span class="n">local</span><span class="p">),</span> <span class="n">d</span><span class="o">=</span><span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span> <span class="p">(</span><span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span><span class="p">),</span> <span class="nb">len</span> <span class="mi">328</span><span class="p">,</span> <span class="n">sending</span> <span class="n">broad</span><span class="o">/</span><span class="n">multicast</span>
<span class="o">...</span>
<span class="n">R1</span><span class="c1"># debug ip dhcp server events</span>
<span class="n">DHCPD</span><span class="p">:</span> <span class="n">returned</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.11</span> <span class="n">to</span> <span class="n">address</span> <span class="n">pool</span> <span class="n">LAN</span><span class="o">-</span><span class="n">POOL</span><span class="o">-</span><span class="mi">1</span>
<span class="n">DHCPD</span><span class="p">:</span> <span class="n">assigned</span> <span class="n">IP</span> <span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.12</span> <span class="n">to</span> <span class="n">client</span> <span class="mf">0100.0103</span><span class="o">.</span><span class="mf">85e9</span><span class="o">.</span><span class="mf">87.</span>
<span class="n">DHCPD</span><span class="p">:</span> <span class="n">checking</span> <span class="k">for</span> <span class="n">expired</span> <span class="n">leases</span><span class="o">.</span>
<span class="n">DHCPD</span><span class="p">:</span> <span class="n">the</span> <span class="n">lease</span> <span class="k">for</span> <span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.10</span> <span class="n">has</span> <span class="n">expired</span><span class="o">.</span>
<span class="n">DHCPD</span><span class="p">:</span> <span class="n">returned</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.10</span> <span class="n">to</span> <span class="n">address</span> <span class="n">pool</span> <span class="n">LAN</span><span class="o">-</span><span class="n">POOL</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>The extended ACL is used with the <code class="docutils literal"><span class="pre">debug</span> <span class="pre">ip</span> <span class="pre">packet</span></code> command to display only DHCPv4 messages.</p>
<p>The output in the figure shows that the router is receiving DHCP requests from the client. The source IP address is 0.0.0.0 because the client does not yet have an IP address. The destination is 255.255.255.255 because the DHCP discovery message from the client is sent as a broadcast. This output only shows a summary of the packet and not the DHCPv4 message itself. Nevertheless, the router did receive a broadcast packet with the source and destination IP and UDP ports that are correct for DHCPv4. The complete debug output shows all the packets in the DHCPv4 communications between the DHCPv4 server and client.</p>
<p>Another useful command for troubleshooting DHCPv4 operation is the <code class="docutils literal"><span class="pre">debug</span> <span class="pre">ip</span> <span class="pre">dhcp</span> <span class="pre">server</span> <span class="pre">events</span></code> command. This command reports server events, like address assignments and database updates.</p>
<p>The DHCP assignment conflict indicates there may be an issue with the excluded-address statement on the DHCP server configuration on R2.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.939</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Sending</span> <span class="n">notification</span> <span class="n">of</span> <span class="n">DISCOVER</span><span class="p">:</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.939</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">htype</span> <span class="mi">1</span> <span class="n">chaddr</span> <span class="mf">0050.56</span><span class="n">be</span><span class="o">.</span><span class="mi">768</span><span class="n">c</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.939</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">circuit</span> <span class="nb">id</span> <span class="mi">00000000</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.939</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Seeing</span> <span class="k">if</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">internally</span> <span class="n">specified</span> <span class="n">pool</span> <span class="n">class</span><span class="p">:</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.939</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">htype</span> <span class="mi">1</span> <span class="n">chaddr</span> <span class="mf">0050.56</span><span class="n">be</span><span class="o">.</span><span class="mi">768</span><span class="n">c</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.939</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">circuit</span> <span class="nb">id</span> <span class="mi">00000000</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.943</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Allocated</span> <span class="n">binding</span> <span class="mi">2944</span><span class="n">C764</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.943</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Adding</span> <span class="n">binding</span> <span class="n">to</span> <span class="n">radix</span> <span class="n">tree</span> <span class="p">(</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.1</span><span class="p">)</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.943</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Adding</span> <span class="n">binding</span> <span class="n">to</span> <span class="nb">hash</span> <span class="n">tree</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.943</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">assigned</span> <span class="n">IP</span> <span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.1</span> <span class="n">to</span> <span class="n">client</span> <span class="mf">0100.5056</span><span class="o">.</span><span class="n">be76</span><span class="o">.</span><span class="mi">8</span><span class="n">c</span><span class="o">.</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.951</span><span class="p">:</span> <span class="o">%</span><span class="n">DHCPD</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="n">PING_CONFLICT</span><span class="p">:</span> <span class="n">DHCP</span> <span class="n">address</span> <span class="n">conflict</span><span class="p">:</span> <span class="n">server</span> <span class="n">pinged</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.1</span><span class="o">.</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.951</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">returned</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.1</span> <span class="n">to</span> <span class="n">address</span> <span class="n">pool</span> <span class="n">R1G1</span><span class="o">.</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.951</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Sending</span> <span class="n">notification</span> <span class="n">of</span> <span class="n">DISCOVER</span><span class="p">:</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.951</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">htype</span> <span class="mi">1</span> <span class="n">chaddr</span> <span class="mf">0050.56</span><span class="n">be</span><span class="o">.</span><span class="mi">768</span><span class="n">c</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.951</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">circuit</span> <span class="nb">id</span> <span class="mi">00000000</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.951</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Seeing</span> <span class="k">if</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">internally</span> <span class="n">specified</span> <span class="n">pool</span> <span class="n">class</span><span class="p">:</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.951</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">htype</span> <span class="mi">1</span> <span class="n">chaddr</span> <span class="mf">0050.56</span><span class="n">be</span><span class="o">.</span><span class="mi">768</span><span class="n">c</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.951</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">circuit</span> <span class="nb">id</span> <span class="mi">00000000</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.951</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Allocated</span> <span class="n">binding</span> <span class="mi">31</span><span class="n">DC93C8</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.951</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Adding</span> <span class="n">binding</span> <span class="n">to</span> <span class="n">radix</span> <span class="n">tree</span> <span class="p">(</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span><span class="p">)</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.951</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Adding</span> <span class="n">binding</span> <span class="n">to</span> <span class="nb">hash</span> <span class="n">tree</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">16.951</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">assigned</span> <span class="n">IP</span> <span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span> <span class="n">to</span> <span class="n">client</span> <span class="mf">0100.5056</span><span class="o">.</span><span class="n">be76</span><span class="o">.</span><span class="mi">8</span><span class="n">c</span><span class="o">.</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">18.383</span><span class="p">:</span> <span class="o">%</span><span class="n">DHCPD</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="n">PING_CONFLICT</span><span class="p">:</span> <span class="n">DHCP</span> <span class="n">address</span> <span class="n">conflict</span><span class="p">:</span><span class="n">server</span> <span class="n">pinged</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span><span class="o">.</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">18.383</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">returned</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span> <span class="n">to</span> <span class="n">address</span> <span class="n">pool</span> <span class="n">R1G1</span><span class="o">.</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">18.383</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Sending</span> <span class="n">notification</span> <span class="n">of</span> <span class="n">DISCOVER</span><span class="p">:</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">18.383</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">htype</span> <span class="mi">1</span> <span class="n">chaddr</span> <span class="mf">0050.56</span><span class="n">be</span><span class="o">.</span><span class="mi">6</span><span class="n">c89</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">18.383</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">circuit</span> <span class="nb">id</span> <span class="mi">00000000</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">18.383</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Seeing</span> <span class="k">if</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">internally</span> <span class="n">specified</span> <span class="n">pool</span> <span class="n">class</span><span class="p">:</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">18.383</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">htype</span> <span class="mi">1</span> <span class="n">chaddr</span> <span class="mf">0050.56</span><span class="n">be</span><span class="o">.</span><span class="mi">6</span><span class="n">c89</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">18.383</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">circuit</span> <span class="nb">id</span> <span class="mi">00000000</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">18.383</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Allocated</span> <span class="n">binding</span> <span class="mi">2</span><span class="n">A40E074</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">18.383</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Adding</span> <span class="n">binding</span> <span class="n">to</span> <span class="n">radix</span> <span class="n">tree</span> <span class="p">(</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.3</span><span class="p">)</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">18.383</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">Adding</span> <span class="n">binding</span> <span class="n">to</span> <span class="nb">hash</span> <span class="n">tree</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">5</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">18.383</span><span class="p">:</span> <span class="n">DHCPD</span><span class="p">:</span> <span class="n">assigned</span> <span class="n">IP</span> <span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.3</span> <span class="n">to</span> <span class="n">client</span> <span class="mf">0100.5056</span><span class="o">.</span><span class="n">be76</span><span class="o">.</span><span class="mi">8</span><span class="n">c</span>
<span class="o">.</span>
<span class="o">&lt;</span><span class="n">output</span> <span class="n">omitted</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1">#</span>
<span class="n">show</span> <span class="n">run</span> <span class="o">|</span> <span class="n">section</span> <span class="n">dhcp</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">excluded</span><span class="o">-</span><span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">11.1</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">11.9</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">excluded</span><span class="o">-</span><span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.1</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.9</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">pool</span> <span class="n">R1G1</span>
 <span class="n">network</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>
 <span class="n">default</span><span class="o">-</span><span class="n">router</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.1</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">pool</span> <span class="n">R1G0</span>
 <span class="n">network</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.0</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.128</span>
 <span class="n">default</span><span class="o">-</span><span class="n">router</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.1</span>
</pre></div>
</div>
</div>
<div class="section" id="slaac">
<h4>SLAAC<a class="headerlink" href="#slaac" title="Permalink to this headline">¶</a></h4>
<p><strong>Stateless</strong> Address AutoConfiguration</p>
<dl class="docutils">
<dt>A Stateless service</dt>
<dd>no server that maintains network address information. Unlike DHCP there is no SLAAC server that knows what IPv6 addresses are being used and which ones are available</dd>
</dl>
<p>SLAAC is a method in which a device can obtain an IPv6 global unicast address without the services of a DHCPv6 server. <strong>At the core of SLAAC is ICMPv6</strong>. ICMPv6 is similar to ICMPv4 but includes additional functionality and is a much more robust protocol. <strong>SLAAC uses ICMPv6 Router Solicitation and Router Advertisement messages</strong> to provide addressing and other configuration information that would normally be provided by a DHCP server:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>Router Solicitation (RS) message</dt>
<dd>When a client is configured to obtain its addressing information automatically using SLAAC, the client sends an RS message to the router. The RS message is sent to the IPv6 all-routers multicast address <strong>FF02::2</strong></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Router Advertisement (RA) message</dt>
<dd>RA messages are sent by routers to provide addressing information to clients configured to obtain their IPv6 addresses automatically. The RA message includes the prefix and prefix length of the local segment. A client uses this information to create its own IPv6 global unicast address. A router sends an RA message periodically, or in response to an RS message. By default, Cisco routers send RA messages every 200 seconds.</dd>
</dl>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">RA messages are always sent to the IPv6 all-nodes multicast address FF02::1</p>
</div>
<div class="section" id="slaac-operation">
<h5>SLAAC operation<a class="headerlink" href="#slaac-operation" title="Permalink to this headline">¶</a></h5>
<img alt="nw/_static/img/Ch8_SLAAC_operation.png" src="nw/_static/img/Ch8_SLAAC_operation.png" />
<ol class="arabic">
<li><dl class="first docutils">
<dt>Client sends Router Sollicitation message</dt>
<dd><p class="first last">Since booting, PC1 has not received an RA message, so it sends an RS message to the all-routers multicast address to inform the local IPv6 router that it needs an RA.</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">a router must have IPv6 routing enabled before it can send RA messages <code class="docutils literal"><span class="pre">Router(config)#</span> <span class="pre">ipv6</span> <span class="pre">unicast-routing</span></code></p>
</div>
</li>
<li><dl class="first docutils">
<dt>R1 receives the RS message and responds with an RA message</dt>
<dd><p class="first last">Included in the RA message are the prefix and prefix length of the network. The RA message is sent to the IPv6 all-nodes multicast address <strong>FF02::1</strong>, with the <strong>link-local address of the router as the IPv6 source address</strong>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>PC1 receives the RA message containing the prefix and prefix length for the local network</dt>
<dd><p class="first">PC1 will use this information to create its own IPv6 global unicast address. PC1 now has a 64-bit network prefix, but needs a 64-bit Interface ID (IID) to create a global unicast address.
There are 2 ways PC1 can create its own unique IID</p>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>EUI-64</dt>
<dd>Using the EUI-64 process, PC1 will create an IID using its 48-bit MAC address.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Randomly generated</dt>
<dd>The 64-bit IID can be a random number generated by the client operating system.</dd>
</dl>
</li>
</ol>
<p class="last">PC1 can create a 128-bit IPv6 global unicast address by combining the 64-bit prefix with the 64-bit IID. PC1 will use the link-local address of the router as its IPv6 default gateway address.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Because SLAAC is stateless, PC1 must verify that this newly created IPv6 address is unique</dt>
<dd><p class="first last">PC1 sends an <strong>ICMPv6 Neighbor Solicitation message with a specially constructed multicast address</strong>, called a solicited-node multicast address, which duplicates the last 24 bits of PC1’s IPv6 address. If no other devices respond with a Neighbor Advertisement message, then the address is virtually guaranteed to be unique and can be used by PC1. <strong>If a Neighbor Advertisement is received</strong> by PC1 <strong>then the address is not unique</strong> and the operating system has to determine a new Interface ID to use.</p>
</dd>
</dl>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This process is part of ICMPv6 Neighbor Discovery and is known as Duplicate Address Detection (DAD).</p>
</div>
<p>The decision of whether a client is configured to obtain its IPv6 address information automatically using SLAAC, DHCPv6, or a combination of both depends on the <strong>settings within the RA message</strong></p>
<dl class="docutils">
<dt>The two flags are the Managed Address Configuration flag (M flag) and the Other Configuration flag (O flag)</dt>
<dd><p class="first">Using different combinations of the M and O flags, RA messages have one of three addressing options for the IPv6 device:</p>
<ul class="last simple">
<li>SLAAC (Router Advertisement only) (Default)</li>
<li>Stateless DHCPv6 (Router Advertisement and DHCPv6)</li>
<li>Stateful DHCPv6 (DHCPv6 only)</li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Regardless of the option used, it is recommended by RFC 4861 that all IPv6 devices perform Duplicate Address Detection (DAD) on any unicast address, including addresses configured using SLAAC or DHCPv6. DAD is implemented using ICMPv6, which is specified by RFC 4443.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although the RA message specifies the process the client should use in obtaining an IPv6 address dynamically, the client operating system may choose to ignore the RA message and use the services of a DHCPv6 server exclusively.</p>
</div>
</div>
<div class="section" id="slaac-option">
<h5>SLAAC Option<a class="headerlink" href="#slaac-option" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt>SLAAC Option (Router Advertisement only)</dt>
<dd>SLAAC is the default option on Cisco routers. Both the M flag and the O flag are set to 0 in the RA</dd>
</dl>
<p>This option instructs the client to use the information in the RA message exclusively. This includes <strong>prefix, prefix-length, DNS server, MTU, and default gateway information</strong>. There is no further information available from a DHCPv6 server. The IPv6 global unicast address is created by combining the prefix from RA and an Interface ID using either EUI-64 or a randomly generated value.</p>
<dl class="docutils">
<dt>RA messages are configured on an individual interface of a router</dt>
<dd><p class="first">To <strong>re-enable an interface for SLAAC</strong> that might have been set to another option, the M and O flags need to be reset to their initial values of 0. This is done using the following interface configuration mode commands:</p>
<div class="code last highlight-default"><div class="highlight"><pre><span></span><span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no ipv6 nd managed-config-flag</span>
<span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no ipv6 nd other-config-flag</span>
</pre></div>
</div>
</dd>
</dl>
<p>ipv6 <strong>N</strong> eighbor <strong>D</strong> iscovery <strong>M</strong> anaged/<strong>O</strong> ther <strong>-CONFIG-FLAG</strong></p>
<img alt="nw/_static/img/Ch8_stateful_dhcpv6_option.png" src="nw/_static/img/Ch8_stateful_dhcpv6_option.png" />
</div>
</div>
<div class="section" id="dhcpv6-operations">
<h4>DHCPv6 Operations<a class="headerlink" href="#dhcpv6-operations" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch8_DHCPv6_operations.png" src="nw/_static/img/Ch8_DHCPv6_operations.png" />
<p>When stateless DHCPv6 or stateful DHCPv6 is indicated by the RA, DHCPv6 operation is invoked. DHCPv6 messages are sent over UDP. DHCPv6 messages from the <strong>server to the client use UDP destination port 546</strong>. <strong>The client sends DHCPv6 messages to the server using UDP destination port 547</strong>.</p>
<ol class="arabic simple">
<li>Router Solicitation</li>
<li>Router Advertisement</li>
<li>the client sends a DHCPv6 <strong>SOLICIT</strong> message to the <strong>reserved IPv6 multicast all-DHCPv6-servers address FF02::1:2</strong>. This multicast address has <strong>link-local scope</strong>, which means routers do not forward the messages to other networks.</li>
<li>One or more DHCPv6 servers respond with a <strong>DHCPv6 ADVERTISE unicast message</strong> as shown in Figure 3. The ADVERTISE message informs the DHCPv6 client that the server is available for DHCPv6 service.</li>
<li>the client responds with a DHCPv6 <strong>REQUEST or INFORMATION-REQUEST</strong> unicast message to the server, <strong>depending on whether it is using stateful or stateless DHCPv6</strong>.<ul>
<li><dl class="first docutils">
<dt>Stateless DHCPv6 client</dt>
<dd>The client sends a DHCPv6 INFORMATION-REQUEST message to the DHCPv6 server requesting only configuration parameters, such as DNS server address. The <strong>client generated its own IPv6 address using the prefix from the RA message and a self-generated Interface ID</strong>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Stateful DHCPv6 client</dt>
<dd>The client sends a DHCPv6 REQUEST message to the server to obtain an IPv6 address and all other configuration parameters from the server</dd>
</dl>
</li>
</ul>
</li>
<li>server sends a DHCPv6 <strong>REPLY</strong> unicast message to the client containing the information requested in the REQUEST or INFORMATION-REQUEST message as shown in 5.</li>
</ol>
<p>mnemonic: RSRA SolARR (vd SARR)</p>
</div>
<div class="section" id="dhcpv6-stateless-config">
<h4>DHCPv6 Stateless Config<a class="headerlink" href="#dhcpv6-stateless-config" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Enable IPv6 Routing</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ipv6 unicast-routing</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure a DHCPv6 Pool</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ipv6 dhcp pool STUDENT-POOL</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">dhcpv6</span><span class="p">)</span><span class="c1">#</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure Pool Parameters</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">dhcpv6</span><span class="p">)</span><span class="c1"># dns-server dns-server-address</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">dhcpv6</span><span class="p">)</span><span class="c1"># domain-name domain-name</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">During the SLAAC process, the client received the information it needed to create an IPv6 global unicast address. The client also received the default gateway information using the source IPv6 address from the RA message, which is the link-local address of the router. However, the stateless DHCPv6 server can be configured to provide other information that might not have been included in the RA message such as DNS server address and the domain name.</p>
</div>
</li>
<li><p class="first">Configure DHCPv6 Interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Gi0/0</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ipv6 dhcp server STUDENT-POOL</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ipv6 nd other-config-flag</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">server</span> <span class="pre">STUDENT-POOL</span></code> binds the DHCPv6 pool to the interface. The router responds to stateless DHCPv6 requests on this interface with the information contained in the pool. The O flag needs to be changed from 0 to 1 using the interface command <code class="docutils literal"><span class="pre">ipv6</span> <span class="pre">nd</span> <span class="pre">other-config-flag</span></code>. RA messages sent on this interface indicate that additional information is available from a stateless DHCPv6 server.</p>
</li>
</ol>
<p>Example, R3 is configured as a client to help verify the stateless DHCPv6 operations.</p>
<img alt="nw/_static/img/Ch8_dhcpv6_stateless_server.png" src="nw/_static/img/Ch8_dhcpv6_stateless_server.png" />
</div>
<div class="section" id="dhcpv6-stateless-client">
<h4>DHCPv6 Stateless Client<a class="headerlink" href="#dhcpv6-stateless-client" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/1</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ipv6 enable</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ipv6 address autoconfig</span>
</pre></div>
</div>
<p>The client router needs an IPv6 link-local address on the interface to send and receive IPv6 messages, such as RS messages and DHCPv6 messages. The link-local address of a router is created automatically when IPv6 is enabled on the interface. This can happen when a global unicast address is configured on the interface or by using the ipv6 enable command. <code class="docutils literal"><span class="pre">After</span> <span class="pre">the</span> <span class="pre">router</span> <span class="pre">receives</span> <span class="pre">a</span> <span class="pre">link-local</span> <span class="pre">address,</span> <span class="pre">it</span> <span class="pre">can</span> <span class="pre">participate</span> <span class="pre">in</span> <span class="pre">IPv6</span> <span class="pre">neighbor</span> <span class="pre">discovery</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the ipv6 enable command is used because the router does not yet have a global unicast address.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">ipv6</span> <span class="pre">address</span> <span class="pre">autoconfig</span></code> command enables automatic configuration of IPv6 addressing using SLAAC. By assumption, the server router is configured for stateless DHCPv6 so it sends an RA message to inform the client router to use stateless DHCPv6 to obtain DNS information.</p>
</div>
<div class="section" id="verify-stateless-dhcpv6">
<h4>Verify Stateless dhcpv6<a class="headerlink" href="#verify-stateless-dhcpv6" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>server</dt>
<dd><code class="docutils literal"><span class="pre">R1#</span> <span class="pre">show</span> <span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">pool</span></code></dd>
<dt>client</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">R3#</span> <span class="pre">show</span> <span class="pre">ipv6</span> <span class="pre">interface</span> <span class="pre">Gi0/1</span></code></li>
<li><code class="docutils literal"><span class="pre">debug</span> <span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">detail</span></code>
The debug output displays all the DHCPv6 messages sent between the client and the server including the DNS server and domain name options that were configured on the server.</li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice that the client, router R3, is sending the DHCPv6 messages from its link-local address to the All_DHCPv6_Relay_Agents_and_Servers address FF02::1:2</p>
</div>
</div>
<div class="section" id="dhcpv6-stateful-config">
<h4>DHCPv6 Stateful Config<a class="headerlink" href="#dhcpv6-stateful-config" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Enable IPv6 Routing</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ipv6 unicast-routing</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command is not necessary for the router to be a stateful DHCPv6 server, but it is required for the router to source ICMPv6 RA messages</p>
</div>
</li>
<li><p class="first">Configure a DHCPv6 Pool</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ipv6 dhcp pool IPV6-STATEFUL</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">dhcpv6</span><span class="p">)</span><span class="c1">#</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure Pool Parameters</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">dhcpv6</span><span class="p">)</span><span class="c1"># address prefix prefix/length [lifetime {valid-lifetime preferred-lifetime | infinite}]</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">dhcpv6</span><span class="p">)</span><span class="c1"># address prefix 2001:db8:cafe:1::/64 lifetime infinite</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">dhcpv6</span><span class="p">)</span><span class="c1"># dns-server 2001:db8:cafe:aaaa::5</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">dhcpv6</span><span class="p">)</span><span class="c1"># domain-name example.com</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">dhcpv6</span><span class="p">)</span><span class="c1"># exit</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">During the SLAAC process, the client received the information it needed to create an IPv6 global unicast address. The client also received the default gateway information using the source IPv6 address from the RA message, which is the link-local address of the router. However, the stateless DHCPv6 server can be configured to provide other information that might not have been included in the RA message such as DNS server address and the domain name.</p>
</div>
</li>
<li><p class="first">Configure DHCPv6 Interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Gi0/0</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ipv6 dhcp server IPV6-STATEFUL</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ipv6 nd MANAGED-config-flag</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">The</span> <span class="pre">M</span> <span class="pre">flag</span> <span class="pre">needs</span> <span class="pre">to</span> <span class="pre">be</span> <span class="pre">changed</span> <span class="pre">from</span> <span class="pre">0</span> <span class="pre">to</span> <span class="pre">1</span> <span class="pre">using</span> <span class="pre">the</span> <span class="pre">interface</span> <span class="pre">command</span> <span class="pre">ipv6</span> <span class="pre">nd</span> <span class="pre">managed-config-flag.</span> <span class="pre">This</span> <span class="pre">informs</span> <span class="pre">the</span> <span class="pre">device</span> <span class="pre">not</span> <span class="pre">to</span> <span class="pre">use</span> <span class="pre">SLAAC</span> <span class="pre">but</span> <span class="pre">to</span> <span class="pre">obtain</span> <span class="pre">IPv6</span> <span class="pre">addressing</span> <span class="pre">and</span> <span class="pre">all</span> <span class="pre">configuration</span> <span class="pre">parameters</span> <span class="pre">from</span> <span class="pre">a</span> <span class="pre">stateful</span> <span class="pre">DHCPv6</span> <span class="pre">server</span></code></p>
</li>
</ol>
</div>
<div class="section" id="dhcpv6-stateful-client">
<h4>DHCPv6 Stateful Client<a class="headerlink" href="#dhcpv6-stateful-client" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/1</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ipv6 enable</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ipv6 address dhcp</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">ipv6</span> <span class="pre">enable</span></code> interface configuration mode command allows the client router to receive an IPv6 link-local address on the interface to send RS messages and participate in DHCPv6</p>
</div>
<div class="section" id="verify-stateful-dhcpv6">
<h4>Verify Stateful dhcpv6<a class="headerlink" href="#verify-stateful-dhcpv6" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>server</dt>
<dd><code class="docutils literal"><span class="pre">R1#</span> <span class="pre">show</span> <span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">pool</span></code>
<code class="docutils literal"><span class="pre">R1#</span> <span class="pre">show</span> <span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">binding</span></code>
displays the automatic binding between the link-local address of the client and the address assigned by the server. FE80::32F7:DFF:FE25:2DE1 is the link-local address of the client. In this example, this is the G0/1 interface of R3. This address is bound to the IPv6 global unicast address, 2001:DB8:CAFE:1:5844:47B2:2603:C171, which was assigned by R1, the DHCPv6 server. This information is maintained by a stateful DHCPv6 server and NOT by a stateless DHCPv6 server.</dd>
<dt>client</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">R3#</span> <span class="pre">show</span> <span class="pre">ipv6</span> <span class="pre">interface</span> <span class="pre">Gi0/1</span></code></li>
<li><code class="docutils literal"><span class="pre">debug</span> <span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">detail</span></code>
The debug output displays all the DHCPv6 messages sent between the client and the server including the DNS server and domain name options that were configured on the server.</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="configure-dhcpv6-relay">
<h4>Configure DHCPv6 relay<a class="headerlink" href="#configure-dhcpv6-relay" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch8_dhcpv6_relay_agent.png" src="nw/_static/img/Ch8_dhcpv6_relay_agent.png" />
<p>DHCPv6 messages from clients are sent to the IPv6 multicast address <strong>FF02::1:2. All_DHCPv6_Relay_Agents_and_Servers address</strong>. This address has link-local scope which means routers do not forward these messages. The router must be configured as a DHCPv6 relay agent to enable the DHCPv6 client and server to communicate.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ipv6 dhcp relay destination 2001:db8:cafe:1::6</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">R1</span><span class="c1"># show ipv6 interface g0/0</span>
<span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">relay</span> <span class="n">mode</span>
  <span class="n">Relay</span> <span class="n">destinations</span><span class="p">:</span>
    <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">CAFE</span><span class="p">:</span><span class="mi">1</span><span class="p">::</span><span class="mi">6</span>
<span class="n">R1</span><span class="c1">#</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">DHCPv6 relay agent is configured using the <code class="docutils literal"><span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">relay</span> <span class="pre">destination</span></code> command. This command is configured on the interface facing the DHCPv6 client using the address of the DHCPv6 server as the destination.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">show</span> <span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">interface</span></code> command verifies the G0/0 interface is in relay mode with 2001:DB8:CAFE:1::6 configured as the DHCPv6 server.</p>
<dl class="docutils">
<dt>The dynamic assignment of IPv6 global unicast addresses can be configured in three ways:</dt>
<dd><ul class="first last simple">
<li>Stateless Address Autoconfiguration (SLAAC) only</li>
<li>Stateless Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</li>
<li>Stateful DHCPv6</li>
</ul>
</dd>
</dl>
<p>With SLAAC (pronounced slack), a DHCPv6 server is not needed for hosts to acquire IPv6 addresses. It can be used to receive additional information that the host needs, such as the domain name and the domain name server (DNS) address. When SLAAC is used to assign the IPv6 host addresses and DHCPv6 is used to assign other network parameters, it is called Stateless DHCPv6.
With Stateful DHCPv6, the DHCP server assigns all information, including the host IPv6 address.
Determination of how hosts obtain their dynamic IPv6 addressing information is dependent on flag settings contained within the router advertisement (RA) messages.</p>
</div>
<div class="section" id="dhcpv6-labs">
<h4>DHCPv6 labs<a class="headerlink" href="#dhcpv6-labs" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The default bias template (used by the Switch Database Manager (SDM)) does not provide IPv6 address capabilities. Verify that SDM is using either the dual-ipv4-and-ipv6 template or the lanbase-routing template. The new template will be used after reboot even if the config is not saved</p>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># show sdm prefer</span>

<span class="n">assign</span> <span class="n">the</span> <span class="n">dual</span><span class="o">-</span><span class="n">ipv4</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">ipv6</span> <span class="n">template</span> <span class="k">as</span> <span class="n">the</span> <span class="n">default</span> <span class="n">sdm</span> <span class="n">template</span><span class="p">:</span>

<span class="n">S1</span><span class="c1"># config t</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># sdm prefer dual-ipv4-and-ipv6 default</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">S1</span><span class="c1"># reload</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">wireshark filter to see only ipv6 RA messages <code class="docutils literal"><span class="pre">ipv6.dst==ff02::1</span></code></p>
</div>
<p>Use the show ipv6 interface g0/1 command to verify that G0/1 is part of the All-router multicast group (FF02::2). RA messages are not sent out G0/1 without that group assignment.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show ipv6 interface g0/1</span>
<span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">IPv6</span> <span class="ow">is</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">link</span><span class="o">-</span><span class="n">local</span> <span class="n">address</span> <span class="ow">is</span> <span class="n">FE80</span><span class="p">::</span><span class="mi">1</span>
  <span class="n">No</span> <span class="n">Virtual</span> <span class="n">link</span><span class="o">-</span><span class="n">local</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">Global</span> <span class="n">unicast</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
    <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="n">A</span><span class="p">::</span><span class="mi">1</span><span class="p">,</span> <span class="n">subnet</span> <span class="ow">is</span> <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="n">A</span><span class="p">::</span><span class="o">/</span><span class="mi">64</span>
  <span class="n">Joined</span> <span class="n">group</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
    <span class="n">FF02</span><span class="p">::</span><span class="mi">1</span>
    <span class="n">FF02</span><span class="p">::</span><span class="mi">2</span>
    <span class="n">FF02</span><span class="p">::</span><span class="mi">1</span><span class="p">:</span><span class="n">FF00</span><span class="p">:</span><span class="mi">1</span>
  <span class="n">MTU</span> <span class="ow">is</span> <span class="mi">1500</span> <span class="nb">bytes</span>
  <span class="n">ICMP</span> <span class="n">error</span> <span class="n">messages</span> <span class="n">limited</span> <span class="n">to</span> <span class="n">one</span> <span class="n">every</span> <span class="mi">100</span> <span class="n">milliseconds</span>
  <span class="n">ICMP</span> <span class="n">redirects</span> <span class="n">are</span> <span class="n">enabled</span>
  <span class="n">ICMP</span> <span class="n">unreachables</span> <span class="n">are</span> <span class="n">sent</span>
  <span class="n">ND</span> <span class="n">DAD</span> <span class="ow">is</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">number</span> <span class="n">of</span> <span class="n">DAD</span> <span class="n">attempts</span><span class="p">:</span> <span class="mi">1</span>
  <span class="n">ND</span> <span class="n">reachable</span> <span class="n">time</span> <span class="ow">is</span> <span class="mi">30000</span> <span class="n">milliseconds</span> <span class="p">(</span><span class="n">using</span> <span class="mi">30000</span><span class="p">)</span>
  <span class="n">ND</span> <span class="n">advertised</span> <span class="n">reachable</span> <span class="n">time</span> <span class="ow">is</span> <span class="mi">0</span> <span class="p">(</span><span class="n">unspecified</span><span class="p">)</span>
  <span class="n">ND</span> <span class="n">advertised</span> <span class="n">retransmit</span> <span class="n">interval</span> <span class="ow">is</span> <span class="mi">0</span> <span class="p">(</span><span class="n">unspecified</span><span class="p">)</span>
  <span class="n">ND</span> <span class="n">router</span> <span class="n">advertisements</span> <span class="n">are</span> <span class="n">sent</span> <span class="n">every</span> <span class="mi">200</span> <span class="n">seconds</span>
  <span class="n">ND</span> <span class="n">router</span> <span class="n">advertisements</span> <span class="n">live</span> <span class="k">for</span> <span class="mi">1800</span> <span class="n">seconds</span>
  <span class="n">ND</span> <span class="n">advertised</span> <span class="n">default</span> <span class="n">router</span> <span class="n">preference</span> <span class="ow">is</span> <span class="n">Medium</span>
  <span class="n">Hosts</span> <span class="n">use</span> <span class="n">stateless</span> <span class="n">autoconfig</span> <span class="k">for</span> <span class="n">addresses</span><span class="o">.</span>
</pre></div>
</div>
<p>Use the ipv6 address autoconfig command on VLAN 1 to obtain an IPv6 address through SLAAC</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface vlan 1</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ipv6 address autoconfig</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ipv6</span> <span class="pre">interface</span></code> command to verify that SLAAC provided a unicast address to VLAN1 on S1.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># show ipv6 interface</span>
<span class="n">Vlan1</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">IPv6</span> <span class="ow">is</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">link</span><span class="o">-</span><span class="n">local</span> <span class="n">address</span> <span class="ow">is</span> <span class="n">FE80</span><span class="p">::</span><span class="n">ED9</span><span class="p">:</span><span class="mi">96</span><span class="n">FF</span><span class="p">:</span><span class="n">FEE8</span><span class="p">:</span><span class="mi">8</span><span class="n">A40</span>
  <span class="n">No</span> <span class="n">Virtual</span> <span class="n">link</span><span class="o">-</span><span class="n">local</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">Stateless</span> <span class="n">address</span> <span class="n">autoconfig</span> <span class="n">enabled</span>
  <span class="n">Global</span> <span class="n">unicast</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
    <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="n">A</span><span class="p">:</span><span class="n">ED9</span><span class="p">:</span><span class="mi">96</span><span class="n">FF</span><span class="p">:</span><span class="n">FEE8</span><span class="p">:</span><span class="mi">8</span><span class="n">A40</span><span class="p">,</span> <span class="n">subnet</span> <span class="ow">is</span> <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="n">A</span><span class="p">::</span><span class="o">/</span><span class="mi">64</span> <span class="p">[</span><span class="n">EUI</span><span class="o">/</span><span class="n">CAL</span><span class="o">/</span><span class="n">PRE</span><span class="p">]</span>
      <span class="n">valid</span> <span class="n">lifetime</span> <span class="mi">2591988</span> <span class="n">preferred</span> <span class="n">lifetime</span> <span class="mi">604788</span>
  <span class="n">Joined</span> <span class="n">group</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
    <span class="n">FF02</span><span class="p">::</span><span class="mi">1</span>
    <span class="n">FF02</span><span class="p">::</span><span class="mi">1</span><span class="p">:</span><span class="n">FFE8</span><span class="p">:</span><span class="mi">8</span><span class="n">A40</span>
  <span class="n">MTU</span> <span class="ow">is</span> <span class="mi">1500</span> <span class="nb">bytes</span>
  <span class="n">ICMP</span> <span class="n">error</span> <span class="n">messages</span> <span class="n">limited</span> <span class="n">to</span> <span class="n">one</span> <span class="n">every</span> <span class="mi">100</span> <span class="n">milliseconds</span>
  <span class="n">ICMP</span> <span class="n">redirects</span> <span class="n">are</span> <span class="n">enabled</span>
  <span class="n">ICMP</span> <span class="n">unreachables</span> <span class="n">are</span> <span class="n">sent</span>
  <span class="n">Output</span> <span class="n">features</span><span class="p">:</span> <span class="n">Check</span> <span class="n">hwidb</span>
  <span class="n">ND</span> <span class="n">DAD</span> <span class="ow">is</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">number</span> <span class="n">of</span> <span class="n">DAD</span> <span class="n">attempts</span><span class="p">:</span> <span class="mi">1</span>
  <span class="n">ND</span> <span class="n">reachable</span> <span class="n">time</span> <span class="ow">is</span> <span class="mi">30000</span> <span class="n">milliseconds</span> <span class="p">(</span><span class="n">using</span> <span class="mi">30000</span><span class="p">)</span>
  <span class="n">ND</span> <span class="n">NS</span> <span class="n">retransmit</span> <span class="n">interval</span> <span class="ow">is</span> <span class="mi">1000</span> <span class="n">milliseconds</span>
  <span class="n">Default</span> <span class="n">router</span> <span class="ow">is</span> <span class="n">FE80</span><span class="p">::</span><span class="mi">1</span> <span class="n">on</span> <span class="n">Vlan1</span>
</pre></div>
</div>
<p>Configure an IPv6 stateless DHCP server on R1.</p>
<ol class="loweralpha simple">
<li><dl class="first docutils">
<dt>Create an IPv6 DHCP pool.</dt>
<dd><code class="docutils literal"><span class="pre">R1(config)#</span> <span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">pool</span> <span class="pre">IPV6POOL-A</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Assign a domain name to the pool.</dt>
<dd><code class="docutils literal"><span class="pre">R1(config-dhcpv6)#</span> <span class="pre">domain-name</span> <span class="pre">ccna-statelessDHCPv6.com</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Assign a DNS server address.</dt>
<dd><code class="docutils literal"><span class="pre">R1(config-dhcpv6)#</span> <span class="pre">dns-server</span> <span class="pre">2001:db8:acad:a::abcd</span></code>
<code class="docutils literal"><span class="pre">R1(config-dhcpv6)#</span> <span class="pre">exit</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Assign the DHCPv6 pool to the interface.</dt>
<dd><code class="docutils literal"><span class="pre">R1(config)#</span> <span class="pre">interface</span> <span class="pre">g0/1</span></code>
<code class="docutils literal"><span class="pre">R1(config-if)#</span> <span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">server</span> <span class="pre">IPV6POOL-A</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Set the DHCPv6 network discovery (ND) other-config-flag.</dt>
<dd><code class="docutils literal"><span class="pre">R1(config-if)#</span> <span class="pre">ipv6</span> <span class="pre">nd</span> <span class="pre">other-config-flag</span></code>
<code class="docutils literal"><span class="pre">R1(config-if)#</span> <span class="pre">end</span></code></dd>
</dl>
</li>
</ol>
<p>Configure an IPv6 stateful DHCP server on R1.</p>
<ol class="loweralpha">
<li><dl class="first docutils">
<dt>Add the network prefix to the pool</dt>
<dd><p class="first last"><code class="docutils literal"><span class="pre">R1(config)#</span> <span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">pool</span> <span class="pre">IPV6POOL-A</span></code>
<code class="docutils literal"><span class="pre">R1(config-dhcpv6)#</span> <span class="pre">address</span> <span class="pre">prefix</span> <span class="pre">2001:db8:acad:a::/64</span></code></p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Change domain name to ccna-statefulDHCPv6.com</dt>
<dd><p class="first last"><code class="docutils literal"><span class="pre">R1(config-dhcpv6)#</span> <span class="pre">no</span> <span class="pre">domain-name</span> <span class="pre">ccna-statelessDHCPv6.com</span></code>
<code class="docutils literal"><span class="pre">R1(config-dhcpv6)#</span> <span class="pre">domain-name</span> <span class="pre">ccna-statefulDHCPv6.com</span></code>
<code class="docutils literal"><span class="pre">R1(config-dhcpv6)#</span> <span class="pre">end</span></code></p>
</dd>
</dl>
</li>
<li><p class="first">Verify DHCPv6 pool settings</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show ipv6 dhcp pool</span>
<span class="n">DHCPv6</span> <span class="n">pool</span><span class="p">:</span> <span class="n">IPV6POOL</span><span class="o">-</span><span class="n">A</span>
  <span class="n">Address</span> <span class="n">allocation</span> <span class="n">prefix</span><span class="p">:</span> <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="n">A</span><span class="p">::</span><span class="o">/</span><span class="mi">64</span> <span class="n">valid</span> <span class="mi">172800</span> <span class="n">preferred</span> <span class="mi">86400</span> <span class="p">(</span><span class="mi">0</span> <span class="ow">in</span> <span class="n">use</span><span class="p">,</span> <span class="mi">0</span> <span class="n">conflicts</span><span class="p">)</span>
  <span class="n">DNS</span> <span class="n">server</span><span class="p">:</span> <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="n">A</span><span class="p">::</span><span class="n">ABCD</span>
  <span class="n">Domain</span> <span class="n">name</span><span class="p">:</span> <span class="n">ccna</span><span class="o">-</span><span class="n">StatefulDHCPv6</span><span class="o">.</span><span class="n">com</span>
  <span class="n">Active</span> <span class="n">clients</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><dl class="first docutils">
<dt>Enter debug mode to verify the stateful DHCPv6 address assignment</dt>
<dd><p class="first last"><code class="docutils literal"><span class="pre">R1#</span> <span class="pre">debug</span> <span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">detail</span></code>
``  IPv6 DHCP debugging is on (detailed)``</p>
</dd>
</dl>
</li>
</ol>
<p>Set the flag on G0/1 for stateful DHCPv6</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Shutting down the G0/1 interface before making changes ensures that an RA message is sent when the interface is activated.</p>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># shutdown</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ipv6 nd managed-config-flag</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no shutdown</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Enable interface F0/6 on S1</dt>
<dd><p class="first">Now that R1 is configured for stateful dhcpv6 you can reconnect PC-A to the nw by activating f0/6 on s1</p>
<div class="code last highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface f0/6</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no shutdown</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
</pre></div>
</div>
</dd>
</dl>
<p>verify</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show ipv6 dhcp pool</span>
<span class="n">DHCPv6</span> <span class="n">pool</span><span class="p">:</span> <span class="n">IPV6POOL</span><span class="o">-</span><span class="n">A</span>
  <span class="n">Address</span> <span class="n">allocation</span> <span class="n">prefix</span><span class="p">:</span> <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="n">A</span><span class="p">::</span><span class="o">/</span><span class="mi">64</span> <span class="n">valid</span> <span class="mi">172800</span> <span class="n">preferred</span> <span class="mi">86400</span> <span class="p">(</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">use</span><span class="p">,</span> <span class="mi">0</span> <span class="n">conflicts</span><span class="p">)</span>
  <span class="n">DNS</span> <span class="n">server</span><span class="p">:</span> <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="n">A</span><span class="p">::</span><span class="n">ABCD</span>
  <span class="n">Domain</span> <span class="n">name</span><span class="p">:</span> <span class="n">ccna</span><span class="o">-</span><span class="n">StatefulDHCPv6</span><span class="o">.</span><span class="n">com</span>
  <span class="n">Active</span> <span class="n">clients</span><span class="p">:</span> <span class="mi">1</span>


<span class="n">R1</span><span class="c1"># show ipv6 dhcp binding</span>
<span class="n">Client</span><span class="p">:</span> <span class="n">FE80</span><span class="p">::</span><span class="n">D428</span><span class="p">:</span><span class="mi">7</span><span class="n">DE2</span><span class="p">:</span><span class="mi">997</span><span class="n">C</span><span class="p">:</span><span class="n">B05A</span>
  <span class="n">DUID</span><span class="p">:</span> <span class="mi">0001000117</span><span class="n">F6723D000C298D5444</span>
  <span class="n">Username</span> <span class="p">:</span> <span class="n">unassigned</span>
  <span class="n">IA</span> <span class="n">NA</span><span class="p">:</span> <span class="n">IA</span> <span class="n">ID</span> <span class="mh">0x0E000C29</span><span class="p">,</span> <span class="n">T1</span> <span class="mi">43200</span><span class="p">,</span> <span class="n">T2</span> <span class="mi">69120</span>
    <span class="n">Address</span><span class="p">:</span> <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="n">A</span><span class="p">:</span><span class="n">B55C</span><span class="p">:</span><span class="mi">8519</span><span class="p">:</span><span class="mi">8915</span><span class="p">:</span><span class="mi">57</span><span class="n">CE</span>
            <span class="n">preferred</span> <span class="n">lifetime</span> <span class="mi">86400</span><span class="p">,</span> <span class="n">valid</span> <span class="n">lifetime</span> <span class="mi">172800</span>
            <span class="n">expires</span> <span class="n">at</span> <span class="n">Mar</span> <span class="mi">07</span> <span class="mi">2013</span> <span class="mi">04</span><span class="p">:</span><span class="mi">09</span> <span class="n">PM</span> <span class="p">(</span><span class="mi">171595</span> <span class="n">seconds</span><span class="p">)</span>
<span class="n">R1</span><span class="c1"># u all</span>
<span class="n">All</span> <span class="n">possible</span> <span class="n">debugging</span> <span class="n">has</span> <span class="n">been</span> <span class="n">turned</span> <span class="n">off</span>
</pre></div>
</div>
<p>Stateful DHCPv6 uses more memory resources. Stateful DHCPv6 requires the router to store dynamic state information about the DHCPv6 clients. Stateless DHCPv6 clients do not use the DHCP server to obtain address information, so this information does not need to be stored.</p>
<p>Which type of dynamic IPv6 address assignment is recommended by Cisco, Stateless DHCPv6 or Stateful DHCPv6?
Cisco recommends Stateless DHCPv6 when implementing and deploying IPv6 networks without a Cisco Network Registar (CNR)</p>
</div>
<div class="section" id="dhcpv6-troubleshooting-tasks">
<h4>DHCPv6 Troubleshooting Tasks<a class="headerlink" href="#dhcpv6-troubleshooting-tasks" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Resolve address conflicts</dt>
<dd><p class="first last">The <code class="docutils literal"><span class="pre">show</span> <span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">conflict</span></code> command displays all address conflicts recorded by the stateful DHCPv6 server. If an address conflict is detected, the client typically removes the address and generates a new address using either SLAAC or stateful DHCPv6.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Verify allocation method</dt>
<dd><p class="first last">the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ipv6</span> <span class="pre">interface</span> <span class="pre">g0/0</span></code> command can be used to verify the method of address allocation indicated in the RA message as indicated by the settings of the M and O flags. This information is displayed in the last lines of the output. If a client is not receiving its IPv6 address information from a stateful DHCPv6 server, it could be due to incorrect M and O flags in the RA message.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Test with a static IPv6 address</dt>
<dd><p class="first last">In the case of IPv6, if the workstation is unable to reach network resources with a statically configured IPv6 address, the root cause of the problem is not SLAAC or DHCPv6. At this point, network connectivity troubleshooting is required.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Verify switch port configuration</dt>
<dd><p class="first">If the DHCPv6 client is unable to obtain information from a DHCPv6 server, verify that the switch port is enabled and is operating correctly.
In linux do a manual <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">dhclient</span> <span class="pre">-6</span></code></p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If there is a switch between the client and the DHCPv6 server, and the client is unable to obtain the DHCP configuration, switch port configuration issues may be the cause. These causes may include issues related to trunking, channeling, or spanning tree. <strong>PortFast and edge port</strong> configurations resolve the most common DHCPv6 client issues that occur with an initial installation of a Cisco switch.</p>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Test DHCPv6 Operation on the same subnet or VLAN</dt>
<dd><p class="first last">If the stateless or stateful DHCPv6 server is functioning correctly, but is on a different IPv6 network or VLAN than the client, the problem may be with the DHCPv6 relay agent. The <strong>client facing interface</strong> on the router must be configured with the <code class="docutils literal"><span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">relay</span> <span class="pre">destination</span></code> command.</p>
</dd>
</dl>
</li>
</ol>
<img alt="nw/_static/img/verify_router_dhcpv6_config1.png" src="nw/_static/img/verify_router_dhcpv6_config1.png" />
<img alt="nw/_static/img/verify_router_dhcpv6_config2.png" src="nw/_static/img/verify_router_dhcpv6_config2.png" />
<p><code class="docutils literal"><span class="pre">R1#</span> <span class="pre">debug</span> <span class="pre">ipv6</span> <span class="pre">dhcp</span> <span class="pre">detail</span></code></p>
</div>
<div class="section" id="ch8-lab-troubleshooting-dhcpv6">
<h4>Ch8 Lab Troubleshooting DHCPv6<a class="headerlink" href="#ch8-lab-troubleshooting-dhcpv6" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="13%" />
<col width="36%" />
<col width="18%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IPv6 Address</th>
<th class="head">Prefix Length</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R1</td>
<td>G0/1</td>
<td>2001:DB8:ACAD:A::1</td>
<td>64</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>S1</td>
<td>VLAN 1</td>
<td>Assigned by SLAAC</td>
<td>64</td>
<td>Assigned by SLAAC</td>
</tr>
<tr class="row-even"><td>PC-A</td>
<td>NIC</td>
<td>Assigned by SLAAC and DHCPv6</td>
<td>64</td>
<td>Assigned by SLAAC</td>
</tr>
</tbody>
</table>
<img alt="nw/_static/img/Ch8_8.2.4.4_TB_DHCPv6.png" src="nw/_static/img/Ch8_8.2.4.4_TB_DHCPv6.png" />
<div class="section" id="part-1-build-nw-and-configure-basic-settings">
<h5>Part 1 Build NW and configure basic settings<a class="headerlink" href="#part-1-build-nw-and-configure-basic-settings" title="Permalink to this headline">¶</a></h5>
<p>cable as show in topology, intitialize and reload the router n switch
.. code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show sdm prefer</span>
</pre></div>
</div>
<p>Follow this configuration to assign the dual-ipv4-and-ipv6 template as the default SDM template:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># config t</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># sdm prefer dual-ipv4-and-ipv6 default</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">S1</span><span class="c1"># reload</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Required Resources</dt>
<dd><ul class="first last simple">
<li>1 Router (Cisco 1941 with Cisco IOS Release 15.2(4)M3 universal image or comparable)</li>
<li>1 Switch (Cisco 2960 with Cisco IOS Release 15.0(2) lanbasek9 image or comparable)</li>
<li>PC (Linux, don’t bother with Windows)</li>
<li>Console cables to configure the Cisco IOS devices via the console ports</li>
<li>Ethernet cables as shown in the topology</li>
</ul>
</dd>
</dl>
<ol class="loweralpha simple">
<li>Disable DNS lookup.</li>
<li>Configure device names as shown in the topology.</li>
<li>Encrypt plain text passwords.</li>
<li>Create a MOTD banner warning users that unauthorized access is prohibited.</li>
<li>Assign class as the encrypted privileged EXEC mode password.</li>
<li>Assign cisco as the console and vty passwords and enable login.</li>
<li>Configure logging synchronous to prevent console messages from interrupting command entry.</li>
</ol>
<p>Load the IPv6 configuration to R1</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">domain</span> <span class="n">name</span> <span class="n">ccna</span><span class="o">-</span><span class="n">lab</span><span class="o">.</span><span class="n">com</span>
<span class="n">ipv6</span> <span class="n">dhcp</span> <span class="n">pool</span> <span class="n">IPV6POOL</span><span class="o">-</span><span class="n">A</span>
 <span class="n">dns</span><span class="o">-</span><span class="n">server</span> <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="n">CAFE</span><span class="p">::</span><span class="n">A</span>
 <span class="n">domain</span><span class="o">-</span><span class="n">name</span> <span class="n">ccna</span><span class="o">-</span><span class="n">lab</span><span class="o">.</span><span class="n">com</span>
<span class="n">interface</span> <span class="n">g0</span><span class="o">/</span><span class="mi">0</span>
 <span class="n">no</span> <span class="n">ip</span> <span class="n">address</span>
 <span class="n">shutdown</span>
 <span class="n">duplex</span> <span class="n">auto</span>
 <span class="n">speed</span> <span class="n">auto</span>
<span class="n">interface</span> <span class="n">g0</span><span class="o">/</span><span class="mi">1</span>
 <span class="n">no</span> <span class="n">ip</span> <span class="n">address</span>
 <span class="n">duplex</span> <span class="n">auto</span>
 <span class="n">speed</span> <span class="n">auto</span>
 <span class="n">ipv6</span> <span class="n">address</span> <span class="n">FE80</span><span class="p">::</span><span class="mi">1</span> <span class="n">link</span><span class="o">-</span><span class="n">local</span>
 <span class="n">ipv6</span> <span class="n">address</span> <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="n">A</span><span class="p">::</span><span class="mi">11</span><span class="o">/</span><span class="mi">64</span>
<span class="n">end</span>
</pre></div>
</div>
<p>Load the IPv6 configuration to S1.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">interface</span> <span class="nb">range</span> <span class="n">f0</span><span class="o">/</span><span class="mi">1</span><span class="o">-</span><span class="mi">24</span>
 <span class="n">shutdown</span>
<span class="n">interface</span> <span class="nb">range</span> <span class="n">g0</span><span class="o">/</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span>
 <span class="n">shutdown</span>
<span class="n">interface</span> <span class="n">Vlan1</span>
 <span class="n">shutdown</span>
<span class="n">end</span>
</pre></div>
</div>
<p>Save the running configurations on R1 and S1
Verify that IPv6 is enabled on PC-A
Verify that IPv6 has been enabled in the Local Area Connection Properties window on PC-A</p>
</div>
<div class="section" id="part-2-troubleshoot-ipv6-connectivity">
<h5>Part 2 Troubleshoot IPv6 connectivity<a class="headerlink" href="#part-2-troubleshoot-ipv6-connectivity" title="Permalink to this headline">¶</a></h5>
<p>you will test and verify Layer 3 IPv6 connectivity on the network</p>
<p>Continue troubleshooting the network until Layer 3 connectivity has been established on all devices. Do not continue to Part 3
until you have succe ssfully completed Part 2</p>
<dl class="docutils">
<dt>Troubleshoot IPv6 interfaces on R1</dt>
<dd><ol class="first last loweralpha simple">
<li>According to the topology, which interface must be active on R1 for network connectivity to be established?  Record any commands used to identify which interfaces are active.</li>
<li>If necessary, take the steps required to bring up the interface. Record the commands used to correct the configuration errors and verify that the interface is active.</li>
<li>Identify the IPv6 addresses configured on R1. Record the address es found and the commands used to view the IPv6 addresses.</li>
<li>Determine if a configuration error has been made. If any errors are identified, record all the commands used to correct the configuration.</li>
<li>On R1, what multicast group is needed for SLAAC to function?</li>
<li>What command is used to verify that R1 is a member of that group?</li>
<li>If R1 is not a member of the multicast group that is needed for SLAAC to function correctly, make the necessary changes to the configuration so that it joins the group. Record any commands necessary to correct the configurations errors.</li>
<li>Re-issue the command to verify that interface G0/1 has joined the all-routers multicast group (FF02::2).</li>
</ol>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are unable to join the all-routers multicast group, you may need to save your current configuration and reload the router.</p>
</div>
<dl class="docutils">
<dt>Troubleshoot S1</dt>
<dd><ol class="first last loweralpha simple">
<li>Are the interfaces needed for network connectivity active on S1?  Record any commands that are used to activate necessary interfaces on S1</li>
<li>What command could you use to determine if an IPv6 unicast address has been assigned to S1?</li>
<li>Does S1 have an IPv6 unicast address configured? If so, what is it?</li>
<li>If S1 is not receiving a SLAAC address, make the necessary configuration changes to allow it to receive one. Record the commands used.</li>
<li>Re-issue the command that verifies that the interface now receives a SLAAC address.</li>
<li>Can S1 ping the IPv6 unicast address assigned to the G0/1 interface assigned to R1?</li>
</ol>
</dd>
<dt>Troubleshoot PC-A</dt>
<dd><ol class="first loweralpha simple">
<li>Issue the command used on PC-A to verify the IPv6 address assigned. Record the command</li>
<li>What is the IPv6 unicast address SLAAC is providing to PC-A?</li>
<li>Can PC-A ping th e default gateway address that was assigned by SLAAC?</li>
<li>Can PC-A ping the management interface on S1?</li>
</ol>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Continue troubleshooting until you can ping R1 and S1 from PC-A</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="part-3-troubleshoot-stateless-dhcpv6">
<h5>Part 3 Troubleshoot Stateless DHCPv6<a class="headerlink" href="#part-3-troubleshoot-stateless-dhcpv6" title="Permalink to this headline">¶</a></h5>
<p>You will test and verify that Stateless DHCPv6 is working correctly on the network. You will need to use the correct IPv6 CLI commands on the router to determine if Stateless DHCPv6 is working. You may want to use <strong>debug</strong> to help determine if the DHCP server is being solicited.</p>
<dl class="docutils">
<dt>Determine if Stateless DHCPv6 is functioning correctly.</dt>
<dd><ol class="first last loweralpha simple">
<li>What is the name of the IPv6 DHCP pool? How did you determine this?</li>
<li>What network information is listed in the DHCPv6 pool?</li>
<li>Was the DHCPv6 information assigned to PC-A?  How did you determine this?</li>
</ol>
</dd>
<dt>Troubleshoot R1</dt>
<dd><ol class="first last loweralpha simple">
<li>What commands can be used to determine if R1 is configured for Stateless DHCPv6?</li>
<li>Is the G0/1 interface on R1 in Stateless DHCPv6 mode?</li>
<li>What command can be used to have R1 join the all-DHCPv6 server group?</li>
<li>Verify that the all-DHCPv6 server group is configured for interface G0/1.</li>
<li>Will PC-A receive the DHCP information now? Explain?</li>
<li>What is missing from the configuration of G0/1 that causes hosts to use the DCHP server to retrieve other network information?</li>
<li>Reset the IPv6 settings on PC-A
1) Open the Local Area Connection Properties window, deselect the Internet Protocol Version 6 (TCP/IPv6) check box, and then click OK to accept the change.
2) Open the Local Area Connection Properties window again, click the Internet Protocol Version 6 (TCP/IPv6) check box, and then click OK to accept the change.</li>
<li>Issue the command to verify changes have been made on PC-A.
Continue troubleshooting until PC-A receives the additional DHCP information from R1</li>
</ol>
</dd>
<dt>Reflection</dt>
<dd><ol class="first last arabic simple">
<li>What command is needed in the DHCPv6 pool for Stateful DHCPv6 that is not needed for Stateless DHCPv6? Why?</li>
<li>What command is needed on the interface to change the network to use Stateful DHCPv6 instead of Stateless DHCPv6?</li>
</ol>
</dd>
</dl>
</div>
</div>
<div class="section" id="ch8-8-3-1-2-skills-integration-challenge-dhcpv4">
<h4>Ch8 8.3.1.2 Skills Integration Challenge DHCPv4<a class="headerlink" href="#ch8-8-3-1-2-skills-integration-challenge-dhcpv4" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/ch8_skills_integration_challenge.png" src="nw/_static/img/ch8_skills_integration_challenge.png" />
<div class="section" id="addressing-table">
<h5>Addressing Table<a class="headerlink" href="#addressing-table" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="16%" />
<col width="22%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#160;</td>
<td>G0/0.10</td>
<td>172.31.10.1</td>
<td>255.255.255.224</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0.20</td>
<td>172.31.20.1</td>
<td>255.255.255.240</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>R1</td>
<td>G0/0.30</td>
<td>172.31.30.1</td>
<td>255.255.255.128</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0.40</td>
<td>172.31.40.1</td>
<td>255.255.255.192</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/1</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>PC1</td>
<td>NIC</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
</tr>
<tr class="row-even"><td>PC2</td>
<td>NIC</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
</tr>
<tr class="row-odd"><td>PC3</td>
<td>NIC</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
</tr>
<tr class="row-even"><td>PC4</td>
<td>NIC</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="vlan-port-assignments-and-dhcp-information">
<h5>VLAN Port Assignments and DHCP Information<a class="headerlink" href="#vlan-port-assignments-and-dhcp-information" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="31%" />
<col width="23%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ports</th>
<th class="head">VLAN Number - Name</th>
<th class="head">DHCP Pool Name</th>
<th class="head">Network</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Fa0/5 – 0/9</td>
<td>VLAN 10 - Sales</td>
<td>VLAN_10</td>
<td>172.31.10.0/27</td>
</tr>
<tr class="row-odd"><td>Fa0/10 – Fa0/14</td>
<td>VLAN 20 - Production</td>
<td>VLAN_20</td>
<td>172.31.20.0/28</td>
</tr>
<tr class="row-even"><td>Fa0/15 – Fa0/19</td>
<td>VLAN 30 - Marketing</td>
<td>VLAN_30</td>
<td>172.31.30.0/25</td>
</tr>
<tr class="row-odd"><td>Fa0/20 – Fa0/24</td>
<td>VLAN 40 - HR</td>
<td>VLAN_40</td>
<td>172.31.40.0/26</td>
</tr>
</tbody>
</table>
<p>Configure VLANs, trunks, DHCP Server, DHCP relay agents, and configure a router as a DHCP client</p>
<ul class="simple">
<li>Create VLANs on S2 and assign VLANs to appropriate ports. Names are case-sensitive</li>
<li>Configure S2 ports for trunking.</li>
<li>Configure all non-trunk ports on S2 as access ports.</li>
<li>Configure R1 to route between VLANs. Subinterface names should match the VLAN number.</li>
<li>Configure R1 to act as a DHCP server for the VLANs attached to S2.<ul>
<li>Create a DHCP pool for each VLAN. Names are case-sensitive.</li>
<li>Assign the appropriate addresses to each pool.</li>
<li>Configure DHCP to provide the default gateway address</li>
<li>Configure the DNS server 209.165.201.14 for each pool.</li>
<li>Prevent the first 10 addresses from each pool from being distributed to end devices.</li>
</ul>
</li>
<li>Verify that each PC has an address assigned from the correct DHCP pool.
Note: DHCP address assignments may take some time. Click Fast Forward Time to speed up the process.</li>
<li>Configure R1 as a DHCP client so that it receives an IP address from the ISP network.</li>
<li>Verify all devices can now ping each other and www.cisco.pka</li>
</ul>
<p>Solution</p>
<p>R1</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="o">&gt;</span><span class="n">en</span>
<span class="n">R1</span><span class="c1">#conf t</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface G0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#no shutdown</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="o">%</span><span class="n">LINK</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">CHANGED</span><span class="p">:</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>

<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#interface G0/0.10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">subif</span><span class="p">)</span><span class="c1">#</span>
<span class="o">%</span><span class="n">LINK</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">CHANGED</span><span class="p">:</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">subif</span><span class="p">)</span><span class="c1">#encapsulation dot1Q 10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">subif</span><span class="p">)</span><span class="c1">#ip address 172.31.10.1 255.255.255.224</span>

<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">subif</span><span class="p">)</span><span class="c1">#interface G0/0.20</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">subif</span><span class="p">)</span><span class="c1">#</span>
<span class="o">%</span><span class="n">LINK</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">CHANGED</span><span class="p">:</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">0.20</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">0.20</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="n">encapsulation</span> <span class="n">dot1Q</span> <span class="mi">20</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">subif</span><span class="p">)</span><span class="c1">#encapsulation dot1Q 20</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">subif</span><span class="p">)</span><span class="c1">#ip address 172.31.20.1 255.255.255.240</span>

<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">subif</span><span class="p">)</span><span class="c1">#interface G0/0.30</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">subif</span><span class="p">)</span><span class="c1">#</span>
<span class="o">%</span><span class="n">LINK</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">CHANGED</span><span class="p">:</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">0.30</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">0.30</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="n">encapsulation</span> <span class="n">dot1Q</span> <span class="mi">30</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">subif</span><span class="p">)</span><span class="c1">#ip address 172.31.30.1 255.255.255.128</span>

<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">subif</span><span class="p">)</span><span class="c1">#interface G0/0.40</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">subif</span><span class="p">)</span><span class="c1">#</span>
<span class="o">%</span><span class="n">LINK</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">CHANGED</span><span class="p">:</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">0.40</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mf">0.40</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="n">encapsulation</span> <span class="n">dot1Q</span> <span class="mi">40</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">subif</span><span class="p">)</span><span class="c1">#ip address 172.31.40.1 255.255.255.192</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">subif</span><span class="p">)</span><span class="c1">#exit</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#</span>
</pre></div>
</div>
<p>Configure R1 G0/1 as DHCP client</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface G0/1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip address dhcp</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#no shutdown</span>
<span class="o">%</span><span class="n">LINK</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">CHANGED</span><span class="p">:</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="o">%</span><span class="n">DHCP</span><span class="o">-</span><span class="mi">6</span><span class="o">-</span><span class="n">ADDRESS_ASSIGN</span><span class="p">:</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="n">assigned</span> <span class="n">DHCP</span> <span class="n">address</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.227</span><span class="p">,</span> <span class="n">mask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.224</span><span class="p">,</span> <span class="n">hostname</span> <span class="n">R1</span>
</pre></div>
</div>
<p>Configure R1 as DHCPv4 server for each vlan</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp excluded-address 172.31.10.1 172.31.10.10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp pool VLAN_10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#network 172.31.10.0 255.255.255.224</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#dns-server 209.165.201.14</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#default-router 172.31.10.1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#option ?</span>
  <span class="o">&lt;</span><span class="mi">0</span><span class="o">-</span><span class="mi">254</span><span class="o">&gt;</span>  <span class="n">DHCP</span> <span class="n">option</span> <span class="n">code</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#exit</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp excluded-address 172.31.20.1 172.31.20.10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp pool VLAN_20</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#network 172.31.20.0 255.255.255.240</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#default-router 172.31.20.1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#dns-server 209.165.201.14</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#exit</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp excluded-address 172.31.30.1 172.31.30.10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp pool VLAN_30</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#default-router 172.31.30.1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#dns-server 209.165.201.14</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#network 172.31.30.0 255.255.255.128</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#exit</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp excluded-address 172.31.40.1 172.31.40.10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip dhcp pool VLAN_40</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#network 172.31.40.0 255.255.255.192</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#default-router 172.31.40.1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#dns-server 209.165.201.14</span>
<span class="n">R1</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1">#exit</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#</span>
</pre></div>
</div>
<p>Create VLANs on S2 and assign VLANs to respective ports</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface range fastEthernet 0/1 - 4</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#switchport mode trunk</span>
<span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">down</span>
<span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">down</span>
<span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#switchport trunk allowed vlan 10,20,30,40</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface range fastEthernet 0/5 - 24</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#switchport mode access</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#switchport ?</span>
  <span class="n">access</span>         <span class="n">Set</span> <span class="n">access</span> <span class="n">mode</span> <span class="n">characteristics</span> <span class="n">of</span> <span class="n">the</span> <span class="n">interface</span>
  <span class="n">mode</span>           <span class="n">Set</span> <span class="n">trunking</span> <span class="n">mode</span> <span class="n">of</span> <span class="n">the</span> <span class="n">interface</span>
  <span class="n">native</span>         <span class="n">Set</span> <span class="n">trunking</span> <span class="n">native</span> <span class="n">characteristics</span> <span class="n">when</span> <span class="n">interface</span> <span class="ow">is</span> <span class="ow">in</span>
                 <span class="n">trunking</span> <span class="n">mode</span>
  <span class="n">nonegotiate</span>    <span class="n">Device</span> <span class="n">will</span> <span class="ow">not</span> <span class="n">engage</span> <span class="ow">in</span> <span class="n">negotiation</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">this</span>
                 <span class="n">interface</span>
  <span class="n">port</span><span class="o">-</span><span class="n">security</span>  <span class="n">Security</span> <span class="n">related</span> <span class="n">command</span>
  <span class="n">priority</span>       <span class="n">Set</span> <span class="n">appliance</span> <span class="mf">802.1</span><span class="n">p</span> <span class="n">priority</span>
  <span class="n">trunk</span>          <span class="n">Set</span> <span class="n">trunking</span> <span class="n">characteristics</span> <span class="n">of</span> <span class="n">the</span> <span class="n">interface</span>
  <span class="n">voice</span>          <span class="n">Voice</span> <span class="n">appliance</span> <span class="n">attributes</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#interface range fastEthernet 0/5 - 9</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#switchport access vlan 10</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#interface range fastEthernet 0/10 - 14</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#switchport access vlan 20</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#interface range fastEthernet 0/15 - 19</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#switchport access vlan 30</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#interface range fastEthernet 0/20 - 24</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#switchport access vlan 40</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="nb">range</span><span class="p">)</span><span class="c1">#</span>
</pre></div>
</div>
<p>running config R1</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>R1&gt;en
R1#show run
Building configuration...

Current configuration : 1786 bytes
!
version 15.1
no service timestamps log datetime msec
no service timestamps debug datetime msec
no service password-encryption
!
hostname R1
!
!
!
!
ip dhcp excluded-address 172.31.10.1 172.31.10.10
ip dhcp excluded-address 172.31.20.1 172.31.20.10
ip dhcp excluded-address 172.31.30.1 172.31.30.10
ip dhcp excluded-address 172.31.40.1 172.31.40.10
!
ip dhcp pool VLAN_10
 network 172.31.10.0 255.255.255.224
 default-router 172.31.10.1
 dns-server 209.165.201.14
ip dhcp pool VLAN_20
 network 172.31.20.0 255.255.255.240
 default-router 172.31.20.1
 dns-server 209.165.201.14
ip dhcp pool VLAN_30
 network 172.31.30.0 255.255.255.128
 default-router 172.31.30.1
 dns-server 209.165.201.14
ip dhcp pool VLAN_40
 network 172.31.40.0 255.255.255.192
 default-router 172.31.40.1
 dns-server 209.165.201.14
!
!
!
ip cef
no ipv6 cef
!
!
!
!
license udi pid CISCO2911/K9 sn FTX1524A6QI
!
!
!
!
!
!
!
!
!
!
!
spanning-tree mode pvst
!
!
!
!
!
!
interface GigabitEthernet0/0
 no ip address
 duplex auto
 speed auto
!
interface GigabitEthernet0/0.10
 encapsulation dot1Q 10
 ip address 172.31.10.1 255.255.255.224
!
interface GigabitEthernet0/0.20
 encapsulation dot1Q 20
 ip address 172.31.20.1 255.255.255.240
!
interface GigabitEthernet0/0.30
 encapsulation dot1Q 30
 ip address 172.31.30.1 255.255.255.128
!
interface GigabitEthernet0/0.40
 encapsulation dot1Q 40
 ip address 172.31.40.1 255.255.255.192
!
interface GigabitEthernet0/1
 description Connection to ISP
 ip address dhcp
 duplex auto
 speed auto
!
interface GigabitEthernet0/2
 no ip address
 duplex auto
 speed auto
 shutdown
!
interface Vlan1
 no ip address
 shutdown
!
ip classless
ip route 0.0.0.0 0.0.0.0 GigabitEthernet0/1
!
ip flow-export version 9
!
!
!
!
!
!
!
line con 0
!
line aux 0
!
line vty 0 4
 login
!
!
!
end
</pre></div>
</div>
<p>switch2</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S2</span><span class="c1">#show vlan brief</span>

<span class="n">VLAN</span> <span class="n">Name</span>                             <span class="n">Status</span>    <span class="n">Ports</span>
<span class="o">----</span> <span class="o">--------------------------------</span> <span class="o">---------</span> <span class="o">-------------------------------</span>
<span class="mi">1</span>    <span class="n">default</span>                          <span class="n">active</span>    <span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">Gig0</span><span class="o">/</span><span class="mi">2</span>
<span class="mi">10</span>   <span class="n">Sales</span>                            <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">7</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">8</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">9</span>
<span class="mi">20</span>   <span class="n">Production</span>                       <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">11</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">13</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">14</span>
<span class="mi">30</span>   <span class="n">Marketing</span>                        <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">15</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">17</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">18</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">19</span>
<span class="mi">40</span>   <span class="n">HR</span>                               <span class="n">active</span>    <span class="n">Fa0</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">21</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">22</span><span class="p">,</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">23</span>
                                                <span class="n">Fa0</span><span class="o">/</span><span class="mi">24</span>
<span class="mi">1002</span> <span class="n">fddi</span><span class="o">-</span><span class="n">default</span>                     <span class="n">active</span>
<span class="mi">1003</span> <span class="n">token</span><span class="o">-</span><span class="n">ring</span><span class="o">-</span><span class="n">default</span>               <span class="n">active</span>
<span class="mi">1004</span> <span class="n">fddinet</span><span class="o">-</span><span class="n">default</span>                  <span class="n">active</span>
<span class="mi">1005</span> <span class="n">trnet</span><span class="o">-</span><span class="n">default</span>                    <span class="n">active</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span>S2#show running-config
Building configuration...

Current configuration : 2356 bytes
!
version 12.2
no service timestamps log datetime msec
no service timestamps debug datetime msec
no service password-encryption
!
hostname S2
!
!
!
!
!
spanning-tree mode pvst
spanning-tree extend system-id
!
interface FastEthernet0/1
 switchport trunk allowed vlan 10,20,30,40
 switchport mode trunk
!
interface FastEthernet0/2
 switchport trunk allowed vlan 10,20,30,40
 switchport mode trunk
!
interface FastEthernet0/3
 switchport trunk allowed vlan 10,20,30,40
 switchport mode trunk
!
interface FastEthernet0/4
 switchport trunk allowed vlan 10,20,30,40
 switchport mode trunk
!
interface FastEthernet0/5
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/6
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/7
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/8
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/9
 switchport access vlan 10
 switchport mode access
!
interface FastEthernet0/10
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/11
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/12
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/13
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/14
 switchport access vlan 20
 switchport mode access
!
interface FastEthernet0/15
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/16
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/17
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/18
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/19
 switchport access vlan 30
 switchport mode access
!
interface FastEthernet0/20
 switchport access vlan 40
 switchport mode access
!
interface FastEthernet0/21
 switchport access vlan 40
 switchport mode access
!
interface FastEthernet0/22
 switchport access vlan 40
 switchport mode access
!
interface FastEthernet0/23
 switchport access vlan 40
 switchport mode access
!
interface FastEthernet0/24
 switchport access vlan 40
 switchport mode access
!
interface GigabitEthernet0/1
!
interface GigabitEthernet0/2
!
interface Vlan1
 no ip address
 shutdown
!
!
!
!
line con 0
!
line vty 0 4
 login
line vty 5 15
 login
!
</pre></div>
</div>
<p>Router1 DHCP show commands</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1">#show ip dhcp ?</span>
  <span class="n">binding</span>   <span class="n">DHCP</span> <span class="n">address</span> <span class="n">bindings</span>
  <span class="n">conflict</span>  <span class="n">DHCP</span> <span class="n">address</span> <span class="n">conflicts</span>
  <span class="n">pool</span>      <span class="n">DHCP</span> <span class="n">pools</span> <span class="n">information</span>
  <span class="n">relay</span>     <span class="n">Miscellaneous</span> <span class="n">DHCP</span> <span class="n">relay</span> <span class="n">information</span>
<span class="n">R1</span><span class="c1">#show ip dhcp binding</span>
<span class="n">IP</span> <span class="n">address</span>       <span class="n">Client</span><span class="o">-</span><span class="n">ID</span><span class="o">/</span>              <span class="n">Lease</span> <span class="n">expiration</span>        <span class="n">Type</span>
                 <span class="n">Hardware</span> <span class="n">address</span>
<span class="mf">172.31</span><span class="o">.</span><span class="mf">10.11</span>     <span class="mf">0000.0</span><span class="n">C92</span><span class="o">.</span><span class="n">D758</span>           <span class="o">--</span>                     <span class="n">Automatic</span>
<span class="mf">172.31</span><span class="o">.</span><span class="mf">20.11</span>     <span class="mf">0060.706</span><span class="n">D</span><span class="o">.</span><span class="mi">2129</span>           <span class="o">--</span>                     <span class="n">Automatic</span>
<span class="mf">172.31</span><span class="o">.</span><span class="mf">30.11</span>     <span class="mf">0030.</span><span class="n">F21A</span><span class="o">.</span><span class="mi">5348</span>           <span class="o">--</span>                     <span class="n">Automatic</span>
<span class="mf">172.31</span><span class="o">.</span><span class="mf">40.11</span>     <span class="mf">0002.1730</span><span class="o">.</span><span class="mi">4277</span>           <span class="o">--</span>                     <span class="n">Automatic</span>
<span class="n">R1</span><span class="c1">#show ip dhcp conflict</span>
<span class="n">IP</span> <span class="n">address</span>        <span class="n">Detection</span> <span class="n">method</span>   <span class="n">Detection</span> <span class="n">time</span>          <span class="n">VRF</span>
<span class="n">R1</span><span class="c1">#show ip dhcp pool</span>

<span class="n">Pool</span> <span class="n">VLAN_10</span> <span class="p">:</span>
 <span class="n">Utilization</span> <span class="n">mark</span> <span class="p">(</span><span class="n">high</span><span class="o">/</span><span class="n">low</span><span class="p">)</span>    <span class="p">:</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">0</span>
 <span class="n">Subnet</span> <span class="n">size</span> <span class="p">(</span><span class="n">first</span><span class="o">/</span><span class="nb">next</span><span class="p">)</span>       <span class="p">:</span> <span class="mi">0</span> <span class="o">/</span> <span class="mi">0</span>
 <span class="n">Total</span> <span class="n">addresses</span>                <span class="p">:</span> <span class="mi">30</span>
 <span class="n">Leased</span> <span class="n">addresses</span>               <span class="p">:</span> <span class="mi">1</span>
 <span class="n">Excluded</span> <span class="n">addresses</span>             <span class="p">:</span> <span class="mi">4</span>
 <span class="n">Pending</span> <span class="n">event</span>                  <span class="p">:</span> <span class="n">none</span>

 <span class="mi">1</span> <span class="n">subnet</span> <span class="ow">is</span> <span class="n">currently</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">pool</span>
 <span class="n">Current</span> <span class="n">index</span>        <span class="n">IP</span> <span class="n">address</span> <span class="nb">range</span>                    <span class="n">Leased</span><span class="o">/</span><span class="n">Excluded</span><span class="o">/</span><span class="n">Total</span>
 <span class="mf">172.31</span><span class="o">.</span><span class="mf">10.1</span>          <span class="mf">172.31</span><span class="o">.</span><span class="mf">10.1</span>      <span class="o">-</span> <span class="mf">172.31</span><span class="o">.</span><span class="mf">10.30</span>      <span class="mi">1</span>    <span class="o">/</span> <span class="mi">4</span>     <span class="o">/</span> <span class="mi">30</span>

<span class="n">Pool</span> <span class="n">VLAN_20</span> <span class="p">:</span>
 <span class="n">Utilization</span> <span class="n">mark</span> <span class="p">(</span><span class="n">high</span><span class="o">/</span><span class="n">low</span><span class="p">)</span>    <span class="p">:</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">0</span>
 <span class="n">Subnet</span> <span class="n">size</span> <span class="p">(</span><span class="n">first</span><span class="o">/</span><span class="nb">next</span><span class="p">)</span>       <span class="p">:</span> <span class="mi">0</span> <span class="o">/</span> <span class="mi">0</span>
 <span class="n">Total</span> <span class="n">addresses</span>                <span class="p">:</span> <span class="mi">14</span>
 <span class="n">Leased</span> <span class="n">addresses</span>               <span class="p">:</span> <span class="mi">1</span>
 <span class="n">Excluded</span> <span class="n">addresses</span>             <span class="p">:</span> <span class="mi">4</span>
 <span class="n">Pending</span> <span class="n">event</span>                  <span class="p">:</span> <span class="n">none</span>

 <span class="mi">1</span> <span class="n">subnet</span> <span class="ow">is</span> <span class="n">currently</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">pool</span>
 <span class="n">Current</span> <span class="n">index</span>        <span class="n">IP</span> <span class="n">address</span> <span class="nb">range</span>                    <span class="n">Leased</span><span class="o">/</span><span class="n">Excluded</span><span class="o">/</span><span class="n">Total</span>
 <span class="mf">172.31</span><span class="o">.</span><span class="mf">20.1</span>          <span class="mf">172.31</span><span class="o">.</span><span class="mf">20.1</span>      <span class="o">-</span> <span class="mf">172.31</span><span class="o">.</span><span class="mf">20.14</span>      <span class="mi">1</span>    <span class="o">/</span> <span class="mi">4</span>     <span class="o">/</span> <span class="mi">14</span>

<span class="n">Pool</span> <span class="n">VLAN_30</span> <span class="p">:</span>
 <span class="n">Utilization</span> <span class="n">mark</span> <span class="p">(</span><span class="n">high</span><span class="o">/</span><span class="n">low</span><span class="p">)</span>    <span class="p">:</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">0</span>
 <span class="n">Subnet</span> <span class="n">size</span> <span class="p">(</span><span class="n">first</span><span class="o">/</span><span class="nb">next</span><span class="p">)</span>       <span class="p">:</span> <span class="mi">0</span> <span class="o">/</span> <span class="mi">0</span>
 <span class="n">Total</span> <span class="n">addresses</span>                <span class="p">:</span> <span class="mi">126</span>
 <span class="n">Leased</span> <span class="n">addresses</span>               <span class="p">:</span> <span class="mi">1</span>
 <span class="n">Excluded</span> <span class="n">addresses</span>             <span class="p">:</span> <span class="mi">4</span>
 <span class="n">Pending</span> <span class="n">event</span>                  <span class="p">:</span> <span class="n">none</span>

 <span class="mi">1</span> <span class="n">subnet</span> <span class="ow">is</span> <span class="n">currently</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">pool</span>
 <span class="n">Current</span> <span class="n">index</span>        <span class="n">IP</span> <span class="n">address</span> <span class="nb">range</span>                    <span class="n">Leased</span><span class="o">/</span><span class="n">Excluded</span><span class="o">/</span><span class="n">Total</span>
 <span class="mf">172.31</span><span class="o">.</span><span class="mf">30.1</span>          <span class="mf">172.31</span><span class="o">.</span><span class="mf">30.1</span>      <span class="o">-</span> <span class="mf">172.31</span><span class="o">.</span><span class="mf">30.126</span>     <span class="mi">1</span>    <span class="o">/</span> <span class="mi">4</span>     <span class="o">/</span> <span class="mi">126</span>

<span class="n">Pool</span> <span class="n">VLAN_40</span> <span class="p">:</span>
 <span class="n">Utilization</span> <span class="n">mark</span> <span class="p">(</span><span class="n">high</span><span class="o">/</span><span class="n">low</span><span class="p">)</span>    <span class="p">:</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">0</span>
 <span class="n">Subnet</span> <span class="n">size</span> <span class="p">(</span><span class="n">first</span><span class="o">/</span><span class="nb">next</span><span class="p">)</span>       <span class="p">:</span> <span class="mi">0</span> <span class="o">/</span> <span class="mi">0</span>
 <span class="n">Total</span> <span class="n">addresses</span>                <span class="p">:</span> <span class="mi">62</span>
 <span class="n">Leased</span> <span class="n">addresses</span>               <span class="p">:</span> <span class="mi">1</span>
 <span class="n">Excluded</span> <span class="n">addresses</span>             <span class="p">:</span> <span class="mi">4</span>
 <span class="n">Pending</span> <span class="n">event</span>                  <span class="p">:</span> <span class="n">none</span>

 <span class="mi">1</span> <span class="n">subnet</span> <span class="ow">is</span> <span class="n">currently</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">pool</span>
 <span class="n">Current</span> <span class="n">index</span>        <span class="n">IP</span> <span class="n">address</span> <span class="nb">range</span>                    <span class="n">Leased</span><span class="o">/</span><span class="n">Excluded</span><span class="o">/</span><span class="n">Total</span>
 <span class="mf">172.31</span><span class="o">.</span><span class="mf">40.1</span>          <span class="mf">172.31</span><span class="o">.</span><span class="mf">40.1</span>      <span class="o">-</span> <span class="mf">172.31</span><span class="o">.</span><span class="mf">40.62</span>      <span class="mi">1</span>    <span class="o">/</span> <span class="mi">4</span>     <span class="o">/</span> <span class="mi">62</span>
<span class="n">R1</span><span class="c1">#show ip dhcp relay ?</span>
  <span class="n">information</span>  <span class="n">DHCP</span> <span class="n">relay</span> <span class="n">information</span> <span class="n">option</span>
<span class="n">R1</span><span class="c1">#show ip dhcp relay information trusted-sources</span>
<span class="n">List</span> <span class="n">of</span> <span class="n">trusted</span> <span class="n">sources</span> <span class="n">of</span> <span class="n">relay</span> <span class="n">agent</span> <span class="n">information</span> <span class="n">option</span><span class="p">:</span>

<span class="n">R1</span><span class="c1">#show dhcp lease</span>
<span class="n">Temp</span> <span class="n">IP</span> <span class="n">addr</span><span class="p">:</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.227</span> <span class="k">for</span> <span class="n">peer</span> <span class="n">on</span> <span class="n">Interface</span><span class="p">:</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Temp</span> <span class="n">sub</span> <span class="n">net</span> <span class="n">mask</span><span class="p">:</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.224</span>
   <span class="n">DHCP</span> <span class="n">Lease</span> <span class="n">server</span><span class="p">:</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span> <span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Bound</span>
   <span class="n">DHCP</span> <span class="n">Transaction</span> <span class="nb">id</span><span class="p">:</span> <span class="mf">0E98472</span><span class="n">C</span>
   <span class="n">Lease</span><span class="p">:</span> <span class="mi">86400</span> <span class="n">secs</span><span class="p">,</span>  <span class="n">Renewal</span><span class="p">:</span> <span class="mi">43200</span> <span class="n">secs</span><span class="p">,</span>  <span class="n">Rebind</span><span class="p">:</span> <span class="mi">75600</span> <span class="n">secs</span>
<span class="n">Temp</span> <span class="n">default</span><span class="o">-</span><span class="n">gateway</span> <span class="n">addr</span><span class="p">:</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span>
   <span class="n">Next</span> <span class="n">timer</span> <span class="n">fires</span> <span class="n">after</span><span class="p">:</span> <span class="mi">09</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">51</span>
   <span class="n">Retry</span> <span class="n">count</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Client</span><span class="o">-</span><span class="n">ID</span><span class="p">:</span><span class="n">cisco</span><span class="o">-</span><span class="mf">0002.1638</span><span class="o">.</span><span class="n">B602</span><span class="o">-</span><span class="n">Gig0</span><span class="o">/</span><span class="mi">1</span>
   <span class="n">Client</span><span class="o">-</span><span class="n">ID</span> <span class="nb">hex</span> <span class="n">dump</span><span class="p">:</span> <span class="mi">636973636</span><span class="n">F2D303030322E313633382E</span>
                       <span class="mi">23630322</span><span class="n">D476967302F31</span>
   <span class="n">Hostname</span><span class="p">:</span> <span class="n">R1</span>

<span class="n">R1</span><span class="c1">#show ip interface GigabitEthernet 0/1</span>
<span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span> <span class="p">(</span><span class="n">connected</span><span class="p">)</span>
  <span class="n">Internet</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.227</span><span class="o">/</span><span class="mi">27</span>
  <span class="n">Broadcast</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
  <span class="n">Address</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">DHCP</span>
  <span class="n">MTU</span> <span class="ow">is</span> <span class="mi">1500</span> <span class="nb">bytes</span>
  <span class="n">Helper</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="n">Directed</span> <span class="n">broadcast</span> <span class="n">forwarding</span> <span class="ow">is</span> <span class="n">disabled</span>
  <span class="n">Outgoing</span> <span class="n">access</span> <span class="nb">list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="n">Inbound</span>  <span class="n">access</span> <span class="nb">list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dhcpv6-conclusion">
<h4>DHCPv6 conclusion<a class="headerlink" href="#dhcpv6-conclusion" title="Permalink to this headline">¶</a></h4>
<p>There are two methods available for the dynamic configuration of IPv6 global unicast addresses.</p>
<ul class="simple">
<li>Stateless Address Autoconfiguration (SLAAC)</li>
<li>Dynamic Host Configuration Protocol for IPv6 (Stateful DHCPv6)</li>
</ul>
<p>With stateless autoconfiguration, the client uses information provided by the IPv6 RA message to automatically select and configure a unique IPv6 address. The stateless DHCPv6 option informs the client to use the information in the RA message for addressing, but additional configuration parameters are available from a DHCPv6 server.</p>
<p>Stateful DHCPv6 is similar to DHCPv4. In this case, the RA message informs the client not to use the information in the RA message. All addressing information and DNS configuration information is obtained from a stateful DHCPv6 server. The DHCPv6 server maintains IPv6 state information similar to a DHCPv4 server allocating addresses for IPv4.</p>
</div>
<div class="section" id="ch8-qna">
<h4>Ch8 QnA<a class="headerlink" href="#ch8-qna" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>SLAAC</dt>
<dd>stateless address autoconfiguation. A method of automatic IPv6 address configuration on a client</dd>
<dt>Stateless DHCPv6</dt>
<dd>method of automatic IPv6 address configuration on a client with additional information provided by aDHCPv6 server</dd>
<dt>Stateful DHCPv6</dt>
<dd>a method of obtaining an IPv6 address and other configuration values from a DHCPv6 server</dd>
<dt>EUI-64</dt>
<dd>extended unique identifier. a process to configure the client ID based on the interface MAC address</dd>
<dt>DAD</dt>
<dd>Duplicate Address Detection. a process by a SLAAC client to verify that no duplication exists for its self-configured IPv6 address</dd>
<dt>FF02::1:2</dt>
<dd>Which destination IP address is used when an IPv6 host sends a DHCPv6 SOLICIT message to locate a DHCPv6 server?
.. note:: DHCPv6 hosts will send a DHCP SOLICIT message to the all DHCP routers multicast address of FF02::1:2</dd>
<dt>client rcvs RA msg with M flag 0 and O flag 1</dt>
<dd>The client should automatically configure an IPv6 address without contacting a DHCPv6 server.</dd>
<dt>Why is DHCPREQUEST sent as broadcast?</dt>
<dd>The client may have received offers from multiple servers, and the broadcast serves to implicitly decline those other offers</dd>
<dt>ipv6 address dhcp</dt>
<dd>set the router as a stateful DHCPv6 client</dd>
<dt>255.255.255.255</dt>
<dd>the destination IP address when an IPv4 host sends a DHCPDISCOVER message
.. note:: Because a DHCP client does not have a valid IPv4 address, it must use a broadcast IP address of 255.255.255.255 as the destination address to communicate with the DHCP server. The DHCPDISCOVER message sent by the client is the first message sent in order to make initial contact with a DHCP server.</dd>
</dl>
<p>An administrator has configured a DHCPv4 relay router and issued these commands</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/0</span>
<span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 10.0.1.1 255.255.255.0</span>
<span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no shutdown</span>
<span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip dhcp pool RELAY</span>
<span class="n">Router</span><span class="p">(</span><span class="n">dhcp</span><span class="o">-</span><span class="n">config</span><span class="p">)</span><span class="c1"># end</span>
</pre></div>
</div>
<p>The clients are not receiving IP parameters from the DHCPv4 server. What is a possible cause?
The <code class="docutils literal"><span class="pre">ip</span> <span class="pre">helper-address</span> <span class="pre">server-ip</span></code> command is missing</p>
<dl class="docutils">
<dt>DHCPREQUEST</dt>
<dd>What message does an IPv4 host use to reply when it receives a DHCPOFFER message from a DHCP server?
.. note:: When the client receives the DHCPOFFER from the server, it sends back a DHCPREQUEST broadcast message. On receiving the DHCPREQUEST message, the server replies with a unicast DHCPACK message.</dd>
<dt>SLAAC</dt>
<dd>In which alternative to DHCPv6 does a router dynamically provide IPv6 configuration information to hosts?
.. note:: Stateless Address Autoconfiguration (SLAAC) can be used as an alternative to DHCPv6. In this approach, a router provides global routing prefix, prefix length, default gateway, and DNS server information to a host. The host is not provided with a global unicast address by SLAAC. Instead, SLAAC suggests that the host create its own global unicast address based on the supplied global routing prefix. ARP is not used in IPv6. ICMPv6 messages are used by SLAAC to provide addressing and other configuration information. EUI-64 is a process in which a host will create an Interface ID from its 48-bit MAC address.</dd>
<dt>DAD</dt>
<dd>What process is used in ICMPv6 for a host to verify that an IPv6 address is unique before configuring it on an interface?
.. note:: Before an IPv6 host can enable and use an assigned IPv6 address, the host must verify that the address is unique on the network. To verify that no other hosts are using the IPv6 address, the host performs the duplicate address detection (DAD) process by sending a <strong>Neighbor Solicitation (NS) message</strong> to the IPv6 address.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">clients in stateless DHCPv6 operation will configure their interface IDs either by EUI-64 or a random number</p>
</div>
<dl class="docutils">
<dt>Router# show ip dhcp binding</dt>
<dd>Which command will allow a network administrator to check the IP address that is assigned to a particular MAC address?</dd>
<dt>After booting, a client receives an ICMPv6 RA message with the M flag set to 0 and the O flag set to 1. What does this indicate?</dt>
<dd><a href="#id1"><span class="problematic" id="id2">:strike:`The client should automatically configure an IPv6 address without contacting a DHCPv6 server`</span></a>
The client should automatically configure an IPv6 address and then contact a DHCPv6 server for more information</dd>
<dt>When a client is requesting an initial address lease from a DHCP server, why is the DHCPREQUEST message sent as a broadcast?</dt>
<dd>The client may have received offers from multiple servers, and the broadcast serves to implicitly decline those other offers
.. note:: During the initial DHCP exchange between a client and server, the client broadcasts a DHCPDISCOVER message looking for DHCP servers. Multiple servers may be configured to respond to this request with DHCPOFFER messages. The client will choose the lease from one of the servers by sending a DHCPREQUEST message. It sends this message as a broadcast so that the other DHCP servers that sent offers will know that their offers were declined and the corresponding address can go back into the pool</dd>
<dt>An administrator is troubleshooting a DHCPv4 issue on a router. By issuing the debug ip dhcp …….. command, the administrator can watch, in real time, the IP address assignments that are performed by the router.</dt>
<dd><code class="docutils literal"><span class="pre">debug</span> <span class="pre">ip</span> <span class="pre">dhcp</span> <span class="pre">server</span> <span class="pre">events</span></code></dd>
</dl>
</div>
<div class="section" id="ch8-practice-exam">
<h4>Ch8 practice exam<a class="headerlink" href="#ch8-practice-exam" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Which DHCPv4 message will a client send to accept an IPv4 address that is offered by a DHCP server?</p>
<ul class="simple">
<li>unicast DHCPACK</li>
<li>broadcast DHCPACK</li>
<li>unicast DHCPREQUEST</li>
<li>broadcast DHCPREQUEST</li>
<li>Answer -&gt; <a href="#id3"><span class="problematic" id="id4">:transparent:`broadcast DHCPREQUEST`</span></a></li>
</ul>
</li>
<li><p class="first">A company uses DHCP servers to dynamically assign IPv4 addresses to employee workstations. The address lease duration is set as 5 days. An employee returns to the office after an absence of one week. When the employee boots the workstation, it sends a message to obtain an IP address. Which Layer 2 and Layer 3 destination addresses will the message contain?</p>
<ul class="simple">
<li>FF-FF-FF-FF-FF-FF and 255.255.255.255</li>
<li>both MAC and IPv4 addresses of the DHCP server</li>
<li>MAC address of the DHCP server and 255.255.255.255</li>
<li>FF-FF-FF-FF-FF-FF and IPv4 address of the DHCP server</li>
<li>Answer -&gt; <a href="#id5"><span class="problematic" id="id6">:transparent:`FF-FF-FF-FF-FF-FF and 255.255.255.255`</span></a></li>
</ul>
</li>
<li><p class="first">Which is a DHCPv4 address allocation method that assigns IPv4 addresses for a limited lease period?</p>
<ul class="simple">
<li>manual allocation</li>
<li>pre-allocation</li>
<li>automatic allocation</li>
<li>dynamic allocation</li>
<li>Answer -&gt; <a href="#id7"><span class="problematic" id="id8">:transparent:`dynamic allocation`</span></a></li>
</ul>
</li>
<li><p class="first">Which address does a DHCPv4 server target when sending a DHCPOFFER message to a client that makes an address request?</p>
<ul class="simple">
<li>client IP address</li>
<li>client hardware address</li>
<li>gateway IP address</li>
<li>broadcast MAC address</li>
<li>Answer -&gt; <a href="#id9"><span class="problematic" id="id10">:transparent:`client hardware address`</span></a></li>
</ul>
</li>
<li><p class="first">As a DHCPv4 client lease is about to expire, what is the message that the client sends the DHCP server?</p>
<ul class="simple">
<li>DHCPDISCOVER</li>
<li>DHCPOFFER</li>
<li>DHCPREQUEST</li>
<li>DHCPACK</li>
<li>Answer -&gt; <a href="#id11"><span class="problematic" id="id12">:transparent:`DHCPREQUEST`</span></a></li>
</ul>
</li>
<li><p class="first">What is an advantage of configuring a Cisco router as a relay agent?</p>
<ul class="simple">
<li>It will allow DHCPDISCOVER messages to pass without alteration</li>
<li>It can forward both broadcast and multicast messages on behalf of clients</li>
<li>It can provide relay services for multiple UDP services</li>
<li>It reduces the response time from a DHCP server.</li>
<li>Answer -&gt; <a href="#id13"><span class="problematic" id="id14">:transparent:`It can provide relay services for multiple UDP services`</span></a></li>
</ul>
</li>
<li><p class="first">An administrator issues the commands</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/1</span>
<span class="n">Router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address dhcp</span>
</pre></div>
</div>
<p>What is the administrator trying to achieve?</p>
<ul class="simple">
<li>configuring the router to act as a DHCPv4 server</li>
<li>configuring the router to obtain IP parameters from a DHCPv4 server</li>
<li>configuring the router to act as a relay agent</li>
<li>configuring the router to resolve IP address conflicts</li>
<li>Answer -&gt; <a href="#id15"><span class="problematic" id="id16">:transparent:`configuring the router to obtain IP parameters from a DHCPv4 server`</span></a></li>
</ul>
</li>
<li><p class="first">Under which two circumstances would a router usually be configured as a DHCPv4 client? (Choose two.)</p>
<ul class="simple">
<li>The router is intended to be used as a SOHO gateway</li>
<li>The administrator needs the router to act as a relay agent</li>
<li>The router is meant to provide IP addresses to the hosts</li>
<li>This is an ISP requirement</li>
<li>The router has a fixed IP address</li>
<li>Answer -&gt; <a href="#id17"><span class="problematic" id="id18">:transparent:`The router is intended to be used as a SOHO gateway &amp;&amp; This is an ISP requirement`</span></a></li>
</ul>
</li>
<li><p class="first">A company uses the SLAAC method to configure IPv6 addresses for the employee workstations. Which address will a client use as its default gateway?</p>
<ul class="simple">
<li>the all-routers multicast address</li>
<li>the link-local address of the router interface that is attached to the network</li>
<li>the unique local address of the router interface that is attached to the network</li>
<li>the global unicast address of the router interface that is attached to the network</li>
<li>Answer -&gt; <a href="#id19"><span class="problematic" id="id20">:transparent:`the link-local address of the router interface that is attached to the network`</span></a></li>
</ul>
</li>
<li><p class="first">A network administrator configures a router to send RA messages with M flag as 0 and O flag as 1. Which statement describes the effect of this configuration when a PC tries to configure its IPv6 address?</p>
<ul class="simple">
<li>It should contact a DHCPv6 server for all the information that it needs</li>
<li>It should use the information that is contained in the RA message exclusively</li>
<li>It should use the information that is contained in the RA message and contact a DHCPv6 server for additional information</li>
<li>It should contact a DHCPv6 server for the prefix, the prefix-length information, and an interface ID that is both random and unique</li>
<li>Answer -&gt; <a href="#id21"><span class="problematic" id="id22">:transparent:`It should use the information that is contained in the RA message and contact a DHCPv6 server for additional information`</span></a></li>
</ul>
</li>
<li><p class="first">A company implements the stateless DHCPv6 method for configuring IPv6 addresses on employee workstations. After a workstation receives messages from multiple DHCPv6 servers to indicate their availability for DHCPv6 service, which message does it send to a server for configuration information?</p>
<ul class="simple">
<li>DHCPv6 SOLICIT</li>
<li>DHCPv6 REQUEST</li>
<li>DHCPv6 ADVERTISE</li>
<li>DHCPv6 INFORMATION-REQUEST</li>
<li>Answer -&gt; <a href="#id23"><span class="problematic" id="id24">:transparent:`DHCPv6 INFORMATION-REQUEST`</span></a></li>
</ul>
</li>
<li><p class="first">An administrator wants to configure hosts to automatically assign IPv6 addresses to themselves by the use of Router Advertisement messages, but also to obtain the DNS server address from a DHCPv6 server. Which address assignment method should be configured?</p>
<ul class="simple">
<li>SLAAC</li>
<li>stateless DHCPv6</li>
<li>stateful DHCPv6</li>
<li>RA and EUI-64</li>
<li>Answer -&gt; <a href="#id25"><span class="problematic" id="id26">:transparent:`stateless DHCPv6`</span></a></li>
</ul>
</li>
<li><p class="first">How does an IPv6 client ensure that it has a unique address after it configures its IPv6 address using the SLAAC allocation method?</p>
<ul class="simple">
<li>It sends an ARP message with the IPv6 address as the destination IPv6 address</li>
<li>It checks with the IPv6 address database that is hosted by the SLAAC server</li>
<li>It contacts the DHCPv6 server via a special formed ICMPv6 message</li>
<li>It sends an ICMPv6 Neighbor Solicitation message with the IPv6 address as the target IPv6 address</li>
<li>Answer -&gt; <a href="#id27"><span class="problematic" id="id28">:transparent:`It sends an ICMPv6 Neighbor Solicitation message with the IPv6 address as the target IPv6 address`</span></a></li>
</ul>
</li>
<li><p class="first">What is used in the EUI-64 process to create an IPv6 interface ID on an IPv6 enabled interface?</p>
<ul class="simple">
<li>the MAC address of the IPv6 enabled interface</li>
<li>a randomly generated 64-bit hexadecimal address</li>
<li>an IPv6 address that is provided by a DHCPv6 server</li>
<li>an IPv4 address that is configured on the interface</li>
<li>Answer -&gt; <a href="#id29"><span class="problematic" id="id30">:transparent:`the MAC address of the IPv6 enabled interface`</span></a></li>
</ul>
</li>
<li><p class="first">What two methods can be used to generate an interface ID by an IPv6 host that is using SLAAC? (Choose two.)</p>
<ul class="simple">
<li>EUI-64</li>
<li>random generation</li>
<li>stateful DHCPv6</li>
<li>DAD</li>
<li>ARP</li>
<li>Answer -&gt; <a href="#id31"><span class="problematic" id="id32">:transparent:`EUI-64 &amp;&amp; random generation`</span></a></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. Based on the output that is shown, what kind of IPv6 addressing is being configured?</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>R1# show running-config
&lt;output omitted&gt;
!
ipv6 dhcp pool IPV6
 dns-server 2001:DB8:1234:5678::100
 domain-name netacad.com
!
interface FastEthernet0/0
 &lt;output omitted&gt;
!
 ipv6 nd other-config-flag
 ipv6 dhcp server IPV6
!
&lt;output omitted&gt;
</pre></div>
</div>
<ul class="simple">
<li>SLAAC</li>
<li>stateful DHCPv6</li>
<li>stateless DHCPv6</li>
<li>static link-local</li>
<li>Answer -&gt; <a href="#id33"><span class="problematic" id="id34">:transparent:`stateless DHCPv6`</span></a></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. What should be done to allow PC-A to receive an IPv6 address from the DHCPv6 server?</p>
<img alt="nw/_static/img/Ch8_exam_practice_1.png" src="nw/_static/img/Ch8_exam_practice_1.png" />
<ul class="simple">
<li>Add the ipv6 dhcp relay command to interface Fa0/0</li>
<li>Configure the ipv6 nd managed-config-flag command on interface Fa0/1</li>
<li>Change the ipv6 nd managed-config-flag command to ipv6 nd other-config-flag</li>
<li>Add the IPv6 address 2001:DB8:1234:5678::10/64 to the interface configuration of the DHCPv6 server</li>
<li>Answer -&gt; <a href="#id35"><span class="problematic" id="id36">:transparent:`Add the ipv6 dhcp relay command to interface Fa0/0`</span></a></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. A network administrator is implementing stateful DHCPv6 operation for the company. However, the clients are not using the prefix and prefix-length information that is configured in the DHCP pool. The administrator issues a show ipv6 interface command. What could be the cause of the problem?</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show ipv6 interface gigabitBthernet 0/0</span>
<span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">IPv6</span> <span class="ow">is</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">link</span><span class="o">-</span><span class="n">local</span> <span class="n">address</span> <span class="ow">is</span> <span class="n">FE80</span><span class="p">::</span><span class="mi">523</span><span class="n">D</span><span class="p">:</span><span class="n">E5FF</span><span class="p">:</span><span class="n">FEAA</span><span class="p">:</span><span class="n">COAO</span>
  <span class="n">No</span> <span class="n">Virtual</span> <span class="n">link</span><span class="o">-</span><span class="n">local</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">Global</span> <span class="n">unicast</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="mi">1</span><span class="p">::</span><span class="mi">1</span><span class="p">,</span> <span class="n">subnet</span> <span class="ow">is</span> <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="mi">1</span><span class="p">::</span><span class="o">/</span><span class="mi">64</span>

<span class="o">&lt;</span><span class="n">output</span> <span class="n">omitted</span><span class="o">&gt;</span>
<span class="n">ICMP</span> <span class="n">error</span> <span class="n">messages</span> <span class="n">limited</span> <span class="n">to</span> <span class="n">one</span> <span class="n">every</span> <span class="mi">100</span> <span class="n">milliseconds</span>
<span class="n">ICMP</span> <span class="n">redirects</span> <span class="n">are</span> <span class="n">enabled</span>
<span class="n">ICMP</span> <span class="n">unreachables</span> <span class="n">are</span> <span class="n">sent</span> <span class="n">ND</span> <span class="n">DAD</span> <span class="ow">is</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">number</span> <span class="n">of</span> <span class="n">DAD</span> <span class="n">attempts</span><span class="p">:</span><span class="mi">1</span>
<span class="n">ND</span> <span class="n">reachable</span> <span class="n">time</span> <span class="ow">is</span> <span class="mi">30000</span> <span class="n">milliseconds</span> <span class="p">(</span><span class="n">using</span> <span class="mi">30000</span><span class="p">)</span>
<span class="n">ND</span> <span class="n">advertised</span> <span class="n">reachable</span> <span class="n">time</span> <span class="ow">is</span> <span class="mi">0</span> <span class="p">(</span><span class="n">unspecified</span><span class="p">)</span>
<span class="n">ND</span> <span class="n">advertised</span> <span class="n">retransmit</span> <span class="n">interval</span> <span class="ow">is</span> <span class="mi">0</span> <span class="p">(</span><span class="n">unspecified</span><span class="p">)</span>
<span class="n">ND</span> <span class="n">router</span> <span class="n">advertisements</span> <span class="n">are</span> <span class="n">sent</span> <span class="n">every</span> <span class="mi">200</span> <span class="n">seconds</span>
<span class="n">ND</span> <span class="n">router</span> <span class="n">advertisements</span> <span class="n">live</span> <span class="k">for</span> <span class="mi">1800</span> <span class="n">seconds</span>
<span class="n">ND</span> <span class="n">advertised</span> <span class="n">default</span> <span class="n">router</span> <span class="n">preference</span> <span class="ow">is</span> <span class="n">Medium</span>
<span class="n">Hosts</span> <span class="n">use</span> <span class="n">stateless</span> <span class="n">autoconfig</span> <span class="k">for</span> <span class="n">addresses</span><span class="o">.</span>
<span class="n">Hosts</span> <span class="n">use</span> <span class="n">DHCP</span> <span class="n">to</span> <span class="n">obtain</span> <span class="n">other</span> <span class="n">configuration</span><span class="o">.</span>
<span class="n">R1</span><span class="c1">#</span>
</pre></div>
</div>
<ul class="simple">
<li>No virtual link-local address is configured</li>
<li>The Duplicate Address Detection feature is disabled</li>
<li>The router is configured for SLAAC DHCPv6 operation</li>
<li>The router is configured for stateless DHCPv6 operation</li>
<li>Answer -&gt; <a href="#id37"><span class="problematic" id="id38">:transparent:`The router is configured for stateless DHCPv6 operation`</span></a></li>
<li>more info on answer -&gt; <a href="#id39"><span class="problematic" id="id40">:transparent:`The router is configured for stateless DHCPv6 operation, which is shown by the last two lines of the show command output. Hosts will configure their IPv6 addresses by using the prefix information that is provided by RA messages. They will also obtain additional configuration information from a DHCPv6 server. The “No virtual link-local address” option and the “Duplicate Address Detection” option are irrelevant to DHCP configuration. Option “SLAAC configuration” is incorrect because by definition SLAAC will use only the information that is provided by RA messages to configure IPv6 settings.`</span></a></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. A network administrator is implementing the stateless DHCPv6 operation for the company. Clients are configuring IPv6 addresses as expected. However, the clients are not getting the DNS server address and the domain name information configured in the DHCP pool. What could be the cause of the problem?</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># configure terminal</span>
<span class="n">Enter</span> <span class="n">configuration</span> <span class="n">commands</span><span class="p">,</span> <span class="n">one</span> <span class="n">per</span> <span class="n">line</span><span class="o">.</span> <span class="n">End</span> <span class="k">with</span> <span class="n">CNTL</span><span class="o">/</span><span class="n">Z</span><span class="o">.</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ipv6 unicast-routing</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ipv6 dhcp pool ACAD_NET</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">dhcp</span><span class="p">)</span><span class="c1"># dns-server 2001:db8:acad:a1::10</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">dhcp</span><span class="p">)</span><span class="c1"># domain-name netacad.net</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">dhcp</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface gigabitEthernet 0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ipv6 address 2001:db8:acad:1::1/64</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ipv6 dhcp server ACAD_NET</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">R1</span><span class="c1">#</span>
<span class="n">R1</span><span class="c1"># show ipv6 dhcp pool</span>
<span class="n">DHCPv6</span> <span class="n">pool</span><span class="p">:</span> <span class="n">ACAD_NET</span>
<span class="n">DNS</span> <span class="n">server</span><span class="p">:</span> <span class="mi">2001</span><span class="p">:</span><span class="n">DE8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="n">A1</span><span class="p">::</span><span class="mi">10</span>
<span class="n">Domain</span> <span class="n">name</span><span class="p">:</span> <span class="n">netacad</span><span class="o">.</span><span class="n">net</span>
<span class="n">Active</span> <span class="n">clients</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">R1</span><span class="c1">#</span>
</pre></div>
</div>
<ul class="simple">
<li>The GigabitEthernet interface is not activated</li>
<li>The router is configured for SLAAC operation</li>
<li>The DNS server address is not on the same network as the clients are on</li>
<li>The clients cannot communicate with the DHCPv6 server, evidenced by the number of active clients being 0</li>
<li>Answer -&gt; <a href="#id41"><span class="problematic" id="id42">:transparent:`The router is configured for SLAAC operation`</span></a></li>
</ul>
</li>
<li><p class="first">Fill in the blank. Do not abbreviate.
Type a command to exclude the first fifteen useable IP addresses from a DHCPv4 address pool of the network 10.0.15.0/24</p>
<ul class="simple">
<li>Router(config)# ip dhcp <a href="#id43"><span class="problematic" id="id44">:transparent:`excluded-address 10.0.15.1 10.0.15.15`</span></a></li>
</ul>
</li>
<li><p class="first">Order the steps of configuring a router as a DHCPv4 Server. (Not all options are used.)</p>
<ul class="simple">
<li>Step 1</li>
<li>Step 2</li>
<li>Step 3</li>
<li>Configure a DHCP pool.</li>
<li>Exclude IP addresses.</li>
<li>Configure the routing protocol.</li>
<li>Define the default gateway router.</li>
<li>Configure a secret password.</li>
<li>Answer -&gt; <a href="#id45"><span class="problematic" id="id46">:transparent:`Step1=Exclude IP addresses - Step2=Configure a DHCP pool - Step3=Define the default gateway router`</span></a></li>
</ul>
</li>
<li><p class="first">Match the descriptions to the corresponding DHCPv6 server type. (Not all options are used)</p>
<ul class="simple">
<li>enabled in RA messages with the ipv6 nd other-config-flag command</li>
<li>clients communicate with the DHCPv6 server by the use of RA messages</li>
<li>the M flag is set to 1 in RA messages</li>
<li>uses the address command to create a pool of addresses for clients</li>
<li>clients send only DHCPv6 INFORMATION-REQUEST messages to the server</li>
<li>enabled on the client with the ipv6 address dhcp command</li>
<li>enabled on the client with the ipv6 address autoconfig command</li>
<li>Stateless DHCPv6<ul>
<li><a href="#id47"><span class="problematic" id="id48">:transparent:`enabled in RA messages with the ipv6 nd other-config-flag command`</span></a></li>
<li><a href="#id49"><span class="problematic" id="id50">:transparent:`clients send only DHCPv6 INFORMATION-REQUEST messages to the server`</span></a></li>
<li><a href="#id51"><span class="problematic" id="id52">:transparent:`enabled on the client with the ipv6 address autoconfig command`</span></a></li>
</ul>
</li>
<li>Stateful DHCPv6<ul>
<li><a href="#id53"><span class="problematic" id="id54">:transparent:`the M flag is set to 1 in RA messages`</span></a></li>
<li><a href="#id55"><span class="problematic" id="id56">:transparent:`uses the address command to create a pool of addresses for clients`</span></a></li>
<li><a href="#id57"><span class="problematic" id="id58">:transparent:`enabled on the client with the ipv6 address dhcp command`</span></a></li>
</ul>
</li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. What should be done to allow PC-A to receive an IPv6 address from the DHCPv6 server?</p>
<img alt="nw/_static/img/Ch10_practice_exam_q1.png" src="nw/_static/img/Ch10_practice_exam_q1.png" />
<div class="code highlight-default"><div class="highlight"><pre><span></span>RTR1# show running-config
hostname RTR1
!
&lt;output omitted&gt;
interface FastEthernet0/0
 ip address dhcp
 duplex auto
 speed auto
 ipv6 address 2001:DB8:1234:5678::1/64
 ipv6 nd managed-config-flag
!
interface FastEthernet0/1
 no ip address
 duplex auto
 speed auto
 ipv6 address 2001:DB8:1234:ABCD::1/64
!
&lt;output omitted&gt;
</pre></div>
</div>
<ul class="simple">
<li>Add the IPv6 address 2001:DB8:1234:5678::10/64 to the interface configuration of the DHCPv6 server</li>
<li>Configure the ipv6 nd managed-config-flag command on interface Fa0/1</li>
<li>Change the ipv6 nd managed-config-flag command to ipv6 nd other-config-flag</li>
<li>Add the ipv6 dhcp relay command to interface Fa0/0</li>
<li>Answer -&gt; <a href="#id59"><span class="problematic" id="id60">:transparent:`Add the ipv6 dhcp relay command to interface Fa0/0`</span></a></li>
</ul>
</li>
<li><p class="first">What is the reason why the DHCPREQUEST message is sent as a broadcast during the DHCPv4 process?</p>
<ul class="simple">
<li>for routers to fill their routing tables with this new information</li>
<li>to notify other hosts not to request the same IP address</li>
<li>to notify other DHCP servers on the subnet that the IP address was leased*</li>
<li>for hosts on other subnets to receive the information</li>
<li>answer -&gt; <a href="#id61"><span class="problematic" id="id62">:transparent:`to notify other DHCP servers on the subnet that the IP address was leased`</span></a></li>
</ul>
</li>
<li><p class="first">A company uses DHCP servers to dynamically assign IPv4 addresses to employee workstations. The address lease duration is set as 5 days. An employee returns to the office after an absence of one week. When the employee boots the workstation, it sends a message to obtain an IP address. Which Layer 2 and Layer 3 destination addresses will the message contain?</p>
<ul class="simple">
<li>FF-FF-FF-FF-FF-FF and 255.255.255.255*</li>
<li>MAC address of the DHCP server and 255.255.255.255</li>
<li>FF-FF-FF-FF-FF-FF and IPv4 address of the DHCP server</li>
<li>both MAC and IPv4 addresses of the DHCP server</li>
<li>answer -&gt; <a href="#id63"><span class="problematic" id="id64">:transparent:`to notify other DHCP servers on the subnet that the IP address was leased`</span></a></li>
</ul>
</li>
</ol>
<p>#. Fill in the blank. Do not abbreviate.
Type a command to exclude the first fifteen useable IP addresses from a DHCPv4 address pool of the network 10.0.15.0/24.</p>
<blockquote>
<div><ul class="simple">
<li>Router(config)# ip dhcp <a href="#id65"><span class="problematic" id="id66">:transparent:`excluded-address 10.0.15.1 10.0.15.15`</span></a></li>
</ul>
</div></blockquote>
<ol class="arabic">
<li><p class="first">Match the descriptions to the corresponding DHCPV6 servertype. (Not all options are used)</p>
<ul class="simple">
<li><a href="#id67"><span class="problematic" id="id68">:transparent:`0`</span></a> enabled in RA messages with the <code class="docutils literal"><span class="pre">ipv6</span> <span class="pre">nd</span> <span class="pre">other-config-flag</span></code> command</li>
<li><a href="#id69"><span class="problematic" id="id70">:transparent:`x`</span></a> clients communicate with the DHCPV6 server by the use of RA messages</li>
<li><a href="#id71"><span class="problematic" id="id72">:transparent:`1`</span></a> the M flag is set to 1 in RA messages</li>
<li><a href="#id73"><span class="problematic" id="id74">:transparent:`1`</span></a> uses the <code class="docutils literal"><span class="pre">address</span></code> command to create a pool of addresses for clients</li>
<li><a href="#id75"><span class="problematic" id="id76">:transparent:`0`</span></a> clients send only DHCPV6 INFORMATlON-REQUEST messages to the server</li>
<li><a href="#id77"><span class="problematic" id="id78">:transparent:`1`</span></a> enabled on the client with the <code class="docutils literal"><span class="pre">ipv6</span> <span class="pre">address</span> <span class="pre">dhcp</span></code> command</li>
<li><a href="#id79"><span class="problematic" id="id80">:transparent:`0`</span></a> enabled on the client with the <code class="docutils literal"><span class="pre">ipv6</span> <span class="pre">address</span> <span class="pre">autoconfig</span></code> command</li>
<li>Stateless DHCPV6 = 0</li>
<li>Stateful DHCPV6 = 1</li>
<li>Neither = x</li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. A network administrator is implementing stateful DHCPv6 operation for the company. However, the clients are not using the prefix and prefix-length information that is configured in the DHCP pool. The administrator issues a show ipv6 interface command. What could be the cause of the problem?</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show ipv6 interface gigabitEthernet 0/0</span>
<span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">IPv6</span> <span class="ow">is</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">link</span><span class="o">-</span><span class="n">local</span> <span class="n">address</span> <span class="ow">is</span> <span class="n">FE80</span><span class="p">::</span><span class="mi">523</span><span class="n">D</span><span class="p">:</span><span class="n">E5FF</span><span class="p">:</span><span class="n">FEAA</span><span class="p">:</span><span class="n">C0A0</span>
  <span class="n">No</span> <span class="n">Virtual</span> <span class="n">link</span><span class="o">-</span><span class="n">local</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">Global</span> <span class="n">unicast</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>  <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="mi">1</span><span class="p">::</span><span class="mi">1</span><span class="p">,</span> <span class="n">subnet</span> <span class="ow">is</span> <span class="mi">2001</span><span class="p">:</span><span class="n">DB8</span><span class="p">:</span><span class="n">ACAD</span><span class="p">:</span><span class="mi">1</span><span class="p">::</span><span class="o">/</span><span class="mi">64</span>

<span class="o">&lt;</span><span class="n">output</span> <span class="n">omitted</span><span class="o">&gt;</span>

  <span class="n">ICMP</span> <span class="n">error</span> <span class="n">messages</span> <span class="n">limited</span> <span class="n">to</span> <span class="n">one</span> <span class="n">every</span> <span class="mi">100</span> <span class="n">milliseconds</span>
  <span class="n">ICMP</span> <span class="n">redirects</span> <span class="n">are</span> <span class="n">enabled</span>
  <span class="n">ICMP</span> <span class="n">unreachables</span> <span class="n">are</span> <span class="n">sent</span>
  <span class="n">ND</span> <span class="n">DAD</span> <span class="ow">is</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">number</span> <span class="n">of</span> <span class="n">DAD</span> <span class="n">attempts</span><span class="p">:</span> <span class="mi">1</span>
  <span class="n">ND</span> <span class="n">reachable</span> <span class="n">time</span> <span class="ow">is</span> <span class="mi">30000</span> <span class="n">milliseconds</span> <span class="p">(</span><span class="n">using</span> <span class="mi">30000</span><span class="p">)</span>
  <span class="n">ND</span> <span class="n">advertised</span> <span class="n">reachable</span> <span class="n">time</span> <span class="ow">is</span> <span class="mi">0</span> <span class="p">(</span><span class="n">unspecified</span><span class="p">)</span>
  <span class="n">ND</span> <span class="n">advertised</span> <span class="n">retransmit</span> <span class="n">interval</span> <span class="ow">is</span> <span class="mi">0</span> <span class="p">(</span><span class="n">unspecified</span><span class="p">)</span>
  <span class="n">ND</span> <span class="n">router</span> <span class="n">advertisements</span> <span class="n">are</span> <span class="n">sent</span> <span class="n">every</span> <span class="mi">200</span> <span class="n">seconds</span>
  <span class="n">ND</span> <span class="n">router</span> <span class="n">advertisements</span> <span class="n">live</span> <span class="k">for</span> <span class="mi">1800</span> <span class="n">seconds</span>
  <span class="n">ND</span> <span class="n">advertised</span> <span class="n">default</span> <span class="n">router</span> <span class="n">preference</span> <span class="ow">is</span> <span class="n">Medium</span>
  <span class="n">Hosts</span> <span class="n">use</span> <span class="n">stateless</span> <span class="n">autoconfig</span> <span class="k">for</span> <span class="n">addresses</span><span class="o">.</span>
  <span class="n">Hosts</span> <span class="n">use</span> <span class="n">DHCP</span> <span class="n">to</span> <span class="n">obtain</span> <span class="n">other</span> <span class="n">configuration</span><span class="o">.</span>
<span class="n">R1</span><span class="c1">#</span>
</pre></div>
</div>
<ul class="simple">
<li>The router is configured for stateless DHCPv6 operation</li>
<li>No virtual link-local address is configured</li>
<li>The router is configured for SLAAC DHCPv6 operation</li>
<li>The Duplicate Address Detection feature is disabled</li>
<li>Answer -&gt; <a href="#id81"><span class="problematic" id="id82">:transparent:`The router is configured for stateless DHCPv6 operation`</span></a></li>
</ul>
</li>
<li><p class="first">A network engineer is troubleshooting hosts on a LAN that are not being assigned an IPv4 address from a DHCP server after a new Ethernet switch has been installed on the LAN. The configuration of the DHCP server has been confirmed as correct and the clients have network connectivity to other networks if a static IP address is configured on each one. What step should the engineer take next to solve the issue?</p>
<ul class="simple">
<li>Issue the ipconfig/release command on each client</li>
<li>Issue the show ip dhcp binding command on the switch</li>
<li>Issue the show interface command on the router to confirm that the LAN gateway is operational</li>
<li>Confirm that ports on the Layer 2 LAN switch are configured as edge ports</li>
<li>Answer -&gt; <a href="#id83"><span class="problematic" id="id84">:transparent:`Confirm that ports on the Layer 2 LAN switch are configured as edge ports`</span></a></li>
</ul>
</li>
<li><p class="first">A network administrator configures a router to send RA messages with M flag as 0 and O flag as 1. Which statement describes the effect of this configuration when a PC tries to configure its IPv6 address?</p>
<ul class="simple">
<li>It should use the information that is contained in the RA message exclusively</li>
<li>It should contact a DHCPv6 server for the prefix, the prefix-length information, and an interface ID that is both random and unique</li>
<li>It should use the information that is contained in the RA message and contact a DHCPv6 server for additional information</li>
<li>It should contact a DHCPv6 server for all the information that it needs</li>
<li>Answer -&gt; <a href="#id85"><span class="problematic" id="id86">:transparent:`It should use the information that is contained in the RA message and contact a DHCPv6 server for additional information`</span></a></li>
</ul>
</li>
<li><p class="first">Which protocol supports Stateless Address Autoconfiguration (SLAAC) for dynamic assignment of IPv6 addresses to a host?</p>
<ul class="simple">
<li>UDP</li>
<li>ICMPv6</li>
<li>ARPv6</li>
<li>DHCPv6</li>
<li>Answer -&gt; <a href="#id87"><span class="problematic" id="id88">:transparent:`ICMPv6`</span></a></li>
</ul>
</li>
<li><p class="first">A company uses the SLAAC method to configure IPv6 addresses for the employee workstations. Which address will a client use as its default gateway?</p>
<ul class="simple">
<li>the unique local address of the router interface that is attached to the network</li>
<li>the global unicast address of the router interface that is attached to the network</li>
<li>the link-local address of the router interface that is attached to the network</li>
<li>the all-routers multicast address</li>
<li>Answer -&gt; <a href="#id89"><span class="problematic" id="id90">:transparent:`the link-local address of the router interface that is attached to the network`</span></a></li>
</ul>
</li>
<li><p class="first">Which set of commands will configure a router as a DHCP server that will assign IPv4 addresses to the 192.168.100.0/23 LAN while reserving the first 10 and the last addresses for static assignment?</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="mi">1</span> <span class="o">--</span>
<span class="n">dhcp</span> <span class="n">pool</span> <span class="n">LAN</span><span class="o">-</span><span class="n">POOL</span><span class="o">-</span><span class="mi">100</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">excluded</span><span class="o">-</span><span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.9</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">excluded</span><span class="o">-</span><span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.254</span>
<span class="n">network</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.0</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">254.0</span>
<span class="n">default</span><span class="o">-</span><span class="n">router</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">101.1</span>

<span class="o">--</span> <span class="mi">2</span> <span class="o">--</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">excluded</span><span class="o">-</span><span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.9</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">excluded</span><span class="o">-</span><span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">101.254</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">pool</span> <span class="n">LAN</span><span class="o">-</span><span class="n">POOL</span><span class="o">-</span><span class="mi">100</span>
<span class="n">ip</span> <span class="n">network</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.0</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">254.0</span>
<span class="n">ip</span> <span class="n">default</span><span class="o">-</span><span class="n">gateway</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span>

<span class="o">--</span> <span class="mi">3</span> <span class="o">--</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">excluded</span><span class="o">-</span><span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.10</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">excluded</span><span class="o">-</span><span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">101.254</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">pool</span> <span class="n">LAN</span><span class="o">-</span><span class="n">POOL</span><span class="o">-</span><span class="mi">100</span>
<span class="n">network</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.0</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">254.0</span>
<span class="n">default</span><span class="o">-</span><span class="n">router</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span> <span class="o">************************</span>

<span class="o">--</span> <span class="mi">4</span> <span class="o">--</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">excluded</span><span class="o">-</span><span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.10</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">excluded</span><span class="o">-</span><span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.254</span>
<span class="n">ip</span> <span class="n">dhcp</span> <span class="n">pool</span> <span class="n">LAN</span><span class="o">-</span><span class="n">POOL</span><span class="o">-</span><span class="mi">100</span>
<span class="n">network</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.0</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>
<span class="n">ip</span> <span class="n">default</span><span class="o">-</span><span class="n">gateway</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span>
</pre></div>
</div>
<ul class="simple">
<li>The answer is: <a href="#id91"><span class="problematic" id="id92">:transparent:`-- 3 --`</span></a></li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section" id="chapter-9-nat-for-ipv4">
<h3>Chapter 9 NAT for IPv4<a class="headerlink" href="#chapter-9-nat-for-ipv4" title="Permalink to this headline">¶</a></h3>
<div class="section" id="nat-border">
<h4>NAT Border<a class="headerlink" href="#nat-border" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_NAT_border.png" src="nw/_static/img/Ch9_NAT_border.png" />
<p>NAT has many uses, but its primary use is to conserve public IPv4 addresses. It does this by allowing networks to use private IPv4 addresses internally and providing translation to a public address only when needed. NAT has an added benefit of adding a degree of privacy and security to a network, because it hides internal IPv4 addresses from outside networks.</p>
<p>NAT-enabled routers can be configured with <strong>one or more valid public IPv4 addresses</strong>. These public addresses are known as the <strong>NAT pool</strong>. When an internal device sends traffic out of the network, the <strong>NAT-enabled router translates the internal IPv4 address of the device to a public address from the NAT pool</strong>. To outside devices, all traffic entering and exiting the network appears to have a public IPv4 address from the provided pool of addresses.</p>
<p>A NAT router typically operates at the border of a stub network. A stub network is a network that has a single connection to its neighboring network, one way in and one way out of the network. In the example in the figure, R2 is a border router. As seen from the ISP, R2 forms a stub network.</p>
<p>When a device inside the stub network wants to communicate with a device outside of its network, the packet is forwarded to the border router. The border router performs the NAT process, translating the internal private address of the device to a public, outside, routable address.</p>
</div>
<div class="section" id="types-of-nat-addresses">
<h4>Types of NAT Addresses<a class="headerlink" href="#types-of-nat-addresses" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_Types_of_NAT_addresses.png" src="nw/_static/img/Ch9_Types_of_NAT_addresses.png" />
<p>It is important to remember that NAT terminology is always applied from the perspective of the device with the translated address:</p>
<dl class="docutils">
<dt>Inside address</dt>
<dd>The address of the device which is being translated by NAT.</dd>
<dt>Outside address</dt>
<dd>The address of the destination device.</dd>
</dl>
<p>NAT also uses the concept of local or global with respect to addresses:</p>
<dl class="docutils">
<dt>Local address</dt>
<dd>A local address is any address that appears on the inside portion of the network.</dd>
<dt>Global address</dt>
<dd>A global address is any address that appears on the outside portion of the network.</dd>
</dl>
<p>PC1 has an inside local address of 192.168.10.10. From the perspective of PC1, the web server has an outside address of 209.165.201.1. When packets are sent from PC1 to the global address of the web server, the inside local address of PC1 is translated to 209.165.200.226 (inside global address). The address of the outside device is not typically translated, because that address is usually a public IPv4 address.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">PC1 has different local and global addresses, whereas the web server has the same public IPv4 address for both. From the perspective of the web server, traffic originating from PC1 appears to have come from 209.165.200.226, the inside global address.</p>
</div>
<p>The NAT router, R2, is the <strong>demarcation point</strong> between the inside and outside networks and as between local and global addresses.</p>
</div>
<div class="section" id="nat-address-terminology">
<h4>NAT Address Terminology<a class="headerlink" href="#nat-address-terminology" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_NAT_address_examples.png" src="nw/_static/img/Ch9_NAT_address_examples.png" />
<p>The terms, inside and outside, are combined with the terms local and global to refer to specific addresses. In the figure, router R2 has been configured to provide NAT. It has a pool of public addresses to assign to inside hosts.</p>
<dl class="docutils">
<dt>Inside local address</dt>
<dd>The address of the source as seen from inside the network. In the figure, the IPv4 address 192.168.10.10 is assigned to PC1. This is the inside local address of PC1.</dd>
<dt>Inside global address</dt>
<dd><strong>The address of source as seen from the outside network</strong>. In the figure, when traffic from PC1 is sent to the web server at 209.165.201.1,**R2 translates the inside local address to an inside global address**. In this case, R2 changes the IPv4 source address <strong>from 192.168.10.10 to 209.165.200.226</strong>. In NAT terminology, the <strong>inside local address of 192.168.10.10 is translated to the inside global address of 209.165.200.226</strong>.</dd>
<dt>Outside global address</dt>
<dd><strong>The address of the destination as seen from the outside network</strong>. It is a <strong>globally routable IPv4 address assigned to a host on the Internet</strong>. For example, the web server is reachable at IPv4 address 209.165.201.1. Most often the outside local and outside global addresses are the same.</dd>
<dt>Outside local address</dt>
<dd><strong>The address of the destination as seen from the inside network</strong>. In this example, PC1 sends traffic to the web server at the IPv4 address 209.165.201.1. While uncommon, this address could be different than the globally routable address of the destination.</dd>
</dl>
<p>The figure shows how traffic is addressed that is sent from an internal PC to an external web server, across the NAT-enabled router. It also shows how return traffic is initially addressed and translated.</p>
<p>Note: The use of the outside local address is outside the scope of this course.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">inside = Source  outside = Destination</p>
</div>
<img alt="nw/_static/img/Ch9_NAT_identify1.png" src="nw/_static/img/Ch9_NAT_identify1.png" />
</div>
<div class="section" id="static-nat">
<h4>Static NAT<a class="headerlink" href="#static-nat" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_Static_NAT.png" src="nw/_static/img/Ch9_Static_NAT.png" />
<p>There are three types of NAT translation:</p>
<dl class="docutils">
<dt>Static address translation (static NAT)</dt>
<dd>One-to-one address mapping between local and global addresses.</dd>
<dt>Dynamic address translation (dynamic NAT)</dt>
<dd>Many-to-many address mapping between local and global addresses. Translations are made on an as-available basis; for example, if there are 100 inside local addresses and 10 inside global addresses, then at any given time only 10 of the 100 inside local addresses can be translated. This limitation of dynamic NAT makes it much less useful for production networks than port address translation.</dd>
<dt>Port Address Translation (PAT)</dt>
<dd>Many-to-one address mapping between local and global addresses. This method is also known as overloading (NAT overloading). For example, if there are 100 inside local addresses and 10 inside global addresses, PAT uses ports as an additional parameter to provide a multiplier effect, making it possible to reuse any one of the 10 inside global addresses up to 65,536 times (depending on whether the flow is based on UDP, TCP, or ICMP).</dd>
</dl>
<p><strong>Static NAT uses a one-to-one mapping of local and global addresses</strong>. These mappings are configured by the network administrator and remain constant.</p>
<p>R2 is configured with static mappings for the inside local addresses of Svr1, PC2, and PC3. When these devices send traffic to the Internet, <strong>their inside local addresses are translated to the configured inside global addresses</strong>. <strong>To outside networks, these devices have public IPv4 addresses.</strong></p>
<p>Static NAT is particularly <strong>useful for web servers or devices that must have a consistent address that is accessible from the Internet</strong>, such as a company web server. It is <em>also useful for devices that must be accessible by authorized personnel when offsite</em>, but not by the general public on the Internet. For example, a network administrator from PC4 can SSH to Svr1’s inside global address (209.165.200.226). R2 translates this inside global address to the inside local address and connects the administrator’s session to Svr1.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Static NAT requires that enough public addresses are available to satisfy the total number of simultaneous user sessions.</p>
</div>
</div>
<div class="section" id="dynamic-nat">
<h4>Dynamic NAT<a class="headerlink" href="#dynamic-nat" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_Dynamic_NAT.png" src="nw/_static/img/Ch9_Dynamic_NAT.png" />
<dl class="docutils">
<dt>Dynamic NAT</dt>
<dd>uses a pool of public addresses and assigns them on a <strong>first-come, first-served basis</strong>. When an inside device requests access to an outside network, dynamic NAT assigns an available public IPv4 address from the pool.</dd>
</dl>
<p>PC3 has accessed the Internet using the first available address in the dynamic NAT pool. The other addresses are still available for use.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Similar to static NAT, dynamic NAT requires that enough public addresses are available to satisfy the total number of simultaneous user sessions.</p>
</div>
</div>
<div class="section" id="pat-aka-nat-overload">
<h4>PAT aka NAT Overload<a class="headerlink" href="#pat-aka-nat-overload" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_PAT_process.png" src="nw/_static/img/Ch9_PAT_process.png" />
<p>Port Address Translation (PAT), also known as NAT overload, maps multiple private IPv4 addresses to a single public IPv4 address or a few addresses. This is what most home routers do. The ISP assigns one address to the router, yet several members of the household can simultaneously access the Internet. This is the most common form of NAT.</p>
<p>With PAT, multiple addresses can be mapped to one or to a few addresses, because each private address is also tracked by a port number. When a device initiates a TCP/IP session, it generates a TCP or UDP source port value or a specially assigned query ID for ICMP, to uniquely identify the session. When the NAT router receives a packet from the client, it uses its source port number to uniquely identify the specific NAT translation.</p>
<p><strong>PAT ensures that devices use a different TCP port number for each session with a server on the Internet. When a response comes back from the server, the source port number, which becomes the destination port number on the return trip, determines to which device the router forwards the packets. The PAT process also validates that the incoming packets were requested, thus adding a degree of security to the session.</strong></p>
<p>The source address (SA) is the inside local address with the TCP/IP assigned port number added. The destination address (DA) is the outside local address with the service port number added. In this example, the service port is 80, which is HTTP.</p>
<p>For the source address, R2 translates the inside local address to an inside global address with the port number added. The destination address is not changed, but is now referred to as the outside global IPv4 address. When the web server replies, the path is reversed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">PAT attempts to preserve the original source port. However, if the original source port is already used, PAT assigns the first available port number starting from the beginning of the appropriate port group 0–511, 512–1,023, or 1,024–65,535. When there are no more ports available and there is more than one external address in the address pool, PAT moves to the next address to try to allocate the original source port. This process continues until there are no more available ports or external IPv4 addresses</p>
</div>
</div>
<div class="section" id="nat-vs-pat">
<h4>NAT vs PAT<a class="headerlink" href="#nat-vs-pat" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_NAT_vs_PAT.png" src="nw/_static/img/Ch9_NAT_vs_PAT.png" />
<p>NAT translates IPv4 addresses on a 1:1 basis between private IPv4 addresses and public IPv4 addresses. However, PAT modifies both the address and the port number.</p>
<p>NAT forwards incoming packets to their inside destination by referring to the incoming source IPv4 address given by the host on the public network. With PAT, there is generally only one or a very few publicly exposed IPv4 addresses. Incoming packets from the public network are routed to their destinations on the private network by referring to a table in the NAT router. This table tracks public and private port pairs. <strong>This is called connection tracking</strong></p>
<div class="section" id="packets-without-a-layer-4-segment">
<h5>Packets without a Layer 4 Segment<a class="headerlink" href="#packets-without-a-layer-4-segment" title="Permalink to this headline">¶</a></h5>
<p>What about IPv4 packets carrying data other than a TCP or UDP segment? These packets do not contain a Layer 4 port number. PAT translates most common protocols carried by IPv4 that do not use TCP or UDP as a transport layer protocol. The most common of these is ICMPv4. Each of these types of protocols is handled differently by PAT. For example, ICMPv4 query messages, echo requests, and echo replies include a Query ID. <strong>ICMPv4 uses the Query ID to identify an echo request with its corresponding echo reply. The Query ID is incremented with each echo request sent. PAT uses the Query ID instead of a Layer 4 port number</strong>.</p>
<p>Note: Other ICMPv4 messages do not use the Query ID. These messages and other protocols that do not use TCP or UDP port numbers vary and are beyond the scope of this curriculum.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1">#show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.2</span><span class="p">:</span><span class="mi">25</span>    <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">25</span>      <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.2</span><span class="p">:</span><span class="mi">443</span>   <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">443</span>     <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.2</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">80</span>      <span class="o">---</span>                <span class="o">---</span>

<span class="n">R2</span><span class="c1">#show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">udp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.2</span><span class="p">:</span><span class="mi">1025</span>  <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">1025</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">8.8</span><span class="p">:</span><span class="mi">53</span>      <span class="mf">64.100</span><span class="o">.</span><span class="mf">8.8</span><span class="p">:</span><span class="mi">53</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.2</span><span class="p">:</span><span class="mi">25</span>    <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">25</span>      <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.2</span><span class="p">:</span><span class="mi">443</span>   <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">443</span>     <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.2</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">80</span>      <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1025</span>  <span class="mf">10.2</span><span class="o">.</span><span class="mf">0.5</span><span class="p">:</span><span class="mi">1025</span>      <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1026</span>  <span class="mf">10.2</span><span class="o">.</span><span class="mf">0.5</span><span class="p">:</span><span class="mi">1026</span>      <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1027</span>  <span class="mf">10.2</span><span class="o">.</span><span class="mf">0.5</span><span class="p">:</span><span class="mi">1027</span>      <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">7</span> <span class="p">(</span><span class="mi">3</span> <span class="n">static</span><span class="p">,</span> <span class="mi">4</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">7</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span> <span class="p">,</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span> <span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="p">,</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">2</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">19</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">R2Pool</span> <span class="n">refCount</span> <span class="mi">4</span>
 <span class="n">pool</span> <span class="n">R2Pool</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.224</span>
       <span class="n">start</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span> <span class="n">end</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.31</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">29</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">6</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>
<span class="n">R2</span><span class="c1">#</span>

<span class="n">R4</span><span class="c1">#show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">150.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">80</span>      <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">25</span>    <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">25</span>      <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">443</span>   <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">443</span>     <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">80</span>      <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">80</span>      <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1025</span>  <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1025</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">80</span>      <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1026</span>  <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1026</span>
<span class="n">tcp</span> <span class="mf">64.100</span><span class="o">.</span><span class="mf">200.1</span><span class="p">:</span><span class="mi">80</span>    <span class="mf">172.16</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span><span class="mi">80</span>      <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1027</span>  <span class="mf">64.100</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">1027</span>

<span class="n">R4</span><span class="c1">#show ip nat sta</span>
<span class="n">R4</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">7</span> <span class="p">(</span><span class="mi">4</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">6</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span> <span class="p">,</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span> <span class="p">,</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">17</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">5</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="n">R4</span><span class="c1">#</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="nat-advantages">
<h4>NAT Advantages<a class="headerlink" href="#nat-advantages" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Conserves the legally registered addressing scheme<ul>
<li>by allowing privatization of intranets</li>
<li>NAT conserves addresses through app port-level multiplexing</li>
<li>with NAT overload very few external addresses are required to support many internal hosts</li>
</ul>
</li>
<li>NAT increases flexibility of connections to public network<ul>
<li>Multiple pools, backup pools, and load-balancing pools can be implemented to ensure reliable public network connections</li>
</ul>
</li>
<li>Provides consistency for internal network addressing schemes<ul>
<li>NAT allows the existing private IPv4 address scheme to remain while allowing for easy change to a new public addressing scheme. This means an organization could change ISPs and not need to change any of its inside clients.</li>
</ul>
</li>
<li>Provides network security<ul>
<li>NAT provides the side effect of hiding users and other devices’ IPv4 addresses. Some people consider this a security feature, however most experts agree that NAT does not provide security. A stateful firewall is what provides security on the edge of the network</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="nat-disadvantages">
<h4>NAT Disadvantages<a class="headerlink" href="#nat-disadvantages" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Performance is degraded<ul>
<li>One disadvantage of using NAT is related to network performance, particularly for real time protocols such as VoIP. NAT increases forwarding delays because the translation of each IPv4 address within the packet headers takes time. The first packet is always process-switched going through the slower path. The router must look at every packet to decide whether it needs translation. The router must alter the IPv4 header, and possibly alter the TCP or UDP header. The IPv4 header checksum, along with the TCP or UDP checksum must be recalculated each time a translation is made. Remaining packets go through the fast-switched path if a cache entry exists; otherwise, they too are delayed.</li>
</ul>
</li>
<li>End-to-end functionality is degraded<ul>
<li>Many Internet protocols and applications depend on end-to-end addressing from the source to the destination. Some applications do not work with NAT. For example, some security applications, such as digital signatures, fail because the source IPv4 address changes before reaching the destination. Applications that use physical addresses, instead of a qualified domain name, do not reach destinations that are translated across the NAT router. <strong>Sometimes, this problem can be avoided by implementing static NAT mappings.</strong></li>
</ul>
</li>
<li>End-to-end IP traceability is lost<ul>
<li>it becomes much more difficult to trace packets that undergo numerous packet address changes over multiple NAT hops, making troubleshooting challenging.</li>
</ul>
</li>
<li>Tunneling becomes more complicated<ul>
<li>Using NAT also complicates the use of tunneling protocols, such as IPsec, because NAT modifies values in the headers, causing integrity checks to fail.</li>
</ul>
</li>
<li>Initiating TCP connections can be disrupted<ul>
<li>Services that require the initiation of TCP connections from the outside network, or stateless protocols, such as those using UDP, can be disrupted. Unless the NAT router has been configured to support such protocols, incoming packets cannot reach their destination. Some protocols can accommodate one instance of NAT between participating hosts (passive mode FTP, for example), but fail when both systems are separated from the Internet by NAT.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="configuring-static-nat">
<h4>Configuring Static NAT<a class="headerlink" href="#configuring-static-nat" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">create a MAPPING between inside local address and the inside global addresses</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source static local-ip global-ip</span>
</pre></div>
</div>
</li>
<li><dl class="first docutils">
<dt>Specify the INSIDE interface</dt>
<dd><p class="first last">In the example, the Serial 0/0/0 interface of R2 is an inside interface and Serial 0/1/0 is an outside interface.</p>
</dd>
</dl>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface type number</span>
</pre></div>
</div>
</li>
<li><p class="first">Mark the interface as connected to the inside</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
</pre></div>
</div>
</li>
<li><dl class="first docutils">
<dt>Specify the OUTSIDE interface</dt>
<dd><p class="first last">E.g. Serial 0/1/0</p>
</dd>
</dl>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface type number</span>
</pre></div>
</div>
</li>
<li><p class="first">Mark the interface as connected to the outside</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
</li>
</ol>
<p>Image shows the commands needed on R2 to create a static NAT mapping to the web server in the example topology. With the configuration shown, R2 translates packets from the web server with address 192.168.10.254 to public IPv4 address 209.165.201.5. The Internet client directs web requests to the public IPv4 address 209.165.201.5. R2 forwards that traffic to the web server at 192.168.10.254.</p>
<img alt="nw/_static/img/Ch9_Static_NAT_example.png" src="nw/_static/img/Ch9_Static_NAT_example.png" />
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">establishes</span> <span class="n">static</span> <span class="n">translation</span> <span class="n">between</span> <span class="n">an</span> <span class="n">inside</span> <span class="n">local</span> <span class="n">address</span> <span class="o">&amp;</span> <span class="n">an</span> <span class="n">inside</span> <span class="k">global</span> <span class="n">address</span>
<span class="o">---</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source static 192.168.10.254 209.165.201.5</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Serial0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 10.1.1.2 255.255.255.252</span>

<span class="n">identifies</span> <span class="n">interface</span> <span class="n">Serial</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span> <span class="k">as</span> <span class="n">an</span> <span class="n">inside</span> <span class="n">NAT</span> <span class="n">interface</span>
<span class="o">---</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># exit</span>

<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Serial 0/1/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 209.165.200.1 255.255.255.252</span>
<span class="n">Identifies</span> <span class="n">interface</span> <span class="n">serial</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span> <span class="k">as</span> <span class="n">the</span> <span class="n">outside</span> <span class="n">NAT</span> <span class="n">interface</span>
<span class="o">---</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
</div>
<div class="section" id="static-nat-process">
<h4>Static NAT Process<a class="headerlink" href="#static-nat-process" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_Static_NAT_process.png" src="nw/_static/img/Ch9_Static_NAT_process.png" />
<ol class="arabic simple">
<li>The client sends a packet to the web server using the public IPv4 destination address of 209.165.201.5. This is the <strong>inside global address of the web server</strong></li>
<li>The first packet that R2 receives from the client on its NAT outside interface causes R2 to check its NAT table. The destination IPv4 address is located in the NAT table and is translated</li>
<li>R2 <strong>replaces the inside global address of 209.165.201.5 with the inside local address of 192.168.10.254</strong>. R2 then forwards the packet towards the web server.</li>
<li>The web server receives the packet and responds to the client using the <strong>inside local address</strong>, 192.168.10.254</li>
<li>Router 2<ol class="loweralpha">
<li>receives the packet from the webserver on its <strong>NAT inside interface with source address of the inside local address of the webserver</strong>,192.168.10.254</li>
<li>checks the <strong>NAT table for a translation for the inside local address</strong>. The address is found in the NAT table. R2 <strong>translates the source address to the inside global address of 209.165.201.5</strong> and forwards the packet toward the client</li>
</ol>
</li>
<li>The client receives the packet and continues the conversation. The NAT router performs Steps 2 to 5b for each packet.</li>
</ol>
<dl class="docutils">
<dt>verify with</dt>
<dd><code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">translations</span></code></dd>
<dt>clear nat statistics</dt>
<dd><code class="docutils literal"><span class="pre">clear</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code></dd>
<dt>check if nat is working</dt>
<dd><code class="docutils literal"><span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code></dd>
</dl>
<p>In this example it would show <strong>1 static</strong> in <strong>Total active translations</strong></p>
</div>
<div class="section" id="configure-static-nat-exercise">
<h4>Configure Static NAT exercise<a class="headerlink" href="#configure-static-nat-exercise" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_9.2.1.4_Configuring_Static_NAT.png" src="nw/_static/img/Ch9_9.2.1.4_Configuring_Static_NAT.png" />
<p>configure static NAT so that outside devices can access and inside server at its public address</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="o">&gt;</span><span class="n">enable</span>
<span class="n">R1</span><span class="c1">#show ip nat translations</span>
<span class="n">R1</span><span class="c1">#map the server1 inside address to its outside address</span>
<span class="n">R1</span><span class="c1">#conf t</span>
<span class="n">Enter</span> <span class="n">configuration</span> <span class="n">commands</span><span class="p">,</span> <span class="n">one</span> <span class="n">per</span> <span class="n">line</span><span class="o">.</span>  <span class="n">End</span> <span class="k">with</span> <span class="n">CNTL</span><span class="o">/</span><span class="n">Z</span><span class="o">.</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip nat inside source static 172.16.16.1 64.100.50.1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface Gig0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat inside</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#exit</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface Serial0/0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat outside</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#exit</span>
</pre></div>
</div>
<p>Use the following commands to verify the static NAT configuration:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>show running-config
show ip nat translations
show ip nat statistics

R1#show running-config
!
!
interface GigabitEthernet0/0
 ip address 172.16.16.14 255.255.255.240
 ip nat inside
 duplex auto
 speed auto
!
interface GigabitEthernet0/1
 no ip address
 duplex auto
 speed auto
 shutdown
!
interface GigabitEthernet0/2
 no ip address
 duplex auto
 speed auto
 shutdown
!
interface Serial0/0/0
 ip address 209.165.128.130 255.255.255.248
 ip nat outside
!
interface Serial0/0/1
 no ip address
 clock rate 2000000
 shutdown
!
interface Vlan1
 no ip address
 shutdown
!
ip nat inside source static 172.16.16.1 64.100.50.1
ip classless
!
ip flow-export version 9
!

R1#show ip nat translations
Pro  Inside global     Inside local       Outside local      Outside global
---  64.100.50.1       172.16.16.1        ---                ---

R1#show ip nat statistics
Total translations: 1 (1 static, 0 dynamic, 0 extended)
Outside Interfaces: Serial0/0/0
Inside Interfaces: GigabitEthernet0/0
Hits: 0  Misses: 0
Expired translations: 0
Dynamic mappings:
</pre></div>
</div>
</div>
<div class="section" id="dynamic-nat-operation">
<h4>Dynamic NAT operation<a class="headerlink" href="#dynamic-nat-operation" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_Dynamic_NAT_1to1_translation.png" src="nw/_static/img/Ch9_Dynamic_NAT_1to1_translation.png" />
<p>While static NAT provides a permanent mapping between an inside local address and an inside global address, <strong>dynamic NAT allows the automatic mapping of inside local addresses to inside global addresses</strong>. <strong>These inside global addresses are typically public IPv4 addresses</strong>. Dynamic NAT uses a group, or pool of public IPv4 addresses for translation.</p>
<p>Dynamic NAT, like static NAT, requires the configuration of the inside and outside interfaces participating in NAT. However, where static NAT creates a permanent mapping to a single address, dynamic NAT uses a pool of addresses.</p>
<p>Attached to router R1 are two LANs, 192.168.10.0/24 and 192.168.11.0/24. Router R2, the border router, is configured for dynamic NAT using a pool of public IPv4 addresses 209.165.200.226 through 209.165.200.240</p>
<p>The pool of public IPv4 addresses <strong>(inside global address pool)</strong> is available to any device on the inside network on a first-come first-served basis.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">With dynamic NAT, a single inside address is translated to a single outside address. With this type of translation there must be enough addresses in the pool to accommodate all the inside devices needing access to the outside network at the same time. If all of the addresses in the pool have been used, a device must wait for an available address before it can access the outside network.</p>
</div>
</div>
<div class="section" id="configuring-dynamic-nat">
<h4>Configuring Dynamic NAT<a class="headerlink" href="#configuring-dynamic-nat" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Define a <strong>pool of global addresses</strong> to be used for translation</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat pool name start-ip end-ip {netmask netmask | prefix-length prefix-length}</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure a standard <strong>access list permitting the addresses that should be translated</strong></p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list access-list-number permit source [source-wildcard]</span>
</pre></div>
</div>
</li>
<li><p class="first">Establish dynamic <strong>source</strong> translation, specifying the <strong>access list and pool</strong> defined in prior steps</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside source list access-list-number pool name</span>
</pre></div>
</div>
</li>
<li><p class="first">identify the INSIDE interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface type number</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
</pre></div>
</div>
</li>
<li><p class="first">identify the OUTSIDE interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface type number</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="dynamic-nat-example">
<h4>Dynamic NAT example<a class="headerlink" href="#dynamic-nat-example" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_dynamic_NAT_example_config.png" src="nw/_static/img/Ch9_dynamic_NAT_example_config.png" />
<p>Defines a pool of public IPv4 addresses under the pool name NAT POOL1</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat pool NAT-POOL1 209.165.200.226 209.165.200.240 netmask 255.255.255.224</span>
</pre></div>
</div>
<p>Defines what addresses are eligible to be translated</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit 192.168.0.0 0.0.255.255</span>
</pre></div>
</div>
<p>Binds NAT-POOL1 with ACL 1</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source list 1 pool NAT-POOL1</span>
</pre></div>
</div>
<p>Identifies interface serial 0/0/0 as an inside NAT interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Serial 0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
</pre></div>
</div>
</div>
<div class="section" id="dynamic-nat-process">
<h4>Dynamic NAT process<a class="headerlink" href="#dynamic-nat-process" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_Dynamic_NAT_process_1.png" src="nw/_static/img/Ch9_Dynamic_NAT_process_1.png" />
<p>Using the previous configuration, the figures illustrate the dynamic NAT translation process between two clients and the web server:</p>
<p>In image 1, the traffic flow from inside to outside is shown:</p>
<ol class="arabic">
<li><p class="first">The hosts with the source IPv4 addresses (192.168.10.10 (PC1) and 192.168.11.10 (PC2)) send packets requesting a connection to the server at the public IPv4 address (209.165.200.254).</p>
</li>
<li><p class="first">R2 receives the first packet from host 192.168.10.10. Because this packet was received on an interface configured as an inside NAT interface, R2 checks the NAT configuration to determine if this packet should be translated. The ACL permits this packet, so R2 will translate the packet. R2 checks its NAT table. <strong>Because there is no translation entry for this IPv4 address, R2 determines that the source address 192.168.10.10 must be translated dynamically</strong>. R2 selects an available global address from the dynamic address pool and creates a translation entry, 209.165.200.226. The original source IPv4 address (192.168.10.10) is the inside local address and the translated address is the inside global address (209.165.200.226) in the NAT table.</p>
<p>For the second host, 192.168.11.10, R2 repeats the procedure, selects the next available global address from the dynamic address pool, and creates a second translation entry, 209.165.200.227.</p>
</li>
<li><p class="first">R2 replaces the inside local source address of PC1, 192.168.10.10, with the translated inside global address of 209.165.200.226 and forwards the packet. The same process occurs for the packet from PC2 using the translated address for PC2 (209.165.200.227).</p>
<img alt="nw/_static/img/Ch9_Dynamic_NAT_process_2.png" src="nw/_static/img/Ch9_Dynamic_NAT_process_2.png" />
<p>In image 2, the traffic flow from outside to inside is shown:</p>
</li>
<li><p class="first">The server receives the packet from PC1 and responds using the IPv4 destination address of 209.165.200.226. When the server receives the second packet, it responds to PC2 using the IPv4 destination address of 209.165.200.227.</p>
</li>
<li><p class="first">When R2 receives the packet with the destination IPv4 address of 209.165.200.226;</p>
<ol class="loweralpha simple">
<li><strong>it performs a NAT table lookup</strong>. Using the mapping from the table, R2 translates the address back to the inside local address (192.168.10.10) and forwards the packet toward PC1.</li>
<li>When R2 receives the packet with the destination IPv4 address of 209.165.200.227; it performs a NAT table lookup. Using the mapping from the table, R2 translates the address back to the inside local address (192.168.11.10) and forwards the packet toward PC2.</li>
</ol>
</li>
<li><p class="first">PC1 at 192.168.10.10 and PC2 at 192.168.11.10 receive the packets and continue the conversation. The router performs Steps 2 to 5 for each packet.</p>
</li>
</ol>
<p>Verify with <code class="docutils literal"><span class="pre">R2#</span> <span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">translations</span> <span class="pre">verbose</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, translation entries time out after 24 hours, unless the timers have been reconfigured with the <code class="docutils literal"><span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">translation</span> <span class="pre">timeout</span> <span class="pre">timeout-seconds</span></code> command in global configuration mode.</p>
</div>
</div>
<div class="section" id="clearing-nat-translations">
<h4>Clearing NAT Translations<a class="headerlink" href="#clearing-nat-translations" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">clears</span> <span class="nb">all</span> <span class="n">dynamic</span> <span class="n">address</span> <span class="n">translation</span> <span class="n">entries</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">NAT</span> <span class="n">translation</span> <span class="n">table</span>
<span class="o">-----------------------------------------------------------------------------</span>
<span class="n">R2</span><span class="c1"># clear ip nat translation *</span>

<span class="n">Clear</span> <span class="n">a</span> <span class="n">simple</span> <span class="n">dynamic</span> <span class="n">translation</span> <span class="n">entry</span> <span class="n">containing</span> <span class="n">an</span> <span class="n">inside</span> <span class="n">translation</span>
<span class="ow">or</span> <span class="n">both</span> <span class="n">inside</span> <span class="o">&amp;</span> <span class="n">outside</span> <span class="n">translation</span>
<span class="o">------------------------------------</span>
<span class="n">R2</span><span class="c1"># clear ip nat translation inside global-ip local-ip [outside local-ip global-ip]</span>

<span class="n">Clears</span> <span class="n">an</span> <span class="n">extended</span> <span class="n">dynamic</span> <span class="n">translation</span> <span class="n">entry</span>
<span class="o">--------------------------------------------</span>
<span class="n">R2</span><span class="c1"># clear ip nat translation protocol inside global-ip global-port local-ip local-port</span>
 <span class="p">[</span><span class="n">outside</span> <span class="n">local</span><span class="o">-</span><span class="n">ip</span> <span class="n">local</span><span class="o">-</span><span class="n">port</span> <span class="k">global</span><span class="o">-</span><span class="n">ip</span> <span class="k">global</span><span class="o">-</span><span class="n">port</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only the dynamic translations are cleared from the table. Static translations cannot be cleared from the translation table</p>
</div>
<p><code class="docutils literal"><span class="pre">R2#</span> <span class="pre">clear</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code></p>
</div>
<div class="section" id="configure-dynamic-nat-exercise">
<h4>Configure Dynamic NAT exercise<a class="headerlink" href="#configure-dynamic-nat-exercise" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_9.2.2.5_Configuring_Dynamic_NAT.png" src="nw/_static/img/Ch9_9.2.2.5_Configuring_Dynamic_NAT.png" />
<div class="section" id="configure-dynamic-nat">
<h5>configure dynamic NAT<a class="headerlink" href="#configure-dynamic-nat" title="Permalink to this headline">¶</a></h5>
<p>On R2:</p>
<ul>
<li><p class="first">configure one statement for ACL 1 to permit any address belonging to 172.16.0.0/16</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#access-list 1 permit 172.16.0.0 0.0.255.255</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure a NAT pool that uses all four addresses in the 209.165.76.196/30 address space</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip nat pool NAT-POOL1 209.165.76.196 209.165.76.199 netmask 255.255.255.252</span>
</pre></div>
</div>
</li>
</ul>
<p>Notice in the topology there are 3 network ranges that would be translated based on the ACL created. What will happen if more than 2 devices attempt to access the Internet?</p>
<ul>
<li><p class="first">Associate ACL1 with the NAT pool</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source list 1 nat NAT-POOL1</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure the NAT interfaces</p>
<p>Configure R2 interfaces with the appropriate inside and outside NAT commands</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface Serial 0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat outside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#interface Serial 0/0/1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat inside</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">if you try to remove an active pool you will get an error msg that it is in use <code class="docutils literal"><span class="pre">R2(config)#no</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">pool</span> <span class="pre">1</span> <span class="pre">209.165.76.192</span> <span class="pre">209.165.76.195</span> <span class="pre">netmask</span> <span class="pre">255.255.255.252</span></code>
%Pool 1 in use, cannot destroy
You need to remove the pool reference first from the inside nat
<code class="docutils literal"><span class="pre">R2(config)#no</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">inside</span> <span class="pre">source</span> <span class="pre">list</span> <span class="pre">1</span></code></p>
</div>
</div>
<div class="section" id="verify-nat-implementation">
<h5>Verify NAT implementation<a class="headerlink" href="#verify-nat-implementation" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span>R2 running-config
-----------------
!
interface Serial0/0/0
 ip address 209.165.76.193 255.255.255.224
 ip nat outside
 clock rate 2000000
!
interface Serial0/0/1
 ip address 172.16.1.1 255.255.255.252
 ip nat inside
 clock rate 2000000
!
interface Vlan1
 no ip address
 shutdown
!
ip nat pool NAT-POOL1 209.165.76.196 209.165.76.199 netmask 255.255.255.252
ip nat inside source list 1 pool NAT-POOL1
ip classless
ip route 0.0.0.0 0.0.0.0 Serial0/0/0
ip route 172.16.0.0 255.255.0.0 Serial0/0/1
!
ip flow-export version 9
!
!
access-list 1 permit 172.16.0.0 0.0.255.255
!
</pre></div>
</div>
<ul>
<li><p class="first">From the web browser of L1, PC1, or PC2, access the web page for Server1</p>
<p>The first 2 devices have access and any additional devices are denied access until the other 2 are timed out.</p>
</li>
<li><p class="first">View the NAT translations on R2</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">0</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">0</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">0</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">0</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">2</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">2</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">15</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">2</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">25</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">3</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">22</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">3</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">50</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>

<span class="n">R2</span><span class="c1">#show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.197</span><span class="p">:</span><span class="mf">1025172.16</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">1025</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.197</span><span class="p">:</span><span class="mf">1026172.16</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">1026</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.198</span><span class="p">:</span><span class="mf">1025172.16</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">1025</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>

<span class="n">R2</span><span class="c1">#show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.197</span><span class="p">:</span><span class="mf">1025172.16</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">1025</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.197</span><span class="p">:</span><span class="mf">1026172.16</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">1026</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.198</span><span class="p">:</span><span class="mf">1025172.16</span><span class="o">.</span><span class="mf">10.2</span><span class="p">:</span><span class="mi">1025</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">3</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">22</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">27</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">3</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">50</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">24</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">3</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">22</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">39</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">3</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">50</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">36</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">3</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">22</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">51</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">3</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">50</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">48</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">3</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">22</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">63</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">3</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">50</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">60</span>

<span class="n">R2</span><span class="c1">#clear ip nat translation</span>
<span class="o">%</span> <span class="n">Incomplete</span> <span class="n">command</span><span class="o">.</span>
<span class="n">R2</span><span class="c1">#clear ip nat translation ?</span>
  <span class="o">*</span>  <span class="n">Deletes</span> <span class="nb">all</span> <span class="n">dynamic</span> <span class="n">translations</span>
<span class="n">R2</span><span class="c1">#clear ip nat translation *</span>
<span class="n">R2</span><span class="c1">#show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.197</span><span class="p">:</span><span class="mf">1027172.16</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">1027</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.198</span><span class="p">:</span><span class="mf">1030172.16</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">1030</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">80</span>

<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">2</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">2</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">36</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">65</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span> <span class="n">refCount</span> <span class="mi">2</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL1</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.252</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.199</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">4</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">50</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">60</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="configure-dynamic-static-nat-lab">
<h4>Configure Dynamic &amp; Static NAT Lab<a class="headerlink" href="#configure-dynamic-static-nat-lab" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_9.2.2.6_Configuring_Dynamic_And_Static_NAT.png" src="nw/_static/img/Ch9_9.2.2.6_Configuring_Dynamic_And_Static_NAT.png" />
<div class="section" id="addressing-table-9-2-2-6">
<h5>Addressing Table 9.2.2.6<a class="headerlink" href="#addressing-table-9-2-2-6" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="16%" />
<col width="18%" />
<col width="19%" />
<col width="19%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Gateway</td>
<td>G0/1</td>
<td>192.168.1.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>209.165.201.18</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>ISP</td>
<td>S0/0/0 (DCE)</td>
<td>209.165.201.17</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Lo0</td>
<td>192.31.7.1</td>
<td>255.255.255.255</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>PC-A (Simulated Server)</td>
<td>NIC</td>
<td>192.168.1.20</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
<tr class="row-odd"><td>PC-B</td>
<td>NIC</td>
<td>192.168.1.21</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="objectives-9-2-2-6">
<h5>Objectives 9.2.2.6<a class="headerlink" href="#objectives-9-2-2-6" title="Permalink to this headline">¶</a></h5>
<p>Part 1: Build the Network and Verify Connectivity
Part 2: Configure and Verify Static NAT
Part 3: Configure and Verify Dynamic NAT</p>
<p>An ISP has allocated the public IP address space of 209.165.200.224/27 to a company. This provides the company with 30 public IP addresses. The addresses , 209.165.200.225 to 209.165.200.241, are for static allocation and 209.165.200.242 to 209.165.200.254 are for dynamic allocation.</p>
<p>A static route is used from the ISP to the gateway router, and a default route is used from the gateway to the ISP router. The ISP connection to the Internet is simulated by a loopback address on the ISP router.</p>
</div>
<div class="section" id="required-resources">
<h5>Required Resources<a class="headerlink" href="#required-resources" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>2 Routers (Cisco 1941 with Cisco IOS Release 15.2(4)M3 universal image or comparable)</li>
<li>1 Switch (Cisco 2960 with Cisco IOS Release 15.0(2) lanbasek9 image or comparable)</li>
<li>2 PCs (Windows 7, Vista, or XP with terminal emulation program, such as Tera Term)</li>
<li>Console cables to configure the Cisco IOS devices via the console ports</li>
<li>Ethernet and serial cables as shown in the topology</li>
</ul>
</div>
<div class="section" id="build-network-verify-connectivity">
<h5>Build network &amp; verify connectivity<a class="headerlink" href="#build-network-verify-connectivity" title="Permalink to this headline">¶</a></h5>
<p>Basic settings for each router:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">no</span> <span class="n">ip</span> <span class="n">domain</span><span class="o">-</span><span class="n">lookup</span>
<span class="n">service</span> <span class="n">password</span><span class="o">-</span><span class="n">encryption</span>
<span class="n">enable</span> <span class="n">secret</span> <span class="k">class</span>
<span class="nc">banner</span> <span class="n">motd</span> <span class="c1">#</span>
<span class="n">Unauthorized</span> <span class="n">access</span> <span class="ow">is</span> <span class="n">strictly</span> <span class="n">prohibited</span><span class="o">.</span> <span class="c1">#</span>
<span class="n">line</span> <span class="n">con</span> <span class="mi">0</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
<span class="n">logging</span> <span class="n">synchronous</span>
<span class="n">line</span> <span class="n">vty</span> <span class="mi">0</span> <span class="mi">4</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
</pre></div>
</div>
<p>Configure the host name as shown in the topology.
Copy the running configuration to the startup configuration.</p>
<ul>
<li><p class="first">Create a simulated web server on ISP</p>
<ul>
<li><p class="first">Create a local user named webuser with an encrypted password of webpass</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ISP</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># username webuser privilege 15 secret webpass</span>
</pre></div>
</div>
</li>
<li><p class="first">Create a default route from the Gateway router to the ISP router</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 0.0.0.0 0.0.0.0 209.165.201.17</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Save the running configuration to the startup configuration</p>
</li>
<li><p class="first">Verify network connectivity</p>
<ul class="simple">
<li>From the PC hosts, ping the G0/1 interface on the Gateway router. Troubleshoot if the pings are unsuccessful</li>
<li>Display the routing tables on both routers to verify that the static routes are in the routing table and configured correctly on both routers</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="configure-and-verify-static-nat">
<h5>Configure and Verify Static NAT<a class="headerlink" href="#configure-and-verify-static-nat" title="Permalink to this headline">¶</a></h5>
<p>Static NAT uses a one-to-one mapping of local and global addresses, and these mappings remain constant.
Static NAT is particularly useful for web servers or devices that must have static addresses that are accessible from the Internet</p>
<ul>
<li><p class="first">configure a static mapping</p>
<p>A static map is configured to tell the router to translate between the private inside server address 192.168.1.20 and the public address 209.165.200.225. This allows a user from the Internet to access PC-A.
PC-A is simulating a server or device with a constant address that can be accessed from the Internet.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source static 192.168.1.20 209.165.200.225</span>
</pre></div>
</div>
</li>
<li><p class="first">specify the interfaces</p>
<ul>
<li><p class="first">Issue the <code class="docutils literal"><span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">inside</span></code> and <code class="docutils literal"><span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">outside</span></code> commands to the interfaces</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/1</span>
<span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
<span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># interface s0/0/1</span>
<span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
</li>
<li><p class="first">Display the static NAT table by issuing the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">translations</span></code> command</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>      <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>       <span class="o">---</span>                <span class="o">---</span>
</pre></div>
</div>
<p>What is the translation of the Inside local host address?
192.168.1.20 =
The Inside global address is assigned by?</p>
<p>The Inside local address is assigned by?</p>
</li>
<li><p class="first">From PC-A, ping the Lo0 interface ( 192.31.7.1) on ISP. If the ping was un successful, troubleshoot and correct the issues.  On the Gateway router, d isplay the NAT table.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>      <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">1</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>       <span class="o">---</span>                <span class="o">---</span>
</pre></div>
</div>
<p>A NAT entry was added to the table with ICMP listed as the protocol when PC-A sent an ICMP request (ping) to 192.31.7.1 on ISP.
What port number was used in this ICMP exchange?
Note: It may be necessary to disable the PC-A firewall for the ping to be successful.</p>
</li>
<li><p class="first">From PC-A, telnet to the ISP Lo0 interface and display the NAT table</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>        <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">1</span>   <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">1034</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span><span class="p">:</span><span class="mi">1034</span>  <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">23</span>      <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">23</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span>      <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>       <span class="o">---</span>                <span class="o">---</span>
</pre></div>
</div>
<p>Note: The NAT for the ICMP request may have timed out and been removed from the NAT table.
What was the protocol used in this translation?
What are the port numbers used?</p>
<p>Inside global / local:
Outside global / local:</p>
</li>
<li><p class="first">Because static NAT was configured for PC-A, verify that pinging from ISP to PC-A at the static NAT public address (209.165.200.225) is successful.</p>
</li>
<li><p class="first">On the Gateway router, display the NAT table to verify the translation.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>       <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">12</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span><span class="p">:</span><span class="mi">12</span>    <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.17</span><span class="p">:</span><span class="mi">12</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.17</span><span class="p">:</span><span class="mi">12</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span>     <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>       <span class="o">---</span>                <span class="o">---</span>
</pre></div>
</div>
<p>Notice that the Outside local and Outside global addresses are the same. This address is the ISP remote network source address. For the ping from the ISP to succeed, the Inside global static NAT address 209.165.200.225 was translated to the Inside local address of PC-A (192.168.1.20).</p>
</li>
<li><p class="first">Verify NAT statistics by using the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code> command on the Gateway router</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat statistics</span>
<span class="n">Total</span> <span class="n">active</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">1</span> <span class="n">static</span><span class="p">,</span> <span class="mi">1</span> <span class="n">dynamic</span><span class="p">;</span> <span class="mi">1</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Peak</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">occurred</span> <span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">12</span> <span class="n">ago</span>
<span class="n">Outside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Inside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">39</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">CEF</span> <span class="n">Translated</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">39</span><span class="p">,</span> <span class="n">CEF</span> <span class="n">Punted</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="n">Total</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Appl</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Normal</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Queued</span> <span class="n">Packets</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="configure-and-verify-dynamic-nat">
<h5>Configure and Verify Dynamic NAT<a class="headerlink" href="#configure-and-verify-dynamic-nat" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt>Dynamic NAT</dt>
<dd>uses a pool of public addresses and assigns them on a first-come, first-served basis. When an inside device requests access to an outside network, dynamic NAT assigns an available public IPv4 address from the pool. Dynamic NAT results in a many-to-many address mapping between local and global addresses.</dd>
</dl>
<ul>
<li><p class="first">Clear NATs
Before proceeding to add dynamic NATs, clear the NATs and statistics from Part 2.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># clear ip nat translation *</span>
<span class="n">Gateway</span><span class="c1"># clear ip nat statistics</span>
</pre></div>
</div>
</li>
<li><p class="first">Define an access control list (ACL) that matches the LAN private IP address range.</p>
<p>ACL 1 is used to allow 192.168.1.0/24 network to be translated.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit 192.168.1.0 0.0.0.255</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify that the NAT interface configurations are still valid</p>
<p>Issue the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code> command on the Gateway router to verify the NAT configurations.</p>
</li>
<li><p class="first">Define the pool of usable public IP addresses.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat pool public_access 209.165.200.242 209.165.200.254 netmask 255.255.255.224</span>
</pre></div>
</div>
</li>
<li><p class="first">Define the NAT from the inside source list to the outside pool</p>
<p>Note: Remember that NAT pool names are case-sensitive and the pool name entered here must match that used in the previous step.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source list 1 pool public_access</span>
</pre></div>
</div>
</li>
<li><p class="first">Test the configuration</p>
<ol class="loweralpha">
<li><p class="first">From PC-B, ping the Lo0 interface (192.31.7.1) on ISP. If the ping was unsuccessful, troubleshoot and correct the issues. On the Gateway router, display the NAT table.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>      <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>       <span class="o">---</span>                <span class="o">---</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span>       <span class="o">---</span>                <span class="o">---</span>
</pre></div>
</div>
<p>What is the translation of the Inside local host address for PC-B?</p>
<p>192.168.1.21 =</p>
<p>A dynamic NAT entry was added to the table with ICMP as the protocol when PC-B sent an ICMP message to 192.31.7.1 on ISP.</p>
<p>What port number was used in this ICMP exchange?</p>
</li>
<li><p class="first">From PC-B, open a browser and enter the IP address of the ISP-simulated web server (Lo0 interface)
When prompted, log in as webuser with a password of webpass</p>
</li>
<li><p class="first">Display the NAT table.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>        <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span>      <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>       <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1038</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1038</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1039</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1039</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1040</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1040</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1041</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1041</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1042</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1042</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1043</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1043</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1044</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1044</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1045</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1045</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1046</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1046</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1047</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1047</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1048</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1048</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1049</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1049</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1050</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1050</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1051</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1051</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">1052</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1052</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">80</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.22</span>       <span class="o">---</span>                <span class="o">---</span>
</pre></div>
</div>
<p>What protocol was used in this translation? What port numbers were used?
Inside:
Outside:
What well-known port number and service was used?</p>
</li>
<li><p class="first">Verify NAT statistics by using the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code> command on the Gateway router</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat statistics</span>
<span class="n">Total</span> <span class="n">active</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">1</span> <span class="n">static</span><span class="p">,</span> <span class="mi">2</span> <span class="n">dynamic</span><span class="p">;</span> <span class="mi">1</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Peak</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="n">occurred</span> <span class="mi">00</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">40</span> <span class="n">ago</span>
<span class="n">Outside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Inside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">345</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">CEF</span> <span class="n">Translated</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">345</span><span class="p">,</span> <span class="n">CEF</span> <span class="n">Punted</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">20</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="p">[</span><span class="n">Id</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">public_access</span> <span class="n">refcount</span> <span class="mi">2</span>
 <span class="n">pool</span> <span class="n">public_access</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.224</span>
        <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.254</span>
        <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">13</span><span class="p">,</span> <span class="n">allocated</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">7</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>
<span class="n">Total</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Appl</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Normal</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Queued</span> <span class="n">Packets</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p class="first">Remove the static NAT entry</p>
<ol class="loweralpha">
<li><p class="first">Remove the static NAT from Part 2. Enter yes when prompted to delete child entries.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>Gateway(config)# no ip nat inside source static 192.168.1.20 209.165.200.225
Static entry in use, do you want to delete child entries? [no]: yes
</pre></div>
</div>
</li>
<li><p class="first">Clear the NATs and statistics.</p>
</li>
<li><p class="first">Ping the ISP (192.31.7.1) from both hosts.</p>
</li>
<li><p class="first">Display the NAT table and statistics.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat statistics</span>
<span class="n">Total</span> <span class="n">active</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">4</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">4</span> <span class="n">dynamic</span><span class="p">;</span> <span class="mi">2</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Peak</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="n">occurred</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">43</span> <span class="n">ago</span>
<span class="n">Outside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Inside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">16</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">CEF</span> <span class="n">Translated</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">285</span><span class="p">,</span> <span class="n">CEF</span> <span class="n">Punted</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">11</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="p">[</span><span class="n">Id</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">public_access</span> <span class="n">refcount</span> <span class="mi">4</span>
 <span class="n">pool</span> <span class="n">public_access</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.224</span>
        <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.254</span>
        <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">13</span><span class="p">,</span> <span class="n">allocated</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">15</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>
<span class="n">Total</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Appl</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Normal</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Queued</span> <span class="n">Packets</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Gateway</span><span class="c1"># show ip nat translation</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>      <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.243</span><span class="p">:</span><span class="mi">512</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span><span class="p">:</span><span class="mi">512</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">512</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">512</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.243</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span>       <span class="o">---</span>                <span class="o">---</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span><span class="p">:</span><span class="mi">512</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">512</span> <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">512</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">512</span>
<span class="o">---</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.242</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span>       <span class="o">---</span>                <span class="o">---</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ul>
<dl class="docutils">
<dt>Reflection</dt>
<dd><ol class="first last arabic simple">
<li>Why would NAT be used in a network?</li>
<li>What are the limitations of NAT?</li>
</ol>
</dd>
</dl>
</div>
</div>
<div class="section" id="configuring-pat-nat-overload">
<h4>Configuring PAT (NAT overload)<a class="headerlink" href="#configuring-pat-nat-overload" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Define a pool of global addresses to be used for overload translation</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat pool NAT-POOL-OVERLOAD start-ip end-ip {netmask netmask prefix-length prefix-length}</span>
</pre></div>
</div>
</li>
<li><p class="first">Define a standard access list permitting the addresses that should be translated</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit source source-wildcard</span>
</pre></div>
</div>
</li>
<li><p class="first">Establish overload translation, specifying the acl and pool defined in prior steps</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source list 1 pool NAT-POOL-OVERLOAD overload</span>
</pre></div>
</div>
</li>
<li><p class="first">Identify the inside interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Serial 0/0/0</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
</pre></div>
</div>
</li>
<li><p class="first">Identify the outside interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># interface Serial 0/1/0</span>
<span class="n">R</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
</li>
</ol>
<p>When multiple inside local addresses map to one inside global address, the TCP or UDP port numbers of each inside host distinguish between the local addresses.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The total number of internal addresses that can be translated to one external address could theoretically be as high as 65,536 per IPv4 address. However, the number of internal addresses that can be assigned a single IPv4 address is around 4,000.</p>
</div>
<p>There are two ways to configure PAT, depending on how the ISP allocates public IPv4 addresses:</p>
<blockquote>
<div><ol class="arabic simple">
<li>ISP allocates more than one public IPv4 address to the organization</li>
<li>It allocates a single public IPv4 address that is required for the organization to connect to the ISP</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The primary difference between this configuration and the configuration for dynamic, one-to-one NAT is that the overload keyword is used. The <strong>overload</strong> keyword enables PAT.</p>
</div>
<img alt="nw/_static/img/Ch9_PAT_with_single_address.png" src="nw/_static/img/Ch9_PAT_with_single_address.png" />
<p><code class="docutils literal"><span class="pre">R2(config)#</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">inside</span> <span class="pre">source</span> <span class="pre">list</span> <span class="pre">2</span> <span class="pre">interface</span> <span class="pre">Serial</span> <span class="pre">0/1/0</span> <span class="pre">overload</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">PAT with single public ip = <strong>interface</strong> type number overload</p>
</div>
</div>
<div class="section" id="pat-analysis">
<h4>PAT analysis<a class="headerlink" href="#pat-analysis" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_PAT_Analysis1.png" src="nw/_static/img/Ch9_PAT_Analysis1.png" />
<img alt="nw/_static/img/Ch9_PAT_Analysis2.png" src="nw/_static/img/Ch9_PAT_Analysis2.png" />
<p>However, PC2 has the same source port number as a current PAT entry, the translation for PC1. <strong>PAT increments the source port number until it is a unique value in its table</strong>. In this instance, the source port entry in the NAT table and the packet for PC2 receives 1445.</p>
<p>Although PC1 and PC2 are using the same translated address, the inside global address of 209.165.200.225, and the same source port number of 1444; the modified port number for PC2 (1445) makes each entry in the NAT table unique. This will become evident with the packets sent from the servers back to the clients.</p>
<p>When the packet from Svr2 arrives R2 performs a similar translation. The destination IPv4 address of 209.165.200.225 is located, again with multiple entries. However, using the destination port of 1445, R2 is able to uniquely identify the translation entry. The destination IPv4 address is changed to 192.168.10.11. <strong>In this case, the destination port must also be modified back to its original value of 1444, which is stored in the NAT table.</strong> The packet is then forwarded toward PC2.</p>
</div>
<div class="section" id="pt-implementing-static-dynamic-nat">
<h4>PT Implementing Static &amp; Dynamic NAT<a class="headerlink" href="#pt-implementing-static-dynamic-nat" title="Permalink to this headline">¶</a></h4>
<div class="section" id="pt-9-2-3-6">
<h5>PT 9.2.3.6<a class="headerlink" href="#pt-9-2-3-6" title="Permalink to this headline">¶</a></h5>
<img alt="nw/_static/img/Ch9_pt_9.2.3.6_statdyn_NAT.png" src="nw/_static/img/Ch9_pt_9.2.3.6_statdyn_NAT.png" />
</div>
<div class="section" id="configure-dynamic-nat-with-pat">
<h5>Configure dynamic NAT with PAT<a class="headerlink" href="#configure-dynamic-nat-with-pat" title="Permalink to this headline">¶</a></h5>
<ol class="arabic">
<li><p class="first">Configure traffic that will be permitted for NAT translations</p>
<ul>
<li><p class="first">On R2, configure a standard ACL named R2NAT that uses three statements to permit, in order, the following private address spaces:192.168.10.0/24, 192.168.20.0/24, and 192.168.30.0/24</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip access-list standard R2NAT</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#permit 192.168.10.0 0.0.0.255</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#permit 192.168.20.0 0.0.0.255</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#permit 192.168.30.0 0.0.0.255</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">std</span><span class="o">-</span><span class="n">nacl</span><span class="p">)</span><span class="c1">#exit</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Configure a pool of addresses for NAT</p>
<ul>
<li><p class="first">Configure R2 with a NAT pool named R2POOL that uses the first address in the 209.165.202.128/30 address space. The second address is used for static NAT later in Part 2.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip nat pool R2POOL 209.165.202.129 209.165.202.129 netmask 255.255.255.255</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Associate the named ACL with the NAT pool and enable PAT</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip nat inside source list R2NAT pool R2POOL overload</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure the NAT interfaces</p>
<ul>
<li><p class="first">Configure R2 interfaces with the appropriate inside and outside NAT commands</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#interface FastEthernet 0/1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#interface Serial 0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#interface Serial 0/0/1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#interface FastEthernet 0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface Serial 0/1/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#ip nat outside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># exit</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="configure-static-nat">
<h5>Configure Static NAT<a class="headerlink" href="#configure-static-nat" title="Permalink to this headline">¶</a></h5>
<p>Create a static NAT translation to map the local.pka inside address to its outside address</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source static 192.168.20.254 209.165.202.130</span>
</pre></div>
</div>
</div>
<div class="section" id="verify-nat-implementation-9-2-3-6">
<h5>Verify NAT implementation 9.2.3.6<a class="headerlink" href="#verify-nat-implementation-9-2-3-6" title="Permalink to this headline">¶</a></h5>
<ol class="arabic">
<li><p class="first">Access services across the Internet</p>
<ol class="loweralpha simple">
<li>From the web browser of PC1, or PC3, access the web page for cisco.pka</li>
<li>From the web browser for PC4, access the web page for local.pka</li>
</ol>
</li>
<li><p class="first">View NAT translations</p>
<p>View the NAT translations on R2</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#do show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="o">---</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.130</span>   <span class="mf">192.168</span><span class="o">.</span><span class="mf">20.254</span>     <span class="o">---</span>                <span class="o">---</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.129</span><span class="p">:</span><span class="mf">1025192.168</span><span class="o">.</span><span class="mf">10.10</span><span class="p">:</span><span class="mi">1025</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.30</span><span class="p">:</span><span class="mi">80</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.30</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.129</span><span class="p">:</span><span class="mf">1026192.168</span><span class="o">.</span><span class="mf">10.10</span><span class="p">:</span><span class="mi">1026</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.30</span><span class="p">:</span><span class="mi">80</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.30</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.129</span><span class="p">:</span><span class="mf">1027192.168</span><span class="o">.</span><span class="mf">10.10</span><span class="p">:</span><span class="mi">1027</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.30</span><span class="p">:</span><span class="mi">80</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.30</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.130</span><span class="p">:</span><span class="mi">80</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">20.254</span><span class="p">:</span><span class="mi">80</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.14</span><span class="p">:</span><span class="mf">1029209.165</span><span class="o">.</span><span class="mf">201.14</span><span class="p">:</span><span class="mi">1029</span>

<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#do show ip access-list</span>
<span class="n">Standard</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="n">R2NAT</span>
    <span class="mi">10</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span> <span class="p">(</span><span class="mi">6</span> <span class="n">match</span><span class="p">(</span><span class="n">es</span><span class="p">))</span>
    <span class="mi">20</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">20.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="mi">30</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">30.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>

<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#do show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">5</span> <span class="p">(</span><span class="mi">1</span> <span class="n">static</span><span class="p">,</span> <span class="mi">4</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">4</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span> <span class="p">,</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="p">,</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span> <span class="p">,</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">68</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">8</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="n">R2NAT</span> <span class="n">pool</span> <span class="n">R2POOL</span> <span class="n">refCount</span> <span class="mi">3</span>
 <span class="n">pool</span> <span class="n">R2POOL</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.129</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.129</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">100</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
</ol>
<p>Router 2 running config</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>spanning-tree mode pvst
!
!
!
!
!
!
interface FastEthernet0/0
 ip address 192.168.20.1 255.255.255.0
 ip nat inside
 duplex auto
 speed auto
!
interface FastEthernet0/1
 no ip address
 ip nat inside
 duplex auto
 speed auto
 shutdown
!
interface Serial0/0/0
 ip address 10.1.1.2 255.255.255.252
 ip nat inside
!
interface Serial0/0/1
 ip address 10.2.2.1 255.255.255.252
 ip nat inside
 clock rate 64000
!
interface Serial0/1/0
 ip address 209.165.200.225 255.255.255.224
 ip nat outside
!
interface Serial0/1/1
 no ip address
 clock rate 2000000
 shutdown
!
interface Vlan1
 no ip address
 shutdown
!
router rip
 version 2
 passive-interface Serial0/1/0
 network 10.0.0.0
 default-information originate
 no auto-summary
!
ip nat pool R2POOL 209.165.202.129 209.165.202.129 netmask 255.255.255.255
ip nat inside source list R2NAT pool R2POOL overload
ip nat inside source static 192.168.20.254 209.165.202.130
ip classless
ip route 0.0.0.0 0.0.0.0 Serial0/1/0
!
ip flow-export version 9
!
!
ip access-list standard R2NAT
 permit 192.168.10.0 0.0.0.255
 permit 192.168.20.0 0.0.0.255
 permit 192.168.30.0 0.0.0.255
!
banner motd ^CAUTHORIZED ACCESS ONLY!^C
</pre></div>
</div>
</div>
</div>
<div class="section" id="configure-pat-nat-lab">
<h4>Configure PAT NAT Lab<a class="headerlink" href="#configure-pat-nat-lab" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_9.2.3.7_Configuring_PAT_NAT_lab.png" src="nw/_static/img/Ch9_9.2.3.7_Configuring_PAT_NAT_lab.png" />
<div class="section" id="addressing-table-9-2-3-7">
<h5>Addressing Table 9.2.3.7<a class="headerlink" href="#addressing-table-9-2-3-7" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="16%" />
<col width="18%" />
<col width="19%" />
<col width="19%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Gateway</td>
<td>G0/1</td>
<td>192.168.1.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>209.165.201.18</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>ISP</td>
<td>S0/0/0 (DCE)</td>
<td>209.165.201.17</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Lo0</td>
<td>192.31.7.1</td>
<td>255.255.255.255</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>PC-A (Simulated Server)</td>
<td>NIC</td>
<td>192.168.1.20</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
<tr class="row-odd"><td>PC-B</td>
<td>NIC</td>
<td>192.168.1.21</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
<tr class="row-even"><td>PC-C</td>
<td>NIC</td>
<td>192.168.1.22</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="objectives-9-2-3-7">
<h5>Objectives 9.2.3.7<a class="headerlink" href="#objectives-9-2-3-7" title="Permalink to this headline">¶</a></h5>
<p>Part 1: Build the Network and Verify Connectivity
Part 2: Configure and Verify NAT Pool Overload
Part 3: Configure and Verify PAT</p>
<p>your company is allocated the public IP address range of 209.165.200.224/29 by the ISP . This provides the company with six public IP addresses</p>
<p>Dynamic NAT pool overload uses a pool of IP addresses in a many-to-many relationship. The router uses the first IP address in the pool and assigns connections using the IP address plus a unique port number. After the maximum number of translations for a single IP address have been reached on the router (platform and hardware specific), it uses the next IP address in the pool.</p>
<p>NAT pool overload is a form port address translation (PAT) that overloads a group of public IPv4 addresses.</p>
<p>In Part 2, the ISP has allocated a single IP address, 209.165.201.18, to your company for use on the Internet connection from the company G ateway router to the ISP.  You will use the PAT to convert multiple internal addresses into the one usable public address. You will test, view, and verify that the translations are taking place, and you will interpret the NAT/PAT statistics to monitor the process.</p>
</div>
<div class="section" id="required-resources-9-2-3-7">
<h5>Required Resources 9.2.3.7<a class="headerlink" href="#required-resources-9-2-3-7" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>2 Routers (Cisco 1941 with Cisco IOS Release 15.2(4)M3 universal image or comparable)</li>
<li>1 Switch (Cisco 2960 with Cisco IOS Release 15.0(2) lanbasek9 image or comparable)</li>
<li>3 PCs (Windows 7, Vista, or XP with terminal emulation program, such as Tera Term)</li>
<li>Console cables to configure the Cisco IOS devices via the console ports</li>
<li>Ethernet and serial cables as shown in the topology</li>
</ul>
</div>
<div class="section" id="build-network-verify-connectivity-9-2-3-7">
<h5>Build network &amp; verify connectivity 9.2.3.7<a class="headerlink" href="#build-network-verify-connectivity-9-2-3-7" title="Permalink to this headline">¶</a></h5>
<p>Basic settings for each router:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">no</span> <span class="n">ip</span> <span class="n">domain</span><span class="o">-</span><span class="n">lookup</span>
<span class="n">service</span> <span class="n">password</span><span class="o">-</span><span class="n">encryption</span>
<span class="n">enable</span> <span class="n">secret</span> <span class="k">class</span>
<span class="nc">banner</span> <span class="n">motd</span> <span class="c1">#</span>
<span class="n">Unauthorized</span> <span class="n">access</span> <span class="ow">is</span> <span class="n">strictly</span> <span class="n">prohibited</span><span class="o">.</span> <span class="c1">#</span>
<span class="n">line</span> <span class="n">con</span> <span class="mi">0</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
<span class="n">logging</span> <span class="n">synchronous</span>
<span class="n">line</span> <span class="n">vty</span> <span class="mi">0</span> <span class="mi">4</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
</pre></div>
</div>
<p>Configure Static Routing</p>
<ul>
<li><p class="first">Create a static route from the ISP router to the Gateway router</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ISP</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 209.165.200.224 255.255.255.248 209.165.201.18</span>
</pre></div>
</div>
</li>
<li><p class="first">Create a default route from the Gateway router to the ISP router</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 0.0.0.0 0.0.0.0 209.165.201.17</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify network connectivity</p>
</li>
</ul>
<ol class="loweralpha simple">
<li>From the PC hosts, ping the G0/1 interface on the Gateway router. Troubleshoot if the pings are unsuccessful.</li>
<li>Verify that the static routes are configured correctly on both routers.</li>
</ol>
</div>
<div class="section" id="configure-and-verify-nat-pool-overload-9-2-3-7">
<h5>Configure and Verify NAT Pool Overload 9.2.3.7<a class="headerlink" href="#configure-and-verify-nat-pool-overload-9-2-3-7" title="Permalink to this headline">¶</a></h5>
<p>You will configure the Gateway router to translate the IP addresses from the 192.168.1.0/24 network to one of the six usable addresses in the 209.165.200.224/29 range.</p>
<ol class="arabic">
<li><p class="first">Define an access control list that matches the LAN private IP addresses.
ACL 1 is used to allow the 192.168.1.0/24 network to be translated.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit 192.168.1.0 0.0.0.255</span>
</pre></div>
</div>
</li>
<li><p class="first">Define the pool of usable public IP addresses.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat pool public_access 209.165.200.225 209.165.200.230 netmask 255.255.255.248</span>
</pre></div>
</div>
</li>
<li><p class="first">Define the NAT from the inside source list to the outside pool.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source list 1 pool public_access overload</span>
</pre></div>
</div>
</li>
<li><p class="first">Specify the interfaces</p>
<p>Issue the ip nat inside and ip nat outside commands to the interfaces.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/1</span>
<span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
<span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="o">-</span> <span class="k">if</span><span class="p">)</span><span class="c1"># interface s0/0/1</span>
<span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify the NAT pool overload configuration.</p>
<ol class="loweralpha">
<li><p class="first">From each PC host, ping the 192.31.7.1 address on the ISP router.</p>
</li>
<li><p class="first">Display NAT statistics on the Gateway router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat statistics</span>
<span class="n">Total</span> <span class="n">active</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">;</span> <span class="mi">3</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Peak</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">occurred</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">25</span> <span class="n">ago</span>
<span class="n">Outside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Inside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">24</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">CEF</span> <span class="n">Translated</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="n">CEF</span> <span class="n">Punted</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="p">[</span><span class="n">Id</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">public_access</span> <span class="n">refcount</span> <span class="mi">3</span>
 <span class="n">pool</span> <span class="n">public_access</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.248</span>
        <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.230</span>
        <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">6</span><span class="p">,</span> <span class="n">allocated</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">16</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>
<span class="n">Total</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Appl</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Normal</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Queued</span> <span class="n">Packets</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p class="first">Display NATs on the Gateway router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>      <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">0</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">0</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">1</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">2</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.22</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">2</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div class="section" id="configure-and-verify-pat-9-2-3-7">
<h5>Configure and Verify PAT 9.2.3.7<a class="headerlink" href="#configure-and-verify-pat-9-2-3-7" title="Permalink to this headline">¶</a></h5>
<p>In Part 3, you will configure PAT by using an interface instead of a pool of addresses to define the outside address.  Not all of the commands in Part 2 will be reused in Part 3.</p>
<ol class="arabic">
<li><p class="first">Clear NATs and statistics on the gateway router</p>
</li>
<li><p class="first">Verify the configuration for NAT</p>
<ol class="loweralpha simple">
<li>Verify that statistics have been cleared.</li>
<li>Verify that the outside and inside interfaces are configured for NATs.</li>
<li>Verify that the ACL is still configured for NATs.</li>
</ol>
</li>
<li><p class="first">Remove the pool of useable public IP addresses</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no ip nat pool public_access 209.165.200.225 209.165.200.230 netmask 255.255.255.248</span>
</pre></div>
</div>
</li>
<li><p class="first">Remove the NAT translation from inside source list to outside pool.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no ip nat inside source list 1 pool public_access overload</span>
</pre></div>
</div>
</li>
<li><p class="first">Associate the source list with the outside interface.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source list 1 interface serial 0/0/1 overload</span>
</pre></div>
</div>
</li>
<li><p class="first">Test the PAT configuration.</p>
<ol class="loweralpha">
<li><p class="first">From each PC, ping the 192.31.7.1 address on the ISP router.</p>
</li>
<li><p class="first">Display NAT statistics on the Gateway router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat statistics</span>
<span class="n">Total</span> <span class="n">active</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">3</span> <span class="n">dynamic</span><span class="p">;</span> <span class="mi">3</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Peak</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">occurred</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">19</span> <span class="n">ago</span>
<span class="n">Outside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Inside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">24</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">CEF</span> <span class="n">Translated</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="n">CEF</span> <span class="n">Punted</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="p">[</span><span class="n">Id</span><span class="p">:</span> <span class="mi">2</span><span class="p">]</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">interface</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span> <span class="n">refcount</span> <span class="mi">3</span>
<span class="n">Total</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Appl</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Normal</span> <span class="n">doors</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Queued</span> <span class="n">Packets</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p class="first">Display NAT translations on Gateway.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>      <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.18</span><span class="p">:</span><span class="mi">3</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.20</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">3</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.18</span><span class="p">:</span><span class="mi">1</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.21</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.18</span><span class="p">:</span><span class="mi">4</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.22</span><span class="p">:</span><span class="mi">1</span>     <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">1</span>       <span class="mf">192.31</span><span class="o">.</span><span class="mf">7.1</span><span class="p">:</span><span class="mi">4</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ol>
<p>Reflection</p>
<blockquote>
<div>What advantages does PAT provide?</div></blockquote>
</div>
</div>
<div class="section" id="port-forwarding">
<h4>Port Forwarding<a class="headerlink" href="#port-forwarding" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">inside</span> <span class="pre">source</span> <span class="pre">{static</span> <span class="pre">{tcp</span> <span class="pre">|</span> <span class="pre">udp</span> <span class="pre">local-ip</span> <span class="pre">local-port</span> <span class="pre">global-ip</span> <span class="pre">global-port}</span> <span class="pre">[extendable]}</span></code></p>
<ul class="simple">
<li>TCP or UDP port number</li>
<li>local-ip = 192.168.10.254</li>
<li>local-port = 80</li>
<li>global-ip = 209.165.200.225</li>
<li>global-port = 8080</li>
<li><dl class="first docutils">
<dt>extendable</dt>
<dd>The extendable option is applied automatically. The <strong>extendable</strong> keyword allows the user to configure several ambiguous static translations, <strong>where ambiguous translations are translations with the same local or global address.</strong> It allows the router to extend the translation to more than one port if necessary.</dd>
</dl>
</li>
</ul>
<img alt="nw/_static/img/Ch9_port_forwarding_example.png" src="nw/_static/img/Ch9_port_forwarding_example.png" />
<p>Establishes static translation between an inside local address and local port and an inside global address and global port</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source static tcp 192.168.10.254 80 209.165.200.225 8080</span>
</pre></div>
</div>
<p>Identifies interface Serial 0/0/0 as an inside NAT interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Serial0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
</pre></div>
</div>
<p>Identifies interface Serial 0/1/0 as an outside NAT interface</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Serial0/1/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>         <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>          <span class="n">Outside</span> <span class="k">global</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.225</span><span class="p">:</span><span class="mi">8080</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.254</span><span class="p">:</span><span class="mi">80</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.254</span><span class="p">:</span><span class="mi">46088</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.254</span><span class="p">:</span><span class="mi">46088</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.225</span><span class="p">:</span><span class="mi">8080</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.254</span><span class="p">:</span><span class="mi">80</span>  <span class="o">---</span>                    <span class="o">---</span>
</pre></div>
</div>
<p>In the example, when the router receives the packet with the inside global IPv4 address of 209.165.200.225 and a TCP destination port 8080, the router performs a NAT table lookup using the destination IPv4 address and destination port as the key. The router then translates the address to the inside local address of host 192.168.10.254 and destination port 80. R2 then forwards the packet to the web server. For return packets from the web server back to the client, this process is reversed.</p>
</div>
<div class="section" id="nat-for-ipv6">
<h4>NAT for IPv6?<a class="headerlink" href="#nat-for-ipv6" title="Permalink to this headline">¶</a></h4>
<p>IPv6, with a 128-bit address, provides 340 undecillion addresses. Therefore, address space is not an issue. IPv6 was developed with the intention of making NAT for IPv4 with its translation between public and private IPv4 addresses unnecessary. However, IPv6 does implement a form of NAT. IPv6 includes both its own IPv6 private address space and NAT, which are implemented differently than they are for IPv4.</p>
</div>
<div class="section" id="ipv6-unique-local-address-ula">
<h4>IPv6 Unique Local Address ULA<a class="headerlink" href="#ipv6-unique-local-address-ula" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_ipv6_unique_local_address.png" src="nw/_static/img/Ch9_ipv6_unique_local_address.png" />
<p>The intent of ULA is to provide IPv6 address space for communications within a local site; it is not meant to provide additional IPv6 address space, nor is it meant to provide a level of security.</p>
<p>As shown in the image, ULA have the <strong>prefix FC00::/7</strong>, which results in a first hextet <strong>range of FC00 to FDFF</strong>. The <strong>next 1 bit is set to 1 if the prefix is locally assigned</strong>. Set to 0 may be defined in the future. The next 40 bits is a global ID followed by a 16-bit Subnet ID. These first 64 bits combine to make the ULA prefix. This leaves the remaining 64 bits for the interface ID, or in IPv4 terms, the host portion of the address.</p>
<p>Unique local addresses are defined in RFC 4193. ULAs are also known as <strong>local IPv6 addresses</strong> (not to be confused with IPv6 link-local addresses) and have several characteristics including:</p>
<ul class="simple">
<li>Allows sites to be combined or privately interconnected, without creating any address conflicts or requiring renumbering of interfaces that use these prefixes.</li>
<li>Independent of any ISP and can be used for communications within a site without having any Internet connectivity.</li>
<li>Not routable across the Internet, however, if accidentally leaked by routing or DNS, there is not conflict with other addresses.</li>
</ul>
<p>ULA is not quite as straight-forward as RFC 1918 addresses. Unlike private IPv4 addresses, it has not been the intention of the IETF to use a form of NAT to translate between unique local addresses and IPv6 global unicast addresses.</p>
<p>The implementation and potential uses for IPv6 unique local addresses are still being examined by the Internet community. For example, the IETF is considering allowing the option of having the 40-bit global ID centrally assigned when using the FC00::/8 ULA prefix, and the 40-bit global ID randomly generated, or perhaps manually assigned, when using the ULA prefix FD00::/8. The rest of the address remains the same. We still use 16 bits for the subnet ID and 64 bits for the interface ID.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The original IPv6 specification allocated address space for site-local addresses, defined in RFC 3513. Site-local addresses have been deprecated by the IETF in RFC 3879 because the term “site” was somewhat ambiguous. Site-local addresses had the prefix range of FEC0::/10 and may still be found in some older IPv6 documentation.T for IPv6</p>
</div>
</div>
<div class="section" id="id93">
<h4>NAT for IPv6<a class="headerlink" href="#id93" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_NAT64.png" src="nw/_static/img/Ch9_NAT64.png" />
<p>NAT for IPv6 is used in a much different context than NAT for IPv4. The varieties of NAT for IPv6 are used to transparently provide access between IPv6-only and IPv4-only networks. It is not used as a form of private IPv6 to global IPv6 translation.</p>
<p>Ideally, IPv6 should be run natively wherever possible. This means IPv6 devices communicating with each other over IPv6 networks. However, to aid in the move from IPv4 to IPv6, the IETF has developed several transition techniques to accommodate a variety of IPv4-to-IPv6 scenarios, including dual-stack, tunneling, and translation.</p>
<p>Dual-stack is when the devices are running protocols associated with both the IPv4 and IPv6. Tunneling for IPV6 is the process of encapsulating an IPv6 packet inside an IPv4 packet. This allows the IPv6 packet to be transmitted over an IPv4-only network.</p>
<p>NAT for IPv6 should not be used as a long term strategy, but as a temporary mechanism to assist in the migration from IPv4 to IPv6. Over the years, there have been several types of NAT for IPv6 including Network Address Translation-Protocol Translation (NAT-PT). NAT-PT has been deprecated by IETF in favor of its replacement, NAT64. NAT64 is beyond the scope of this curriculum.</p>
<p>The image shows three clouds. Two are labeled ipv6 and one is labeled ipv4. The packets traveling between the two ipv6 networks are native ipv6 packets. The packets traveling between the ipv4 and ipv6 are translated.</p>
</div>
<div class="section" id="troubleshooting-nat">
<h4>Troubleshooting NAT<a class="headerlink" href="#troubleshooting-nat" title="Permalink to this headline">¶</a></h4>
<p>The show ip nat Commands</p>
<p>Figure 1 shows R2 enabled for PAT, using the range of addresses 209.165.200.226 to 209.165.200.240.</p>
<p>When there are IPv4 connectivity problems in a NAT environment, it is often difficult to determine the cause of the problem. The first step in solving the problem is to rule out NAT as the cause. Follow these steps to verify that NAT is operating as expected:</p>
<p>Step 1. Based on the configuration, clearly define what NAT is supposed to achieve. This may reveal a problem with the configuration.</p>
<p>Step 2. Verify that correct translations exist in the translation table using the show ip nat translations command.</p>
<p>Step 3. Use the clear and debug commands to verify that NAT is operating as expected. Check to see if dynamic entries are recreated after they are cleared.</p>
<p>Step 4. Review in detail what is happening to the packet, and verify that routers have the correct routing information to move the packet.</p>
<p><code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code> and <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">translations</span></code> commands. Prior to using the show commands, the NAT statistics and entries in the NAT table are cleared with the <code class="docutils literal"><span class="pre">clear</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code> and <code class="docutils literal"><span class="pre">clear</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">translation</span> <span class="pre">*</span></code> commands. After the host at 192.168.10.10 telnets to the server at 209.165.201.1, the NAT statistics and NAT table are displayed to verify NAT is working as expected.</p>
<p>In a simple network environment, it is useful to monitor NAT statistics with the show ip nat statistics command. The show ip nat statistics command displays information about the total number of active translations, NAT configuration parameters, the number of addresses in the pool, and the number that have been allocated. However, in a more complex NAT environment, with several translations taking place, this command may not clearly identify the issue. It may be necessary to run <code class="docutils literal"><span class="pre">debug</span></code> commands on the router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1"># debug ip nat</span>
<span class="n">R2</span><span class="c1"># debug ip nat detailed</span>
</pre></div>
</div>
<p>When decoding the debug output, note what the following symbols and values indicate:</p>
<blockquote>
<div><ul class="simple">
<li>(asterisk) - The asterisk next to NAT indicates that the translation is occurring in the fast-switched path. The first packet in a conversation is always process-switched, which is slower. The remaining packets go through the fast-switched path if a cache entry exists.</li>
</ul>
<p>s= - This symbol refers to the source IPv4 address.</p>
<p>a.b.c.d—&gt;w.x.y.z - This value indicates that source address a.b.c.d is translated to w.x.y.z.</p>
<p>d= - This symbol refers to the destination IPv4 address.</p>
<p>[xxxx] - The value in brackets is the IPv4 identification number. This information may be useful for debugging in that it enables correlation with other packet traces from protocol analyzers.</p>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Verify that the ACL referenced in the NAT command is permitting all of the necessary networks. E.g., only 192.168.0.0/16 addresses are eligible to be translated. Packets from the inside network destined for the Internet with source addresses that are not explicitly permitted by ACL 1 are not translated by R2.</p>
</div>
<img alt="nw/_static/img/Ch9_NAT_troubleshooting_scenario1.png" src="nw/_static/img/Ch9_NAT_troubleshooting_scenario1.png" />
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1"># show ip nat translations</span>
<span class="n">R2</span><span class="c1">#</span>
<span class="n">R2</span><span class="c1"># show ip nat statistics</span>
<span class="n">Total</span> <span class="n">active</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">0</span> <span class="n">dynamic</span><span class="p">;</span> <span class="mi">0</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Peak</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Outside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Inside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">0</span> <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>

<span class="n">R2</span><span class="c1">#conf t</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface serial 0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no ip nat outside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface serial 0/0/1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1"># show access-lists</span>
<span class="n">Standard</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="mi">1</span>
    <span class="mi">10</span> <span class="n">permit</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">wildcard</span> <span class="n">bits</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
<span class="n">R2</span><span class="c1">#</span>

<span class="n">R2</span><span class="c1">#conf t</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no access-list 1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># access-list 1 permit 192.168.0.0 0.0.255.255</span>
</pre></div>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1"># show ip nat statistics</span>
<span class="n">Total</span> <span class="n">active</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">1</span> <span class="n">dynamic</span><span class="p">;</span> <span class="mi">1</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Peak</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">occurred</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">19</span> <span class="n">ago</span>
<span class="n">Outside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Inside</span> <span class="n">interfaces</span><span class="p">:</span>
  <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">20</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">CEF</span> <span class="n">Translated</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="n">CEF</span> <span class="n">Punted</span> <span class="n">packets</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="p">[</span><span class="n">Id</span><span class="p">:</span> <span class="mi">5</span><span class="p">]</span> <span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">1</span> <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL2</span> <span class="n">refcount</span> <span class="n">r1</span>
 <span class="n">pool</span> <span class="n">NAT</span><span class="o">-</span><span class="n">POOL2</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.224</span>
<span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.226</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.240</span>
<span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">15</span><span class="p">,</span> <span class="n">allocated</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">6</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>

<span class="n">R2</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>         <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.226</span><span class="p">:</span><span class="mi">38</span>   <span class="mf">192.168</span><span class="o">.</span><span class="mf">10.10</span><span class="p">:</span><span class="mi">38</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.1</span><span class="p">:</span><span class="mi">38</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">201.1</span><span class="p">:</span><span class="mi">38</span>
<span class="n">R2</span><span class="c1">#</span>
</pre></div>
</div>
</div>
<div class="section" id="pt-troubleshooting-nat-ex1">
<h4>PT Troubleshooting NAT ex1<a class="headerlink" href="#pt-troubleshooting-nat-ex1" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_pt_troubleshooting_NAT_ex1.png" src="nw/_static/img/Ch9_pt_troubleshooting_NAT_ex1.png" />
<div class="section" id="addressing-table-ex1">
<h5>Addressing Table ex1<a class="headerlink" href="#addressing-table-ex1" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="16%" />
<col width="23%" />
<col width="24%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R1</td>
<td>G0/0</td>
<td>10.4.10.254</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/1</td>
<td>10.4.11.254</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/1</td>
<td>10.4.1.2</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>R2</td>
<td>S0/0/0</td>
<td>209.165.76.194</td>
<td>255.255.255.224</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/1</td>
<td>10.4.1.1</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>Server1</td>
<td>NIC</td>
<td>64.100.201.5</td>
<td>255.255.255.0</td>
<td>64.100.201.1</td>
</tr>
<tr class="row-even"><td>PC1</td>
<td>NIC</td>
<td>10.4.10.1</td>
<td>255.255.255.0</td>
<td>10.4.10.254</td>
</tr>
<tr class="row-odd"><td>PC2</td>
<td>NIC</td>
<td>10.4.10.2</td>
<td>255.255.255.0</td>
<td>10.4.10.254</td>
</tr>
<tr class="row-even"><td>L1</td>
<td>NIC</td>
<td>10.4.11.1</td>
<td>255.255.255.0</td>
<td>10.4.11.254</td>
</tr>
<tr class="row-odd"><td>L2</td>
<td>NIC</td>
<td>10.4.11.2</td>
<td>255.255.255.0</td>
<td>10.4.11.254</td>
</tr>
</tbody>
</table>
<p>Objectives</p>
<p>Part 1: Isolate Problems</p>
<p>Part 2: Troubleshoot NAT Configuration</p>
<p>Part 3: Verify Connectivity</p>
<p>Scenario</p>
<p>A contractor restored an old configuration to a new router running NAT. But, the network has changed and a new subnet was added after the old configuration was backed up. It is your job to get the network working again.</p>
<p>Ping Server1 from PC1, PC2, L1, L2, and R2.
Record the success of each ping. Ping any other machines as needed.</p>
<dl class="docutils">
<dt>Pinging 64.100.201.5 with 32 bytes of data:</dt>
<dd><dl class="first last docutils">
<dt>from pc1</dt>
<dd>Packets: Sent = 4, Received = 0, Lost = 4 (100% loss)</dd>
<dt>from pc2</dt>
<dd>Packets: Sent = 4, Received = 0, Lost = 4 (100% loss)</dd>
<dt>from L1</dt>
<dd>Packets: Sent = 4, Received = 0, Lost = 4 (100% loss)</dd>
<dt>from L2</dt>
<dd>Packets: Sent = 4, Received = 0, Lost = 4 (100% loss)</dd>
<dt>from R2</dt>
<dd><div class="code first last highlight-default"><div class="highlight"><pre><span></span>R2#ping 64.100.201.5
Sending 5, 100-byte ICMP Echos to 64.100.201.5, timeout is 2 seconds
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 1/2/5 ms
</pre></div>
</div>
</dd>
</dl>
</dd>
</dl>
</div>
<div class="section" id="pt-troubleshoot-nat-configuration">
<h5>PT Troubleshoot NAT Configuration<a class="headerlink" href="#pt-troubleshoot-nat-configuration" title="Permalink to this headline">¶</a></h5>
<ol class="arabic">
<li><p class="first">View the NAT translations on R2. If NAT is working, there should be table entries.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1">#show ip nat translation</span>
<span class="n">R2</span><span class="c1">#show ip nat statistics</span>
<span class="n">Total</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">0</span> <span class="n">static</span><span class="p">,</span> <span class="mi">0</span> <span class="n">dynamic</span><span class="p">,</span> <span class="mi">0</span> <span class="n">extended</span><span class="p">)</span>
<span class="n">Outside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Inside</span> <span class="n">Interfaces</span><span class="p">:</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Hits</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Misses</span><span class="p">:</span> <span class="mi">16</span>
<span class="n">Expired</span> <span class="n">translations</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Dynamic</span> <span class="n">mappings</span><span class="p">:</span>
<span class="o">--</span> <span class="n">Inside</span> <span class="n">Source</span>
<span class="n">access</span><span class="o">-</span><span class="nb">list</span> <span class="mi">101</span> <span class="n">pool</span> <span class="n">R2POOL</span> <span class="n">refCount</span> <span class="mi">0</span>
 <span class="n">pool</span> <span class="n">R2POOL</span><span class="p">:</span> <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.224</span>
       <span class="n">start</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="n">end</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.223</span>
       <span class="nb">type</span> <span class="n">generic</span><span class="p">,</span> <span class="n">total</span> <span class="n">addresses</span> <span class="mi">29</span> <span class="p">,</span> <span class="n">allocated</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">0</span><span class="o">%</span><span class="p">),</span> <span class="n">misses</span> <span class="mi">0</span>

<span class="n">so</span> <span class="n">the</span> <span class="n">statistics</span> <span class="n">tell</span> <span class="n">us</span> <span class="n">that</span> <span class="n">there</span> <span class="n">were</span> <span class="mi">16</span> <span class="n">misses</span> <span class="n">on</span> <span class="n">the</span> <span class="n">inside</span> <span class="n">interface</span> <span class="n">Serial</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Indeed</span> <span class="n">we</span> <span class="n">deed</span> <span class="n">pings</span> <span class="kn">from</span> <span class="mi">4</span> <span class="n">locations</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">network</span> <span class="n">to</span> <span class="n">this</span> <span class="n">interface</span> <span class="n">towards</span> <span class="n">server1</span> <span class="n">this</span> <span class="n">makes</span> <span class="n">sense</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p class="first">Show the running configuration of R2. The NAT inside port should align with the private address, while the NAT outside port should align with the public address.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>!
interface Serial0/0/0
 ip address 209.165.76.194 255.255.255.224
 ip nat inside
 clock rate 2000000
!
interface Serial0/0/1
 ip address 10.4.1.1 255.255.255.252
 ip nat outside
 clock rate 2000000
!
ip nat pool R2POOL 209.165.76.195 209.165.76.223 netmask 255.255.255.224
ip nat inside source list 101 pool R2POOL
!
ip route 10.0.0.0 255.0.0.0 10.4.1.2
ip route 0.0.0.0 0.0.0.0 209.165.76.193
!
access-list 101 permit ip 10.4.10.0 0.0.0.255 any
!
</pre></div>
</div>
<p>Inside and outside are incorrectly configured, got it backwards here</p>
</li>
<li><p class="first">Correct the Interfaces. Assign the ip nat inside and ip nat outside commands to the correct ports.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">nat</span> <span class="n">debugging</span> <span class="ow">is</span> <span class="n">on</span>

<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface Serial 0/0/1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#no ip nat outside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="n">ip_ifnat_modified</span><span class="p">:</span> <span class="n">old_if</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_if</span> <span class="mi">2</span>

<span class="n">ip</span> <span class="n">nat</span> <span class="n">inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="n">ip_ifnat_modified</span><span class="p">:</span> <span class="n">old_if</span> <span class="mi">2</span><span class="p">,</span> <span class="n">new_if</span> <span class="mi">0</span>

<span class="n">now</span> <span class="n">configure</span> <span class="n">serial</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span> <span class="k">as</span> <span class="n">outside</span> <span class="n">nat</span> <span class="k">if</span>
<span class="o">--------------------------------------------</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#interface Serial 0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#no ip nat insid</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#no ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="n">ip_ifnat_modified</span><span class="p">:</span> <span class="n">old_if</span> <span class="mi">0</span><span class="p">,</span> <span class="n">new_if</span> <span class="mi">2</span>

<span class="n">ip</span> <span class="n">nat</span> <span class="n">outside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="n">ip_ifnat_modified</span><span class="p">:</span> <span class="n">old_if</span> <span class="mi">2</span><span class="p">,</span> <span class="n">new_if</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p class="first">Ping Server1 from PC1, PC2, L1, L2, and R2. Record the success of each ping. Ping any other machines as needed.</p>
<dl class="docutils">
<dt>from L1 and L2</dt>
<dd><p class="first last">same as before, ping unsuccessful and increasing the miss counter in ip nat statistics</p>
</dd>
<dt>from PC1 is successful</dt>
<dd><p class="first">see NAT translations working and later expiring via debug ip nat after the ping from PC1 (ip 10.4.10.1)</p>
<div class="code last highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">33</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">34</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">7</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">35</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">36</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">5</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">6</span> <span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">7</span> <span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">8</span> <span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>View the NAT translations on R2. If NAT is working, there should be table entries.</dt>
<dd><p class="first">Well NAT is not working properly yet as only nodes on the 10.4.10.0/24 network are being translated
the 10.4.11.0/24 ain’t getting any..</p>
<div class="code last highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1">#show ip nat translations</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">10</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">10</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">10</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">10</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">11</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">11</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">11</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">11</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">12</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">12</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">12</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">12</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">9</span>  <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">9</span>        <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">9</span>     <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">9</span>
<span class="n">R2</span><span class="c1">#</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">9</span> <span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">11</span> <span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">12</span> <span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p class="first">Show Access-list 101 on R2. The wildcard mask should encompass both the 10.4.10.0 network and the 10.4.11.0 network.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1">#show ip access-list</span>
<span class="n">Extended</span> <span class="n">IP</span> <span class="n">access</span> <span class="nb">list</span> <span class="mi">101</span>
    <span class="mi">10</span> <span class="n">permit</span> <span class="n">ip</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span> <span class="nb">any</span> <span class="p">(</span><span class="mi">16</span> <span class="n">match</span><span class="p">(</span><span class="n">es</span><span class="p">))</span>
</pre></div>
</div>
<p>obviously the 11 isn’t included.. lets fix this</p>
</li>
<li><p class="first">Correct the Access-list. Delete access-list 101 and replace it with a similar list that is also one statement in length. The only difference should be the wildcard.</p>
<p>to include the 11 we will need to change the third octet of the wildcard..
so to include 11 would be like changing the subnet from 24 to 23 which means 2^23 network bits and 2^9 host bits = 510 nodes
so  255.255.255.255
| - 255.255.254.0 (/23 instead of /24)
| =   0.  0.  1.255</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no access-list 101 permit ip 10.4.10.0 0.0.0.255 any</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#access-list 101 permit ip 10.4.10.0 0.0.1.255 any</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="pt-verify-connectivity">
<h5>PT Verify Connectivity<a class="headerlink" href="#pt-verify-connectivity" title="Permalink to this headline">¶</a></h5>
<ol class="arabic">
<li><p class="first">Verify connectivity to Server1. Record the success of each ping. All hosts should be able to ping Server1, R1, and R2. Troubleshoot if the pings are not successful.
sure enough pings are working now</p>
</li>
<li><p class="first">View the NAT translations on R2. NAT should display many table entries.
launch a ping from a node in each network and check nat translations with debugging on for bonus kudos</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="o">&gt;</span><span class="n">en</span>
<span class="n">R2</span><span class="c1">#show ip nat translation</span>
<span class="n">R2</span><span class="c1">#</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">29</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span> <span class="p">[</span><span class="mi">49</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">30</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span> <span class="p">[</span><span class="mi">50</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">31</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span> <span class="p">[</span><span class="mi">51</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">32</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span> <span class="p">[</span><span class="mi">52</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">13</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">53</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">14</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">54</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">15</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">55</span><span class="p">]</span>

<span class="n">NAT</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="o">-&gt;</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span> <span class="p">[</span><span class="mi">16</span><span class="p">]</span>
<span class="n">NAT</span><span class="o">*</span><span class="p">:</span> <span class="n">s</span><span class="o">=</span><span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="o">-&gt;</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span> <span class="p">[</span><span class="mi">56</span><span class="p">]</span>
<span class="n">show</span> <span class="n">ip</span> <span class="n">nat</span> <span class="n">translation</span>
<span class="n">Pro</span>  <span class="n">Inside</span> <span class="k">global</span>     <span class="n">Inside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="n">local</span>      <span class="n">Outside</span> <span class="k">global</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">29</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">29</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">29</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">29</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">30</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">30</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">30</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">30</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">31</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">31</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">31</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">31</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span><span class="p">:</span><span class="mi">32</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">32</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">32</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">32</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">:</span><span class="mi">13</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">13</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">13</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">13</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">:</span><span class="mi">14</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">14</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">14</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">14</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">:</span><span class="mi">15</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">15</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">15</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">15</span>
<span class="n">icmp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span><span class="p">:</span><span class="mi">16</span> <span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">:</span><span class="mi">16</span>       <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">16</span>    <span class="mf">64.100</span><span class="o">.</span><span class="mf">201.5</span><span class="p">:</span><span class="mi">16</span>

<span class="n">R2</span><span class="c1">#</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">29</span> <span class="p">(</span><span class="mi">29</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">30</span> <span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">31</span> <span class="p">(</span><span class="mi">31</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.195</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">11.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">32</span> <span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">13</span> <span class="p">(</span><span class="mi">13</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">14</span> <span class="p">(</span><span class="mi">14</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">15</span> <span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">NAT</span><span class="p">:</span> <span class="n">expiring</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">76.196</span> <span class="p">(</span><span class="mf">10.4</span><span class="o">.</span><span class="mf">10.1</span><span class="p">)</span> <span class="n">icmp</span> <span class="mi">16</span> <span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="lab-troubleshooting-nat">
<h4>LAB Troubleshooting NAT<a class="headerlink" href="#lab-troubleshooting-nat" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch9_lab_troubleshooting_NAT.png" src="nw/_static/img/Ch9_lab_troubleshooting_NAT.png" />
<div class="section" id="pt-addressing-table">
<h5>PT Addressing Table<a class="headerlink" href="#pt-addressing-table" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="19%" />
<col width="23%" />
<col width="23%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Gateway</td>
<td>G0/1</td>
<td>192.168.1.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>209.165.200.225</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>ISP</td>
<td>S0/0/0 (DCE)</td>
<td>209.165.200.226</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Lo0</td>
<td>198.133.219.1</td>
<td>255.255.255.255</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>PC-A</td>
<td>NIC</td>
<td>192.168.1.3</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
<tr class="row-odd"><td>PC-B</td>
<td>NIC</td>
<td>192.168.1.4</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
</tbody>
</table>
<p>Objectives
Part 1: Build the Network and Configure Basic Device Settings
Part 2: Troubleshoot Static NAT
Part 3: Troubleshoot Dynamic NAT</p>
<p>Background / Scenario
In this lab, the Gateway router was configured by an inexperienced network administrator at your company.  Several errors in the configuration have resulted in NAT issues. Your boss has asked you to troubleshoot and correct the NAT errors and document your work. Ensure that the network supports the following:</p>
<blockquote>
<div><ul class="simple">
<li>PC-A acts as a web server with a static NAT and will be reachable from the outside using the 209.165.200.254 address.</li>
<li>PC-B acts as a host computer and dynamically receives an IP address from the created pool of addresses called NAT_POOL, which uses the 209.165.200.240/29 range.</li>
</ul>
</div></blockquote>
<p>Copy the following basic configuration and paste it to the running-configuration on the router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">no</span> <span class="n">ip</span> <span class="n">domain</span><span class="o">-</span><span class="n">lookup</span>
<span class="n">service</span> <span class="n">password</span><span class="o">-</span><span class="n">encryption</span>
<span class="n">enable</span> <span class="n">secret</span> <span class="k">class</span>
<span class="nc">banner</span> <span class="n">motd</span> <span class="c1">#</span>
<span class="n">Unauthorized</span> <span class="n">access</span> <span class="ow">is</span> <span class="n">strictly</span> <span class="n">prohibited</span><span class="o">.</span> <span class="c1">#</span>
<span class="n">line</span> <span class="n">con</span> <span class="mi">0</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
<span class="n">logging</span> <span class="n">synchronous</span>
<span class="n">line</span> <span class="n">vty</span> <span class="mi">0</span> <span class="mi">4</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-static-routing">
<h5>Configure Static Routing<a class="headerlink" href="#configure-static-routing" title="Permalink to this headline">¶</a></h5>
<ol class="loweralpha">
<li><p class="first">Create a static route from the ISP router to the Gateway router which was assigned public network address range 209.165.200.224/27.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ISP</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 209.165.200.224 255.255.255.224 s0/0/0</span>
</pre></div>
</div>
</li>
<li><p class="first">Create a default route from the Gateway router to the ISP router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip route 0.0.0.0 0.0.0.0 s0/0/1</span>
</pre></div>
</div>
</li>
</ol>
<p>provided faulty configurations:</p>
<p>Gateway Router Configuration</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>interface
g0/1
 ip nat outside
no shutdown
interface
s0/0/0
 ip nat outside
interface
s0/0/1
no shutdown
ip nat inside source static 192.168.2.3
209.165.200.254
ip nat pool NAT_POOL
209.165.200.241 209.165.200.246
netmask 255.255.255.248
ip nat inside source list NAT_ACL pool NATPOOL
ip access-
list standard NAT_ACL
 permit 192.168
.10.0 0.0.0.255
banner motd $AUTHORIZED ACCESS ONLY$
end
</pre></div>
</div>
</div>
<div class="section" id="troubleshoot-static-nat">
<h5>Troubleshoot Static NAT<a class="headerlink" href="#troubleshoot-static-nat" title="Permalink to this headline">¶</a></h5>
<p>examine the static NAT for PC-A to determine if it is configured correctly. You will troubleshoot the scenario until the correct static NAT is verified.</p>
<ol class="loweralpha">
<li><p class="first">To troubleshoot issues with NAT, use the <code class="docutils literal"><span class="pre">debug</span> <span class="pre">ip</span> <span class="pre">nat</span></code> command. Turn on NAT debugging to see translations in real-time across the Gateway router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Gateway</span><span class="c1"># debug ip nat</span>
</pre></div>
</div>
</li>
<li><p class="first">From PC-A, ping Lo0 on the ISP router. Do any NAT debug translations appear on the Gateway router?</p>
</li>
<li><p class="first">On the Gateway router, enter the command that allows you to see all current NAT translations on the Gateway router. Write the command in the space below.
Why are you seeing a NAT translation in the table, but none occurred when PC-A pinged the ISP loopback interface? What is needed to correct the issue?</p>
</li>
<li><p class="first">Record any commands that are necessary to correct the static NAT configuration error</p>
</li>
<li><p class="first">From PC-A, ping Lo0 on the ISP router. Do any NAT debug translations appear on the Gateway router?</p>
</li>
<li><p class="first">On the Gateway router, enter the command that allows you to observe the total number of current NATs.</p>
<p>Write the command in the space below. Is the static NAT occurring successfully? Why?</p>
</li>
<li><p class="first">On the Gateway router, enter the command that allows you to view the current configuration of the router. Write the command in the space below.</p>
</li>
<li><p class="first">Are there any problems with the current configuration that prevent the static NAT from occurring?</p>
</li>
<li><p class="first">Record any commands that are necessary to correct the static NAT configuration errors.</p>
</li>
<li><p class="first">From PC-A, ping Lo0 on the ISP router. Do any NAT debug translations appear on the Gateway router?</p>
</li>
<li><p class="first">Use the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">translations</span> <span class="pre">verbose</span></code> command to verify static NAT functionality.</p>
</li>
</ol>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The timeout value for ICMP is very short. If you do not see all the translations in the output, redo the ping.</p>
</div>
<p>Is the static NAT translation occurring successfully?
If static NAT is not occurring, repeat the steps above to troubleshoot the configuration.</p>
</div></blockquote>
</div>
<div class="section" id="troubleshoot-dynamic-nat">
<h5>Troubleshoot Dynamic NAT<a class="headerlink" href="#troubleshoot-dynamic-nat" title="Permalink to this headline">¶</a></h5>
<ol class="loweralpha">
<li><p class="first">From PC-B, ping Lo0 on the ISP router. Do any NAT debug translations appear on the Gateway router?</p>
</li>
<li><p class="first">On the Gateway router, enter the command that allows you to view the current configuration of the router. Are there any problems with the current configuration that prevent dynamic NAT from occurring?</p>
</li>
<li><p class="first">Record any commands that are necessary to correct the dynamic NAT configuration errors.</p>
</li>
<li><p class="first">From PC-B, ping Lo0 on the ISP router. Do any NAT debug translations appear on the Gateway router?</p>
</li>
<li><p class="first">Use the <code class="docutils literal"><span class="pre">show</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">statistics</span></code> to view NAT usage.</p>
<p>Is the NAT occurring successfully?
What percentage of dynamic addresses has been allocated?</p>
</li>
<li><p class="first">Turn off all debugging using the <code class="docutils literal"><span class="pre">undebug</span> <span class="pre">all</span></code> command.</p>
</li>
</ol>
<p>Reflection</p>
<ol class="arabic simple">
<li>What is the benefit of a static NAT?</li>
<li>What issues would arise if 10 host computers in this network were attempting simultaneous Internet communication?</li>
</ol>
</div>
</div>
<div class="section" id="ch9-skills-integration-test-assignment">
<h4>Ch9 Skills Integration Test - assignment<a class="headerlink" href="#ch9-skills-integration-test-assignment" title="Permalink to this headline">¶</a></h4>
<p>Topology Assigned</p>
<img alt="nw/_static/img/Ch9_skills_integration_test_assignment.png" src="nw/_static/img/Ch9_skills_integration_test_assignment.png" />
<p>Addressing Table Assigned</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="16%" />
<col width="22%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#160;</td>
<td>G0/0.15</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0.30</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/0.45</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0.60</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/1/0</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/0</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/0</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/1</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>VLAN 60</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>NIC</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
</tr>
</tbody>
</table>
<p>VLANs and Port Assignments Table Given</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="37%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">VLAN Number - Name</th>
<th class="head">Port assignment</th>
<th class="head">Network</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>15- Servers</td>
<td>F0/11 - F0/20</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>30- PCs</td>
<td>F0/1 - F0/10</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>45- Native</td>
<td>G0/1</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>60 - Management</td>
<td>VLAN 60</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>complete the documentation for the network</li>
<li>configure VLANS, Trunking, port security and SSH remote access on a switch</li>
<li>implement inter-VLAN routing and NAT on a router</li>
<li>Use your documentation to verify implementation &amp; test end2end connectivity</li>
</ul>
<ol class="arabic simple">
<li>Label All the device names, network addresses and other important information</li>
<li>Complete the <strong>Addressing Table</strong> and <strong>VLANS &amp; Port assignment Table</strong></li>
<li>Fill in any blanks in the implementation and verification steps. The information is supplied when
you launch the Packet Tracer activity.</li>
</ol>
<div class="section" id="implementation-given">
<h5>Implementation Given<a class="headerlink" href="#implementation-given" title="Permalink to this headline">¶</a></h5>
<p>Note: All devices in the topology except , , and    are fully configured. You do not have access to the other routers. You can access all the servers and PCs for testing purposes.</p>
<p>Implement to following requirements using your documentation:
• Configure remote management access including IP addressing and SSH:</p>
<blockquote>
<div><ul class="simple">
<li>Domain is cisco.com</li>
<li>User     with password</li>
<li>Crypto key length of 1024</li>
<li>SSH version 2, limited to 2 authentication attempts and a 60 second timeout</li>
<li>Clear text passwords should be encrypted.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Configure, name and assign VLANs. Ports should be manually configured as access ports.</li>
<li>Configure trunking.</li>
<li>Implement port security:<ul>
<li>On Fa0/1, allow 2 MAC addresses that are automatically added to the configuration file when detected. The port should not be disabled, but a syslog message should be captured if a violation occurs.</li>
<li>Disable all other unused ports.</li>
</ul>
</li>
<li>Configure inter-VLAN routing.</li>
<li>Configure DHCP services for VLAN 30. Use <strong>LAN</strong> as the case-sensitive name for the pool.</li>
<li>Implement routing:</li>
</ul>
<ul class="simple">
<li>Use RIPv2 as the routing protocol.</li>
<li>Configure one network statement for the entire address space.</li>
<li>Disable interfaces that should not send RIPv2 messages.</li>
<li>Configure a default route to the Internet.</li>
</ul>
<ul class="simple">
<li>Implement NAT:<ul>
<li>Configure a standard, one statement ACL number 1. All IP addresses belonging to the addr ess space are allowed.</li>
<li>Refer to your documentation and configure static NAT for the File Server.</li>
<li>Configure dynamic NAT with PAT using a pool name of your choice, a /30 mask, and these two public addresses:</li>
</ul>
</li>
</ul>
<p>Verify       has received full addressing information from       .</p>
</div>
<div class="section" id="verification-given">
<h5>Verification Given<a class="headerlink" href="#verification-given" title="Permalink to this headline">¶</a></h5>
<p>All devices should now be able to ping all other devices. If not, troubleshoot your configurations to isolate and solve problems. A few tests include:
• Verify remote access to       by using SSH from a PC.
• Verify VLANs are assigned to appropriate ports and port security is in force.
• Verify OSPF neighbors and a complete routing table.
• Verify NAT translations and statics.</p>
<blockquote>
<div><ul class="simple">
<li><strong>Outside Host</strong> should be able to access <strong>File Server</strong> at the public address.</li>
<li>Inside PCs should be able to access <strong>Web Server</strong>.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Document any problems you encountered and the solutions in the <strong>Troubleshooting Documentation</strong> table below.</li>
</ul>
<p>Troubleshooting Documentation</p>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">________Problem________</th>
<th class="head">________Solution________</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>Packet Tracer scores 70 points.  Documentation is worth 30 points.</p>
</div>
</div>
<div class="section" id="ch9-skills-integration-test-when-opened-with-pt-7-0-on-windos">
<h4>Ch9 Skills Integration Test - when opened with PT 7.0 on windos<a class="headerlink" href="#ch9-skills-integration-test-when-opened-with-pt-7-0-on-windos" title="Permalink to this headline">¶</a></h4>
<p>Topology Solved</p>
<img alt="nw/_static/img/Ch9_Skills_integration_test.png" src="nw/_static/img/Ch9_Skills_integration_test.png" />
<p>???????why are ips present here and not in PDF ????????</p>
<p>Addressing Table Solved</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="16%" />
<col width="23%" />
<col width="24%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Central</td>
<td>G0/0.15</td>
<td>172.16.15.17</td>
<td>255.255.255.240</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0.30</td>
<td>172.16.15.33</td>
<td>255.255.255.224</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/0.45</td>
<td>172.16.15.1</td>
<td>255.255.255.248</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0.60</td>
<td>172.16.15.9</td>
<td>255.255.255.248</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0</td>
<td>172.16.15.245</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>172.16.15.254</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/1/0</td>
<td>192.135.250.18</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>East</td>
<td>G0/0</td>
<td>172.16.15.65</td>
<td>255.255.255.192</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0</td>
<td>172.16.15.249</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>172.16.15.246</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>West</td>
<td>G0/0</td>
<td>172.16.15.129</td>
<td>255.255.255.192</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/0</td>
<td>172.16.15.253</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/1</td>
<td>172.16.15.250</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>Cnt-Sw</td>
<td>VLAN 60</td>
<td>172.16.15.10</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>NIC</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
</tr>
</tbody>
</table>
<p>VLANs and Port Assignments Table Solved</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="31%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">VLAN Number - Name</th>
<th class="head">Port assignment</th>
<th class="head">Network</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>15 - Servers</td>
<td>F0/11 - F0/20</td>
<td>172.16.15.16 /28</td>
</tr>
<tr class="row-odd"><td>30 - PCs</td>
<td>F0/1 - F0/10</td>
<td>172.16.15.32 /27</td>
</tr>
<tr class="row-even"><td>45 - Native</td>
<td>G0/1</td>
<td>172.16.15.0  /29</td>
</tr>
<tr class="row-odd"><td>60 - Management</td>
<td>VLAN 60</td>
<td>172.16.15.8  /29</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>complete the documentation for the network</li>
<li>configure VLANS, Trunking, port security and SSH remote access on a switch</li>
<li>implement inter-VLAN routing and NAT on a router</li>
<li>Use your documentation to verify implementation &amp; test end2end connectivity</li>
</ul>
<ol class="arabic simple">
<li>Label All the device names, network addresses and other important information</li>
<li>Complete the <strong>Addressing Table</strong> and <strong>VLANS &amp; Port assignment Table</strong></li>
<li>Fill in any blanks in the implementation and verification steps. The information is supplied when
you launch the Packet Tracer activity.</li>
</ol>
<div class="section" id="implementation-completed">
<h5>Implementation completed<a class="headerlink" href="#implementation-completed" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All devices in the topology except Central, Cnt-Sw, and NetAdmin are fully configured. You do not have access to the other routers. You can access all the servers and PCs for testing purposes.</p>
</div>
<p>Implement to following requirements using your documentation:</p>
<p>Cnt-Sw</p>
<ul class="simple">
<li>Configure remote management access including IP addressing and SSH:<ul>
<li>Domain is cisco.com</li>
<li>User HQadmin with password ciscoclass</li>
<li>Crypto key length of 1024</li>
<li>SSH version 2, limited to 2 authentication attempts and a 60 second timeout</li>
<li>Clear text passwords should be encrypted.</li>
</ul>
</li>
<li>Configure, name and assign VLANs. Ports should be manually configured as access ports.</li>
<li>Configure trunking.</li>
<li>Implement port security:<ul>
<li>On Fa0/1, allow 2 MAC addresses that are automatically added to the configuration file when detected. The port should not be disabled, but a syslog message should be captured if a violation occurs.</li>
<li>Disable all other unused ports.</li>
</ul>
</li>
</ul>
<p>Central</p>
<ul>
<li><p class="first">Configure inter-VLAN routing.</p>
</li>
<li><p class="first">Configure DHCP services for VLAN 30. Use <strong>LAN</strong> as the case-sensitive name for the pool.</p>
</li>
<li><p class="first">Implement routing:</p>
<ul class="simple">
<li>Use OSPF Process ID 1 and router ID 1.1.1.1 ?????? why was RIPv2 asked in PDF??????</li>
<li>Configure one network statement for the entire 172.16.15.0/24 address space.</li>
<li>Disable interfaces that should not send RIPv2 messages.</li>
<li>Configure a default route to the Internet.</li>
</ul>
<ul class="simple">
<li>Implement NAT:<ul>
<li>Configure a standard, one statement ACL number 1. All IP addresses belonging to thei 172.16.15.0/24 address space are allowed.</li>
<li>Refer to your documentation and configure static NAT for the File Server.</li>
<li>Configure dynamic NAT with PAT using a pool name of your choice, a /30 mask, and these two public addresses:
209.165.200.225 and 209.165.200.226</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>NetAdmin</p>
<ul class="simple">
<li>Verify NetAdmin has received full addressing information from Central.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the default vlan needs to be configured on the router subinterface <code class="docutils literal"><span class="pre">Central(config-subif)#encapsulation</span> <span class="pre">dot1Q</span> <span class="pre">45</span> <span class="pre">native</span></code></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ospf uses area 0 by default <code class="docutils literal"><span class="pre">Central(config-router)#network</span> <span class="pre">172.16.15.0</span> <span class="pre">0.0.0.255</span> <span class="pre">area</span> <span class="pre">0</span></code></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">don’t forget to apply the ACL. PT does not score this atm. <code class="docutils literal"><span class="pre">Central(config)#ip</span> <span class="pre">nat</span> <span class="pre">inside</span> <span class="pre">source</span> <span class="pre">list</span> <span class="pre">1</span> <span class="pre">pool</span> <span class="pre">NAT-OVERLOAD</span></code></p>
</div>
<p>running configs:</p>
<blockquote>
<div><div class="code highlight-default"><div class="highlight"><pre><span></span>Central(config-router)#do show run
Building configuration...

Current configuration : 2110 bytes
!
version 15.1
no service timestamps log datetime msec
no service timestamps debug datetime msec
no service password-encryption
!
hostname Central
!
no logging console
!
!
!
ip dhcp excluded-address 172.16.15.33
!
ip dhcp pool LAN
 network 172.16.15.32 255.255.255.224
 default-router 172.16.15.33
!
!
!
ip cef
no ipv6 cef
!
!
!
!
license udi pid CISCO1941/K9 sn FTX1524OT6M
!
!
!
!
!
!
!
!
!
!
!
spanning-tree mode pvst
!
!
!
!
interface GigabitEthernet0/0
 no ip address
 ip nat inside
 duplex auto
 speed auto
!
interface GigabitEthernet0/0.15
 description ros-vlan15
 encapsulation dot1Q 15
 ip address 172.16.15.17 255.255.255.240
 ip nat inside
!
interface GigabitEthernet0/0.30
 description ros-vlan30
 encapsulation dot1Q 30
 ip address 172.16.15.33 255.255.255.224
 ip nat inside
!
interface GigabitEthernet0/0.45
 description ros-vlan45-native
 encapsulation dot1Q 45 native
 ip address 172.16.15.1 255.255.255.248
 ip nat inside
!
interface GigabitEthernet0/0.60
 encapsulation dot1Q 60
 ip address 172.16.15.9 255.255.255.248
 ip nat inside
!
interface GigabitEthernet0/1
 no ip address
 duplex auto
 speed auto
 shutdown
!
interface Serial0/0/0
 ip address 172.16.15.245 255.255.255.252
 ip nat inside
 clock rate 2000000
!
interface Serial0/0/1
 ip address 172.16.15.254 255.255.255.252
 ip nat inside
!
interface Serial0/1/0
 description link2internet
 ip address 192.135.250.18 255.255.255.252
 ip nat outside
!
interface Serial0/1/1
 no ip address
 clock rate 2000000
 shutdown
!
interface Vlan1
 no ip address
 shutdown
!
interface Vlan45
 mac-address 0005.5e43.8601
 no ip address
!
router ospf 1
 router-id 1.1.1.1
 log-adjacency-changes
 passive-interface GigabitEthernet0/0
 network 172.16.15.0 0.0.0.255 area 0
!
ip nat pool NAT-OVERLOAD 209.165.200.225 209.165.200.226 netmask 255.255.255.252
ip nat inside source list 1 pool NAT-OVERLOAD
ip nat inside source static 172.16.15.18 209.165.200.227
ip classless
ip route 0.0.0.0 0.0.0.0 Serial0/1/0
!
ip flow-export version 9
!
!
access-list 1 permit 172.16.15.0 0.0.0.255
!
!
!
!
!
line con 0
 exec-timeout 0 0
!
line aux 0
!
line vty 0 4
 login
line vty 5 15
 login
!
!
!
end

switch
------
Cnt-Sw#show run
Building configuration...

Current configuration : 3361 bytes
!
version 12.2
no service timestamps log datetime msec
no service timestamps debug datetime msec
service password-encryption
!
hostname Cnt-Sw
!
!
!
ip ssh version 2
ip ssh authentication-retries 2
ip ssh time-out 60
ip domain-name cisco.com
!
username HQadmin privilege 1 password 7 0822455D0A16061B13181F
!
!
spanning-tree mode pvst
!
interface FastEthernet0/1
 description link2NetAdminVLAN30
 switchport access vlan 30
 switchport mode access
 switchport port-security
 switchport port-security maximum 2
 switchport port-security mac-address sticky
 switchport port-security violation restrict
 switchport port-security mac-address sticky 0001.C90E.8923
!
interface FastEthernet0/2
 switchport access vlan 30
 switchport mode access
 shutdown
!
interface FastEthernet0/3
 switchport access vlan 30
 switchport mode access
 shutdown
!
interface FastEthernet0/4
 switchport access vlan 30
 switchport mode access
 shutdown
!
interface FastEthernet0/5
 switchport access vlan 30
 switchport mode access
 shutdown
!
interface FastEthernet0/6
 switchport access vlan 30
 switchport mode access
 shutdown
!
interface FastEthernet0/7
 switchport access vlan 30
 switchport mode access
 shutdown
!
interface FastEthernet0/8
 switchport access vlan 30
 switchport mode access
 shutdown
!
interface FastEthernet0/9
 switchport access vlan 30
 switchport mode access
 shutdown
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="verification-solved">
<h5>Verification Solved<a class="headerlink" href="#verification-solved" title="Permalink to this headline">¶</a></h5>
<p>to be done 2morrow</p>
<p>All devices should now be able to ping all other devices. If not, troubleshoot your configurations to isolate and solve problems. A few tests include:
• Verify remote access to Cnt-Sw by using SSH from a PC.
• Verify VLANs are assigned to appropriate ports and port security is in force.
• Verify OSPF neighbors and a complete routing table.
• Verify NAT translations and statics.</p>
<blockquote>
<div><ul class="simple">
<li><strong>Outside Host</strong> should be able to access <strong>File Server</strong> at the public address.</li>
<li>Inside PCs should be able to access <strong>Web Server</strong>.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Document any problems you encountered and the solutions in the <strong>Troubleshooting Documentation</strong> table below.</li>
</ul>
</div>
</div>
<div class="section" id="ch9-practice-exam">
<h4>Ch9 practice exam<a class="headerlink" href="#ch9-practice-exam" title="Permalink to this headline">¶</a></h4>
<p>select transparent answer below every question</p>
<ol class="arabic">
<li><p class="first">Which method is used by a PAT-enabled router to send incoming packets to the correct inside hosts?</p>
<ul class="simple">
<li>It uses the destination TCP or UDP port number on the incoming packet</li>
<li>It uses the source IP address on the incoming packet</li>
<li>It uses the source TCP or UDP port number on the incoming packet</li>
<li>It uses a combination of the source TCP or UDP port number and the destination IP address on the incoming packet</li>
<li>Answer -&gt;:transparent:<cite>It uses the destination TCP or UDP port number on the incoming packet</cite></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. Which address or addresses represent the inside global address?</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source static 192.168.0.100 209.165.20.25</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface serial0/0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 10.1.1.2 255.255.255.0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface serial 0/0/2</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 209.165.20.25 255.255.255.0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat outside</span>
</pre></div>
</div>
<ul class="simple">
<li>10.1.1.2</li>
<li>any address in the 10.1.1.0 network</li>
<li>192.168.0.100</li>
<li>209.165.20.25</li>
<li>Answer -&gt; <a href="#id94"><span class="problematic" id="id95">:transparent:`209.165.20.25`</span></a></li>
</ul>
</li>
<li><p class="first">Fill in the blank. Don’t use abbreviations</p>
<ul class="simple">
<li>NAT overload is also known as <a href="#id96"><span class="problematic" id="id97">:transparent:`Port Address Translation`</span></a></li>
</ul>
</li>
<li><p class="first">A network administrator is configuring a static NAT on the border router for a web server located in the DMZ network. The web server is configured to listen on TCP port 8080. The web server is paired with the internal IP address of 192.168.5.25 and the external IP address of 209.165.200.230. For easy access by hosts on the Internet, external users do not need to specify the port when visiting the web server. Which command will configure the static NAT?</p>
<ul class="simple">
<li>R1(config)# ip nat inside source static tcp 192.168.5.25 80 209.165.200.230 8080</li>
<li>R1(config)# ip nat inside source static tcp 192.168.5.25 8080 209.165.200.230 80</li>
<li>R1(config)# ip nat inside source static tcp 209.165.200.230 80 192.168.5.25 8080</li>
<li>R1(config)# ip nat inside source static tcp 209.165.200.230 8080 192.168.5.25 80</li>
<li>Answer -&gt; <a href="#id98"><span class="problematic" id="id99">:transparent:`R1(config)# ip nat inside source static tcp 192.168.5.25 8080 209.165.200.230 80`</span></a></li>
</ul>
</li>
<li><p class="first">What is defined by the ip nat pool command when configuring dynamic NAT?</p>
<ul class="simple">
<li>the pool of available NAT servers</li>
<li>the range of external IP addresses that internal hosts are permitted to access</li>
<li>the range of internal IP addresses that are translated</li>
<li>the pool of global address*</li>
<li>Answer -&gt; <a href="#id100"><span class="problematic" id="id101">:transparent:`the pool of global address`</span></a></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. Based on the output that is shown, what type of NAT has been implemented?</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show ip nat translations</span>
<span class="n">Pro</span> <span class="n">Inside</span> <span class="k">global</span>         <span class="n">Inside</span> <span class="n">local</span>    <span class="n">Outside</span> <span class="n">local</span>       <span class="n">Outside</span> <span class="k">global</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">1405</span>  <span class="mf">10.6</span><span class="o">.</span><span class="mf">15.2</span><span class="p">:</span><span class="mi">1405</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.141</span><span class="p">:</span><span class="mi">80</span>  <span class="mf">209.165</span><span class="o">.</span><span class="mf">202.141</span><span class="p">:</span><span class="mi">80</span>
<span class="n">tcp</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.225</span><span class="p">:</span><span class="mi">1406</span>  <span class="mf">10.6</span><span class="o">.</span><span class="mf">15.1</span><span class="p">:</span><span class="mi">1406</span>  <span class="mf">198.51</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">80</span>     <span class="mf">198.51</span><span class="o">.</span><span class="mf">100.3</span><span class="p">:</span><span class="mi">80</span>
</pre></div>
</div>
<ul class="simple">
<li>dynamic NAT with a pool of two public IP addresses</li>
<li>PAT using an external interface</li>
<li>static NAT with one entry</li>
<li>static NAT with a NAT pool</li>
<li>Answer -&gt; <a href="#id102"><span class="problematic" id="id103">:transparent:`PAT using an external interface`</span></a></li>
</ul>
</li>
<li><p class="first">What is the primary purpose of NAT?</p>
<ul class="simple">
<li>conserve IPv4 addresses*</li>
<li>increase network security</li>
<li>allow peer-to-peer file sharing</li>
<li>enhance network performance</li>
<li>Answer -&gt; <a href="#id104"><span class="problematic" id="id105">:transparent:`conserve IPv4 addresses`</span></a></li>
</ul>
</li>
<li><p class="first">What is the major benefit of using NAT with Port Address Translation?</p>
<ul class="simple">
<li>It allows external hosts access to internal servers</li>
<li>It improves network performance for real-time protocols</li>
<li>It allows many internal hosts to share the same public IPv4 address</li>
<li>It provides a pool of public addresses that can be assigned to internal hosts.</li>
<li>Answer -&gt; <a href="#id106"><span class="problematic" id="id107">:transparent:`It allows many internal hosts to share the same public IPv4 address`</span></a></li>
</ul>
</li>
<li><p class="first">What is a characteristic of unique local addresses?</p>
<ul class="simple">
<li>They allow sites to be combined without creating any address conflicts</li>
<li>They are designed to improve the security of IPv6 networks</li>
<li>Their implementation depends on ISPs providing the service</li>
<li>They are defined in RFC 3927</li>
<li>Answer -&gt; <a href="#id108"><span class="problematic" id="id109">:transparent:`They allow sites to be combined without creating any address conflicts`</span></a></li>
</ul>
</li>
<li><p class="first">A network administrator configures the border router with the command <code class="docutils literal"><span class="pre">R1(config)#</span> <span class="pre">ip</span> <span class="pre">nat</span> <span class="pre">inside</span> <span class="pre">source</span> <span class="pre">list</span> <span class="pre">4</span> <span class="pre">pool</span> <span class="pre">corp</span></code>. What is required to be configured in order for this particular command to be functional?</p>
<ul class="simple">
<li>a NAT pool named corp that defines the starting and ending public IP addresses</li>
<li>an access list named corp that defines the private addresses that are affected by NAT</li>
<li>an access list numbered 4 that defines the starting and ending public IP addresses</li>
<li>ip nat outside to be enabled on the interface that connects to the LAN affected by the NAT</li>
<li>a VLAN named corp to be enabled and active and routed by R1</li>
<li>Answer -&gt; <a href="#id110"><span class="problematic" id="id111">:transparent:`a NAT pool named corp that defines the starting and ending public IP addresses`</span></a></li>
</ul>
</li>
<li><p class="first">Which statement describes IPv6 ULAs?</p>
<ul class="simple">
<li>They conserve IPv6 address space</li>
<li>They begin with the fe80::/10 prefix</li>
<li>They are assigned by an ISP</li>
<li>They are not routable across the internet</li>
<li>Answer -&gt; <a href="#id112"><span class="problematic" id="id113">:transparent:`They are not routable across the internet`</span></a></li>
</ul>
</li>
<li><p class="first">What is the purpose of port forwarding?</p>
<ul class="simple">
<li>Port forwarding allows an external user to reach a service on a private IPv4 address that is located inside a LAN</li>
<li>Port forwarding allows users to reach servers on the Internet that are not using standard port numbers</li>
<li>Port forwarding allows an internal user to reach a service on a public IPv4 address that is located outside a LAN</li>
<li>Port forwarding allows for translating inside local IP addresses to outside local addresses</li>
<li>Answer -&gt; <a href="#id114"><span class="problematic" id="id115">:transparent:`Port forwarding allows an external user to reach a service on a private IPv4 address that is located inside a LAN`</span></a></li>
</ul>
</li>
<li><p class="first">When dynamic NAT without overloading is being used, what happens if seven users attempt to access a public server on the Internet when only six addresses are available in the NAT pool?</p>
<ul class="simple">
<li>No users can access the server</li>
<li>The request to the server for the seventh user fails</li>
<li>All users can access the server</li>
<li>The first user gets disconnected when the seventh user makes the request</li>
<li>Answer -&gt; <a href="#id116"><span class="problematic" id="id117">:transparent:`The request to the server for the seventh user fails`</span></a></li>
</ul>
</li>
<li><p class="first">A network engineer has configured a router with the command ip nat inside source list 4 pool corp overload. Why did the engineer use the overload option?</p>
<ul class="simple">
<li>The company has more private IP addresses than available public IP addresses</li>
<li>The company needs to have more public IP addresses available to be used on the Internet</li>
<li>The company router must throttle or buffer traffic because the processing power of the router is not enough to handle the normal load of external-bound Internet traffic</li>
<li>The company has a small number of servers that should be accessible by clients from the Internet</li>
<li>Answer -&gt; <a href="#id118"><span class="problematic" id="id119">:transparent:`The company has more private IP addresses than available public IP addresses`</span></a></li>
</ul>
</li>
<li><p class="first">Match the steps with the actions that are involved when an internal host with IP address 192.168.10.10 attempts to send a packet to and external server at the IP address 209.165.200.254 across a router R1 that running dynamic NAT. (Not all options are used.)</p>
<ul class="simple">
<li>not scored</li>
<li>step 1</li>
<li>step 2</li>
<li>step 3</li>
<li>step 4</li>
<li>step 5</li>
<li><a href="#id120"><span class="problematic" id="id121">:transparent:`no score!`</span></a> R1 translates the IP address in the packets from 209.65.200.254 to 192.168.10.10</li>
<li><a href="#id122"><span class="problematic" id="id123">:transparent:`step 5 =&gt;`</span></a> R1 replaces the address 192.168.10.10 with a translated inside global address</li>
<li><a href="#id124"><span class="problematic" id="id125">:transparent:`step 2 =&gt;`</span></a> R1 checks the NAT configuration to determine if this packet should be translated</li>
<li><a href="#id126"><span class="problematic" id="id127">:transparent:`step 4 =&gt;`</span></a> R1 selects an available global address from the dynamic address pool</li>
<li><a href="#id128"><span class="problematic" id="id129">:transparent:`step 1 =&gt;`</span></a> The host sends packets that request a connection to the server at the address 209.165.200.254</li>
<li><a href="#id130"><span class="problematic" id="id131">:transparent:`step 3 =&gt;`</span></a> If there is no translation entry for this IP address, R1 determines that the source address 192.168.10.10 must be translated</li>
</ul>
</li>
<li><p class="first">What is a disadvantage of NAT?</p>
<ul class="simple">
<li>There is no end-to-end addressing</li>
<li>The router does not need to alter the checksum of the IPv4 packets.</li>
<li>The internal hosts have to use a single public IPv4 address for external communication.</li>
<li>The costs of readdressing hosts can be significant for a publicly addressed network.</li>
<li>Answer -&gt; <a href="#id132"><span class="problematic" id="id133">:transparent:`There is no end-to-end addressing`</span></a></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. What is the purpose of the command marked with an arrow shown in the partial configuration output of a Cisco broadband router?</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>interface FastEthernet 0/0
 ip address 10.10.10.1 255.255.255.0
 ip nat inside
 no cdp enable
 hold-queue 32 in
 hold-queue 100 out
interface FastEthernet 0/1
 ip address dhcp
 ip nat outside
 no cdp enable
!
ip classless
ip http server
!
ip nat inside source list 102 interface fastethernet 0/1 overload
access-list 102 permit ip 10.10.10.0 0.0.0.255 any
no cdp run
!
</pre></div>
</div>
<ul class="simple">
<li>defines which addresses can be translated</li>
<li>defines which addresses are allowed into the router</li>
<li>defines which addresses are assigned to a NAT pool</li>
<li>defines which addresses are allowed out of the router</li>
<li>Answer -&gt; <a href="#id134"><span class="problematic" id="id135">:transparent:`defines which addresses can be translated`</span></a></li>
</ul>
</li>
<li><p class="first">What are two of the required steps to configure PAT? (Choose two.)</p>
<ul class="simple">
<li>Define a pool of global addresses to be used for overload translation</li>
<li>Create a standard access list to define applications that should be translated</li>
<li>Define the range of source ports to be used</li>
<li>Identify the inside interface</li>
<li>Define the hello and interval timers to match the adjacent neighbor router</li>
<li>answer -&gt; <a href="#id136"><span class="problematic" id="id137">:transparent:`Define a pool of global addresses to be used for overload translation &amp;&amp; Identify the inside interface`</span></a></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. A technician is configuring R2 for static NAT to allow the client to access the web server. What is a possible reason that the client PC cannot access the web server?</p>
<img alt="nw/_static/img/Ch9_practice_exam_q19.png" src="nw/_static/img/Ch9_practice_exam_q19.png" />
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ip nat inside source static 192.168.10.2 209.165.201.5</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Fa0/1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="c1"># ip address 192.168.10.254 255.255.255.0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip nat inside</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface Serial0/0/0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># ip address 209.165.200.225 255.255.255.224</span>
</pre></div>
</div>
<ul class="simple">
<li>Interface S0/0/0 should be identified as the outside NAT interface</li>
<li>Interface Fa0/1 should be identified as the outside NAT interface</li>
<li>The IP NAT statement is incorrect</li>
<li>The configuration is missing a valid access control list</li>
<li>Answer -&gt; <a href="#id138"><span class="problematic" id="id139">:transparent:`Interface Fa0/1 should be identified as the outside NAT interface`</span></a></li>
</ul>
</li>
<li><p class="first">What are two benefits of NAT? (Choose two.)</p>
<ul class="simple">
<li>It saves public IP addresses</li>
<li>It adds a degree of privacy and security to a network</li>
<li>It increases routing performance. It makes troubleshooting routing issues easier</li>
<li>It makes tunneling with IPsec less complicated</li>
<li>It makes troubleshooting routing issues easier</li>
<li>answer -&gt; <a href="#id140"><span class="problematic" id="id141">:transparent:`It saves public IP addresses &amp;&amp; It adds a degree of privacy and security to a network`</span></a></li>
</ul>
</li>
<li><p class="first">What is an advantage of deploying IPv4 NAT technology for internal hosts in an organization?</p>
<ul class="simple">
<li>makes internal network access easy for outside hosts using UDP</li>
<li>provides flexibility in designing the IPv4 addressing scheme</li>
<li>increases the performance of packet transmission to the Internet</li>
<li>enables the easy deployment of applications that require end-to-end traceability</li>
<li>answer -&gt; <a href="#id142"><span class="problematic" id="id143">:transparent:`provides flexibility in designing the IPv4 addressing scheme`</span></a></li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section" id="chapter-10-device-discovery-management-maintenance">
<h3>Chapter 10 Device Discovery Management &amp; Maintenance<a class="headerlink" href="#chapter-10-device-discovery-management-maintenance" title="Permalink to this headline">¶</a></h3>
<p>Cisco Discovery Protocol (CDP) and Link Layer Discover Protocol (LLDP) are both capable of discovering information about directly connected devices.</p>
<p>Network Time Protocol (NTP) can be effectively used to synchronize the time across all your networking devices, which is especially important when trying to compare log files from different devices. Those log files are generated by the syslog protocol. Syslog messages can be captured and sent to a syslog server to aid in device management tasks.</p>
<div class="section" id="cisco-discovery-protocol-operation">
<h4>Cisco Discovery Protocol Operation<a class="headerlink" href="#cisco-discovery-protocol-operation" title="Permalink to this headline">¶</a></h4>
<p>Cisco Discovery Protocol (CDP) is a Cisco proprietary Layer 2 protocol that is used to gather information about Cisco devices which share the same data link. CDP is media and protocol independent and runs on all Cisco devices, such as routers, switches, and access servers.</p>
<p>The device sends periodic CDP advertisements to connected devices. These advertisements share information about the type of device that is discovered, the name of the devices, and the number and type of the interfaces.</p>
<p>CDP can assist in network design decisions, troubleshooting, and making changes to equipment. CDP can also be used as a network discovery tool to determine the information about the neighboring devices. This information gathered from CDP can help build a logical topology of a network when documentation is missing or lacking in detail.</p>
<dl class="docutils">
<dt>Router# show cdp</dt>
<dd>Verify the status of CDP &amp; display information about CDP</dd>
<dt>Router(config)# cdp run</dt>
<dd>enable CDP globally for all the supported interfaces</dd>
<dt>Router(config)# no cdp run</dt>
<dd>disabe cdp for all the interfaces on the device</dd>
<dt>Router(config-if)# no cdp enable</dt>
<dd>disable cdp for specific interface (eg ISP link)</dd>
<dt>Router# show cdp neighbors [detail]</dt>
<dd>verify status of CDP &amp; display list of neighbors. use to display the IFs that are CDP enabled, status of IF is also shown</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">show</span> <span class="pre">cdp</span> <span class="pre">neighbors</span></code> reveals the remote hostname - local IF - remote platform - remote IF - capabilities Router S(witch) I(GMP)</p>
</div>
</div>
<div class="section" id="cdp-exercise-10-1-1-4">
<h4>cdp exercise 10.1.1.4<a class="headerlink" href="#cdp-exercise-10-1-1-4" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="13%" />
<col width="19%" />
<col width="20%" />
<col width="29%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Local IF &amp; Connected NB</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Edge1</td>
<td>G0/0</td>
<td>192.168.1.1</td>
<td>255.255.255.0</td>
<td>G0/0 - S1</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/0</td>
<td>209.165.200.5</td>
<td>255.255.255.252</td>
<td>S0/0/0 - ISP</td>
</tr>
<tr class="row-even"><td>Branch-Edge</td>
<td>S0/0/1</td>
<td>209.165.200.10</td>
<td>255.255.255.252</td>
<td>S0/0/1  - ISP</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0</td>
<td>192.168.3.249</td>
<td>255.255.255.248</td>
<td>G0/0 - Branch-Firewall</td>
</tr>
<tr class="row-even"><td>Branch-Firewall</td>
<td>G0/0</td>
<td>192.168.3.253</td>
<td>255.255.255.248</td>
<td>G0/0 - Branch-Edge</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/1</td>
<td>192.168.4.129</td>
<td>255.255.255.128</td>
<td>G0/1 - sw-br-floor2</td>
</tr>
<tr class="row-even"><td>sw-br-floor1</td>
<td>G0/2</td>
<td>no mgmt ip</td>
<td>&#160;</td>
<td>G0/2 - sw-br-floor2</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/1</td>
<td>no mgmt ip</td>
<td>&#160;</td>
<td>G0/1 - Branch-Firewall</td>
</tr>
<tr class="row-even"><td>sw-br-floor2</td>
<td>vlan 1</td>
<td>192.168.4.132</td>
<td>255.255.255.128</td>
<td>mgmt interface</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/2</td>
<td>192.168.4.132</td>
<td>255.255.255.128</td>
<td>G0/2 - sw-br-floor1</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/1</td>
<td>192.168.4.132</td>
<td>255.255.255.128</td>
<td>G0/1 - Branch-Firewall</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>Fa0/24</td>
<td>192.168.4.132</td>
<td>255.255.255.128</td>
<td>Fa0/24 - sw-br-floor3</td>
</tr>
<tr class="row-even"><td>sw-br-floor3</td>
<td>vlan 1</td>
<td>192.168.4.133</td>
<td>255.255.255.128</td>
<td>mgmt interface</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/1</td>
<td>&#160;</td>
<td>&#160;</td>
<td>G0/1 - sw-br-floor1</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Fa0/24</td>
<td>&#160;</td>
<td>&#160;</td>
<td>Fa0/24 - sw-br-floor2</td>
</tr>
</tbody>
</table>
<p>Map a network using CDP and SSH remote access</p>
<p>Local Network
Username: admin01
Password: <a class="reference external" href="mailto:S3cre7P&#37;&#52;&#48;55">S3cre7P<span>&#64;</span>55</a></p>
<p>Branch Office Network
Username: branchadmin
Password: <a class="reference external" href="mailto:S3cre7P&#37;&#52;&#48;55">S3cre7P<span>&#64;</span>55</a></p>
<img alt="nw/_static/img/Ch10_ex_cdp_10.1.1.4.png" src="nw/_static/img/Ch10_ex_cdp_10.1.1.4.png" />
<ol class="arabic">
<li><p class="first">On Admin-PC open CMD and SSH into the gateway router at 192.168.1.1 using the username admin01 and the password <a class="reference external" href="mailto:S3cre7P&#37;&#52;&#48;55">S3cre7P<span>&#64;</span>55</a></p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>PC&gt; ssh –l admin01 192.168.1.1
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice that you are placed directly into privileged EXEC mode. This is because the admin01 user account is set to privilege level 15.</p>
</div>
</li>
<li><p class="first">Use the show ip interface brief and show interfaces commands to document the Edge1 router’s physical interfaces, IP addresses , and subnet masks in the Addressing Table.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>Edge1# show ip interface brief
Interface              IP-Address      OK? Method Status                Protocol
GigabitEthernet0/0     192.168.1.1     YES manual up                    up
GigabitEthernet0/1     unassigned      YES unset  administratively down down
Serial0/0/0            209.165.200.5   YES manual up                    up
Serial0/0/1            unassigned      YES unset  administratively down down
Vlan1                  unassigned      YES unset  administratively down down

Edge1#show interfaces
GigabitEthernet0/0 is up, line protocol is up (connected)
  Hardware is CN Gigabit Ethernet, address is 00e0.a3dd.7001 (bia 00e0.a3dd.7001)
  Internet address is 192.168.1.1/24
  MTU 1500 bytes, BW 1000000 Kbit, DLY 10 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation ARPA, loopback not set
  Keepalive set (10 sec)
  Full-duplex, 100Mb/s, media type is RJ45
  output flow-control is unsupported, input flow-control is unsupported
  ARP type: ARPA, ARP Timeout 04:00:00,
  Last input 00:00:08, output 00:00:05, output hang never
  Last clearing of &quot;show interface&quot; counters never
  Input queue: 0/75/0 (size/max/drops); Total output drops: 0
  Queueing strategy: fifo
  Output queue :0/40 (size/max)
  5 minute input rate 40 bits/sec, 0 packets/sec
  5 minute output rate 31 bits/sec, 0 packets/sec
     115 packets input, 4666 bytes, 0 no buffer
     Received 0 broadcasts, 0 runts, 0 giants, 0 throttles
     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored, 0 abort
     0 watchdog, 1017 multicast, 0 pause input
     0 input packets with dribble condition detected
     64 packets output, 2616 bytes, 0 underruns
     0 output errors, 0 collisions, 1 interface resets
     0 unknown protocol drops
     0 babbles, 0 late collision, 0 deferred
     0 lost carrier, 0 no carrier
     0 output buffer failures, 0 output buffers swapped out
GigabitEthernet0/1 is administratively down, line protocol is down (disabled)
  Hardware is CN Gigabit Ethernet, address is 00e0.a3dd.7002 (bia 00e0.a3dd.7002)
  MTU 1500 bytes, BW 1000000 Kbit, DLY 10 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation ARPA, loopback not set
  Keepalive set (10 sec)
  Full-duplex, 100Mb/s, media type is RJ45
  output flow-control is unsupported, input flow-control is unsupported
  ARP type: ARPA, ARP Timeout 04:00:00,
  Last input 00:00:08, output 00:00:05, output hang never
  Last clearing of &quot;show interface&quot; counters never
  Input queue: 0/75/0 (size/max/drops); Total output drops: 0
  Queueing strategy: fifo
  Output queue :0/40 (size/max)
  5 minute input rate 0 bits/sec, 0 packets/sec
  5 minute output rate 0 bits/sec, 0 packets/sec
     0 packets input, 0 bytes, 0 no buffer
     Received 0 broadcasts, 0 runts, 0 giants, 0 throttles
     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored, 0 abort
     0 watchdog, 1017 multicast, 0 pause input
     0 input packets with dribble condition detected
     0 packets output, 0 bytes, 0 underruns
     0 output errors, 0 collisions, 2 interface resets
     0 unknown protocol drops
     0 babbles, 0 late collision, 0 deferred
     0 lost carrier, 0 no carrier
     0 output buffer failures, 0 output buffers swapped out
Serial0/0/0 is up, line protocol is up (connected)
  Hardware is HD64570
  Internet address is 209.165.200.5/30
  MTU 1500 bytes, BW 1544 Kbit, DLY 20000 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation HDLC, loopback not set, keepalive set (10 sec)
  Last input never, output never, output hang never
  Last clearing of &quot;show interface&quot; counters never
  Input queue: 0/75/0 (size/max/drops); Total output drops: 0
  Queueing strategy: weighted fair
  Output queue: 0/1000/64/0 (size/max total/threshold/drops)
     Conversations  0/0/256 (active/max active/max total)
     Reserved Conversations 0/0 (allocated/max allocated)
     Available Bandwidth 1158 kilobits/sec
  5 minute input rate 0 bits/sec, 0 packets/sec
  5 minute output rate 0 bits/sec, 0 packets/sec
     0 packets input, 0 bytes, 0 no buffer
     Received 0 broadcasts, 0 runts, 0 giants, 0 throttles
     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored, 0 abort
     0 packets output, 0 bytes, 0 underruns
     0 output errors, 0 collisions, 1 interface resets
     0 output buffer failures, 0 output buffers swapped out
     0 carrier transitions
     DCD=up  DSR=up  DTR=up  RTS=up  CTS=up
Serial0/0/1 is administratively down, line protocol is down (disabled)
  Hardware is HD64570
  MTU 1500 bytes, BW 1544 Kbit, DLY 20000 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation HDLC, loopback not set, keepalive set (10 sec)
  Last input never, output never, output hang never
  Last clearing of &quot;show interface&quot; counters never
  Input queue: 0/75/0 (size/max/drops); Total output drops: 0
  Queueing strategy: weighted fair
  Output queue: 0/1000/64/0 (size/max total/threshold/drops)
     Conversations  0/0/256 (active/max active/max total)
     Reserved Conversations 0/0 (allocated/max allocated)
     Available Bandwidth 1158 kilobits/sec
  5 minute input rate 0 bits/sec, 0 packets/sec
  5 minute output rate 0 bits/sec, 0 packets/sec
     0 packets input, 0 bytes, 0 no buffer
     Received 0 broadcasts, 0 runts, 0 giants, 0 throttles
     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored, 0 abort
     0 packets output, 0 bytes, 0 underruns
     0 output errors, 0 collisions, 2 interface resets
     0 output buffer failures, 0 output buffers swapped out
     0 carrier transitions
     DCD=down  DSR=down  DTR=down  RTS=down  CTS=down
Vlan1 is administratively down, line protocol is down
  Hardware is CPU Interface, address is 0060.70bd.dd13 (bia 0060.70bd.dd13)
  MTU 1500 bytes, BW 100000 Kbit, DLY 1000000 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation ARPA, loopback not set
  ARP type: ARPA, ARP Timeout 04:00:00
  Last input 21:40:21, output never, output hang never
  Last clearing of &quot;show interface&quot; counters never
  Input queue: 0/75/0/0 (size/max/drops/flushes); Total output drops: 0
  Queueing strategy: fifo
  Output queue: 0/40 (size/max)
  5 minute input rate 0 bits/sec, 0 packets/sec
  5 minute output rate 0 bits/sec, 0 packets/sec
     1682 packets input, 530955 bytes, 0 no buffer
     Received 0 broadcasts (0 IP multicast)
     0 runts, 0 giants, 0 throttles
     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored
     563859 packets output, 0 bytes, 0 underruns
     0 output errors, 23 interface resets
     0 output buffer failures, 0 output buffers swapped out
</pre></div>
</div>
</li>
<li><dl class="first docutils">
<dt>Using the Edge1 router’s CLI, you will SSH into the Remote Branch Office at 209.165.200.10 with the username branchadmin and the same password</dt>
<dd><p class="first last">Password:</p>
</dd>
</dl>
<div class="code highlight-default"><div class="highlight"><pre><span></span>  Edge1# ssh –l branchadmin 209.165.200.10
  Branch-Edge#

After connecting to the Remote Branch Office at 209.165.200.10 what piece of previously missing information can now be added to the Addressing Table above?

hostname Branche-Edge, Branch-Firewall hostnames and their ip address + subnet mask

.. code::

   Branch-Edge#show cdp neighbors detail

   Device ID: Branch-Firewall
   Entry address(es):
     IP address : 192.168.3.253
   Platform: cisco C1900, Capabilities: Router
   Interface: GigabitEthernet0/0, Port ID (outgoing port): GigabitEthernet0/0
   Holdtime: 154
</pre></div>
</div>
</li>
<li><p class="first">disable cdp on link to ISP</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Branch</span><span class="o">-</span><span class="n">Edge</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#interface S0/0/1</span>
<span class="n">Branch</span><span class="o">-</span><span class="n">Edge</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#no cdp enable</span>
<span class="n">Branch</span><span class="o">-</span><span class="n">Edge</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#exit</span>
<span class="n">Branch</span><span class="o">-</span><span class="n">Edge</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#cdp run</span>
<span class="n">Branch</span><span class="o">-</span><span class="n">Edge</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#</span>
</pre></div>
</div>
</li>
<li><p class="first">check NBs on Branch-Edge</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Branch</span><span class="o">-</span><span class="n">Edge</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#do show cdp neighbors detail</span>

<span class="n">Device</span> <span class="n">ID</span><span class="p">:</span> <span class="n">Branch</span><span class="o">-</span><span class="n">Firewall</span>
<span class="n">Entry</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">IP</span> <span class="n">address</span> <span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.253</span>
<span class="o">...</span>
</pre></div>
</div>
</li>
<li><p class="first">ssh into the firewall</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Branch</span><span class="o">-</span><span class="n">Edge</span><span class="c1">#ssh -l branchadmin 192.168.3.253</span>
<span class="n">Open</span>
<span class="n">Password</span><span class="p">:</span>

<span class="n">Branch</span><span class="o">-</span><span class="n">Firewall</span><span class="c1">#</span>
</pre></div>
</div>
</li>
<li><p class="first">check NBs on Branch-Firewall</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Branch</span><span class="o">-</span><span class="n">Firewall</span><span class="c1">#show cdp neighbors</span>
<span class="n">Capability</span> <span class="n">Codes</span><span class="p">:</span> <span class="n">R</span> <span class="o">-</span> <span class="n">Router</span><span class="p">,</span> <span class="n">T</span> <span class="o">-</span> <span class="n">Trans</span> <span class="n">Bridge</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">Source</span> <span class="n">Route</span> <span class="n">Bridge</span>
                  <span class="n">S</span> <span class="o">-</span> <span class="n">Switch</span><span class="p">,</span> <span class="n">H</span> <span class="o">-</span> <span class="n">Host</span><span class="p">,</span> <span class="n">I</span> <span class="o">-</span> <span class="n">IGMP</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="n">Repeater</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">Phone</span>
<span class="n">Device</span> <span class="n">ID</span>    <span class="n">Local</span> <span class="n">Intrfce</span>   <span class="n">Holdtme</span>    <span class="n">Capability</span>   <span class="n">Platform</span>    <span class="n">Port</span> <span class="n">ID</span>
<span class="n">sw</span><span class="o">-</span><span class="n">br</span><span class="o">-</span><span class="n">floor2</span>
             <span class="n">Gig</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>          <span class="mi">137</span>            <span class="n">S</span>       <span class="mi">2960</span>        <span class="n">Gig</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Branch</span><span class="o">-</span><span class="n">Edge</span>  <span class="n">Gig</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span>          <span class="mi">171</span>            <span class="n">R</span>       <span class="n">C1900</span>       <span class="n">Gig</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span>

<span class="n">Branch</span><span class="o">-</span><span class="n">Firewall</span><span class="c1">#show cdp neighbors detail</span>

<span class="n">Device</span> <span class="n">ID</span><span class="p">:</span> <span class="n">sw</span><span class="o">-</span><span class="n">br</span><span class="o">-</span><span class="n">floor2</span>
<span class="n">Entry</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">IP</span> <span class="n">address</span> <span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">4.132</span>
<span class="n">Platform</span><span class="p">:</span> <span class="n">cisco</span> <span class="mi">2960</span><span class="p">,</span> <span class="n">Capabilities</span><span class="p">:</span> <span class="n">Switch</span>
<span class="n">Interface</span><span class="p">:</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">Port</span> <span class="n">ID</span> <span class="p">(</span><span class="n">outgoing</span> <span class="n">port</span><span class="p">):</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Holdtime</span><span class="p">:</span> <span class="mi">130</span>

<span class="n">Version</span> <span class="p">:</span>
<span class="n">Cisco</span> <span class="n">IOS</span> <span class="n">Software</span><span class="p">,</span> <span class="n">C2960</span> <span class="n">Software</span> <span class="p">(</span><span class="n">C2960</span><span class="o">-</span><span class="n">LANBASE</span><span class="o">-</span><span class="n">M</span><span class="p">),</span> <span class="n">Version</span> <span class="mf">12.2</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span><span class="n">FX</span><span class="p">,</span> <span class="n">RELEASE</span> <span class="n">SOFTWARE</span> <span class="p">(</span><span class="n">fc1</span><span class="p">)</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">1986</span><span class="o">-</span><span class="mi">2005</span> <span class="n">by</span> <span class="n">Cisco</span> <span class="n">Systems</span><span class="p">,</span> <span class="n">Inc</span><span class="o">.</span>
<span class="n">Compiled</span> <span class="n">Wed</span> <span class="mi">12</span><span class="o">-</span><span class="n">Oct</span><span class="o">-</span><span class="mi">05</span> <span class="mi">22</span><span class="p">:</span><span class="mi">05</span> <span class="n">by</span> <span class="n">pt_team</span>

<span class="n">advertisement</span> <span class="n">version</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">Duplex</span><span class="p">:</span> <span class="n">full</span>
<span class="o">---------------------------</span>

<span class="n">Device</span> <span class="n">ID</span><span class="p">:</span> <span class="n">Branch</span><span class="o">-</span><span class="n">Edge</span>
<span class="n">Entry</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">IP</span> <span class="n">address</span> <span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.249</span>
<span class="n">Platform</span><span class="p">:</span> <span class="n">cisco</span> <span class="n">C1900</span><span class="p">,</span> <span class="n">Capabilities</span><span class="p">:</span> <span class="n">Router</span>
<span class="n">Interface</span><span class="p">:</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span> <span class="n">Port</span> <span class="n">ID</span> <span class="p">(</span><span class="n">outgoing</span> <span class="n">port</span><span class="p">):</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Holdtime</span><span class="p">:</span> <span class="mi">165</span>

<span class="n">Version</span> <span class="p">:</span>
<span class="n">Cisco</span> <span class="n">IOS</span> <span class="n">Software</span><span class="p">,</span> <span class="n">C1900</span> <span class="n">Software</span> <span class="p">(</span><span class="n">C1900</span><span class="o">-</span><span class="n">UNIVERSALK9</span><span class="o">-</span><span class="n">M</span><span class="p">),</span> <span class="n">Version</span> <span class="mf">15.1</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="n">M4</span><span class="p">,</span> <span class="n">RELEASE</span> <span class="n">SOFTWARE</span> <span class="p">(</span><span class="n">fc2</span><span class="p">)</span>
<span class="n">Technical</span> <span class="n">Support</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">cisco</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">techsupport</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">1986</span><span class="o">-</span><span class="mi">2012</span> <span class="n">by</span> <span class="n">Cisco</span> <span class="n">Systems</span><span class="p">,</span> <span class="n">Inc</span><span class="o">.</span>
<span class="n">Compiled</span> <span class="n">Thurs</span> <span class="mi">5</span><span class="o">-</span><span class="n">Jan</span><span class="o">-</span><span class="mi">12</span> <span class="mi">15</span><span class="p">:</span><span class="mi">41</span> <span class="n">by</span> <span class="n">pt_team</span>

<span class="n">advertisement</span> <span class="n">version</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">Duplex</span><span class="p">:</span> <span class="n">full</span>

<span class="n">Branch</span><span class="o">-</span><span class="n">Firewall</span><span class="c1">#</span>
</pre></div>
</div>
</li>
<li><p class="first">explore the discovered switch via ssh</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>Branch-Firewall#ssh -l branchadmin 192.168.4.132
Open
Password:

sw-br-floor2&gt;
sw-br-floor2&gt;show ip int brief
Interface              IP-Address      OK? Method Status                Protocol
...
FastEthernet0/24       unassigned      YES manual up                    up
GigabitEthernet0/1     unassigned      YES manual up                    up
GigabitEthernet0/2     unassigned      YES manual up                    up
Vlan1                  192.168.4.132   YES manual up                    up
------------------
sw-br-floor2&gt;
sw-br-floor2&gt;show cdp neighbors detail
Device ID: sw-br-floor3
Entry address(es):
  IP address : 192.168.4.133
Platform: cisco 2960, Capabilities: Switch
Interface: FastEthernet0/24, Port ID (outgoing port): FastEthernet0/24
Holdtime: 139

Version :
Cisco IOS Software, C2960 Software (C2960-LANBASE-M), Version 12.2(25)FX, RELEASE SOFTWARE (fc1)
Copyright (c) 1986-2005 by Cisco Systems, Inc.
Compiled Wed 12-Oct-05 22:05 by pt_team

advertisement version: 2
Duplex: full
---------------------------

Device ID: Branch-Firewall
Entry address(es):
  IP address : 192.168.4.129
Platform: cisco C1900, Capabilities: Router
Interface: GigabitEthernet0/1, Port ID (outgoing port): GigabitEthernet0/1
Holdtime: 139

Version :
Cisco IOS Software, C1900 Software (C1900-UNIVERSALK9-M), Version 15.1(4)M4, RELEASE SOFTWARE (fc2)
Technical Support: http://www.cisco.com/techsupport
Copyright (c) 1986-2012 by Cisco Systems, Inc.
Compiled Thurs 5-Jan-12 15:41 by pt_team

advertisement version: 2
Duplex: full
---------------------------

Device ID: sw-br-floor1
Entry address(es):
Platform: cisco 2960, Capabilities: Switch
Interface: GigabitEthernet0/2, Port ID (outgoing port): GigabitEthernet0/2
Holdtime: 139

Version :
Cisco IOS Software, C2960 Software (C2960-LANBASE-M), Version 12.2(25)FX, RELEASE SOFTWARE (fc1)
Copyright (c) 1986-2005 by Cisco Systems, Inc.
Compiled Wed 12-Oct-05 22:05 by pt_team

advertisement version: 2
Duplex: full
----------------------------------------------
sw-br-floor2&gt;
</pre></div>
</div>
<p>Add the vlan ip and the newly discovered switch to the addressing table</p>
</li>
<li><p class="first">Verify there are no ip addresses left by using traceroute and even <code class="docutils literal"><span class="pre">show</span> <span class="pre">arp</span></code></p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">sw</span><span class="o">-</span><span class="n">br</span><span class="o">-</span><span class="n">floor3</span><span class="o">&gt;</span><span class="n">traceroute</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.5</span>
<span class="n">Type</span> <span class="n">escape</span> <span class="n">sequence</span> <span class="n">to</span> <span class="n">abort</span><span class="o">.</span>
<span class="n">Tracing</span> <span class="n">the</span> <span class="n">route</span> <span class="n">to</span> <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.5</span>

  <span class="mi">1</span>   <span class="mf">192.168</span><span class="o">.</span><span class="mf">4.129</span>   <span class="mi">0</span> <span class="n">msec</span>    <span class="mi">0</span> <span class="n">msec</span>    <span class="mi">0</span> <span class="n">msec</span>
  <span class="mi">2</span>   <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.249</span>   <span class="mi">0</span> <span class="n">msec</span>    <span class="mi">0</span> <span class="n">msec</span>    <span class="mi">0</span> <span class="n">msec</span>
  <span class="mi">3</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.9</span>   <span class="mi">2</span> <span class="n">msec</span>    <span class="mi">1</span> <span class="n">msec</span>    <span class="mi">0</span> <span class="n">msec</span>
  <span class="mi">4</span>   <span class="mf">209.165</span><span class="o">.</span><span class="mf">200.5</span>   <span class="mi">1</span> <span class="n">msec</span>    <span class="mi">2</span> <span class="n">msec</span>    <span class="mi">1</span> <span class="n">msec</span>

<span class="n">Branch</span><span class="o">-</span><span class="n">Firewall</span><span class="c1">#show arp</span>
<span class="n">Protocol</span>  <span class="n">Address</span>          <span class="n">Age</span> <span class="p">(</span><span class="nb">min</span><span class="p">)</span>  <span class="n">Hardware</span> <span class="n">Addr</span>   <span class="n">Type</span>   <span class="n">Interface</span>
<span class="n">Internet</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.249</span>           <span class="mi">67</span>  <span class="mf">0001.9660</span><span class="o">.</span><span class="mi">0053</span>  <span class="n">ARPA</span>   <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Internet</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.253</span>           <span class="o">-</span>   <span class="mi">00</span><span class="n">D0</span><span class="o">.</span><span class="n">D351</span><span class="o">.</span><span class="mi">0601</span>  <span class="n">ARPA</span>   <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Internet</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">4.129</span>           <span class="o">-</span>   <span class="mi">00</span><span class="n">D0</span><span class="o">.</span><span class="n">D351</span><span class="o">.</span><span class="mi">0602</span>  <span class="n">ARPA</span>   <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Internet</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">4.132</span>           <span class="mi">53</span>  <span class="mf">0060.70</span><span class="n">C4</span><span class="o">.</span><span class="n">E374</span>  <span class="n">ARPA</span>   <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Internet</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">4.133</span>           <span class="mi">12</span>  <span class="mf">0090.2173</span><span class="o">.</span><span class="n">AC1D</span>  <span class="n">ARPA</span>   <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
</pre></div>
</div>
</li>
</ol>
<p>enable password is unkown and switch 1 doesn’t have a mgmt ip address so we can’t explore further</p>
<blockquote>
<div><div class="code highlight-default"><div class="highlight"><pre><span></span>sw-br-floor2&gt;show cdp neighbors detail
Device ID: sw-br-floor3
Entry address(es):
  IP address : 192.168.4.133
Platform: cisco 2960, Capabilities: Switch
Interface: FastEthernet0/24, Port ID (outgoing port): FastEthernet0/24
Holdtime: 139

Version :
Cisco IOS Software, C2960 Software (C2960-LANBASE-M), Version 12.2(25)FX, RELEASE SOFTWARE (fc1)
Copyright (c) 1986-2005 by Cisco Systems, Inc.
Compiled Wed 12-Oct-05 22:05 by pt_team

advertisement version: 2
Duplex: full
---------------------------

Device ID: Branch-Firewall
Entry address(es):
  IP address : 192.168.4.129
Platform: cisco C1900, Capabilities: Router
Interface: GigabitEthernet0/1, Port ID (outgoing port): GigabitEthernet0/1
Holdtime: 139

Version :
Cisco IOS Software, C1900 Software (C1900-UNIVERSALK9-M), Version 15.1(4)M4, RELEASE SOFTWARE (fc2)
Technical Support: http://www.cisco.com/techsupport
Copyright (c) 1986-2012 by Cisco Systems, Inc.
Compiled Thurs 5-Jan-12 15:41 by pt_team

advertisement version: 2
Duplex: full
---------------------------

Device ID: sw-br-floor1
Entry address(es):
Platform: cisco 2960, Capabilities: Switch
Interface: GigabitEthernet0/2, Port ID (outgoing port): GigabitEthernet0/2
Holdtime: 139

Version :
Cisco IOS Software, C2960 Software (C2960-LANBASE-M), Version 12.2(25)FX, RELEASE SOFTWARE (fc1)
Copyright (c) 1986-2005 by Cisco Systems, Inc.
Compiled Wed 12-Oct-05 22:05 by pt_team

advertisement version: 2
Duplex: full

sw-br-floor2&gt;
    !
    interface FastEthernet0/10
     switchport access vlan 30
     switchport mode access
     shutdown
    !
    interface FastEthernet0/11
     description link2FileServerVLAN15
     switchport access vlan 15
     switchport mode access
    !
    interface FastEthernet0/12
     switchport access vlan 15
     switchport mode access
     shutdown
    !
    interface FastEthernet0/13
     switchport access vlan 15
     switchport mode access
     shutdown
    !
    interface FastEthernet0/14
     switchport access vlan 15
     switchport mode access
     shutdown
    !
    interface FastEthernet0/15
     switchport access vlan 15
     switchport mode access
     shutdown
    !
    interface FastEthernet0/16
     switchport access vlan 15
     switchport mode access
     shutdown
    !
    interface FastEthernet0/17
     switchport access vlan 15
     switchport mode access
     shutdown
    !
    interface FastEthernet0/18
     switchport access vlan 15
     switchport mode access
     shutdown
    !
    interface FastEthernet0/19
     switchport access vlan 15
     switchport mode access
     shutdown
    !
    interface FastEthernet0/20
     switchport access vlan 15
     switchport mode access
     shutdown
    !
    interface FastEthernet0/21
     switchport mode access
     switchport port-security violation restrict
     shutdown
    !
    interface FastEthernet0/22
     switchport port-security violation restrict
    !
    interface FastEthernet0/23
     switchport port-security violation restrict
    !
    interface FastEthernet0/24
     switchport port-security violation restrict
    !
    interface GigabitEthernet0/1
     description link_Trunk2Central
     switchport trunk native vlan 45
     switchport trunk allowed vlan 15,30,45,60
     switchport mode trunk
    !
    interface GigabitEthernet0/2
     switchport trunk native vlan 45
     switchport trunk allowed vlan 15,30,45,60
     switchport mode trunk
     shutdown
    !
    interface Vlan1
     no ip address
     shutdown
    !
    interface Vlan60
     mac-address 0001.c9aa.4801
     ip address 172.16.15.10 255.255.255.248
    !
    ip default-gateway 172.16.15.9
    !
    !
    !
    !
    line con 0
    !
    line vty 0 4
     login local
     transport input ssh
     transport output none
    line vty 5 15
     login local
     transport input ssh
     transport output none
    !
    !
    !
    end
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="link-layer-discovery-protocol">
<h4>Link Layer Discovery Protocol<a class="headerlink" href="#link-layer-discovery-protocol" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>LLDP</dt>
<dd>A vendor-neutral neighbor discovery protocol similar to CDP. Works with Routers,Switches,WLAN APs. Advertises its identity and capabilities over L2</dd>
</dl>
<div class="section" id="configuration">
<h5>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Switch</span><span class="c1"># conf t</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># lldp run</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface gigabitethernet 0/1</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># lldp transmit</span>
<span class="n">Switch</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># lldp receive</span>
<span class="n">Switch</span><span class="c1"># show lldp</span>

<span class="n">Global</span> <span class="n">LLDP</span> <span class="n">Information</span><span class="p">:</span>
    <span class="n">Status</span><span class="p">:</span> <span class="n">ACTIVE</span>
    <span class="n">LLDP</span> <span class="n">advertisements</span> <span class="n">are</span> <span class="n">sent</span> <span class="n">every</span> <span class="mi">30</span> <span class="n">seconds</span>
    <span class="n">LLDP</span> <span class="n">hold</span> <span class="n">time</span> <span class="n">advertised</span> <span class="ow">is</span> <span class="mi">120</span> <span class="n">seconds</span>
    <span class="n">LLDP</span> <span class="n">interface</span> <span class="n">reinitialisation</span> <span class="n">delay</span> <span class="ow">is</span> <span class="mi">2</span> <span class="n">seconds</span>

<span class="n">Switch</span><span class="c1"># show lldp neighbors</span>
<span class="n">Switch</span><span class="c1"># show lldp neighbors detail</span>
</pre></div>
</div>
</div>
<div class="section" id="comparison-neighbors-information">
<h5>comparison neighbors information<a class="headerlink" href="#comparison-neighbors-information" title="Permalink to this headline">¶</a></h5>
<p>cdp</p>
<blockquote>
<div><div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S3</span><span class="c1"># show cdp neighbors</span>
<span class="n">Capability</span> <span class="n">Codes</span><span class="p">:</span> <span class="n">R</span> <span class="o">-</span> <span class="n">Router</span><span class="p">,</span> <span class="n">T</span> <span class="o">-</span> <span class="n">Trans</span> <span class="n">Bridge</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">Source</span> <span class="n">Route</span> <span class="n">Bridge</span>
                  <span class="n">S</span> <span class="o">-</span> <span class="n">Switch</span><span class="p">,</span> <span class="n">H</span> <span class="o">-</span> <span class="n">Host</span><span class="p">,</span> <span class="n">I</span> <span class="o">-</span> <span class="n">IGMP</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="n">Repeater</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">Phone</span><span class="p">,</span>
                  <span class="n">D</span> <span class="o">-</span> <span class="n">Remote</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">CVTA</span><span class="p">,</span> <span class="n">M</span> <span class="o">-</span> <span class="n">Two</span><span class="o">-</span> <span class="n">port</span> <span class="n">Mac</span> <span class="n">Relay</span>
<span class="n">Device</span> <span class="n">ID</span>        <span class="n">Local</span> <span class="n">Intrfce</span>     <span class="n">Holdtme</span>    <span class="n">Capability</span>  <span class="n">Platform</span>  <span class="n">Port</span> <span class="n">ID</span>
<span class="n">Gateway</span>          <span class="n">Fas</span> <span class="mi">0</span><span class="o">/</span><span class="mi">5</span>           <span class="mi">143</span>            <span class="n">R</span> <span class="n">B</span> <span class="n">S</span> <span class="n">I</span> <span class="n">CISCO1941</span> <span class="n">Gig</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">S2</span>               <span class="n">Fas</span> <span class="mi">0</span><span class="o">/</span><span class="mi">2</span>           <span class="mi">173</span>              <span class="n">S</span> <span class="n">I</span>   <span class="n">WS</span><span class="o">-</span><span class="n">C2960</span><span class="o">-</span> <span class="n">Fas</span> <span class="mi">0</span><span class="o">/</span><span class="mi">4</span>
<span class="n">S1</span>               <span class="n">Fas</span> <span class="mi">0</span><span class="o">/</span><span class="mi">4</span>           <span class="mi">171</span>              <span class="n">S</span> <span class="n">I</span>   <span class="n">WS</span><span class="o">-</span><span class="n">C2960</span><span class="o">-</span> <span class="n">Fas</span> <span class="mi">0</span><span class="o">/</span><span class="mi">4</span>
</pre></div>
</div>
</div></blockquote>
<p>lldp</p>
<blockquote>
<div><div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Capability</span> <span class="n">codes</span><span class="p">:(</span><span class="n">R</span><span class="p">)</span> <span class="n">Router</span><span class="p">,</span> <span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="n">Bridge</span><span class="p">,</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="n">Telephone</span><span class="p">,</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">DOCSIS</span> <span class="n">Cable</span> <span class="n">Device</span>
                 <span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="n">WLAN</span> <span class="n">Access</span> <span class="n">Point</span><span class="p">,</span> <span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="n">Repeater</span><span class="p">,</span> <span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="n">Station</span><span class="p">,</span> <span class="p">(</span><span class="n">O</span><span class="p">)</span> <span class="n">Other</span>
<span class="n">Device</span> <span class="n">ID</span>           <span class="n">Local</span> <span class="n">Intf</span>     <span class="n">Hold</span><span class="o">-</span><span class="n">time</span>  <span class="n">Capability</span>    <span class="n">Port</span> <span class="n">ID</span>
<span class="n">S3</span>                  <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>          <span class="mi">120</span>        <span class="n">B</span>               <span class="n">Fa0</span><span class="o">/</span><span class="mi">5</span>
<span class="n">Total</span> <span class="n">entries</span> <span class="n">displayed</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">cdp</th>
<th class="head">lldp</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R# show cdp</td>
<td>R# show lldp [traffic]</td>
</tr>
<tr class="row-odd"><td>R(config)# cdp run</td>
<td>R(config)# lldp run</td>
</tr>
<tr class="row-even"><td>R(config)# no cdp run</td>
<td>R(config)# no lldp run</td>
</tr>
<tr class="row-odd"><td>R# show cdp interface [if-id]</td>
<td>R# show lldp interface [if-id]</td>
</tr>
<tr class="row-even"><td>R# show cdp neighbors [detail]</td>
<td>R# show lldp neighbors [detail]</td>
</tr>
<tr class="row-odd"><td>R(config-if)# cdp enable</td>
<td>R(config-if)# lldp transmit  &amp; lldp receive</td>
</tr>
<tr class="row-even"><td>R(config-if)# no cdp enable</td>
<td>R(config-if)# no lldp transmit &amp; no lldp receive</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The show cdp neighbors command can be used to prove that Layer 1 and Layer 2 connectivity exists between two Cisco devices. For example, if two devices have duplicate IP addresses, a ping between the devices will fail, but the output of show cdp neighbors will be successful. The show cdp neighbors detail could be used to verify the IP address of the directly connected device in case the same IP address is assigned to the two routers.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The show cdp neighbors detail command reveals the IP address of a neighboring device regardless of whether you can ping the neighbor</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The show cdp neighbors command provides information on directly connected Cisco devices including Device ID, local interface, capability, platform, and port ID of the remote device.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Cisco developed NetFlow for the purpose of gathering statistics on packets flowing through Cisco routers and multilayer switches. SNMP can be used to collect and store information about a device. Syslog is used to access and store system messages. NTP is used to allow network devices to synchronize time settings.</p>
</div>
</div>
</div>
<div class="section" id="ntp">
<h4>NTP<a class="headerlink" href="#ntp" title="Permalink to this headline">¶</a></h4>
<p>set clock manually (you’d be an idiot but hey learn the command)</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># clock set 20:36:00 dec 11 2015</span>
<span class="n">R1</span><span class="c1"># clock timezone PST -8</span>
<span class="n">R1</span><span class="c1"># clock summer-time PDT recurring</span>
</pre></div>
</div>
<p>Configure the Network Time Protocol (NTP)</p>
<p>When NTP is implemented in the network, it can be set up to synchronize to a private master clock or it can synchronize to a publicly available NTP server on the Internet.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">NTP uses UDP port 123 and is documented in RFC 1305.</p>
</div>
</div>
<div class="section" id="ntp-stratum-labels">
<h4>NTP Stratum Labels<a class="headerlink" href="#ntp-stratum-labels" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch10_NTP_Stratum_labels.png" src="nw/_static/img/Ch10_NTP_Stratum_labels.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The stratum level is defined as the number of hop counts from the authoritative source.</p>
</div>
<dl class="docutils">
<dt>Stratum 0</dt>
<dd>An NTP network gets the time from authoritative time sources. These authoritative time sources, also referred to as stratum 0 devices, are high-precision timekeeping devices assumed to be accurate and with little or no delay associated with them. Stratum 0 devices are represented by the clock in the figure.</dd>
<dt>Stratum 1</dt>
<dd>The stratum 1 devices are directly connected to the authoritative time sources. They act as the primary network time standard.</dd>
<dt>Stratum 2 and Lower</dt>
<dd>The stratum 2 servers are connected to stratum 1 devices through network connections. Stratum 2 devices, such as NTP clients, synchronize their time using the NTP packets from stratum 1 servers. They could also act as servers for stratum 3 devices.</dd>
<dt>Smaller stratum numbers</dt>
<dd>indicate that the server is closer to the authorized time source than larger stratum numbers. The larger the stratum number, the lower the stratum level. The <strong>max hop count is 15. Stratum 16, the lowest stratum level, indicates that a device is unsynchronized</strong>. Time servers on the <strong>same stratum level</strong> can be configured to act as a peer with other time servers on the same stratum level <strong>for backup or verification of time</strong>.</dd>
</dl>
</div>
<div class="section" id="verify-ntp-server-config">
<h4>Verify NTP Server Config<a class="headerlink" href="#verify-ntp-server-config" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch10_Verify_NTP_Server_configuration.png" src="nw/_static/img/Ch10_Verify_NTP_Server_configuration.png" />
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">command</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>show clock detail</td>
<td>check the Time Source</td>
</tr>
<tr class="row-odd"><td>show ntp associations</td>
<td>verify that R1 is synchronized with the NTP server</td>
</tr>
<tr class="row-even"><td>show ntp status</td>
<td>verify synchronization + view stratum</td>
</tr>
<tr class="row-odd"><td>S1(config)# ntp server 192.168.1.1</td>
<td>configure ntp source/server</td>
</tr>
</tbody>
</table>
<div class="code highlight-default"><div class="highlight"><pre><span></span>R2&gt;en
R2#ping 209.165.200.225

Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 209.165.200.225, timeout is 2 seconds:
.!!!!
Success rate is 80 percent (4/5), round-trip min/avg/max = 0/0/0 ms

R2#conf t
Enter configuration commands, one per line.  End with CNTL/Z.
R2(config)#ntp server 209.165.200.225
R2(config)#do show clock
15:13:8.338 UTC Wed Oct 4 2017
R2(config)#do show clock detail
15:13:12.329 UTC Wed Oct 4 2017
Time source is NTP
R2(config)#do show clock detail
15:13:32.787 UTC Wed Oct 4 2017
Time source is NTP
R2(config)#exit
R2#
%SYS-5-CONFIG_I: Configured from console by console

R2#show ntp
R2#show ntp associations
% This command is not supported by Packet Tracer.
R2#show ntp ?
  associations  NTP associations
  status        NTP status
R2#show ntp status
Clock is synchronized, stratum 2, reference is 209.165.200.225
nominal freq is 250.0000 Hz, actual freq is 249.9990 Hz, precision is 2**19
reference time is FFFFFFFFDD5548E2.00000060 (15:12:34.096 UTC Wed Oct 4 2017)
clock offset is 0.00 msec, root delay is 0.00  msec
root dispersion is 0.02 msec, peer dispersion is 0.02 msec.
R2#
</pre></div>
</div>
</div>
<div class="section" id="syslog">
<h4>Syslog<a class="headerlink" href="#syslog" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>Syslog</dt>
<dd>uses UDP port 514 to send event notification messages across IP networks to event message collectors. The protocol allows networking devices to send their system messages across the network to syslog servers</dd>
</dl>
<p>The syslog logging service provides three primary functions:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The ability to gather logging information for monitoring and troubleshooting</li>
<li>The ability to select the type of logging information that is captured</li>
<li>The ability to specify the destinations of captured syslog messages</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="syslog-intro">
<h4>Syslog intro<a class="headerlink" href="#syslog-intro" title="Permalink to this headline">¶</a></h4>
<p>On Cisco network devices, the syslog protocol starts by <strong>sending system messages and debug output to a local logging process internal to the device</strong>.
<strong>How the logging process manages these messages and outputs is based on device configurations</strong>. For example, syslog messages may be sent across the network to an external syslog server. These messages can be retrieved without the need of accessing the actual device. Log messages and outputs stored on the external server can be pulled into various reports for easier reading.</p>
<p>Alternatively, syslog messages may be sent to an internal buffer. Messages sent to the <strong>internal buffer</strong> are only viewable through the CLI of the device.</p>
<p>Finally, the network administrator may specify that only certain types of system messages are sent to various destinations. For example, the device may be configured to forward all system messages to an external syslog server. However, debug-level messages are forwarded to the internal buffer and are only accessible by the administrator from the CLI.</p>
<dl class="docutils">
<dt>popular destinations for syslog messages include</dt>
<dd><ul class="first last simple">
<li>Logging buffer (RAM inside a router or switch)</li>
<li>Console line</li>
<li>Terminal line</li>
<li>Syslog server</li>
</ul>
</dd>
</dl>
<p>It is possible to remotely monitor system messages by viewing the logs on a syslog server, or by accessing the device through Telnet, SSH, or through the console port.</p>
</div>
<div class="section" id="syslog-rfcs">
<h4>Syslog RFCs<a class="headerlink" href="#syslog-rfcs" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="85%" />
<col width="15%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">syslog relation</th>
<th class="head">RFC</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>The BSD syslog Protocol (obsoleted by RFC 5424)</td>
<td><a class="reference external" href="https://tools.ietf.org/html/rfc3164">rfc 3164</a></td>
</tr>
<tr class="row-odd"><td>Reliable Delivery for syslog</td>
<td><a class="reference external" href="https://tools.ietf.org/html/rfc3195">rfc 3195</a></td>
</tr>
<tr class="row-even"><td>The Syslog Protocol</td>
<td><a class="reference external" href="https://tools.ietf.org/html/rfc5424">rfc 5424</a></td>
</tr>
<tr class="row-odd"><td>TLS Transport Mapping for Syslog</td>
<td><a class="reference external" href="https://tools.ietf.org/html/rfc5425">rfc 5425</a></td>
</tr>
<tr class="row-even"><td>Transmission of Syslog Messages over UDP</td>
<td><a class="reference external" href="https://tools.ietf.org/html/rfc5426">rfc 5426</a></td>
</tr>
<tr class="row-odd"><td>Textual Conventions for Syslog Management</td>
<td><a class="reference external" href="https://tools.ietf.org/html/rfc5427">rfc 5427</a></td>
</tr>
<tr class="row-even"><td>Signed Syslog Messages</td>
<td><a class="reference external" href="https://tools.ietf.org/html/rfc5848">rfc 5848</a></td>
</tr>
<tr class="row-odd"><td>Datagram Transport Layer Security (DTLS) Transport Mapping for Syslog</td>
<td><a class="reference external" href="https://tools.ietf.org/html/rfc6012">rfc 6012</a></td>
</tr>
<tr class="row-even"><td>Transmission of Syslog Messages over TCP</td>
<td><a class="reference external" href="https://tools.ietf.org/html/rfc6587">rfc 6587</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="severity-level">
<h4>Severity level<a class="headerlink" href="#severity-level" title="Permalink to this headline">¶</a></h4>
<p>The list of severities is also defined by <a class="reference external" href="https://tools.ietf.org/html/rfc5424">rfc 5424</a></p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="13%" />
<col width="8%" />
<col width="13%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">value</th>
<th class="head">severity</th>
<th class="head">keyword</th>
<th class="head">depr. keyword</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>Emergency</td>
<td>emerg</td>
<td>panic</td>
<td>System is unusable
A panic condition</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>Alert</td>
<td>alert</td>
<td>&#160;</td>
<td>Action must be taken immediately
A condition that should be corrected immediately, such as a corrupted DB</td>
</tr>
<tr class="row-even"><td>2</td>
<td>Critical</td>
<td>crit</td>
<td>&#160;</td>
<td>Critical conditions, such as hard device errors</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>Error</td>
<td>err</td>
<td>error</td>
<td>Error conditions</td>
</tr>
<tr class="row-even"><td>4</td>
<td>Warning</td>
<td>warning</td>
<td>warn</td>
<td>Warning conditions</td>
</tr>
<tr class="row-odd"><td>5</td>
<td>Notice</td>
<td>notice</td>
<td>&#160;</td>
<td>Normal but significant conditions
Conditions that aren’t error conditions but require special handling</td>
</tr>
<tr class="row-even"><td>6</td>
<td>Informational</td>
<td>info</td>
<td>&#160;</td>
<td>Informational messages</td>
</tr>
<tr class="row-odd"><td>7</td>
<td>Debug</td>
<td>debug</td>
<td>&#160;</td>
<td>Debug-level messages
Messages that contain information of use only when debugging a program</td>
</tr>
</tbody>
</table>
<img alt="nw/_static/img/Ch10_Syslog_Severity_Level.png" src="nw/_static/img/Ch10_Syslog_Severity_Level.png" />
<img alt="nw/_static/img/Ch10_Syslog_Message_Format.png" src="nw/_static/img/Ch10_Syslog_Message_Format.png" />
<p>The meaning of severity levels other than Emergency and Debug are relative to the application. For example, if the purpose of the system is to process transactions to update customer account balance information, an error in the final step should be assigned Alert level. However, an error occurring in an attempt to display the ZIP code of the customer may be assigned Error or even Warning level.</p>
<p>The server process which handles the message (syslogd) usually includes all lower (more severe) levels. That is, if messages are separated by individual severity, a Warning level entry will also be included in Notice, Info and Debug processing.</p>
<p>In addition to specifying the severity, syslog messages also contain information on the facility. Syslog facilities are service identifiers that identify and categorize system state data for error and event message reporting. The logging facility options that are available are specific to the networking device. For example, Cisco 2960 Series switches running Cisco IOS Release 15.0(2) and Cisco 1941 routers running Cisco IOS Release 15.2(4) support 24 facility options that are categorized into 12 facility types.</p>
<p>Some common syslog message facilities reported on Cisco IOS routers include</p>
<ul class="simple">
<li>IP</li>
<li>OSPF protocol</li>
<li>SYS operating system</li>
<li>IP security (IPsec)</li>
<li>Interface IP (IF)</li>
</ul>
<p>By default, the format of syslog messages on the Cisco IOS Software is as follows:</p>
<p><code class="docutils literal"><span class="pre">seq</span> <span class="pre">no:</span> <span class="pre">timestamp:</span> <span class="pre">%facility-severity-MNEMONIC:</span> <span class="pre">description</span></code></p>
<p>For example, sample output on a Cisco switch for an EtherChannel link changing state to up is:</p>
<p><code class="docutils literal"><span class="pre">00:00:46:</span> <span class="pre">%LINK-3-UPDOWN:</span> <span class="pre">Interface</span> <span class="pre">Port-channel1,</span> <span class="pre">changed</span> <span class="pre">state</span> <span class="pre">to</span> <span class="pre">up</span></code></p>
<p><strong>Facility-SecurityLvl-Mnemonic:</strong>
Here the facility is <strong>LINK</strong> and the severity level is <strong>3</strong>, with a MNEMONIC of <strong>UPDOWN</strong>.</p>
<p>The most common messages are link up and down messages, and messages that a device produces when it exits from configuration mode. If ACL logging is configured, the device generates syslog messages when packets match a parameter condition.</p>
</div>
<div class="section" id="adding-a-timestamp-to-syslog-messages">
<h4>Adding a timestamp to Syslog Messages<a class="headerlink" href="#adding-a-timestamp-to-syslog-messages" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># conf t</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># shutdown</span>
<span class="o">%</span><span class="n">LINK</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">CHANGED</span><span class="p">:</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">administratively</span> <span class="n">down</span>
<span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">down</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># service timestamps log datetime</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface g0/0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no shutdown</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">1</span> <span class="mi">11</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span> <span class="o">%</span><span class="n">LINK</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">down</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">1</span> <span class="mi">11</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span> <span class="o">%</span><span class="n">LINK</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="o">*</span><span class="n">Mar</span>  <span class="mi">1</span> <span class="mi">11</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span> <span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span>
<span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
</pre></div>
</div>
<p>Use the command <code class="docutils literal"><span class="pre">service</span> <span class="pre">timestamps</span> <span class="pre">log</span> <span class="pre">datetime</span></code> to <strong>force logged events to display the date and time</strong>
Above, when the R1 GigabitEthernet 0/0 interface is reactivated, the log messages now contain the date and time.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">when using the <strong>datetime</strong> keyword, the clock on the networking device must be set, manually or through NTP</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the timestamp can include the date like <strong>Jun 12 22:09:44.643</strong></p>
</div>
<p>To view syslog messages, a syslog server must be installed on a workstation in the network.</p>
</div>
<div class="section" id="default-logging-service-settings">
<h4>Default Logging Service Settings<a class="headerlink" href="#default-logging-service-settings" title="Permalink to this headline">¶</a></h4>
<p>by default routers and switches send log messages for all security levels to the console
<code class="docutils literal"><span class="pre">logging</span> <span class="pre">console</span></code>
On some IOS version the device also <strong>buffers</strong> log messages
<code class="docutils literal"><span class="pre">logging</span> <span class="pre">buffered</span></code></p>
<p>The <code class="docutils literal"><span class="pre">show</span> <span class="pre">logging</span></code> command displays the default logging service settings on a cisco router.</p>
<img alt="nw/_static/img/Ch10_Show_logging.png" src="nw/_static/img/Ch10_Show_logging.png" />
<p>The first highlighted line states that this router logs to the console and includes debug messages. This actually means that <strong>all debug level messages, as well as any lower level messages (such as notification level messages), are logged to the console</strong>. On most Cisco IOS routers, the <strong>default severity level is 7, debugging</strong>. The output also notes that 32 such messages have been logged.</p>
<p>The second highlighted line states that this router logs to an internal buffer. Because this router has <strong>enabled logging to an internal buffer</strong>, the show logging command also lists the messages in that buffer. You can view some of the system messages that have been logged at the end of the output.</p>
</div>
<div class="section" id="syslog-configuration">
<h4>Syslog configuration<a class="headerlink" href="#syslog-configuration" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">configure destination hostname/IPv4 of the syslog server</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># logging 192.168.1.3</span>
</pre></div>
</div>
</li>
<li><p class="first">control messages to be sent to the syslog server with the <code class="docutils literal"><span class="pre">logging</span> <span class="pre">trap</span></code> command. E.g. 4 and lower(more severe) the msgs with a higher,less severe level are sent to console.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># logging trap 4</span>
</pre></div>
</div>
</li>
<li><p class="first">Optionally configure the source IF with <code class="docutils literal"><span class="pre">logging</span> <span class="pre">source-interface</span> <span class="pre">if-type</span> <span class="pre">if-number</span></code>. This specifies that <strong>syslog packets shall contain the IP of this interface</strong> regardless of what IF the packet uses to exit the router</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># logging source-interface GigabitEthernet 0/0</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="verifying-syslog">
<h4>Verifying Syslog<a class="headerlink" href="#verifying-syslog" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show logging | include changed state to up</span>
<span class="n">R1</span><span class="c1"># show logging | begin June 12 22:35</span>
</pre></div>
</div>
<div class="section" id="filter-logging-with-specific-date">
<h5>filter logging with specific date<a class="headerlink" href="#filter-logging-with-specific-date" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Oct</span> <span class="mi">30</span> <span class="mi">20</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mf">42.941</span> <span class="n">UTC</span><span class="p">:</span> <span class="o">%</span><span class="n">LINK</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Interface</span> <span class="n">Serial3</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="mf">0.6</span><span class="o">/</span><span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">down</span>
<span class="n">show</span> <span class="n">logging</span> <span class="o">|</span> <span class="n">include</span> <span class="p">(</span><span class="n">Oct</span> <span class="mi">30</span> <span class="mi">20</span><span class="p">:</span><span class="mi">44</span><span class="p">)</span><span class="o">..*</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="mf">0.6</span><span class="o">/</span><span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="capturing-traffic-epc">
<h5>capturing traffic &amp; EPC<a class="headerlink" href="#capturing-traffic-epc" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt>To capture what’s happening</dt>
<dd><p class="first">To capture what’s happening on each router you can use debug ip icmp detail and debug ip packet detail, increase the buffers and record it or send it to the console and view it in real time , if your coming over the vty log to the monitor or use term mon  which replicates like logging to the console either , logging to monitor is on by default in ios so you will see debug if you enable for a specific  feature even if buffer is not set, other than that you could setup span session and capture the traffic on either side in wireshark</p>
<p class="last">Again syslog is on by default in ios it can’t be disabled but if you don’t have logging host set it won’t actually do anything</p>
</dd>
<dt>Embedded Packet Capture (EPC)</dt>
<dd>Embedded Packet Capture (EPC) is an onboard packet capture facility that allows network administrators to capture packets flowing to, through, and from the device and to analyze them locally or save and export them for offline analysis by using a tool such as Wireshark. This feature simplifies network operations by allowing devices to become active participants in the management and operation of the network. This feature facilitates troubleshooting by gathering information about the packet format. This feature also facilitates application analysis and security.</dd>
</dl>
</div>
</div>
<div class="section" id="pt-configure-syslog-ntp">
<h4>PT Configure Syslog &amp; NTP<a class="headerlink" href="#pt-configure-syslog-ntp" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch10_PT_Syslog_NTP.png" src="nw/_static/img/Ch10_PT_Syslog_NTP.png" />
<ol class="arabic">
<li><p class="first">enable the syslog service on the syslog server via services tab
Turn it on and move the window so you can monitor actively</p>
</li>
<li><p class="first">Configure intermediary devices to use the syslog server</p>
<ul>
<li><p class="first">Configure R1 to send log events</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#logging ?</span>
<span class="n">A</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">D</span>   <span class="n">IP</span> <span class="n">address</span> <span class="n">of</span> <span class="n">the</span> <span class="n">logging</span> <span class="n">host</span>
<span class="n">buffered</span>  <span class="n">Set</span> <span class="n">buffered</span> <span class="n">logging</span> <span class="n">parameters</span>
<span class="n">console</span>   <span class="n">Set</span> <span class="n">console</span> <span class="n">logging</span> <span class="n">parameters</span>
<span class="n">host</span>      <span class="n">Set</span> <span class="n">syslog</span> <span class="n">server</span> <span class="n">IP</span> <span class="n">address</span> <span class="ow">and</span> <span class="n">parameters</span>
<span class="n">on</span>        <span class="n">Enable</span> <span class="n">logging</span> <span class="n">to</span> <span class="nb">all</span> <span class="n">enabled</span> <span class="n">destinations</span>
<span class="n">trap</span>      <span class="n">Set</span> <span class="n">syslog</span> <span class="n">server</span> <span class="n">logging</span> <span class="n">level</span>
<span class="n">userinfo</span>  <span class="n">Enable</span> <span class="n">logging</span> <span class="n">of</span> <span class="n">user</span> <span class="n">info</span> <span class="n">on</span> <span class="n">privileged</span> <span class="n">mode</span> <span class="n">enabling</span>

<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># logging 10.0.1.254</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#exit</span>
<span class="n">R1</span><span class="c1">#</span>
<span class="o">%</span><span class="n">SYS</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">CONFIG_I</span><span class="p">:</span> <span class="n">Configured</span> <span class="kn">from</span> <span class="nn">console</span> <span class="n">by</span> <span class="n">console</span>
<span class="o">%</span><span class="n">SYS</span><span class="o">-</span><span class="mi">6</span><span class="o">-</span><span class="n">LOGGINGHOST_STARTSTOP</span><span class="p">:</span> <span class="n">Logging</span> <span class="n">to</span> <span class="n">host</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.254</span> <span class="n">port</span> <span class="mi">514</span> <span class="n">started</span> <span class="o">-</span> <span class="n">CLI</span> <span class="n">initiated</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure S1 and S2 to send event to syslog server</p>
</li>
</ul>
</li>
<li><p class="first">Change the status of interfaces to create event logs</p>
<ul class="simple">
<li>configure a loopback 0 interface on R1 then disable it</li>
<li>turn off PC1 and PC2 and then turn them on again</li>
</ul>
</li>
<li><p class="first">examine the syslog events.</p>
<ul class="simple">
<li>The timestamps are incorrect!</li>
<li>Clear the log before proceeding</li>
</ul>
</li>
<li><p class="first">manually set the clocks on the switches to the current date and time</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S2</span><span class="c1">#clock set 14:57:33 September 5 2017</span>
<span class="n">S1</span><span class="c1">#clock set 15:00:00 September 5 2017</span>
</pre></div>
</div>
</li>
<li><p class="first">Enable the logging timestamp <strong>service</strong> on the switches</p>
<ul>
<li><p class="first">Configure S1 and S2 to send its timestamp with logs it sends to the syslog server</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># service timestamps log datetime msec</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># service timestamps log datetime msec</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Configure NTP Service (public ntp server). If server was private, authentication could also be used</p>
<ul>
<li><p class="first">Open the services tab of the NTP server</p>
</li>
<li><p class="first">Turn the NTP service on and not the date and time</p>
</li>
<li><p class="first">Automatically set the clock on R1 w date &amp; time according to NTP server</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ntp server 64.103.224.2</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure R1 to send its timestamp with the logs that it sends to the Syslog server</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#service timestamps log datetime msec</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Verify timestamped logs</p>
<ul class="simple">
<li>re-enable and then disable the Loopback 0 interface on R1</li>
<li>turn off laptops L1 and L2. Turn them on again.</li>
<li>Look at the syslog events</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">R1 uses the clock settings from the NTP server, S1 and S2 the clock settings configured by you</p>
</div>
<img alt="nw/_static/img/Ch10_Syslog_Service_Entries.png" src="nw/_static/img/Ch10_Syslog_Service_Entries.png" />
<p>That is one badly configured NTP server :p</p>
</li>
</ol>
</div>
<div class="section" id="lab-configuring-syslog-ntp">
<h4>LAB Configuring syslog &amp; NTP<a class="headerlink" href="#lab-configuring-syslog-ntp" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch10_Lab_syslog_NTP.png" src="nw/_static/img/Ch10_Lab_syslog_NTP.png" />
<p>Addressing Table</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="22%" />
<col width="19%" />
<col width="27%" />
<col width="19%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default GW</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R1</td>
<td>S0/0/0 (DCE)</td>
<td>10.1.1.1</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>R2</td>
<td>S0/0/0</td>
<td>10.1.1.2</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/0</td>
<td>172.16.2.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>PC-B</td>
<td>NIC</td>
<td>172.16.2.3</td>
<td>255.255.255.0</td>
<td>172.16.2.1</td>
</tr>
</tbody>
</table>
<p>In this lab, you will configure R1 as the NTP server and R2 as a Syslog and NTP client. The syslog server application, such as Tftp32d or other similar program, will be running on PC-B. Furthermore, you will control the severity level of log messages that are collected and archived on the syslog server.
Note: The routers used with CCNA hands-on labs are Cisco 1941 Integrated Services Routers (ISRs) with Cisco IOS Release 15.2(4)M3 (universal k9 image). Other routers and Cisco IOS versions can be used.</p>
<ol class="arabic">
<li><p class="first">Console into the router and enter global configuration mode.</p>
<ul>
<li><p class="first">Copy the following basic configuration and paste it to the running-configuration on the router.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">no</span> <span class="n">ip</span> <span class="n">domain</span><span class="o">-</span><span class="n">lookup</span>
<span class="n">service</span> <span class="n">password</span><span class="o">-</span><span class="n">encryption</span>
<span class="n">enable</span> <span class="n">secret</span> <span class="k">class</span>
<span class="nc">banner</span> <span class="n">motd</span> <span class="c1">#</span>
<span class="n">Unauthorized</span> <span class="n">access</span> <span class="ow">is</span> <span class="n">strictly</span> <span class="n">prohibited</span><span class="o">.</span> <span class="c1">#</span>
<span class="n">line</span> <span class="n">con</span> <span class="mi">0</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
<span class="n">logging</span> <span class="n">synchronous</span>
<span class="n">line</span> <span class="n">vty</span> <span class="mi">0</span> <span class="mi">4</span>
<span class="n">password</span> <span class="n">cisco</span>
<span class="n">login</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure the hostname as shown</p>
</li>
<li><p class="first">Apply the IP addresses to Serial and Gig interfaces according to table and activate them</p>
</li>
<li><p class="first">set the clock rate to 128000 for the DCE serial interface</p>
</li>
</ul>
</li>
<li><p class="first">Configure routing</p>
<ul class="simple">
<li>Enable RIPv2 on the routers. Add all the networks into the RIPv2 process</li>
</ul>
</li>
<li><p class="first">Configure IP and Default GW for PC-B</p>
</li>
<li><p class="first">Verify end-to-end connectivity</p>
</li>
<li><p class="first">Save running-config to startup-config</p>
</li>
<li><p class="first">Configure NTP</p>
<ul>
<li><p class="first">Configure R1 as the NTP Server and R2 as the NTP client of R1. Synchronized time is important for Syslog and debug functions</p>
</li>
<li><p class="first">Display the current time</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1">#show clock</span>
</pre></div>
</div>
</li>
<li><p class="first">Set the time. Use the clock set command</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># clock set 15:45:00 5 october 2017</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The time can also be set using the clock timezone command in the global configuration mode. For more information regarding this command, research the clock timezone command at <a class="reference external" href="https://www.cisco.com/c/en/us/td/docs/video/cds/cda/is/3_0/command_reference/Command_Ref/timezone.html">cisco timezone</a> to determine the zone for your region. UTC+1 <code class="docutils literal"><span class="pre">clock</span> <span class="pre">timezone</span> <span class="pre">WEST</span> <span class="pre">+1</span></code> configure summertime <code class="docutils literal"><span class="pre">Router(config)#</span> <span class="pre">clock</span> <span class="pre">summer-time</span> <span class="pre">WEST</span> <span class="pre">recurring</span></code></p>
</div>
</li>
<li><p class="first">Configure the NTP master
Use the <code class="docutils literal"><span class="pre">ntp</span> <span class="pre">master</span> <span class="pre">stratum--hopcountnumber</span></code>. NTP hops away from an authoritative time source.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ntp master 5</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure the NTP client</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ntp server 10.1.1.1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># ntp update-calendar</span>
</pre></div>
</div>
<p>the <code class="docutils literal"><span class="pre">ntp</span> <span class="pre">update-calendar</span></code> command periodically updates the calendar with NTP time</p>
</li>
<li><p class="first">Verify NTP configuration</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1"># show ntp associations</span>
</pre></div>
</div>
</li>
<li><p class="first">Issue show clock on R1 and R2 to compare the timestamp</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># show clock</span>
<span class="n">R2</span><span class="c1"># show clock</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Configure Syslog</p>
<ul>
<li><p class="first">install a syslog server on the pc</p>
</li>
<li><p class="first">start the syslog server on PC-B</p>
</li>
<li><p class="first">Verify that the timestamp service is enabled on R2</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># show run | include timestamp</span>
<span class="n">service</span> <span class="n">timestamps</span> <span class="n">debug</span> <span class="n">datetime</span> <span class="n">msec</span>
<span class="n">service</span> <span class="n">timestamps</span> <span class="n">log</span> <span class="n">datetime</span> <span class="n">msec</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">enabled</span><span class="p">:</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># service timestamps log datetime msec</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure R2 to send syslog messages to syslog server, PC-B</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># logging host 172.16.2.3</span>
</pre></div>
</div>
</li>
<li><p class="first">Display the default logging settings</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="c1"># show logging</span>
</pre></div>
</div>
<ul class="simple">
<li>What is the IP address of the syslog server?</li>
<li>What protocol and port is syslog using?</li>
<li>At what level is trap logging enabled?</li>
</ul>
</li>
<li><p class="first">Configure and observe the effect of logging severity levels on R2</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># logging trap ?</span>
<span class="o">&lt;</span><span class="mi">0</span><span class="o">-</span><span class="mi">7</span><span class="o">&gt;</span>          <span class="n">Logging</span> <span class="n">severity</span> <span class="n">level</span>
<span class="n">alerts</span>         <span class="n">Immediate</span> <span class="n">action</span> <span class="n">needed</span>           <span class="p">(</span><span class="n">severity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">critical</span>       <span class="n">Critical</span> <span class="n">conditions</span>               <span class="p">(</span><span class="n">severity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">debugging</span>      <span class="n">Debugging</span> <span class="n">messages</span>                <span class="p">(</span><span class="n">severity</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">emergencies</span>    <span class="n">System</span> <span class="ow">is</span> <span class="n">unusable</span>                <span class="p">(</span><span class="n">severity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">errors</span>         <span class="n">Error</span> <span class="n">conditions</span>                  <span class="p">(</span><span class="n">severity</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">informational</span>  <span class="n">Informational</span> <span class="n">messages</span>            <span class="p">(</span><span class="n">severity</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">notifications</span>  <span class="n">Normal</span> <span class="n">but</span> <span class="n">significant</span> <span class="n">conditions</span> <span class="p">(</span><span class="n">severity</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">warnings</span>       <span class="ne">Warning</span> <span class="n">conditions</span>                <span class="p">(</span><span class="n">severity</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">cr</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul>
<li><p class="first">if the <code class="docutils literal"><span class="pre">logging</span> <span class="pre">trap</span> <span class="pre">warnings</span></code> command was issued, what severity levels of msgs are logged?</p>
</li>
<li><p class="first">Change the logging severity level to 4</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># logging trap warnings</span>
<span class="ow">or</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># logging trap 4</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Create interface loopback 0 IF on R2 and observe the log messages on PC-B</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface lo 0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1">#</span>
</pre></div>
</div>
</li>
<li><p class="first">Remove the loopback 0 IF on R2 and observe logs</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># no interface lo 0</span>
</pre></div>
</div>
<ul class="simple">
<li>At severity level 4, are there any log messages on the syslog server? If any log messages appeared, explain what appeared and why</li>
</ul>
</li>
<li><p class="first">Change the logging severity to 6</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># logging trap informational</span>
<span class="ow">or</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># logging trap 6</span>
</pre></div>
</div>
</li>
<li><p class="first">Clear the syslog entries on PC-B</p>
</li>
<li><p class="first">Create the loopback 1 IF on R2</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface loopback 1</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># no interface loopback 1</span>
</pre></div>
</div>
</li>
<li><p class="first">Observe the syslog server output. Compare the results with that at trapping lvl 4</p>
</li>
</ul>
</li>
</ol>
<dl class="docutils">
<dt>Reflection</dt>
<dd>What is the problem when setting the level of severity too high or too low for syslog?</dd>
</dl>
</div>
<div class="section" id="router-file-systems">
<h4>Router File Systems<a class="headerlink" href="#router-file-systems" title="Permalink to this headline">¶</a></h4>
<p>Cisco IOS File System (IFS)</p>
<p>Although there are several file systems listed, of interest to us will be the tftp, flash, and nvram file systems.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that the flash file system also has an asterisk preceding it. This indicates that flash is the current default file system. The bootable IOS is located in flash; therefore, the pound symbol (#) is appended to the flash listing, indicating that it is a bootable disk.</p>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Router</span><span class="c1"># show file systems</span>
<span class="n">Router</span><span class="c1"># dir</span>
<span class="n">Router</span><span class="c1"># pwd</span>
<span class="n">nvram</span><span class="p">:</span><span class="o">/</span>
<span class="n">Router</span><span class="c1"># dir</span>
<span class="n">Directory</span> <span class="n">of</span> <span class="n">nvram</span><span class="p">:</span><span class="o">/</span>
<span class="o">....</span>

<span class="n">Switch</span><span class="c1"># show file systems</span>
<span class="n">File</span> <span class="n">Systems</span><span class="p">:</span>
<span class="o">....</span>
</pre></div>
</div>
</div>
<div class="section" id="backing-up-and-restoring">
<h4>Backing up and restoring<a class="headerlink" href="#backing-up-and-restoring" title="Permalink to this headline">¶</a></h4>
<div class="section" id="backup-w-text-capture-eg-tera-term">
<h5>Backup w text capture (eg Tera Term)<a class="headerlink" href="#backup-w-text-capture-eg-tera-term" title="Permalink to this headline">¶</a></h5>
<ol class="arabic simple">
<li>On the File menu, click Log.</li>
<li>Choose the location to save the file. Tera Term will begin capturing text.</li>
<li>After capture has been started, execute the show running-config or show startup-config command at the privileged EXEC prompt. Text displayed in the terminal window will be directed to the chosen file.</li>
<li>When the capture is complete, select Close in the Tera Term: Log window.</li>
<li>View the file to verify that it was not corrupted.</li>
</ol>
<p>Restoring Text Configurations</p>
<p>A configuration can be copied from a file to a device. When copied from a text file and pasted into a terminal window, the IOS executes each line of the configuration text as a command. This means that the file will require editing to ensure that encrypted passwords are in plain text and that non-command text such as “–More–” and IOS messages are removed. This process is discussed in the lab.</p>
<p>Further, at the CLI, the device must be set at the global configuration mode to receive the commands from the text file being pasted into the terminal window.</p>
<p>When using Tera Term, the steps are:</p>
<ol class="arabic simple">
<li>On the File menu, click Send file.</li>
<li>Locate the file to be copied into the device and click Open.</li>
<li>Tera Term will paste the file into the device.</li>
</ol>
<p>The text in the file will be applied as commands in the CLI and become the running configuration on the device. This is a convenient method for manually configuring a router.</p>
</div>
<div class="section" id="backup-configs-w-tftp">
<h5>Backup configs w TFTP<a class="headerlink" href="#backup-configs-w-tftp" title="Permalink to this headline">¶</a></h5>
<ol class="arabic simple">
<li>use the <code class="docutils literal"><span class="pre">copy</span> <span class="pre">running-config</span> <span class="pre">tftp</span></code> or <code class="docutils literal"><span class="pre">copy</span> <span class="pre">startup-config</span> <span class="pre">tftp</span></code> commands to backup the configs</li>
<li>use the <code class="docutils literal"><span class="pre">copy</span> <span class="pre">tftp</span> <span class="pre">running-config</span></code> or <code class="docutils literal"><span class="pre">copy</span> <span class="pre">tftp</span> <span class="pre">startup-config</span></code> commands to restore the configs</li>
</ol>
</div>
</div>
<div class="section" id="using-usb-ports">
<h4>Using USB ports<a class="headerlink" href="#using-usb-ports" title="Permalink to this headline">¶</a></h4>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># dir usbflash0:</span>
<span class="n">Directory</span> <span class="n">of</span> <span class="n">usbflash0</span><span class="p">:</span><span class="o">/</span>
<span class="mi">1</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span> <span class="mi">30125020</span> <span class="n">Dec</span> <span class="mi">22</span> <span class="mi">2032</span> <span class="mi">05</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">32</span> <span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">c3825</span><span class="o">-</span><span class="n">entservicesk9</span><span class="o">-</span><span class="n">mz</span><span class="o">.</span><span class="mi">123</span><span class="o">-</span><span class="mf">14.</span><span class="n">T</span>
<span class="mi">63158272</span> <span class="nb">bytes</span> <span class="n">total</span> <span class="p">(</span><span class="mi">33033216</span> <span class="nb">bytes</span> <span class="n">free</span><span class="p">)</span>
</pre></div>
</div>
<p>you can use the <code class="docutils literal"><span class="pre">more</span></code> command to view the the contents</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># more usbflash0:/R1-Config</span>
</pre></div>
</div>
<div class="section" id="backing-up-to-usb">
<h5>Backing up to USB<a class="headerlink" href="#backing-up-to-usb" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span>R1# copy running-config usbflash0:
Destination filename [running-config]? R1-Config
5024 bytes copied in 0.736 secs (6826 bytes/sec)
</pre></div>
</div>
</div>
<div class="section" id="restoring-from-usb">
<h5>Restoring from USB<a class="headerlink" href="#restoring-from-usb" title="Permalink to this headline">¶</a></h5>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># copy usbflash0:/R1-Config running-config</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="password-recovery">
<h4>Password Recovery<a class="headerlink" href="#password-recovery" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Enter rommon mode</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">With console access, a user can access the ROMMON mode by using a break sequence during the boot up process or removing the external flash memory when the device is powered off.</p>
</div>
</li>
<li><p class="first">Change the configuration register to <code class="docutils literal"><span class="pre">0x2142</span></code> to ignore the startup-config file</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">monitor</span><span class="p">:</span> <span class="n">command</span> <span class="s2">&quot;boot&quot;</span> <span class="n">aborted</span> <span class="n">due</span> <span class="n">to</span> <span class="n">user</span> <span class="n">interrupt</span>
<span class="n">rommon</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">confreg</span> <span class="mh">0x2142</span>
<span class="n">rommon</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="n">reset</span>
</pre></div>
</div>
</li>
<li><p class="first">make necessary changes to original startup config file</p>
</li>
<li><p class="first">save those changes</p>
</li>
<li><p class="first">apply the changes and reset config-register to <code class="docutils literal"><span class="pre">0x2102</span></code> and <code class="docutils literal"><span class="pre">reload</span></code></p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>Router# copy startup-config running-config
Destination filename [running-config]?

1450 bytes copied in 0.156 secs
Router# conf t
Router(config)# enable secret cisco
Router(config)# config-register 0x2102
Router(config)# end
Router# copy running-config startup-config
Destination filename [startup-config]?
Building configuration...
[OK]
Router# reload
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that in rommon it’s <code class="docutils literal"><span class="pre">confreg</span> <span class="pre">0x2142</span></code> and in IOS it’s <code class="docutils literal"><span class="pre">config-register</span> <span class="pre">0x2102</span></code></p>
</div>
</div>
<div class="section" id="lab-managing-device-configuration-files">
<h4>Lab - Managing Device Configuration Files<a class="headerlink" href="#lab-managing-device-configuration-files" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Build the Network and Configure Basic Device Settings</li>
<li>(Optional) Download TFTP Server Software</li>
<li>Use TFTP to Back Up and Restore the Switch Running Configuration</li>
<li>Use TFTP to Back Up and Restore the Router Running Configuration</li>
<li>Back Up and Restore Running Configurations Using Router Flash Memory</li>
<li>(Optional) Use a USB Drive to Back Up and Restore the Running Configuration</li>
</ol>
<p>Addressing Table</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="17%" />
<col width="22%" />
<col width="23%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R1</td>
<td>G0/1</td>
<td>192.168.1.1</td>
<td>255.255.255.0</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>S1</td>
<td>VLAN 1</td>
<td>192.168.1.11</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
<tr class="row-even"><td>PC-A</td>
<td>NIC</td>
<td>192.168.1.3</td>
<td>255.255.255.0</td>
<td>192.168.1.1</td>
</tr>
</tbody>
</table>
<div class="highlight-html"><div class="highlight"><pre><span></span>  g0/1    F0/5
R1 <span class="p">&lt;</span><span class="nt">--------</span><span class="p">&gt;</span> S1 <span class="p">&lt;</span><span class="nt">---------</span><span class="p">&gt;</span> PC-A
tftp            F0/6         tftp
client    tftp client        client
</pre></div>
</div>
<p>Configure basic device parameters as shown in the Addressing Table
To prevent the router and switch from attempting to translate incorrectly entered commands as though they were host names, disable DNS lookup
Assign class as the privileged EXEC encrypted password
Configure the passwords and allow login for console and vty lines using cisco as the password
Configure the default GW for S1
Encrypt clear txt passwords
Configure the IP - SM - GW for PC-A
Ping from PC-A to S1
Ping from PC-A to R1
Install and configure a TFTP server</p>
<p>The TFTP application uses the UDP Layer 4 transport protocol, which is encapsulated in an IP packet. For TFTP file transfers to function, there must be Layer 1 and 2 (Ethernet, in this case) and Layer 3 (IP) connectivity be tween the TFTP client and the TFTP server.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A common misconception is that you can TFTP a file over the console connection. This is not the case because the console connection does not use IP. The TFTP transfer can be initiated from the client device (router or switch) using the console connection, but there must be IP connectivity between the client and server for the file transfer to take place.</p>
</div>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># copy ?</span>
<span class="o">/</span><span class="n">erase</span>          <span class="n">Erase</span> <span class="n">destination</span> <span class="n">file</span> <span class="n">system</span><span class="o">.</span>
<span class="o">/</span><span class="n">error</span>          <span class="n">Allow</span> <span class="n">to</span> <span class="n">copy</span> <span class="n">error</span> <span class="n">file</span><span class="o">.</span>
<span class="o">/</span><span class="n">noverify</span>       <span class="n">Don</span><span class="s1">&#39;t verify image signature before reload.</span>
<span class="o">/</span><span class="n">verify</span>         <span class="n">Verify</span> <span class="n">image</span> <span class="n">signature</span> <span class="n">before</span> <span class="n">reload</span><span class="o">.</span>
<span class="n">archive</span><span class="p">:</span>        <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">archive</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">cns</span><span class="p">:</span>            <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">cns</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">flash0</span><span class="p">:</span>         <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">flash0</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">flash1</span><span class="p">:</span>         <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">flash1</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">flash</span><span class="p">:</span>          <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">flash</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">ftp</span><span class="p">:</span>            <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">ftp</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">http</span><span class="p">:</span>           <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">http</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">https</span><span class="p">:</span>          <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">https</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">null</span><span class="p">:</span>           <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">null</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">nvram</span><span class="p">:</span>          <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">nvram</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">rcp</span><span class="p">:</span>            <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">rcp</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">running</span><span class="o">-</span><span class="n">config</span>  <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">current</span> <span class="n">system</span> <span class="n">configuration</span>
<span class="n">scp</span><span class="p">:</span>            <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">scp</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">startup</span><span class="o">-</span><span class="n">config</span>  <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">startup</span> <span class="n">configuration</span>
<span class="n">system</span><span class="p">:</span>         <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">system</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">tar</span><span class="p">:</span>            <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">tar</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">tftp</span><span class="p">:</span>           <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">tftp</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">tmpsys</span><span class="p">:</span>         <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">tmpsys</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">xmodem</span><span class="p">:</span>         <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">xmodem</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">ymodem</span><span class="p">:</span>         <span class="n">Copy</span> <span class="kn">from</span> <span class="nn">ymodem</span><span class="p">:</span> <span class="n">file</span> <span class="n">syste</span>

<span class="n">Router</span><span class="c1"># copy usbflash1: R1-running-config-backup.txt running-config</span>
</pre></div>
</div>
<p>The flash: file system for S1 is the source file system in this example.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># copy flash: ?</span>
<span class="n">archive</span><span class="p">:</span>        <span class="n">Copy</span> <span class="n">to</span> <span class="n">archive</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">flash0</span><span class="p">:</span>         <span class="n">Copy</span> <span class="n">to</span> <span class="n">flash0</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">flash1</span><span class="p">:</span>         <span class="n">Copy</span> <span class="n">to</span> <span class="n">flash1</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">flash</span><span class="p">:</span>          <span class="n">Copy</span> <span class="n">to</span> <span class="n">flash</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">ftp</span><span class="p">:</span>            <span class="n">Copy</span> <span class="n">to</span> <span class="n">ftp</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">http</span><span class="p">:</span>           <span class="n">Copy</span> <span class="n">to</span> <span class="n">http</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">https</span><span class="p">:</span>          <span class="n">Copy</span> <span class="n">to</span> <span class="n">https</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">idconf</span>          <span class="n">Load</span> <span class="n">an</span> <span class="n">IDConf</span> <span class="n">configuration</span> <span class="n">file</span>
<span class="n">null</span><span class="p">:</span>           <span class="n">Copy</span> <span class="n">to</span> <span class="n">null</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">nvram</span><span class="p">:</span>          <span class="n">Copy</span> <span class="n">to</span> <span class="n">nvram</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">rcp</span><span class="p">:</span>            <span class="n">Copy</span> <span class="n">to</span> <span class="n">rcp</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">running</span><span class="o">-</span><span class="n">config</span>  <span class="n">Update</span> <span class="p">(</span><span class="n">merge</span> <span class="k">with</span><span class="p">)</span> <span class="n">current</span> <span class="n">system</span> <span class="n">configuration</span>
<span class="n">scp</span><span class="p">:</span>            <span class="n">Copy</span> <span class="n">to</span> <span class="n">scp</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">startup</span><span class="o">-</span><span class="n">config</span>  <span class="n">Copy</span> <span class="n">to</span> <span class="n">startup</span> <span class="n">configuration</span>
<span class="n">syslog</span><span class="p">:</span>                  <span class="n">Copy</span> <span class="n">to</span> <span class="n">syslog</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">system</span><span class="p">:</span>         <span class="n">Copy</span> <span class="n">to</span> <span class="n">system</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">tftp</span><span class="p">:</span>           <span class="n">Copy</span> <span class="n">to</span> <span class="n">tftp</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">tmpsys</span><span class="p">:</span>         <span class="n">Copy</span> <span class="n">to</span> <span class="n">tmpsys</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">xmodem</span><span class="p">:</span>         <span class="n">Copy</span> <span class="n">to</span> <span class="n">xmodem</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">ymodem</span><span class="p">:</span>         <span class="n">Copy</span> <span class="n">to</span> <span class="n">ymodem</span><span class="p">:</span> <span class="n">file</span> <span class="n">system</span>
</pre></div>
</div>
<p>Enter the copy running-config tftp: command. Provide the remote host address of the TFTP server (PC-A), 192.168.1.3. Press Enter to accept default destination filename (s1-config) or provide your own filename. The exclamation marks (!!) indicate the transfer process is in progress and is successful.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>S1# copy running-config tftp:
Address or name of remote host []?  192.168.1.3
Destination filename [s1-config]?
!!
1465 bytes copied in 0.663 secs (2210 bytes/sec)
S1#
</pre></div>
</div>
<p>The TFTP server also displays the progress during the transfer.
If you don’t have the required permissions you’ll get this error
%Error opening <a class="reference external" href="tftp://192.168.1.3/s1-config">tftp://192.168.1.3/s1-config</a> (Permission denied)</p>
<p>explore flash/usbflash as well</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># copy running-config flash:</span>
<span class="n">R1</span><span class="c1"># dir flash:</span>
<span class="n">R1</span><span class="c1"># more flash:R1-running-config-backup</span>

<span class="n">R1</span><span class="c1"># show file systems</span>
<span class="n">R1</span><span class="c1"># copy running-config usbflash0:</span>
<span class="n">R1</span><span class="c1"># dir usbflash0:</span>
<span class="n">Router</span><span class="c1"># copy usbflash1: R1-running-config-backup.txt running-config</span>
</pre></div>
</div>
</div>
<div class="section" id="ios-15-system-image-packaging">
<h4>IOS 15 System Image Packaging<a class="headerlink" href="#ios-15-system-image-packaging" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch10_Packaging_Model_4_ISR_G2_Routers.png" src="nw/_static/img/Ch10_Packaging_Model_4_ISR_G2_Routers.png" />
<p>Cisco Integrated Services Routers Generation Two (ISR G2) 1900, 2900, and 3900 Series support services on demand through the use of software licensing. The Services on Demand process enables customers to realize operational savings through ease of software ordering and management. When an order is placed for a new ISR G2 platform, the router is shipped with a single universal Cisco IOS Software image and <strong>a license is used to enable the specific feature set packages</strong>, as shown in image above.</p>
<p>There are 2 types of universal images supported in ISR G2:</p>
<blockquote>
<div><ul class="simple">
<li>Universal images with the “universalk9” designation in the image name - This universal image offers all of the Cisco IOS Software features, including strong payload cryptography features, such as IPsec VPN, SSL VPN, and Secure Unified Communications.</li>
<li>Universal images with the “universalk9_npe” designation in the image name - The strong enforcement of encryption capabilities provided by Cisco Software Activation satisfies requirements for the export of encryption capabilities. However, some countries have import requirements that require that the platform does not support any strong cryptography functionality, such as payload cryptography. To satisfy the import requirements of those countries, the npe universal image does not support any strong payload encryption.</li>
</ul>
</div></blockquote>
<p>With the ISR G2 devices, IOS image selection has been made easier because all features are included within the universal image. Features are activated through licensing. Each device ships with Universal image. The technology packages IP Base, Data, UC (Unified Communications), and SEC (Security), are enabled in the universal image using Cisco Software Activation licensing keys. Each licensing key is unique to a particular device and is obtained from Cisco by providing the product ID and serial number of the router and a Product Activation Key (PAK). The PAK is provided by Cisco at the time of software purchase. The IP Base is installed by default.</p>
</div>
<div class="section" id="ios-image-filenames">
<h4>IOS Image Filenames<a class="headerlink" href="#ios-image-filenames" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch10_Software_Image_Name.png" src="nw/_static/img/Ch10_Software_Image_Name.png" />
<ul class="simple">
<li>Image Name (c1900) - Identifies the platform on which the image runs. In this example, the platform is a Cisco 1900 router.</li>
<li>universalk9 - Specifies the image designation. The two designations for an ISR G2 are universalk9 and universalk9_npe. Universalk9_npe does not contain strong encryption and is meant for countries with encryption restrictions. Features are controlled by licensing and can be divided into four technology packages. These are IP Base, Security, Unified Communications, and Data.</li>
<li>mz - Indicates where the image runs and if the file is compressed. In this example, mz indicates that the file runs from RAM and is compressed.</li>
<li>SPA - Designates that file is digitally signed by Cisco.</li>
<li>152-4.M3 - Specifies the filename format for the image 15.2(4)M3. This is the version of IOS, which includes the major release, minor release, maintenance release, and maintenance rebuild numbers. The M indicates this is an extended maintenance release.</li>
<li>bin - The file extension. This extension indicates that this file is a binary executable file.</li>
</ul>
<p>The most common designation for memory location and compression format is mz. The first letter indicates the location where the image is executed on the router. The locations can include:</p>
<blockquote>
<div><ul class="simple">
<li>f - flash</li>
<li>m - RAM</li>
<li>r - ROM</li>
<li>l - relocatable</li>
</ul>
</div></blockquote>
<p>The compression format can be either z for zip or x for mzip. Zipping is a method Cisco uses to compress some run-from-RAM images that is effective in reducing the size of the image. It is self-unzipping, so when the image is loaded into RAM for execution, the first action is to unzip.</p>
<p>Note: The Cisco IOS Software naming conventions, field meaning, image content, and other details are subject to change.</p>
<p>Memory Requirements</p>
<p>On most Cisco routers including the integrated services routers, the IOS is stored in compact flash as a compressed image and loaded into DRAM during boot-up. The Cisco IOS Software Release 15.0 images available for the Cisco 1900 and 2900 ISR require 256MB of flash and 512MB of RAM. The 3900 ISR requires 256MB of flash and 1GB of RAM. This does not include additional management tools such as Cisco Configuration Professional (Cisco CP). For complete details, refer to the product data sheet for the specific router.</p>
<p>to backup ios image <code class="docutils literal"><span class="pre">R1#</span> <span class="pre">copy</span> <span class="pre">flash0:</span> <span class="pre">tftp:</span></code>
to restore ios image <code class="docutils literal"><span class="pre">R1#</span> <span class="pre">copy</span> <span class="pre">tftp:</span> <span class="pre">flash0:</span></code></p>
</div>
<div class="section" id="boot-system-command">
<h4>boot system command<a class="headerlink" href="#boot-system-command" title="Permalink to this headline">¶</a></h4>
<p>To upgrade to the copied IOS image after that image is saved on the router’s flash memory, configure the router to load the new image during bootup using the <code class="docutils literal"><span class="pre">boot</span> <span class="pre">system</span></code> command
Verify with <code class="docutils literal"><span class="pre">show</span> <span class="pre">version</span></code></p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># configure terminal</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># boot system flash0://c1900-universalk9-mz.SPA.152-4.M3.bin</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># exit</span>
<span class="n">R1</span><span class="c1"># copy running-config startup-config</span>
<span class="n">R1</span><span class="c1"># reload</span>
</pre></div>
</div>
<p>Copy the IPBase with strong encryption IOS image (ipbasek9) for the 1841 router from the TFTP Server to R1</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>R1# copy tftp: flash:
Address or name of remote host []? 192.168.2.254
Source filename []?  c1841-ipbasek9-mz.124-12.bin
Destination filename [c1841-ipbasek9-mz.124-12.bin]?

Accessing tftp://192.168.2.254/c1841-ipbasek9-mz.124-12.bin....
Loading c1841-ipbasek9-mz.124-12.bin from 192.168.2.254:
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
[OK - 16599160 bytes]

16599160 bytes copied in 3.44 secs (1079726 bytes/sec)
</pre></div>
</div>
<p>Verify that the IOS image has been copied to flash
How many IOS images are located in the flash:?</p>
<p>Use the <code class="docutils literal"><span class="pre">boot</span> <span class="pre">system</span></code> command to load the IPBase image on the next reload</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># boot system flash:c1841-ipbasek9-mz.124-12.bin</span>
<span class="n">Save</span> <span class="n">the</span> <span class="n">configuration</span> <span class="ow">and</span> <span class="n">reload</span> <span class="n">R1</span>

<span class="n">Verify</span> <span class="n">the</span> <span class="n">upgraded</span> <span class="n">IOS</span> <span class="n">image</span> <span class="ow">is</span> <span class="n">loaded</span> <span class="n">after</span> <span class="n">R1</span> <span class="n">reboots</span>
</pre></div>
</div>
</div>
<div class="section" id="technology-packages-licenses">
<h4>Technology Packages Licenses<a class="headerlink" href="#technology-packages-licenses" title="Permalink to this headline">¶</a></h4>
<p>What are the ISO v15 Feature sets (technology package) types we have now days with ISR G2:</p>
<ul class="simple">
<li>IP Base (ipbaseK9)come and running with any new ISR G2 routers (1900,2900,3900 Series), its entry level for Cisco IOS functionality
Offers features found in IP Base IOS image on ISR 1900, 2900, and 3900 + Flexible Netflow + IPv6 parity for IPv4 features present in IP Base. Some of the key features are AAA, BGP, OSPF, EIGRP, IS-IS, RIP, PBR, IGMP, Multicast, DHCP, HSRP, GLBP, NHRP, HTTP, HQF, QoS, ACL, NBAR, GRE, CDP, ARP, NTP, PPP, PPPoA, PPPoE, RADIUS, TACACS, SCTP, SMDS, SNMP, STP, VLAN, DTP, IGMP, Snooping, SPAN, WCCP, ISDN, ADSL over ISDN, NAT-Basic X.25, RSVP, NTP, Flexible Netflow, etc.</li>
<li>DATA (dataK9)support MPLS.ATM. Multiprotocol support
Data features found in SP Services and Enterprise Services IOS image on ISR 1900, 2900, and 3900 e.g. MPLS, BFD, RSVP, L2VPN, L2TPv3, Layer 2 Local Switching, Mobile IP, Multicast Authentication, FHRP-GLBP, IP SLAs, PfR, DECnet, ALPS, RSRB, BIP, DLSw+, FRAS, Token Ring, ISL, IPX, STUN, SNTP, SDLC, QLLC, etc.</li>
<li>Unified Commuincations (ucK9) support VOIP &amp; IP Telephony
Offers the UC Features found in IPVoice IOS image on ISR 1900, 2900, and 3900 e.g. TDM/PSTN Gateway, Video Gateway [H320/324], Voice Conferencing, Codec Transcoding, RSVP Agent (voice), FAX T.37/38, CAC/QOS, Hoot-n-Holler, etc.</li>
<li>Security (securityK9) support Cisco IOS Firewall , IPS , IPsec , 3DES, VPN
Offers the security features found in Advanced Security IOS image on ISR 1900, 2900, and 3900 e.g. IKE v1 / IPsec / PKI, IPsec/GRE, Easy VPN w/ DVTI, DMVPN, Static VTI, Firewall, Network Foundation Protection, GETVPN, etc.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The IP Base license is a prerequisite for installing the Data, Security, and Unified Communications licenses. For earlier router platforms that can support Cisco IOS Software release 15.0, a universal image is not available. It is necessary to download a separate image that contains the desired features.</p>
</div>
<p>Technology Package Licenses</p>
<p>Technology package licenses are supported on Cisco ISR G2 platforms (Cisco 1900, 2900, and 3900 Series routers). The Cisco IOS universal image contains all packages and features in one image. Each package is a grouping of technology-specific features. Multiple technology package licenses can be activated on the Cisco 1900, 2900, and 3900 series ISR platforms.</p>
<img alt="nw/_static/img/Ch10_Technology_Packages.png" src="nw/_static/img/Ch10_Technology_Packages.png" />
</div>
<div class="section" id="licensing-proces">
<h4>Licensing Proces<a class="headerlink" href="#licensing-proces" title="Permalink to this headline">¶</a></h4>
<img alt="nw/_static/img/Ch10_Licensing_Process.png" src="nw/_static/img/Ch10_Licensing_Process.png" />
<p>When a new router is shipped, it comes preinstalled with the software image and the corresponding permanent licenses for the customer-specified packages and features.</p>
<p>The router also comes with the evaluation license, known as a temporary license, for most packages and features supported on the specified router. This allows customers to try a new software package or feature by activating a specific evaluation license. If customers want to permanently activate a software package or feature on the router, they must get a new software license.</p>
<p>The figure shows the three steps to permanently activate a new software package or feature on the router.</p>
<p>for more info click here: <a class="reference external" href="https://learningnetwork.cisco.com/docs/DOC-20321">cisco licensing</a></p>
<img alt="nw/_static/img/Ch10_license_purchase.png" src="nw/_static/img/Ch10_license_purchase.png" />
<ol class="arabic simple">
<li>purchase the software package or feature needed. This may be adding a package to IP Base, such as Security.<ul>
<li>Software Claim Certificates are used for licenses that require software activation. The claim certificate provides the Product Activation Key (PAK) for the license and important information regarding the Cisco End User License Agreement (EULA). In most instances, Cisco or the Cisco channel partner will have already activated the licenses ordered at the time of purchase and no Software Claim Certificate is provided.</li>
<li>In either instance, customers receive a PAK with their purchase. The PAK serves as a receipt and is used to obtain a license. A PAK is an 11 digit alpha numeric key created by Cisco manufacturing. It defines the Feature Set associated with the PAK. A PAK is not tied to a specific device until the license is created. A PAK can be purchased that generates any specified number of licenses. As shown in the figure, a separate license is required for each package, IP Base, Data, UC, and SEC.</li>
</ul>
</li>
<li>obtain the license, which is actually a license file. A license file, also known as a Software Activation License, is obtained using one of the following options:<ul>
<li>Cisco License Manager (CLM) - This is a free software application available at <a class="reference external" href="http://www.cisco.com/go/clm">http://www.cisco.com/go/clm</a>. Cisco License Manager is a standalone application from Cisco that helps network administrators rapidly deploy multiple Cisco software licenses across their networks. Cisco License Manager can discover network devices, view their license information, and acquire and deploy licenses from Cisco. The application provides a GUI that simplifies installation and helps automate license acquisition, as well as perform multiple licensing tasks from a central location. CLM is free of charge and can be downloaded from CCO.</li>
<li>Cisco License Registration Portal - This is the web-based portal for getting and registering individual software licenses, available at <a class="reference external" href="http://www.cisco.com/go/license">http://www.cisco.com/go/license</a>.</li>
</ul>
</li>
</ol>
<p>Both of these processes require a PAK number and a Unique Device Identifier (UDI).</p>
<p>The PAK is received during purchase.</p>
<p>The UDI is a combination of the Product ID (PID), the Serial Number (SN), and the hardware version. The SN is an 11 digit number which uniquely identifies a device. The PID identifies the type of device. Only the PID and SN are used for license creation. This UDI can be displayed using the show license udi command shown in Figure 1. This information is also available on a pull-out label tray found on the device. Figure 2 shows an example of the pull-out label on a Cisco 1941 router.</p>
<p>After entering the appropriate information, the customer receives an email containing the license information to install the license file. The license file is an XML text file with a .lic extension.</p>
<p><code class="docutils literal"><span class="pre">R2#</span> <span class="pre">show</span> <span class="pre">license</span> <span class="pre">udi</span></code></p>
<ol class="arabic">
<li><p class="first">Install the license</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># license install flash0:security-CISCO1941-FHH12250057.xml</span>
<span class="o">...</span>
<span class="n">R1</span><span class="c1"># reload</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify with <code class="docutils literal"><span class="pre">show</span> <span class="pre">version</span></code> and <code class="docutils literal"><span class="pre">show</span> <span class="pre">license</span></code></p>
</li>
<li><p class="first">Activate an evaluation right-to-use license</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># license accept end user agreement</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># license boot module c1900 technology-package datak9</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># show license</span>
</pre></div>
</div>
</li>
</ol>
<p>Use the <code class="docutils literal"><span class="pre">show</span> <span class="pre">license</span> <span class="pre">feature</span></code> command to view the technology package licenses and feature licenses supported on the router.</p>
<ol class="arabic">
<li><p class="first">Backup the license</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1"># license save file-sys://lic-location</span>
<span class="n">R1</span><span class="c1"># license save flash0://all_licenses.lic</span>
<span class="n">R1</span><span class="c1"># show flash0:</span>
<span class="n">to</span> <span class="n">restore</span>
<span class="o">----------</span>
<span class="n">R1</span><span class="c1"># license install</span>
</pre></div>
</div>
</li>
</ol>
<p>To clear an active permanent license from the Cisco 1900 series, 2900 series, and 3900 series routers, perform the following steps:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Disable the technology package.</p>
<p>Disable the active license with the command:</p>
<p><code class="docutils literal"><span class="pre">Router(config)#</span> <span class="pre">license</span> <span class="pre">boot</span> <span class="pre">module</span> <span class="pre">module-name</span> <span class="pre">technology-package</span> <span class="pre">package-name</span> <span class="pre">disable</span></code></p>
<p>Reload the router using the reload command. A reload is required to make the software package inactive.</p>
</li>
<li><p class="first">Clear the license.</p>
<p>Clear the technology package license from license storage.</p>
<p><code class="docutils literal"><span class="pre">Router#</span> <span class="pre">license</span> <span class="pre">clear</span> <span class="pre">feature-name</span></code></p>
<p>Clear the license boot module command used for disabling the active license:</p>
<p><code class="docutils literal"><span class="pre">Router(config)#</span> <span class="pre">no</span> <span class="pre">license</span> <span class="pre">boot</span> <span class="pre">module</span> <span class="pre">module-name</span> <span class="pre">technology-package</span> <span class="pre">package-name</span> <span class="pre">disable</span></code></p>
</li>
</ol>
</div></blockquote>
<img alt="nw/_static/img/Ch10_clearing_license.png" src="nw/_static/img/Ch10_clearing_license.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some licenses, such as built-in licenses, cannot be cleared. Only licenses that have been added by using the license install command are removed. Evaluation licenses are not removed.</p>
</div>
<p>A lesson on ios licensing here: <a class="reference external" href="https://networklessons.com/cisco/ccna-routing-switching-icnd1-100-105/ios-licensing/">cisco licensing_lesson</a></p>
</div>
<div class="section" id="ch10-skills-integration-challenge">
<h4>Ch10 Skills Integration Challenge<a class="headerlink" href="#ch10-skills-integration-challenge" title="Permalink to this headline">¶</a></h4>
<p>Addressing Table</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="16%" />
<col width="22%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device</th>
<th class="head">Interface</th>
<th class="head">IP Address</th>
<th class="head">Subnet Mask</th>
<th class="head">Default Gateway</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#160;</td>
<td>G0/0.15</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0.30</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/0.45</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0.60</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/1/0</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>G0/0</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/0</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/1</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>G0/0</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>S0/0/0</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>S0/0/1</td>
<td>&#160;</td>
<td>255.255.255.252</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>VLAN 60</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>NIC</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
<td>DHCP Assigned</td>
</tr>
</tbody>
</table>
<p>VLANs and Port Assignments Table</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="37%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">VLAN Number - Name</th>
<th class="head">Port assignment</th>
<th class="head">Network</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>15 - Servers</td>
<td>F0/11 - F0/20</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>30 - PCs</td>
<td>F0/1 - F0/10</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>45 - Native</td>
<td>G0/1</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>60 - Management</td>
<td>VLAN 60</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ch10-practice-exam">
<h4>Ch10 practice exam<a class="headerlink" href="#ch10-practice-exam" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">A ping fails when performed from router R1 to directly connected router R2. The network administrator then proceeds to issue the show cdp neighbors command. Why would the network administrator issue this command if the ping failed between the two routers?</p>
<ul class="simple">
<li>The network administrator suspects a virus because the ping command did not work.</li>
<li>The network administrator wants to verify Layer 2 connectivity.</li>
<li>The network administrator wants to verify the IP address configured on router R2.</li>
<li>The network administrator wants to determine if connectivity can be established from a non-directly connected network.</li>
<li>Answer -&gt; <a href="#id144"><span class="problematic" id="id145">:transparent:`The network administrator wants to verify Layer 2 connectivity`</span></a></li>
</ul>
</li>
<li><p class="first">Which statement is true about CDP on a Cisco device?</p>
<ul class="simple">
<li>The show cdp neighbor detail command will reveal the IP address of a neighbor only if there is Layer 3 connectivity​.</li>
<li>To disable CDP globally, the no cdp enable command in interface configuration mode must be used.</li>
<li>CDP can be disabled globally or on a specific interface</li>
<li>Because it runs at the data link layer, the CDP protocol can only be implemented in switches.</li>
<li>Answer -&gt; <a href="#id146"><span class="problematic" id="id147">:transparent:`CDP can be disabled globally or on a specific interface`</span></a></li>
</ul>
</li>
<li><p class="first">Why would a network administrator issue the show cdp neigbors command on a router?</p>
<ul class="simple">
<li>to display device ID and other information about directly connected Cisco devices</li>
<li>to display router ID and other information about OSPF neighbors</li>
<li>to display line status and other information about directly connected Cisco devices</li>
<li>to display routing table and other information about directly connected Cisco devices</li>
<li>Answer -&gt; <a href="#id148"><span class="problematic" id="id149">:transparent:`to display device ID and other information about directly connected Cisco devices`</span></a></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. Routers R1 and R2 are connected via a serial link. One router is configured as the NTP master, and the other is an NTP client. Which two pieces of information can be obtained from the partial output of the show ntp associations detail command on R2? (Choose two.)</p>
<ul class="simple">
<li>Both routers are configured to use NTPv2</li>
<li>Router R1 is the master, and R2 is the client</li>
<li>Router R2 is the master, and R1 is the client</li>
<li>The IP address of R1 is 192.168.1.2</li>
<li>The IP address of R2 is 192.168.1.2</li>
<li>Answer -&gt; <a href="#id150"><span class="problematic" id="id151">:transparent:`Router R1 is the master, and R2 is the client &amp;&amp; The IP address of R1 is 192.168.1.2`</span></a></li>
</ul>
</li>
<li><p class="first">Which two statements are true about NTP servers in an enterprise network? (Choose two)</p>
<ul class="simple">
<li>There can only be one NTP server on an enterprise network</li>
<li>All NTP servers synchronize directly to a stratum 1 time source</li>
<li>NTP servers at stratum 1 are directly connected to an authoritative time source</li>
<li>NTP servers ensure an accurate time stamp on logging and debugging information</li>
<li>NTP servers control the mean time between failures (MTBF) for key network devices</li>
<li>Answer -&gt; <a href="#id152"><span class="problematic" id="id153">:transparent:`NTP servers at stratum 1 are directly connected to an authoritative time source &amp;&amp; NTP servers ensure an accurate time stamp on logging and debugging information`</span></a></li>
</ul>
</li>
<li><p class="first">The command ntp server 10.1.1.1 is issued on a router. What impact does this command have?</p>
<ul class="simple">
<li>determines which server to send system log files to</li>
<li>identifies the server on which to store backup configurations</li>
<li>ensures that all logging will have a time stamp associated with it</li>
<li>synchronizes the system clock with the time source with IP address 10.1.1.1</li>
<li>Answer -&gt; <a href="#id154"><span class="problematic" id="id155">:transparent:`synchronizes the system clock with the time source with IP address 10.1.1.1`</span></a></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. Which two conclusions can be drawn from the syslog message that was generated by the router? (Choose two.)</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Mar</span> <span class="mi">31</span> <span class="mi">07</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="mf">03.2323</span><span class="p">:</span> <span class="o">%</span><span class="n">LINEPROTO</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">UPDOWN</span><span class="p">:</span> <span class="n">Line</span> <span class="n">protocol</span> <span class="n">on</span> <span class="n">Interface</span> <span class="n">Serial0</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span> <span class="n">changed</span> <span class="n">state</span> <span class="n">to</span> <span class="n">up</span>
</pre></div>
</div>
<ul class="simple">
<li>This message resulted from an unusual error requiring reconfiguration of the interface.</li>
<li>This message indicates that the interface should be replaced.</li>
<li>This message is a level 5 notification message.</li>
<li>This message indicates that service timestamps have been configured.</li>
<li>This message indicates that the interface changed state five times.</li>
<li>Answer -&gt; <a href="#id156"><span class="problematic" id="id157">:transparent:`This message is a level 5 notification message &amp;&amp; This message indicates that service timestamps have been configured`</span></a></li>
</ul>
</li>
<li><p class="first">Which protocol or service allows network administrators to receive system messages that are provided by network devices?</p>
<ul class="simple">
<li>syslog</li>
<li>NTP</li>
<li>SNMP</li>
<li>NetFlow</li>
<li>Answer -&gt; <a href="#id158"><span class="problematic" id="id159">:transparent:`syslog`</span></a></li>
</ul>
</li>
<li><p class="first">Which syslog message type is accessible only to an administrator and only via the Cisco CLI?</p>
<ul class="simple">
<li>errors</li>
<li>debugging</li>
<li>emergency</li>
<li>alerts</li>
<li>Answer -&gt; <a href="#id160"><span class="problematic" id="id161">:transparent:`debugging`</span></a></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. From what location have the syslog messages been retrieved?</p>
<ul class="simple">
<li>syslog server</li>
<li>syslog client</li>
<li>router RAM</li>
<li>router NVRAM</li>
<li>Answer -&gt; <a href="#id162"><span class="problematic" id="id163">:transparent:`router RAM`</span></a></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. What does the number 17:46:26.143 represent?</p>
<ul class="simple">
<li>the time passed since the syslog server has been started</li>
<li>the time when the syslog message was issued</li>
<li>the time passed since the interfaces have been up</li>
<li>the time on the router when the show logging command was issued</li>
<li>Answer -&gt; <a href="#id164"><span class="problematic" id="id165">:transparent:`the time when the syslog message was issued`</span></a></li>
</ul>
</li>
<li><p class="first">What is used as the default event logging destination for Cisco routers and switches?</p>
<ul class="simple">
<li>terminal line</li>
<li>syslog server</li>
<li>console line</li>
<li>workstation</li>
<li>Answer -&gt; <a href="#id166"><span class="problematic" id="id167">:transparent:`console line`</span></a></li>
</ul>
</li>
<li><p class="first">A network administrator has issued the logging trap 4 global configuration mode command. What is the result of this command?</p>
<ul class="simple">
<li>After four events, the syslog client will send an event message to the syslog server</li>
<li>The syslog client will send to the syslog server any event message that has a severity level of 4 and higher</li>
<li>The syslog client will send to the syslog server any event message that has a severity level of 4 and lower</li>
<li>The syslog client will send to the syslog server event messages with an identification trap level of only 4</li>
<li>Answer -&gt; <a href="#id168"><span class="problematic" id="id169">:transparent:`The syslog client will send to the syslog server any event message that has a severity level of 4 and lower`</span></a></li>
</ul>
</li>
<li><p class="first">What is the major release number in the IOS image name c1900-universalk9-mz.SPA.152-3.T.bin?</p>
<ul class="simple">
<li>2</li>
<li>3</li>
<li>15</li>
<li>52</li>
<li>1900</li>
<li>Answer -&gt; <a href="#id170"><span class="problematic" id="id171">:transparent:`15`</span></a></li>
</ul>
</li>
<li><p class="first">What statement describes a Cisco IOS image with the “universalk9_npe” designation for Cisco ISR G2 routers?</p>
<ul class="simple">
<li>It is an IOS version that can only be used in the United States of America</li>
<li>It is an IOS version that provides only the IPBase feature set</li>
<li>It is an IOS version that offers all of the Cisco IOS Software feature sets</li>
<li>It is an IOS version that, at the request of some countries, removes any strong cryptographic functionality</li>
<li>Answer -&gt; <a href="#id172"><span class="problematic" id="id173">:transparent:`It is an IOS version that, at the request of some countries, removes any strong cryptographic functionality`</span></a></li>
</ul>
</li>
<li><p class="first">What code in the Cisco IOS 15 image filename c1900-universalk9-mz.SPA.153-3.M.bin indicates that the file is digitally signed by Cisco?</p>
<ul class="simple">
<li>SPA</li>
<li>universalk9</li>
<li>M</li>
<li>mz</li>
<li>Answer -&gt; <a href="#id174"><span class="problematic" id="id175">:transparent:`SPA`</span></a></li>
</ul>
</li>
<li><p class="first">Which two conditions should the network administrator verify before attempting to upgrade a Cisco IOS image using a TFTP server? (Choose two.)</p>
<ul class="simple">
<li>Verify the name of the TFTP server using the show hosts command</li>
<li>Verify that the TFTP server is running using the tftpdnld command</li>
<li>Verify that the checksum for the image is valid using the show version command</li>
<li>Verify connectivity between the router and TFTP server using the ping command</li>
<li>Verify that there is enough flash memory for the new Cisco IOS image using the show flash command</li>
<li>Answer -&gt; <a href="#id176"><span class="problematic" id="id177">:transparent:`Verify connectivity between the router and TFTP server using the ping command &amp;&amp; Verify that there is enough flash memory for the new Cisco IOS image using the show flash command`</span></a></li>
</ul>
</li>
<li><p class="first">A network administrator configures a router with the command sequence:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># boot system tftp://c1900-universalk9-mz.SPA.152-4.M3.bin</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># boot system rom</span>
</pre></div>
</div>
<p>What is the effect of the command sequence?</p>
<ul class="simple">
<li>On next reboot, the router will load the IOS image from ROM</li>
<li>The router will copy the IOS image from the TFTP server and then reboot the system</li>
<li>The router will load IOS from the TFTP server. If the image fails to load, it will load the IOS image from ROM</li>
<li>The router will search and load a valid IOS image in the sequence of flash, TFTP, and ROM</li>
<li>Answer -&gt; <a href="#id178"><span class="problematic" id="id179">:transparent:`The router will load IOS from the TFTP server. If the image fails to load, it will load the IOS image from ROM`</span></a></li>
</ul>
</li>
<li><p class="first">A network engineer is upgrading the Cisco IOS image on a 2900 series ISR. What command could the engineer use to verify the total amount of flash memory as well as how much flash memory is currently available?</p>
<ul class="simple">
<li>show flash0:</li>
<li>show version</li>
<li>show interfaces</li>
<li>show startup-config</li>
<li>Answer -&gt; <a href="#id180"><span class="problematic" id="id181">:transparent:`show flash0:`</span></a></li>
</ul>
</li>
<li><p class="first">Beginning with the Cisco IOS Software Release 15.0, which license is a prerequisite for installing additional technology pack licenses?</p>
<ul class="simple">
<li>IPBase</li>
<li>DATA</li>
<li>UC</li>
<li>SEC</li>
<li>Answer -&gt; <a href="#id182"><span class="problematic" id="id183">:transparent:`IPBase`</span></a></li>
</ul>
</li>
<li><p class="first">Which three software packages are available for Cisco IOS Release 15.0?</p>
<ul class="simple">
<li>DATA</li>
<li>IPVoice</li>
<li>Security</li>
<li>Enterprise Services</li>
<li>Unified Communications</li>
<li>Advanced IP Services</li>
<li>Answer -&gt; <a href="#id184"><span class="problematic" id="id185">:transparent:`DATA - Security - Unified Communications`</span></a></li>
</ul>
</li>
<li><p class="first">When a customer purchases a Cisco IOS 15.0 software package, what serves as the receipt for that customer and is used to obtain the license as well?</p>
<ul class="simple">
<li>Software Claim Certificate</li>
<li>End User License Agreement</li>
<li>Unique Device Identifier</li>
<li>Product Activation Key</li>
<li>Answer -&gt; <a href="#id186"><span class="problematic" id="id187">:transparent:`Product Activation Key`</span></a></li>
</ul>
</li>
<li><p class="first">In addition to IPBase, what are the three technology packs that are shipped within the universal Cisco IOS Software Release 15 image? (Choose three.)</p>
<ul class="simple">
<li>Advanced IP Services</li>
<li>Advanced Enterprise Services</li>
<li>DATA</li>
<li>Security</li>
<li>SP Services</li>
<li>Unified Communications</li>
<li>Answer -&gt; <a href="#id188"><span class="problematic" id="id189">:transparent:`DATA - Security - Unified Communications`</span></a></li>
</ul>
</li>
<li><p class="first">Which command would a network engineer use to find the unique device identifier of a Cisco router?</p>
<ul class="simple">
<li>show version</li>
<li>show license udi</li>
<li>show running-configuration</li>
<li>license install stored-location-url</li>
<li>Answer -&gt; <a href="#id190"><span class="problematic" id="id191">:transparent:`show license udi`</span></a></li>
</ul>
</li>
<li><p class="first">Which command is used to configure a one-time acceptance of the EULA for all Cisco IOS software packages and features?</p>
<ul class="simple">
<li>license save</li>
<li>show license</li>
<li>license boot module module-name</li>
<li>license accept end user agreement</li>
<li>Answer -&gt; <a href="#id192"><span class="problematic" id="id193">:transparent:`license accept end user agreement`</span></a></li>
</ul>
</li>
<li><p class="first">Refer to the exhibit. Match the components of the IOS image name to their description. (Not all options are used)</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">part</th>
<th class="head">description choice</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>mz</td>
<td>specifying the feature set</td>
</tr>
<tr class="row-odd"><td>15</td>
<td>minor release number</td>
</tr>
<tr class="row-even"><td>bin</td>
<td>where the image runs and if the file is compressed</td>
</tr>
<tr class="row-odd"><td>universalk9</td>
<td>platform on which the image runs</td>
</tr>
<tr class="row-even"><td>1</td>
<td>authentication type</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>maintenance release and rebuild number</td>
</tr>
<tr class="row-even"><td>M4</td>
<td>new feature release number</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>file extension</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>major release number</td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Answer</p>
</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">part</th>
<th class="head">correct description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>universalk9</td>
<td>specifying the feature set</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>minor release number</td>
</tr>
<tr class="row-even"><td>mz</td>
<td>where the image runs and if the file is compressed</td>
</tr>
<tr class="row-odd"><td>c1900</td>
<td>platform on which the image runs</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>authentication type</td>
</tr>
<tr class="row-odd"><td>M4</td>
<td>maintenance release and rebuild number</td>
</tr>
<tr class="row-even"><td>4</td>
<td>new feature release number</td>
</tr>
<tr class="row-odd"><td>bin</td>
<td>file extension</td>
</tr>
<tr class="row-even"><td>15</td>
<td>major release number</td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">A ping fails when performed from router R1 to directly connected router R2. The network administrator then proceeds to issue the show cdp neighbors command. Why would the network administrator issue this command if the ping failed between the two routers?</p>
<ul class="simple">
<li>The network administrator wants to venfy the IP address configured on router R2</li>
<li>The network administrator suspects a virus because the ping command did not work</li>
<li>The network administrator wants to verify Layer 2 connectivity</li>
<li>The network administrator wants to determine if connectivity can be established from a non-directly connected network</li>
<li>Answer <a href="#id194"><span class="problematic" id="id195">:transparent:`The network administrator wants to verify Layer 2 connectivity`</span></a></li>
</ul>
</li>
</ol>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Patrick Brunswyck.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'20170824',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>