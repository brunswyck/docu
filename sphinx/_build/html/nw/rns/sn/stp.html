

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Spanning Tree Protocol &mdash; debian &amp; networking 20171017 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Etherchannel - HSRP" href="la_hsrp.html" />
    <link rel="prev" title="Scaling VLANs" href="scaling_vlans.html" />
    <link href="../../../_static/mylayout.css" rel="stylesheet" type="text/css">


  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> debian & networking
          

          
          </a>

          
            
            
              <div class="version">
                201710
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../inhoud.html">Routing/Switching</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../basics/inhoud.html">basics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="inhoud.html">scaling networks</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="lan_design.html">LAN design</a></li>
<li class="toctree-l3"><a class="reference internal" href="scaling_vlans.html">Scaling VLANs</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Spanning Tree Protocol</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#best-paths-to-root-bridge">Best Paths to Root Bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-role-decisions">Port Role Decisions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#determine-designated-alternate-ports">Determine designated &amp; alternate ports</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stp-protocols">STP Protocols</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pvst">PVST+</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rstp">RSTP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#r-pvst">R.PVST+</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-states">Port States</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bpdu-headers">BPDU headers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#link-types">Link Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bridge-protocol-data-unit-fields">Bridge Protocol Data Unit fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="#default-switch-configuration">Default Switch Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-bridge-id">Configuring Bridge ID</a></li>
<li class="toctree-l4"><a class="reference internal" href="#portfast-n-bpdu-guard">Portfast n BPDU guard</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pvst-load-balancing">PVST+ Load Balancing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spanning-tree-mode">Spanning Tree Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-rapid-pvst">Configure Rapid PVST+</a></li>
<li class="toctree-l4"><a class="reference internal" href="#analyze-stp">ANALYZE STP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stp-troubleshooting">STP troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#switch-stacks">Switch stacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#diameter">Diameter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="la_hsrp.html">Etherchannel - HSRP</a></li>
<li class="toctree-l3"><a class="reference internal" href="la_hsrp.html#hsrp-states">HSRP States</a></li>
<li class="toctree-l3"><a class="reference internal" href="la_hsrp.html#hsrp-configuration">HSRP Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic_routing.html">Dynamic Routing</a></li>
<li class="toctree-l3"><a class="reference internal" href="eigrp.html">EIGRP</a></li>
<li class="toctree-l3"><a class="reference internal" href="ospf.html">OSPF</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../vim.html">VIM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../commands.html">BASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../git.html">GIT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripting.html">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../storage/storage.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rest.html">reStructuredText Primer</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">debian & networking</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../inhoud.html">Routing/Switching</a> &raquo;</li>
        
          <li><a href="inhoud.html">scaling networks</a> &raquo;</li>
        
      <li>Spanning Tree Protocol</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/nw/rns/sn/stp.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spanning-tree-protocol">
<h1>Spanning Tree Protocol<a class="headerlink" href="#spanning-tree-protocol" title="Permalink to this headline">¶</a></h1>
<div class="section" id="best-paths-to-root-bridge">
<h2>Best Paths to Root Bridge<a class="headerlink" href="#best-paths-to-root-bridge" title="Permalink to this headline">¶</a></h2>
<p>example</p>
<img alt="../../../_images/3_stp_best_paths.png" src="../../../_images/3_stp_best_paths.png" />
<p>the internal root path cost from S2 to the root bridge S1 over path 1 is 19 (based on the IEEE-specified individual port cost) while the internal root path cost over path 2 is 38. Because path 1 has a lower overall path cost to the root bridge, it is the preferred path. STP configures the redundant path to be blocked, which prevents a loop from occurring.</p>
<p>To verify the port and internal root path cost to the root bridge, enter the show spanning-tree command</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface f0/1</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># spanning-tree cost 25</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="c1"># end</span>
<span class="n">S2</span><span class="c1">#</span>

<span class="n">S2</span><span class="c1"># show spanning-tree</span>

<span class="n">VLAN001</span>
   <span class="n">Spanning</span> <span class="n">tree</span> <span class="n">enabled</span> <span class="n">protocol</span> <span class="n">ieee</span>
   <span class="n">Root</span> <span class="n">ID</span>    <span class="n">Priority</span>  <span class="mi">24577</span>
           <span class="n">Address</span>      <span class="mi">000</span><span class="n">A</span><span class="o">.</span><span class="mf">0033.3333</span>
           <span class="n">Cost</span>         <span class="mi">19</span>
           <span class="n">Port</span>         <span class="mi">1</span>
           <span class="n">Hello</span> <span class="n">Time</span>   <span class="mi">2</span> <span class="n">sec</span> <span class="n">Max</span> <span class="n">Age</span> <span class="mi">20</span> <span class="n">sec</span> <span class="n">Forward</span> <span class="n">Delay</span> <span class="mi">15</span> <span class="n">sec</span>

   <span class="n">Bridge</span> <span class="n">ID</span>  <span class="n">Priority</span>      <span class="mi">32769</span>  <span class="p">(</span><span class="n">priority</span> <span class="mi">32768</span> <span class="n">sys</span><span class="o">-</span><span class="nb">id</span><span class="o">-</span><span class="n">ext</span> <span class="mi">1</span><span class="p">)</span>
              <span class="n">Address</span> <span class="mi">000</span><span class="n">A</span><span class="o">.</span><span class="mf">0011.1111</span>
           <span class="n">Hello</span> <span class="n">time</span> <span class="mi">2</span> <span class="n">sec</span> <span class="n">Max</span> <span class="n">Age</span> <span class="mi">20</span> <span class="n">sec</span> <span class="n">Forward</span> <span class="n">Delay</span> <span class="mi">15</span> <span class="n">sec</span>
           <span class="n">Aging</span> <span class="n">Time</span> <span class="mi">300</span>

<span class="n">Interface</span>    <span class="n">Role</span>   <span class="n">Sts</span>  <span class="n">Cost</span>    <span class="n">Prio</span><span class="o">.</span><span class="n">Nbr</span>  <span class="n">Type</span>
<span class="o">-----------</span>  <span class="o">-----</span>  <span class="o">----</span> <span class="o">-----</span>   <span class="o">---------</span> <span class="o">-----------------</span>
<span class="n">F0</span><span class="o">/</span><span class="mi">1</span>              <span class="n">Root</span>   <span class="n">FWD</span>   <span class="mi">19</span>      <span class="mf">128.1</span>     <span class="n">Edge</span> <span class="n">P2p</span>
<span class="n">F0</span><span class="o">/</span><span class="mi">2</span>         <span class="n">Desg</span>   <span class="n">FWD</span>   <span class="mi">19</span>           <span class="mf">128.2</span>     <span class="n">Edge</span> <span class="n">P2p</span>
</pre></div>
</div>
</div>
<div class="section" id="port-role-decisions">
<h2>Port Role Decisions<a class="headerlink" href="#port-role-decisions" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Designated ports are configured for all LAN segments. When two switches are connected to the same LAN segment, and root ports have already been defined, the two switches have to decide which port to configure as a designated port and which port remains the alternate port.</p>
</div>
<ol class="arabic simple">
<li>lowest path cost to root bridge</li>
<li>lowest BID when port cost are equal</li>
</ol>
<img alt="../../../_images/3_stp_port_role_decisions.png" src="../../../_images/3_stp_port_role_decisions.png" />
</div>
<div class="section" id="determine-designated-alternate-ports">
<h2>Determine designated &amp; alternate ports<a class="headerlink" href="#determine-designated-alternate-ports" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/3_stp_designated_and_alternate.png" src="../../../_images/3_stp_designated_and_alternate.png" />
</div>
<div class="section" id="stp-protocols">
<h2>STP Protocols<a class="headerlink" href="#stp-protocols" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>802.1D-1998</dt>
<dd>The legacy standard for bridging and STP.</dd>
<dt>CST</dt>
<dd>Assumes one spanning-tree instance for the entire bridged network, regardless of the number of VLANs.</dd>
<dt>PVST+</dt>
<dd>This is a Cisco enhancement of STP that provides a separate 802.1D spanning tree instance for each VLAN configured in the network. The separate instance supports PortFast, UplinkFast, BackboneFast, BPDU guard, BPDU filter, root guard, and loop guard.</dd>
<dt>802.1D-2004</dt>
<dd>This is an updated version of the STP standard, incorporating IEEE 802.1w</dd>
<dt>Rapid Spanning Tree Protocol (RSTP) or IEEE 802.1w</dt>
<dd>This is an evolution of STP that provides faster convergence than STP</dd>
<dt>Rapid PVST+</dt>
<dd>This is a Cisco enhancement of RSTP that uses PVST+. Rapid PVST+ provides a separate instance of 802.1w per VLAN. Each separate instance supports PortFast, BPDU guard, BPDU filter, root guard, and loop guard</dd>
<dt>Multiple Spanning Tree Protocol (MSTP)</dt>
<dd>This is an IEEE standard inspired by the earlier Cisco proprietary Multiple Instance STP (MISTP) implementation. MSTP maps multiple VLANs into the same spanning tree instance. The Cisco implementation of MSTP is MST, which provides up to 16 instances of RSTP and combines many VLANs with the same physical and logical topology into a common RSTP instance. Each instance supports PortFast, BPDU guard, BPDU filter, root guard, and loop guard</dd>
</dl>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="11%" />
<col width="13%" />
<col width="10%" />
<col width="13%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Protocol</th>
<th class="head">Standard</th>
<th class="head">Resources Needed</th>
<th class="head">Convergence</th>
<th class="head">Tree Calculation</th>
<th class="head">comments</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>STP</td>
<td>802.1D</td>
<td>Low</td>
<td>Slow</td>
<td>All VLANs</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>PVST+</td>
<td>Cisco</td>
<td>High</td>
<td>Slow</td>
<td>Per VLAN</td>
<td>load balancing now, blocking port = Alt port</td>
</tr>
<tr class="row-even"><td>RSTP</td>
<td>802.1W</td>
<td>Medium</td>
<td>Fast</td>
<td>All VLANs</td>
<td>faster convergence than STP</td>
</tr>
<tr class="row-odd"><td>Rapid PVST+</td>
<td>Cisco</td>
<td>Very high</td>
<td>Fast</td>
<td>Per VLAN</td>
<td>Portfast,BPDU guard/filter,root &amp; loop guard per instance</td>
</tr>
<tr class="row-even"><td>MSTP</td>
<td>802.1S, Cisco</td>
<td>Medium or high</td>
<td>Fast</td>
<td>Per Instance</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>(cisco = per vlan en higher resources ieee = all vlans until MSTP)
Cisco switches running IOS 15.0 or later, run PVST+ by default. This version incorporates many of the specifications of IEEE 802.1D-2004, such as alternate ports in place of the former non-designated ports. However, the switches must be explicitly configured for rapid spanning tree mode in order to run the rapid spanning tree protocol</p>
</div>
<div class="section" id="pvst">
<h2>PVST+<a class="headerlink" href="#pvst" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">no load sharing, one uplink must block for all VLANS, CPU. The extended system ID ensures each switch has a unique BID for each VLAN.</p>
</div>
<p>For example, the VLAN 2 default BID would be 32770 (priority 32768, plus the extended system ID of 2). If no priority has been configured, every switch has the same default priority and the election of the root bridge for each VLAN is based on the MAC address</p>
<p>To manipulate the root-bridge election, assign a lower priority to the switch that should be selected as the root bridge for the desired VLAN(s)</p>
</div>
<div class="section" id="rstp">
<h2>RSTP<a class="headerlink" href="#rstp" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/3_stp_rstp_overview.png" src="../../../_images/3_stp_rstp_overview.png" />
<img alt="../../../_images/3_stp_rstp_overview.png" src="../../../_images/3_stp_rstp_overview.png" />
<div class="section" id="rstp-version-2-bpdu">
<h3>RSTP Version 2 BPDU<a class="headerlink" href="#rstp-version-2-bpdu" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="15%" />
<col width="10%" />
<col width="38%" />
<col width="6%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Byte Length</th>
<th class="head">&#160;</th>
<th class="head">Field Bit</th>
<th class="head">Bit</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Protocol ID=0x0000</td>
<td>2</td>
<td>&#160;</td>
<td>Topology Change</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>Protocol Version ID=0x02</td>
<td>1</td>
<td>&#160;</td>
<td>Proposal</td>
<td>1</td>
</tr>
<tr class="row-even"><td>BPDU Type=0X02</td>
<td>1</td>
<td>FLAG</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Flags</td>
<td>1</td>
<td>–&gt;</td>
<td>Port Roles</td>
<td>2-3</td>
</tr>
<tr class="row-even"><td>Root ID</td>
<td>8</td>
<td>FIELDS</td>
<td>Unknown Port</td>
<td>00</td>
</tr>
<tr class="row-odd"><td>Root Path Cost</td>
<td>4</td>
<td>&#160;</td>
<td>Alternate or Backup Port</td>
<td>01</td>
</tr>
<tr class="row-even"><td>Bridge ID</td>
<td>8</td>
<td>&#160;</td>
<td>Root Port</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>Port ID</td>
<td>2</td>
<td>&#160;</td>
<td>Designated Port</td>
<td>11</td>
</tr>
<tr class="row-even"><td>Message Age</td>
<td>2</td>
<td>&#160;</td>
<td>Learning</td>
<td>4</td>
</tr>
<tr class="row-odd"><td>Max Age</td>
<td>2</td>
<td>&#160;</td>
<td>Forwarding</td>
<td>5</td>
</tr>
<tr class="row-even"><td>Hello Time</td>
<td>2</td>
<td>&#160;</td>
<td>Agreement</td>
<td>6</td>
</tr>
<tr class="row-odd"><td>Forward Delay</td>
<td>2</td>
<td>&#160;</td>
<td>Topology Change Acknowledgment</td>
<td>7</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Bits 0 and 7 are used for topology change and acknowledgment. They are in the original 802.1D.</li>
<li>Bits 1 and 6 are used for the Proposal Agreement process (used for rapid convergence).</li>
<li>Bits 2 to 5 encode the role and state of the port.</li>
<li>Bits 4 and 5 are used to encode the port role using a 2-bit code.</li>
</ul>
<p>RSTP keeps the same BPDU format as the original IEEE 802.1D, except that the version field is set to 2 to indicate RSTP and the flags field uses all 8 bits.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">RSTP is able to actively confirm that a port can safely transition to the forwarding state without having to rely on a timer configuration.</p>
</div>
</div>
</div>
<div class="section" id="r-pvst">
<h2>R.PVST+<a class="headerlink" href="#r-pvst" title="Permalink to this headline">¶</a></h2>
<p>Rapid PVST+ commands control the configuration of VLAN spanning tree instances. A spanning tree instance is created when an interface is assigned to a VLAN and is removed when the last interface is moved to another VLAN. As well, you can configure STP switch and port parameters before a spanning tree instance is created. These parameters are applied when a spanning tree instance is created.</p>
<p>An RSTP edge port is a switch port that is never intended to be connected to another switch. It immediately transitions to the forwarding state when enabled.</p>
<p>The RSTP edge port concept corresponds to the PVST+ PortFast feature. An edge port is directly connected to an end station and assumes that no switch device is connected to it. RSTP edge ports should immediately transition to the forwarding state, thereby skipping the time-consuming original 802.1D listening and learning port states.</p>
<p>The Cisco RSTP implementation (Rapid PVST+) maintains the PortFast keyword, using the spanning-tree portfast command for edge port configuration. This makes the transition from STP to RSTP seamless.</p>
</div>
<div class="section" id="port-states">
<h2>Port States<a class="headerlink" href="#port-states" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="52%" />
<col width="9%" />
<col width="10%" />
<col width="9%" />
<col width="11%" />
<col width="9%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operation Allowed</th>
<th class="head">Blocking</th>
<th class="head">Listening</th>
<th class="head">Learning</th>
<th class="head">Forwarding</th>
<th class="head">Disabled</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Can receive and process BPDUs</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>Can forward data frames received on interface</td>
<td>NO</td>
<td>NO</td>
<td>NO</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-even"><td>Can forward data frames switched from another interface</td>
<td>NO</td>
<td>NO</td>
<td>NO</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>Can learn MAC addresses</td>
<td>NO</td>
<td>NO</td>
<td>YES</td>
<td>YES</td>
<td>NO</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="bpdu-headers">
<h2>BPDU headers<a class="headerlink" href="#bpdu-headers" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/3_stp_bpdu_headers.png" src="../../../_images/3_stp_bpdu_headers.png" />
<p>source <a class="reference external" href="http://www.abdorefky.com/wp-content/uploads/2016/11/bpdu.png">http://www.abdorefky.com/wp-content/uploads/2016/11/bpdu.png</a></p>
</div>
<div class="section" id="link-types">
<h2>Link Types<a class="headerlink" href="#link-types" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Point-to-Point:</dt>
<dd>port operating in full-duplex mode typically connects a switch to a switch and is a candidate for a rapid transition to a forwarding state</dd>
<dt>Shared:</dt>
<dd>port operating in half-duplex mode connects a switch to a hub that attaches multiple devices</dd>
</dl>
<p>Link type is automatically determined, but can be overridden with an explicit port configuration using
<cite>spanning-tree link-type { point-to-point | shared }</cite></p>
<p>Edge port connections and point-to-point connections are candidates for rapid transition to a forwarding state. However, before the link-type parameter is considered, RSTP must determine the port role.</p>
<ul class="simple">
<li>Root ports do not use the link-type parameter. Root ports are able to make a rapid transition to the forwarding state as soon as the port is in sync (receives a BPDU from the root bridge).</li>
<li>Alternate and backup ports do not use the link-type parameter in most cases.</li>
<li>Designated ports make the most use of the link-type parameter. A rapid transition to the forwarding state for the designated port occurs only if the link-type parameter is set to point-to-point.</li>
</ul>
<p>RSTP bridge port roles:</p>
<blockquote>
<div><dl class="docutils">
<dt>Root</dt>
<dd>A forwarding port that is the best port from non-root bridge to root bridge</dd>
<dt>Designated</dt>
<dd>A forwarding port for every LAN segment</dd>
<dt>Alternate</dt>
<dd>An alternate path to the root bridge. This path is different from using the root port</dd>
<dt>Backup</dt>
<dd>A backup/redundant path to a segment where another bridge port already connects</dd>
<dt>Disabled</dt>
<dd>Not strictly part of STP, a network administrator can manually disable a port</dd>
</dl>
</div></blockquote>
<p>RSTP switch port states:</p>
<blockquote>
<div><dl class="docutils">
<dt>Discarding</dt>
<dd>No user data is sent over the port</dd>
<dt>Learning</dt>
<dd>The port is not forwarding frames yet, but is populating its MAC-address-table</dd>
<dt>Forwarding</dt>
<dd>The port is fully operational</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">BPDU frame has a destination MAC address of 01:80:C2:00:00:00, which is a multicast address for the spanning tree group</p>
</div>
<p>Configure the priority for VLAN 1 on S3 to 24576 and return to privileged EXEC mode.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># spanning-tree vlan 1 priority 24576</span>
<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">Configure</span> <span class="n">S2</span> <span class="n">to</span> <span class="n">be</span> <span class="n">the</span> <span class="n">secondary</span> <span class="n">root</span> <span class="k">for</span> <span class="n">VLAN</span> <span class="mi">1</span> <span class="ow">and</span> <span class="k">return</span> <span class="n">to</span> <span class="n">privileged</span> <span class="n">EXEC</span> <span class="n">mode</span><span class="o">.</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># spanning-tree vlan 1 root secondary</span>
<span class="n">S2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">Configure</span> <span class="n">S1</span> <span class="n">to</span> <span class="n">be</span> <span class="n">the</span> <span class="n">primary</span> <span class="n">root</span> <span class="k">for</span> <span class="n">VLAN</span> <span class="mi">1</span> <span class="ow">and</span> <span class="k">return</span> <span class="n">to</span> <span class="n">privileged</span> <span class="n">EXEC</span> <span class="n">mode</span><span class="o">.</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># spanning-tree vlan 1 root primary</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">Display</span> <span class="n">the</span> <span class="n">current</span> <span class="n">spanning</span> <span class="n">tree</span> <span class="n">status</span> <span class="n">on</span> <span class="n">S1</span><span class="o">.</span>
<span class="n">S1</span><span class="c1"># show spanning-tree</span>

<span class="n">VLAN0001</span>
  <span class="n">Spanning</span> <span class="n">tree</span> <span class="n">enabled</span> <span class="n">protocol</span> <span class="n">ieee</span>
  <span class="n">Root</span> <span class="n">ID</span>    <span class="n">Priority</span>    <span class="mi">20481</span>
             <span class="n">Address</span>     <span class="mi">000</span><span class="n">A</span><span class="o">.</span><span class="mf">0033.0033</span>
             <span class="n">This</span> <span class="n">bridge</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">root</span>
             <span class="n">Hello</span> <span class="n">Time</span>   <span class="mi">2</span> <span class="n">sec</span>  <span class="n">Max</span> <span class="n">Age</span> <span class="mi">20</span> <span class="n">sec</span>  <span class="n">Forward</span> <span class="n">Delay</span> <span class="mi">15</span> <span class="n">sec</span>

  <span class="n">Bridge</span> <span class="n">ID</span>  <span class="n">Priority</span>    <span class="mi">20481</span>  <span class="p">(</span><span class="n">priority</span> <span class="mi">20480</span> <span class="n">sys</span><span class="o">-</span><span class="nb">id</span><span class="o">-</span><span class="n">ext</span> <span class="mi">1</span><span class="p">)</span>
             <span class="n">Address</span>     <span class="mi">000</span><span class="n">A</span><span class="o">.</span><span class="mf">0033.0033</span>
             <span class="n">Hello</span> <span class="n">Time</span>   <span class="mi">2</span> <span class="n">sec</span>  <span class="n">Max</span> <span class="n">Age</span> <span class="mi">20</span> <span class="n">sec</span>  <span class="n">Forward</span> <span class="n">Delay</span> <span class="mi">15</span> <span class="n">sec</span>
             <span class="n">Aging</span> <span class="n">Time</span>  <span class="mi">15</span>  <span class="n">sec</span>

<span class="n">Interface</span>           <span class="n">Role</span> <span class="n">Sts</span> <span class="n">Cost</span>      <span class="n">Prio</span><span class="o">.</span><span class="n">Nbr</span> <span class="n">Type</span>
<span class="o">-------------------</span> <span class="o">----</span> <span class="o">---</span> <span class="o">---------</span> <span class="o">--------</span> <span class="o">---------------</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>               <span class="n">Desg</span> <span class="n">FWD</span> <span class="mi">4</span>          <span class="mf">128.1</span>    <span class="n">P2p</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span>               <span class="n">Desg</span> <span class="n">FWD</span> <span class="mi">4</span>          <span class="mf">128.2</span>    <span class="n">P2p</span>
<span class="n">S1</span><span class="c1">#</span>
</pre></div>
</div>
</div>
<div class="section" id="bridge-protocol-data-unit-fields">
<h2>Bridge Protocol Data Unit fields<a class="headerlink" href="#bridge-protocol-data-unit-fields" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">Protocol</span> <span class="n">ID</span><span class="p">:</span>       <span class="mi">2</span> <span class="nb">bytes</span> <span class="p">(</span><span class="mh">0x0000</span> <span class="n">IEEE</span> <span class="mf">802.1</span><span class="n">D</span><span class="p">)</span>
<span class="mf">2.</span> <span class="n">Version</span> <span class="n">ID</span><span class="p">:</span>        <span class="mi">1</span> <span class="n">byte</span> <span class="p">(</span><span class="mh">0x00</span> <span class="n">Config</span> <span class="o">&amp;</span> <span class="n">TCN</span> <span class="o">/</span> <span class="mh">0x02</span> <span class="n">RST</span> <span class="o">/</span> <span class="mh">0x03</span> <span class="n">MST</span> <span class="o">/</span> <span class="mh">0x04</span> <span class="n">SPT</span>  <span class="n">BPDU</span><span class="p">)</span>
<span class="mf">3.</span> <span class="n">BPDU</span> <span class="n">Type</span><span class="p">:</span>         <span class="mi">1</span> <span class="n">byte</span> <span class="p">(</span><span class="mh">0x00</span> <span class="n">STP</span> <span class="n">Config</span> <span class="n">BPDU</span><span class="p">,</span> <span class="mh">0x80</span> <span class="n">TCN</span> <span class="n">BPDU</span><span class="p">,</span> <span class="mh">0x02</span> <span class="n">RST</span><span class="o">/</span><span class="n">MST</span> <span class="n">Config</span> <span class="n">BPDU</span><span class="p">)</span>
<span class="mf">4.</span> <span class="n">Flags</span><span class="p">:</span>             <span class="mi">1</span> <span class="n">byte</span>
  <span class="n">bits</span>  <span class="p">:</span> <span class="n">usage</span>
      <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span> <span class="ow">or</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">Topology</span> <span class="n">Change</span>
      <span class="mi">2</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="n">unused</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">Proposal</span> <span class="ow">in</span> <span class="n">RST</span><span class="o">/</span><span class="n">MST</span><span class="o">/</span><span class="n">SPT</span> <span class="n">BPDU</span>
    <span class="mi">3</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span> <span class="mi">00</span> <span class="p">(</span><span class="n">unused</span><span class="p">)</span> <span class="ow">or</span>
          <span class="mi">01</span> <span class="k">for</span> <span class="n">Port</span> <span class="n">Role</span> <span class="n">Alternate</span><span class="o">/</span><span class="n">Backup</span> <span class="ow">in</span> <span class="n">RST</span><span class="o">/</span><span class="n">MST</span><span class="o">/</span><span class="n">SPT</span> <span class="n">BPDU</span>
          <span class="mi">10</span> <span class="k">for</span> <span class="n">Port</span> <span class="n">Role</span> <span class="n">Root</span> <span class="ow">in</span> <span class="n">RST</span><span class="o">/</span><span class="n">MST</span><span class="o">/</span><span class="n">SPT</span> <span class="n">BPDU</span>
          <span class="mi">11</span> <span class="k">for</span> <span class="n">Port</span> <span class="n">Role</span> <span class="n">Designated</span> <span class="ow">in</span> <span class="n">RST</span><span class="o">/</span><span class="n">MST</span><span class="o">/</span><span class="n">SPT</span> <span class="n">BPDU</span>
      <span class="mi">5</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="n">unused</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">Learning</span> <span class="ow">in</span> <span class="n">RST</span><span class="o">/</span><span class="n">MST</span><span class="o">/</span><span class="n">SPT</span> <span class="n">BPDU</span>
      <span class="mi">6</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="n">unused</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">Forwarding</span> <span class="ow">in</span> <span class="n">RST</span><span class="o">/</span><span class="n">MST</span><span class="o">/</span><span class="n">SPT</span> <span class="n">BPDU</span>
      <span class="mi">7</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="n">unused</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">Agreement</span> <span class="ow">in</span> <span class="n">RST</span><span class="o">/</span><span class="n">MST</span><span class="o">/</span><span class="n">SPT</span> <span class="n">BPDU</span>
      <span class="mi">8</span> <span class="p">:</span> <span class="mi">0</span> <span class="ow">or</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">Topology</span> <span class="n">Change</span> <span class="n">Acknowledgement</span>
<span class="mf">5.</span> <span class="n">Root</span> <span class="n">ID</span><span class="p">:</span>           <span class="mi">8</span> <span class="nb">bytes</span> <span class="p">(</span><span class="n">CIST</span> <span class="n">Root</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">MST</span><span class="o">/</span><span class="n">SPT</span> <span class="n">BPDU</span><span class="p">)</span>
  <span class="n">bits</span>  <span class="p">:</span> <span class="n">usage</span>
    <span class="mi">1</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span> <span class="n">Root</span> <span class="n">Bridge</span> <span class="n">Priority</span>
   <span class="mi">5</span><span class="o">-</span><span class="mi">16</span> <span class="p">:</span> <span class="n">Root</span> <span class="n">Bridge</span> <span class="n">System</span> <span class="n">ID</span> <span class="n">Extension</span>
  <span class="mi">17</span><span class="o">-</span><span class="mi">64</span> <span class="p">:</span> <span class="n">Root</span> <span class="n">Bridge</span> <span class="n">MAC</span> <span class="n">Address</span>
<span class="mf">6.</span> <span class="n">Root</span> <span class="n">Path</span> <span class="n">Cost</span><span class="p">:</span>    <span class="mi">4</span> <span class="nb">bytes</span> <span class="p">(</span><span class="n">CIST</span> <span class="n">External</span> <span class="n">Path</span> <span class="n">Cost</span> <span class="ow">in</span> <span class="n">MST</span><span class="o">/</span><span class="n">SPT</span> <span class="n">BPDU</span><span class="p">)</span>
<span class="mf">7.</span> <span class="n">Bridge</span> <span class="n">ID</span><span class="p">:</span>         <span class="mi">8</span> <span class="nb">bytes</span> <span class="p">(</span><span class="n">CIST</span> <span class="n">Regional</span> <span class="n">Root</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">MST</span><span class="o">/</span><span class="n">SPT</span> <span class="n">BPDU</span><span class="p">)</span>
  <span class="n">bits</span>  <span class="p">:</span> <span class="n">usage</span>
    <span class="mi">1</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span> <span class="n">Bridge</span> <span class="n">Priority</span>
   <span class="mi">5</span><span class="o">-</span><span class="mi">16</span> <span class="p">:</span> <span class="n">Bridge</span> <span class="n">System</span> <span class="n">ID</span> <span class="n">Extension</span>
  <span class="mi">17</span><span class="o">-</span><span class="mi">64</span> <span class="p">:</span> <span class="n">Bridge</span> <span class="n">MAC</span> <span class="n">Address</span>
 <span class="mf">8.</span> <span class="n">Port</span> <span class="n">ID</span><span class="p">:</span>          <span class="mi">2</span> <span class="nb">bytes</span>
 <span class="mf">9.</span> <span class="n">Message</span> <span class="n">Age</span><span class="p">:</span>      <span class="mi">2</span> <span class="nb">bytes</span> <span class="ow">in</span> <span class="mi">1</span><span class="o">/</span><span class="mi">256</span> <span class="n">secs</span>
<span class="mf">10.</span> <span class="n">Max</span> <span class="n">Age</span><span class="p">:</span>          <span class="mi">2</span> <span class="nb">bytes</span> <span class="ow">in</span> <span class="mi">1</span><span class="o">/</span><span class="mi">256</span> <span class="n">secs</span>
<span class="mf">11.</span> <span class="n">Hello</span> <span class="n">Time</span><span class="p">:</span>       <span class="mi">2</span> <span class="nb">bytes</span> <span class="ow">in</span> <span class="mi">1</span><span class="o">/</span><span class="mi">256</span> <span class="n">secs</span>
<span class="mf">12.</span> <span class="n">Forward</span> <span class="n">Delay</span><span class="p">:</span>    <span class="mi">2</span> <span class="nb">bytes</span> <span class="ow">in</span> <span class="mi">1</span><span class="o">/</span><span class="mi">256</span> <span class="n">secs</span>
<span class="mf">13.</span> <span class="n">Version</span> <span class="mi">1</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">1</span> <span class="n">byte</span> <span class="p">(</span><span class="mh">0x00</span> <span class="n">no</span> <span class="n">ver</span> <span class="mi">1</span> <span class="n">protocol</span> <span class="n">info</span> <span class="n">present</span><span class="o">.</span> <span class="n">RST</span><span class="p">,</span> <span class="n">MST</span><span class="p">,</span> <span class="n">SPT</span> <span class="n">BPDU</span> <span class="n">only</span><span class="p">)</span>
<span class="mf">14.</span> <span class="n">Version</span> <span class="mi">3</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="p">(</span><span class="n">MST</span><span class="p">,</span> <span class="n">SPT</span> <span class="n">BPDU</span> <span class="n">only</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="default-switch-configuration">
<h2>Default Switch Configuration<a class="headerlink" href="#default-switch-configuration" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="61%" />
<col width="39%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Feature</th>
<th class="head">Default Setting</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Enable state</td>
<td>Enabled on VLAN 1</td>
</tr>
<tr class="row-odd"><td>Spanning-tree mode</td>
<td>PVST+ (Rapid PVST+ and MSTP are disabled.)</td>
</tr>
<tr class="row-even"><td>Switch priority</td>
<td>32768</td>
</tr>
<tr class="row-odd"><td>Spanning-tree port priority (configurable on a per-interface basis)</td>
<td>128</td>
</tr>
<tr class="row-even"><td><p class="first">Spanning-tree port cost</p>
<p class="last">(configurable on a per-interface basis)</p>
</td>
<td>1000 Mb/s: 4
100 Mb/s: 19
10 Mb/s: 100</td>
</tr>
<tr class="row-odd"><td>Spanning-tree VLAN port priority (configurable on a per-VLAN basis)</td>
<td>128</td>
</tr>
<tr class="row-even"><td><p class="first">Spanning-tree VLAN port cost</p>
<p class="last">(configurable on a per-VLAN basis)</p>
</td>
<td>1000 Mb/s: 4
100 Mb/s: 19
10 Mb/s: 100</td>
</tr>
<tr class="row-odd"><td>Spanning-tree timers</td>
<td>Hello time: 2 seconds
Forward-delay time: 15 seconds
Maximum-aging time: 20 seconds
Transmit hold count: 6 BPDUs</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuring-bridge-id">
<h2>Configuring Bridge ID<a class="headerlink" href="#configuring-bridge-id" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/3_stp_configuring_bid1.png" src="../../../_images/3_stp_configuring_bid1.png" />
<img alt="../../../_images/3_stp_configuring_bid2.png" src="../../../_images/3_stp_configuring_bid2.png" />
</div>
<div class="section" id="portfast-n-bpdu-guard">
<h2>Portfast n BPDU guard<a class="headerlink" href="#portfast-n-bpdu-guard" title="Permalink to this headline">¶</a></h2>
<p>PortFast is a Cisco feature for PVST+ environments. When a switch port is configured with PortFast that port transitions from blocking to forwarding state immediately, bypassing the usual 802.1D STP transition states (the listening and learning states). You can use PortFast on access ports to allow these devices to connect to the network immediately, rather than waiting for IEEE 802.1D STP to converge on each VLAN.
Without PortFast, a PC can send a DHCP request before the port is in forwarding state, denying the host from getting a usable IP address and other information. Because PortFast immediately changes the state to forwarding, the PC always gets a usable IP address</p>
<p>BPDU guard puts the port in an errdisabled (error-disabled) state on receipt of a BPDU. This will effectively shut down the port. The BPDU guard feature provides a secure response to invalid configurations because you must manually put the interface back into service.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>Configure FastEthernet 0/11 for portfast on S2
----------
S2(config)# interface FastEthernet 0/11
S2(config-if)# spanning-tree portfast
%Warning: portfast should only be enabled on ports connected to a single host. Connecting hubs, concentrators, switches, bridges, etc... to this interface when portfast is enabled, can cause temporary bridging loops.
Use with CAUTION
Portfast has been configured on FastEthernet0/11 but will only have effect when the interface is in a non-trunking mode.

S2(config-if)# spanning-tree bpduguard enable
S2# show running-config interface f0/11
Building configuration...

Current configuration : 90 bytes
!
interface FastEthernet0/11
 spanning-tree portfast
 spanning-tree bpduguard enable
end

Configure portfast to be the default for all interfaces on S1.

S1(config)# spanning-tree portfast default
%Warning: this command enables portfast by default on all interfaces. You should now disable portfast explicitly on switched ports leading to hubs, switches and bridges as they may create temporary bridging loops.

S1(config)# spanning-tree portfast bpduguard default

S1# show running-config | begin spanning-tree

spanning-tree mode pvst
spanning-tree portfast default
spanning-tree portfast bpduguard default
spanning-tree extend system-id
spanning-tree vlan 1 priority 0
spanning-tree vlan 10 priority 24576
spanning-tree vlan 20 priority 28672
</pre></div>
</div>
</div>
<div class="section" id="pvst-load-balancing">
<h2>PVST+ Load Balancing<a class="headerlink" href="#pvst-load-balancing" title="Permalink to this headline">¶</a></h2>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Configure</span> <span class="n">the</span> <span class="n">following</span> <span class="n">on</span> <span class="n">S3</span>

<span class="n">VLAN</span> <span class="mi">20</span> <span class="k">as</span> <span class="n">primary</span> <span class="n">root</span>
<span class="n">VLAN</span> <span class="mi">10</span> <span class="k">as</span> <span class="n">secondary</span> <span class="n">root</span>

<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># spanning-tree vlan 20 root primary</span>
<span class="n">S3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># spanning-tree vlan 10 root secondary</span>

<span class="n">Configure</span> <span class="n">the</span> <span class="n">following</span> <span class="n">on</span> <span class="n">S1</span>

<span class="n">VLAN</span> <span class="mi">10</span> <span class="k">as</span> <span class="n">primary</span> <span class="n">root</span>
<span class="n">VLAN</span> <span class="mi">20</span> <span class="k">as</span> <span class="n">secondary</span> <span class="n">root</span>
<span class="n">Set</span> <span class="n">VLAN</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">priority</span> <span class="mi">0</span>

<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># spanning-tree vlan 10 root primary</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># spanning-tree vlan 20 root secondary</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># spanning-tree vlan 1 priority 0</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># end</span>

<span class="n">Display</span> <span class="n">the</span> <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">status</span> <span class="k">for</span> <span class="n">VLAN</span> <span class="mf">1.</span>

<span class="n">S1</span><span class="c1"># show spanning-tree vlan 1</span>

<span class="n">VLAN0001</span>
  <span class="n">Spanning</span> <span class="n">tree</span> <span class="n">enabled</span> <span class="n">protocol</span> <span class="n">ieee</span>
  <span class="n">Root</span> <span class="n">ID</span>    <span class="n">Priority</span>    <span class="mi">1</span>
             <span class="n">Address</span>     <span class="mf">0019.</span><span class="n">aa9e</span><span class="o">.</span><span class="n">b000</span>
             <span class="n">This</span> <span class="n">bridge</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">root</span>
             <span class="n">Hello</span> <span class="n">Time</span>   <span class="mi">2</span> <span class="n">sec</span>  <span class="n">Max</span> <span class="n">Age</span> <span class="mi">20</span> <span class="n">sec</span>  <span class="n">Forward</span> <span class="n">Delay</span> <span class="mi">15</span> <span class="n">sec</span>

  <span class="n">Bridge</span> <span class="n">ID</span>  <span class="n">Priority</span>    <span class="mi">1</span>      <span class="p">(</span><span class="n">priority</span> <span class="mi">0</span> <span class="n">sys</span><span class="o">-</span><span class="nb">id</span><span class="o">-</span><span class="n">ext</span> <span class="mi">1</span><span class="p">)</span>
             <span class="n">Address</span>     <span class="mf">0019.</span><span class="n">aa9e</span><span class="o">.</span><span class="n">b000</span>
             <span class="n">Hello</span> <span class="n">Time</span>   <span class="mi">2</span> <span class="n">sec</span>  <span class="n">Max</span> <span class="n">Age</span> <span class="mi">20</span> <span class="n">sec</span>  <span class="n">Forward</span> <span class="n">Delay</span> <span class="mi">15</span> <span class="n">sec</span>
             <span class="n">Aging</span> <span class="n">Time</span>  <span class="mi">300</span> <span class="n">sec</span>

<span class="n">Interface</span>           <span class="n">Role</span> <span class="n">Sts</span> <span class="n">Cost</span>      <span class="n">Prio</span><span class="o">.</span><span class="n">Nbr</span> <span class="n">Type</span>
<span class="o">-------------------</span> <span class="o">----</span> <span class="o">---</span> <span class="o">---------</span> <span class="o">--------</span> <span class="o">---------------------------</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span>               <span class="n">Desg</span> <span class="n">FWD</span> <span class="mi">19</span>        <span class="mf">128.2</span>    <span class="n">P2p</span>
<span class="n">Fa0</span><span class="o">/</span><span class="mi">4</span>               <span class="n">Desg</span> <span class="n">FWD</span> <span class="mi">19</span>        <span class="mf">128.4</span>    <span class="n">P2p</span>

<span class="n">Display</span> <span class="n">the</span> <span class="n">current</span> <span class="n">configuration</span> <span class="n">filtering</span> <span class="n">the</span> <span class="n">output</span> <span class="n">to</span> <span class="n">begin</span> <span class="n">at</span> <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span><span class="o">.</span>

<span class="n">S1</span><span class="c1"># show running-config | begin spanning-tree</span>
<span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">mode</span> <span class="n">pvst</span>
<span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">extend</span> <span class="n">system</span><span class="o">-</span><span class="nb">id</span>
<span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">vlan</span> <span class="mi">1</span> <span class="n">priority</span> <span class="mi">0</span>
<span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">vlan</span> <span class="mi">10</span> <span class="n">priority</span> <span class="mi">24576</span>
<span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">vlan</span> <span class="mi">20</span> <span class="n">priority</span> <span class="mi">28672</span>
</pre></div>
</div>
</div>
<div class="section" id="spanning-tree-mode">
<h2>Spanning Tree Mode<a class="headerlink" href="#spanning-tree-mode" title="Permalink to this headline">¶</a></h2>
<p>When specifying an interface to configure, valid interfaces include physical ports, VLANs, and port channels. The VLAN ID range is 1 to 4094 when the enhanced software image (EI) is installed and 1 to 1005 when the standard software image (SI) is installed. The port-channel range is 1 to 6.</p>
</div>
<div class="section" id="configure-rapid-pvst">
<h2>Configure Rapid PVST+<a class="headerlink" href="#configure-rapid-pvst" title="Permalink to this headline">¶</a></h2>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">S1</span><span class="c1"># configure terminal</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># spanning-tree mode rapid-pvst</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># interface f0/2</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># spanning-tree link-type point-to-point</span>
<span class="n">S1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="k">if</span><span class="p">)</span><span class="c1"># end</span>
<span class="n">S1</span><span class="c1"># clear spanning-tree detected-protocols</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Generally, it is unnecessary to configure the point-to-point link-type parameter for Rapid PVST+, because it is unusual to have a shared link-type. In most cases, the only difference between configuring PVST+ and Rapid PVST+ is the spanning-tree mode rapid-pvst command.</p>
</div>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>S1# show run
!
spanning-tree mode rapid-pvst
spanning-tree extend system-id
spanning-tree vlan 1 priority 24576
spanning-tree vlan 10 priority 4096
spanning-tree vlan 20 priority 28672
!
!
S1#
</pre></div>
</div>
</div>
<div class="section" id="analyze-stp">
<h2>ANALYZE STP<a class="headerlink" href="#analyze-stp" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">command</th>
<th class="head">goal</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>show cdp neighbors</td>
<td>-&gt; discover L2 topology</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>prepare expected L2 path</td>
</tr>
<tr class="row-even"><td>show spanning-tree vlan</td>
<td>-&gt; verify root bridge switch</td>
</tr>
<tr class="row-odd"><td>show spanning-tree vlan</td>
<td>-&gt; on all switches to find out what ports are in blocking or forwarding state</td>
</tr>
<tr class="row-even"><td>show spanning-tree vlan id</td>
<td>-&gt; get STP info on particular VLAN port role/status BID n Root ID(BID of root bridge)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="stp-troubleshooting">
<h2>STP troubleshooting<a class="headerlink" href="#stp-troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>Remember that an Ethernet frame header does not include a TTL field, which means that any frame that enters a bridging loop continues to be forwarded by the switches indefinitely. The only exceptions are frames that have their destination address recorded in the MAC address table of the switches. These frames are simply forwarded to the port that is associated with the MAC address and do not enter a loop. However, any frame that is flooded by a switch enters the loop (Figure 2). This may include broadcasts, multicasts, and unicasts with a globally unknown destination MAC address.</p>
<p>In many cases, the earliest indication of this broadcast storm in progress is that routers or Layer 3 switches are reporting control plane failures and that they are running at a high CPU load.</p>
<p>The switches experience frequent MAC address table changes. If a loop exists, a switch may see a frame with a certain source MAC address coming in on one port and then see the another frame with the same source MAC address coming in on a different port a fraction of a second later. This will cause the switch to update the MAC address table twice for the same MAC address.</p>
</div>
<div class="section" id="switch-stacks">
<h2>Switch stacks<a class="headerlink" href="#switch-stacks" title="Permalink to this headline">¶</a></h2>
<p>A switch stack can consist of up to nine Catalyst 3750 switches connected through their StackWise ports. One of the switches controls the operation of the stack and is called the stack master. The stack master and the other switches in the stack are stack members. Layer 2 and Layer 3 protocols present the entire switch stack as a single entity to the network.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>Switch# show running-config | begin interface
interface GigabitEthernet1/0/1
!
interface GigabitEthernet1/0/2
!
interface GigabitEthernet1/0/3
!
output omitted
!
interface GigabitEthernet1/0/52
!
interface GigabitEthernet2/0/1
!
interface GigabitEthernet2/0/2
!
...
!
interface GigabitEthernet2/0/52
!
interface GigabitEthernet3/0/1
!
interface GigabitEthernet3/0/2
!
&amp;lt;output omitted&amp;gt;
!
interface GigabitEthernet3/0/52
!
interface GigabitEthernet4/0/1
!
interface GigabitEthernet4/0/2
!
...
!
interface GigabitEthernet4/0/52
!
Switch#
</pre></div>
</div>
<p>Switch stacks help to maintain or reduce the impact of diameter on STP reconvergence. In a switch stack, all switches use the same bridge ID for a given spanning-tree instance.</p>
</div>
<div class="section" id="diameter">
<h2>Diameter<a class="headerlink" href="#diameter" title="Permalink to this headline">¶</a></h2>
<p>The ability to add more switches to a single STP instance without increasing the STP diameter. The diameter is the maximum number of switches that data must cross to connect any two switches.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The IEEE recommends a maximum diameter of seven switches for the default STP timers. For example, in Figure 1 the diameter from S1-4 to S3-4 is nine switches. This design violates the IEEE recommendation.</p>
</div>
<ul class="simple">
<li><dl class="first docutils">
<dt>Hello Timer (2 seconds)</dt>
<dd>The interval between BPDU updates.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Max Age Timer (20 seconds)</dt>
<dd>The maximum length of time a switch saves BPDU information.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Forward Delay Timer (15 seconds)</dt>
<dd>The time spent in the listening and learning states.</dd>
</dl>
</li>
</ul>
<p><a class="reference external" href="http://www.cisco.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/19120-122.html">http://www.cisco.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/19120-122.html</a></p>
<p>Use show commands to locate Layer 2 switch information</p>
<ol class="loweralpha simple">
<li>show version</li>
<li>show cdp neighbors detail</li>
<li>show spanning-tree</li>
</ol>
<p>PVST+ is the default configuration of IEEE 802.1D on Cisco switches. It runs one instance of STP for each VLAN. A newer, faster-converging spanning tree protocol, RSTP, can be implemented on Cisco switches on a per-VLAN basis in the form of Rapid PVST+. Multiple Spanning Tree (MST) is the Cisco implementation of Multiple Spanning Tree Protocol (MSTP), where one instance of spanning tree runs for a defined group of VLANs. Features such as PortFast and BPDU guard ensure that hosts in the switched environment are provided immediate access to the network without interfering with spanning tree operation.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="la_hsrp.html" class="btn btn-neutral float-right" title="Etherchannel - HSRP" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="scaling_vlans.html" class="btn btn-neutral" title="Scaling VLANs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Patrick Brunswyck.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'20171017',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>