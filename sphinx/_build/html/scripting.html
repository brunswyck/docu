

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Scripting &mdash; debian &amp; networking 20170824 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="debian &amp; networking 20170824 documentation" href="index.html"/>
        <link rel="next" title="Storage" href="storage/storage.html"/>
        <link rel="prev" title="GIT" href="git.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> debian & networking
          

          
          </a>

          
            
            
              <div class="version">
                201708
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="nw/rns/routing_n_switching.html">Routing/Switching</a></li>
<li class="toctree-l1"><a class="reference internal" href="vim.html">VIM</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">BASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="git.html">GIT</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Scripting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#bash">BASH</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#functions">functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#run-commands-in-script-as-sudo">run commands in script as sudo</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="storage/storage.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest.html">reStructuredText Primer</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">debian & networking</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Scripting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/scripting.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scripting">
<h1>Scripting<a class="headerlink" href="#scripting" title="Permalink to this headline">¶</a></h1>
<div class="section" id="bash">
<h2>BASH<a class="headerlink" href="#bash" title="Permalink to this headline">¶</a></h2>
<div class="section" id="functions">
<h3>functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>funcky() { echo &quot;this is a funky function&quot;; echo; } # compacted needs semicolon

a function call is the equivalent to a command

simple functions
----------------

#!/bin/bash
JUST_A_SECOND=1 # uppercase for constant

funcky()
{
  echo &quot;simple function.&quot;
} # function call --&gt; after declaration!

fun ()
{
  i=0
  REPEATS=30

  echo &quot;And now the fun really begins.&quot;

  sleep $JUST_A_SECOND
  while [ $i -lt $REPEATS ]
  do
    echo &quot;&lt;-------i is $i---------&gt;&quot;
    echo &quot;&lt;-- $REPEATS-$i: left --&gt;&quot;
    let &quot;i+=1&quot;
  done
}

funky
fun

exit $?
</pre></div>
</div>
<div class="section" id="run-commands-in-script-as-sudo">
<h4>run commands in script as sudo<a class="headerlink" href="#run-commands-in-script-as-sudo" title="Permalink to this headline">¶</a></h4>
<p><strong>Use the NOPASSWD directive</strong></p>
<p>You can use the NOPASSWD directive in your <code class="docutils literal"><span class="pre">/etc/sudoers</span> <span class="pre">file</span></code>.</p>
<p>If your user is called user and your host is called host you could add these lines to /etc/sudoers:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="n">host</span> <span class="o">=</span> <span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">NOPASSWD</span><span class="p">:</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">shutdown</span>
<span class="n">user</span> <span class="n">host</span> <span class="o">=</span> <span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">NOPASSWD</span><span class="p">:</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">reboot</span>
</pre></div>
</div>
<p>This will allow the user user to run the desired commands on host without entering a password. All other sudoed commands will still require a password.</p>
<p>The commands specified in the sudoers file must be fully qualified (i.e. using the absolute path to the command to run) as described in the sudoers man page. Providing a relative path is considered a syntax error.</p>
<p>If the command ends with a trailing / character and points to a directory, the user will be able to run any command in that directory (but not in any sub-directories therein). In the following example, the user user can run any command in the directory /home/someuser/bin/:</p>
<p><code class="docutils literal"><span class="pre">user</span> <span class="pre">host</span> <span class="pre">=</span> <span class="pre">(root)</span> <span class="pre">NOPASSWD:</span> <span class="pre">/home/someuser/bin/</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Always use the command visudo to edit the sudoers file to make sure you do not lock yourself out of the system – just in case you accidentally write something incorrect to the sudoers file. visudo will save your modified file to a temporary location and will only overwrite the real sudoers file if the modified file can be parsed without errors.</p>
</div>
<p><strong>Using /etc/sudoers.d instead of modifying /etc/sudoers</strong></p>
<p>As an alternative to editing the /etc/sudoers file, you could add the two lines to a new file in /etc/sudoers.d e.g. /etc/sudoers.d/shutdown. This is an elegant way of separating different changes to the sudo rights and also leaves the original sudoers file untouched for easier upgrades.</p>
<p><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">visudo</span> <span class="pre">-f</span> <span class="pre">/etc/sudoers.d/shutdown</span></code></p>
<p>This also automatically ensures that the owner and permissions of the new file is set correctly.</p>
<p>example for DHCP
::
# User alias specification
User_Alias DHCPUSERS = guru, patrick
# Cmnd alias specification
Cmnd_Alias DHCP = /usr/sbin/dhclient
# User privilege specification
root    ALL=(ALL:ALL) ALL
DHCPUSERS       ALL = NOPASSWD: DHCP</p>
<div class="section" id="if-sudoers-is-messed-up">
<h5>If sudoers is messed up<a class="headerlink" href="#if-sudoers-is-messed-up" title="Permalink to this headline">¶</a></h5>
<p>If you did not use visudo to edit your files and then accidentally messed up /etc/sudoers or messed up a file in /etc/sudoers.d then you will be locked out of sudo.</p>
<p>The solution could be to fix the files using pkexec which is an alternative to sudo.</p>
<p>To fix /etc/sudoers:</p>
<p><code class="docutils literal"><span class="pre">pkexec</span> <span class="pre">visudo</span></code></p>
<p>To fix /etc/sudoers.d/shutdown:</p>
<p><code class="docutils literal"><span class="pre">pkexec</span> <span class="pre">visudo</span> <span class="pre">-f</span> <span class="pre">/etc/sudoers.d/shutdown</span></code></p>
<p>If the ownership and/or permissions are incorrect for any sudoers file, the file will be ignored by sudo so you might also find yourself locked out in this situation. Again, you can use pkexec to fix this.</p>
<p>The correct permissions should be like this:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ls -l /etc/sudoers.d/shutdown
-r--r----- 1 root root 86 Jul 16 15:37 /etc/sudoers.d/shutdown

Use pkexec like this to fix ownership and permissions:

pkexec chown root:root /etc/sudoers.d/shutdown
pkexec chmod 0440 /etc/sudoers.d/shutdown
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="storage/storage.html" class="btn btn-neutral float-right" title="Storage" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="git.html" class="btn btn-neutral" title="GIT" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Patrick Brunswyck.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'20170824',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>